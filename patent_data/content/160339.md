# IMPROVEMENTS IN OR RELATING TO DIRECT MODULATION FM DATA RECEIVERS

## Claims
FM Datenempfänger für Direkt Frequenzmodulation mit einer Mischstufe 14 mit einem ersten Eingang zum Empfangen eines direkt modulierten FM Signals mit zwei Signalisierfrequenzen f

## Description
The present invention relates to improvements in or relating to direct modulation FM data receivers in which a local oscillator frequency is located between two signalling frequencies thereby deliberately folding the transmitted spectrum about d.c. More particularly the present invention relates to automatic frequency control in such receivers which may be used in receiving and demodulating frequency shift keyed F.S.K signals as may be used in digital paging in which the bit rate, for example 512 bits second is lower than the deviation Δf , for example 4.5kHz. A direct modulation FM data receiver in which a local oscillator frequency is located between two signalling frequencies is disclosed in British Patent Specification 2109201A details of which are incorporated herein by way of reference. This known receiver comprises a mixer having a first input for receiving a directly modulated FM signal with deviation Δf and a second input for a local oscillator signal having a frequency within the signal channel but offset from the input signal carrier frequency by an amount δ f , and demodulating means for distinguishing between the signalling tones Δf δf and Δf δf and deriving an output data signal therefrom. An important consideration in such receivers which for convenience will be referred to as offset receivers is frequency stability of the carrier frequency and the local oscillator frequency. Ideally there should be a constant frequency difference between them in order to maintain a constant frequency spacing between the low and high frequency tones. For example with a deviation or centre frequency of 4.5 kHz and an offset of 2.25 kHz then the lower frequency tone will be 2.25 kHz and the higher frequency tone will be 6.75 kHz. If the local oscillator frequency should drift further from the transmitter carrier by say 2 kHz then the effect will be to increase the frequency separation between the tones so that their respective frequencies are 250Hz and 8.75 kHz. Consequently the frequency discriminator has to work over the ends of a range from say d.c. to 9 kHz which is not desirable because the performance of the discriminator drops off at tone frequencies below the bit rate. Alternatively if the local oscillator frequency should drift closer to the carrier frequency then the frequency separation between the tones diminishes, making the demodulation of the tones more difficult. When the carrier and local oscillator frequencies are the same then other receiver architectures have to be used. Mistuning of up to 2 kHz in either direction is possible because local oscillator frequency drifts of up to 1 kHz at VHF can be expected and also in some transmission systems transmitter offsets of up to 1 kHz are introduced. Accordingly there is a need for an automatic frequency control system in such receivers. British Patent Specification 2109201A discloses two alternative AFC systems. Each has its own disadvantages, in the case of the simpler AFC system in which a low pass filter is coupled between the receiver output and a control input of a local oscillator, it was found that the trimming of two bandpass filters used in the demodulating means was critical to avoid spurious locking positions. The second AFC system required providing another mixer and local oscillator coupled to the output of the first mentioned mixer as well as a frequency discriminator whose output is coupled to a control input of the local oscillator. Although this second AFC system has been shown to work it is nevertheless somewhat complicated. Accordingly it is an object to provide a simple and effective AFC system for an offset receiver. According to the present invention there is provided a direct modulation FM data receiver comprising a mixer having a first input for receiving a directly modulated FM signal having two signalling frequencies f Compared with the AFC systems, disclosed in British Patent Specification No. 2109201A, the system incorporated into the receiver made in accordance with the present invention is simple in its construction and operation. Also as it can operate with both high and low frequency tones, the AFC system is substantially independent of the actual data signal being received. Further one is able to have the other advantages of an AFC system of ensuring a proper separation of the high and low frequency tones so that the discriminator performance is optimum. Additionally in the case of having a transmission system which does not have deliberate offsets, then one can use narrower channels, say 12,5 kHz, rather than the present channel width of 25 kHz. US A 4 103 244 discloses an FSK demodulator for signals f₀ and f₁ which respectively represent digital signals such as 0 and 1 . The demodulator includes an AFC circuit which operates so that the local oscillator frequency in the receiver tracks the frequency drift in the transmitter. The AFC circuit includes a frequency discriminator which is constructed so as to have n frequency stable points, for example, in correspondence to an n level FSK signal. A dc component is derived by low pass filtering the output from the frequency discriminator and is used to control a local oscillator. Various embodiments of an AFC circuit are disclosed but none are relevant to a direct modulation FM data receiver in which the local oscillator frequency is deliberately offset from a nominal carrier frequency by an amount less than the deviation frequency and it is desired to preserve the offset in order to be able to recover the desired signals using a simple demodulating means. An AFC system for an FM receiver is also known from British Patent Specification No. 2059702A. However unlike the offset receiver to which the present invention relates, the AFC system tunes a local oscillator whose frequency remains to one side of the transmitted signal. In this known receiver a conventional discriminator can be used to generate the appropriate AFC transfer function which is linear. By increasing the loop gain and lengthening the time constant of the AFC loop, to prevent the local oscillator following the modulation, a predetermined offset can be maintained between the local oscillator and the transmitted carrier. This can only be achieved as long as the transmitted signal remains on the correct side of the local oscillator, the nominal offset from which must be greater than the deviation. Such an arrangement cannot be used when the offset is smaller than the deviation because a non linear discriminator transfer characteristic must be used. The realisation of such a non linear discriminator transfer characteristic can be done very simply. In one embodiment of the present invention the AFC feedback path has a substantially symmetrical triangular voltage frequency transfer function with a vertex of the transfer function occurring at the deviation frequency Δf and an output of said means is coupled to a frequency control input of the local oscillator. The vertex of the substantially triangular voltage frequency transfer function may occur at a maximum or a minimum voltage. Such a transfer function enables the correct AFC output to be obtained for both of said signalling tones. The AFC feedback path in the receiver made in accordance with the present invention may be implemented in an analogue or digital form. An analogue implementation of the AFC feedback path having a substantially triangular transfer function with a vertex at a maximum voltage, comprises a multiplier having one input coupled to the output of the mixer and another input connected to an output of a delay device whose input is coupled to the mixer. A smoothing circuit is connected to the output of the multiplier to remove the high frequency product term and also it defines the time constant of the AFC system. A digital implementation of the AFC feedback path comprises coupling a voltage limiter circuit to the output of the mixer, coupling the output of the voltage limiter circuit and a delayed version thereof to respective inputs of an Exclusive OR circuit. An output of the Exclusive OR circuit is coupled to a smoothing circuit which supplies the control voltage to the local oscillator. The means for delaying output of the voltage limiter circuit may comprise a shift register having at least 8 stages. By having at least 8 stages in the shift register then a high clock frequency can be used which will avoid problems caused by the input frequency and the clock frequency being harmonically related. Whilst it would be advantageous to use a larger shift register and a higher clock frequency there are penalties in the form of cost of the shift register and a higher power consumption of the clock generator. In another embodiment of the present invention the AFC feedback path further comprises a low pass filter which provides the loop filter function and also combines the AFC signals resulting from the reception of the two signalling frequencies. The transfer function is derived from the average of the outputs produced by the two tones and takes advantage of assuming that in signalling there is a substantially equal number of 1 s and 0 s. The AFC feedback path in this embodiment is able to tune the local oscillator over an extended range compared to those embodiments in which the AFC feedback path operates on one of the tones. The present invention will now be described, by way of example, with reference to the accompanying drawings, wherein In the drawings the same reference numerals have been used to indicate the corresponding features. Referring initially to Figures 1 to 3 of the drawings, a direct modulation FM input signal 10 Figure 2 with carrier f In the illustrated embodiment this is done by separating the tones from each other and from any low frequency noise by bandpass filters 22, 24, respectively, having a bandwidth of the order of the bit rate, say 500 Hz for a bit rate of 512 bits second. The output of each bandpass filter 22, 24 is applied to a respective amplitude or envelope detector 26, 28. In order to recover the data signal the outputs of the amplitude detectors 26, 28 are compared in a difference circuit 30 to provide a data output on a terminal 32. The offset δf is less than the deviation Δf in order to avoid too big a separation between the peaks and undue erosion of the guard band between the adjacent channels. If the offset δf is large enough to place the local oscillator frequency outside the signalling channel so that no folding of the spectrum occurs, then a low I.F. conventional superhet results. In order to improve the adjacent channel selectivity, the frequency shifted adjacent channel signals 16 , 18 are attenuated by connecting a low pass or a bandpass filter 36 between the output of the mixer 14 and the bandpass filters 22, 24. In fact the filter 36 may be essential in situations where the discriminator does not provide filtering or where there is narrow channel spacing because by using the offset local oscillator signal f It is necessary to stabilise the frequency of the local oscillator 20 in order to help produce the signalling tones at the desired frequencies. Referring to Figure 4 the ordinate represents the local oscillator frequency f Taking as an example a case when the local oscillator frequency is f The movement of one or both of these tones relative to a reference audio signal such as Δf, when f Reverting to Figure 1, the feedback loop includes a functional block 40 whose input is connected to the output of the channel filter 36 and whose output is connected to an amplifier 42, the output of which is filtered in a low pass filter 44 before being connected to the local oscillator 20. The general requirement of the functional block 40 is that when the receiver is tuned to the nominal frequency offset, the discriminator transfer function for the offset receiver AFC must be non linear for example peaked. Thus the functional block 40 should provide the correct output sign over the relevant frequency ranges to urge the local oscillator frequency in a direction to tune the receiver properly. Figure 5 shows the transfer function of the functional block 40 and illustrates how the D.C. voltage developed at the output depends on the frequency of a single tone input. In the drawing the ordinate is the feedback voltage V f , the abscissa is frequency, and the curve has the general form of V f α cos ϑ f . The transfer characteristic is of generally inverted voltage V form with the vertex occuring at a frequency Δf. If the feedback voltage V f is taken as zero when the receiver is correctly tuned which will occur at the frequency Δf δf in the case of a 1 tone and Δf δf in the case of a 0 tone. Then if the local oscillator frequency drifts so that the two tones move from Δf δf and Δf δf towards each other then the feedback voltage V f goes negative and conversely when the local oscillator frequency changes to cause the tones which are lower than Δf δf and higher than Δf δf to move further apart in frequency relative to each other, then the feedback voltage V f goes positive. The transfer characteristic shown in Figure 5 has the following criteria for a local oscillator tuned below the carrier The criteria set forth above can be met with a functional block comprising an analogue circuit as shown in Figure 7. The analogue circuit comprises an input 46 which is connected to a phase shifter 48 and to one input of a mixer 50. A second input of the mixer 50 is coupled to the output of the phase shifter 48. An output 52 of the mixer 50 is connected to the amplifier 42 Figure 1 . Disregarding multiples of 2 π the phase shifter 48 has criteria corresponding to those above, that is, In an embodiment of such a functional block, the phase shifter 48 comprised three cascaded first order sections and it was found to act correctly down to signal levels as low as the minimum that could be demodulated when tuned. Figure 6 shows how the voltage developed at the output of the functional block 40 Figure 1 depends on the local oscillator frequency, for when, each of the two signalling frequencies 1 and 0 are transmitted the theoretical maximum range of mistuning that can be handled by this system is 2Δf i.e. from 2Δf δf to δf. Even this theoretical range may not be obtainable in practice. Furthermore the range of mistuning may be inadequate for some markets where a deliberate offset of up to 1kHz is applied, thus leading to a maximum drift specification of 8 parts per million. The range is limited as shown by the cross hatching because beyond the limits shown for a 1 tone or a 0 tone the sine wave continues and thus, for example, if the 1 tone moves to the right of δf then the feedback voltage will become positive and the effect of this would be to cause the local oscillator frequency to be increased rather than decreased. Figure 6 illustrates the case where the local oscillator is tuned on δf. However if the tuning is on δf then one has the inverse situation as shown in Figure 6A in which the tuning limits are at δf and 2Δ δf. If it is desired to provide a digital feedback loop, then as shown in Figure 8 the functional block may comprise a limiting amplifier 54 connected to the terminal 46, the output of which is connected to one input of an Exclusive OR gate 56 and to a digital delay element constituted by an externally clocked shift register 58 having a clock input 60. A charged coupled delay line or an all pass filter may alternatively be used. The output of the shift register 58 is coupled to another input of the Exclusive OR gate 56. The output 52 can be connected directly to the low pass filter 44 Figure 1 directly without the interposition of an amplifier. In the case of using a clocked delay element 58, care has to be exercised when a harmonic of the input frequency is close to the clock frequency because this can lead to undesirable ripples in the output of the AFC loop, caused by non coincidence between the zero crossing times of the signal and the clock waveforms. One way of resolving this problem when using a shift register is to increase the number of stages and at the same time increase the clock frequency. However not only will increasing the size of the delay element increase its cost, but also increasing the clock frequency will increase the power consumption of the clock oscillator which is undesirable in a battery powered receiver. Empirical tests have indicated that the minimum size of a shift register should be 8 stages. The selection of the clock frequency is dependent on the amount of delay required. An alternative delay element which will give an improved performance without necessitating a higher clock frequency is to use two interlaced shift registers with polyphase clock signals. In a modified feedback system, the transfer characteristic of the AFC loop is substantially of symmetrical triangular form. Such a transfer characteristic is shown in Figure 9 and the inverse thereof is shown in Figure 10. If the feedback voltage V f is taken to be correct at a value V 2 then this may effectively serve as a reference voltage so that in the case of the tones moving together, the feedback voltage is positive relative to V 2 whereas when the tones move further apart the feedback voltage is negative with respect to a reference constituted by V 2. A method by which such a triangular characteristic of Figure 9 can be derived digitally will be described with Figures 11 to 15. The feedback circuit will be substantially identical to that described with reference to Figure 8. The tone signals Δf δf and Δf δf are applied to the limiter circuit 54 which converts them into rectangular waveform signals. The output of the limiter circuit 54 is applied to one input of the two input Exclusive OR circuit 56 and, A low pass filter or R C smoothing circuit 44 Figure 1 is connected to an output of the Exclusive OR circuit 56 to produce the control voltage to be applied to the local oscillator 20 Figure 1 . The time delay τ applied by the delay element is constant and is related to the frequency of the vertex, Δf, by Δf 1 2 τ . Figures 11 to 15 illustrate how points on the transfer function can be derived. In each of these Figures the waveform marked A is the input tone signal, the waveform marked B is the input tone signal after being delayed by τ, the waveform marked C is the output of the Exclusive OR circuit 56 and the waveform marked D is the output of the smoothing circuit 44. Referring to Figure 11 the input waveform A has an even mark space ratio and a half period equal to the time delay τ, that is the frequency of the input waveform A is Δf. Consequently the input and the delayed input signals are in antiphase to each other so that the output of the Exclusive OR circuit is permanently binary 1 and thus the control voltage has a maximum value V which is in accordance with the value of the vertex in Figure C. Figure 12 shows the case for the input frequency being Δf δf and the delay being a quarter of the period of this tone signal. The output from the Exclusive OR circuit, waveform C, is a rectangular waveform of even mark space ratio, which when smoothed produces a control voltage of V 2. Figure 13 illustrates the case when the input frequency corresponds to the tone Δf δf and the delay period τ being equal to three quarters of the period of the input signal. Waveform C shows that the output of the Exclusive OR circuit 56 has an even mark space ratio which when smoothed produces the control voltage V 2. Figure 14 illustrates the case of the lower tone when the local oscillator has drifted low so that the delay τ is equal to one eighth of the period of the input waveform. The mark space ratio of the output of the Exclusive OR circuit 56 is 1 3 so that the output of the smoothing circuit 106 is V 4. Figure 15 illustrates the case of the higher tone with a similar local oscillator drift as in Figure 14. Here the delays τ equals seven eighths of the period of the input waveform. The output of the Exclusive OR circuit 56 has a mark space ratio of 1 3 so that the output of the smoothing circuit is V 4. Although the triangular transfer function repeats itself ad infinitum, as far as the practical application of this AFC principle is concerned only the first portion of the transfer function is normally used. Figure 16 illustrates a block schematic diagram of an offset receiver including an analogue AFC system. In the interests of brevity, only the AFC system will be described as the discriminator is as described with reference to Figure 1. The AFC system in Figure 16 comprises a non inverting amplifier 47 whose input is coupled to the output of the channel filter 36. The gain of the amplifier 47 is such that the signal therefrom has a sufficient level to drive the circuitry which follows it. The output of the amplifier 47 is coupled directly to one input of a mixer 50 and, In order to cope with the situation when no signal is being received, a reference voltage V In the absence of a signal to provide an AFC voltage, and if the receiver noise is such that the average output voltage is V 2, then the triangular transfer characteristic will provide an average output half way between the vertex and zero. Thus noise in the no signal condition will bias the AFC to the centre of its control range the optimum point . However D.C. offsets can be put into the system should it be necessary to have the no signal AFC voltage at a different level. The maximum range of mistuning can be extended by making the assumption that roughly equal numbers of data 1 s and 0 s are being transmitted. Consequently an alternative set of criteria can be used and a more relaxed local oscillator specification catered for. The principle behind the alternative criteria is that when the local oscillator frequency has drifted a long way, in the direction of increasing offset, the upper tone frequency, at Δf δf is attenuated in the channel filter 36. At this end of the frequency range, therefore, the AFC system operates on only the lower frequency tone, at Δf δf . The alternative criteria will now be described with reference to Figures 17 to 19. To take advantage of the fact that the AFC system operates on only the lower frequency tone, the low frequency, positive region of the transfer characteristic shown in Figure 5 is in Figure 17 extended outwards from f Δf δf to f f Figure 17 thereby extending the tuning range by f δf Δf. However in this new arrangement the lower frequency tone also gives rise to a positive output instead of zero as in Figure 5 when the receiver is properly tuned. This is compensated for by increasing the upper limit for the negative region of the feedback voltage V f in Figure 17 relative to that shown in Figure 5, so that the upper frequency tone gives rise to balancing negative output. This means that the value of V f is still negative at Δf δf whereas in Figure 5 it has fallen to zero. Taking advantage of the assumption that there is substantially equal numbers of 1 s and 0 s then in order to obtain the correct polarity output, positive for increasing frequency and negative for decreasing frequency it is the average of the AFC outputs produced by the two tones that now has to be of the correct polarity, this is shown in Figure 19 of the drawings. The new criteria are as follows, it being assumed that the local oscillator frequency is below the carrier frequency As shown in Figure 19 the new tuning range is Δf δf f and in consequence δf and f have to be as large as possible, but f must, however, be kept less than Δf. The correction of the local oscillator frequency relies upon the sign of the feedback voltage and any attempted corrections outside the range Δf f to δf will adjust to the local oscillator frequency such that correct tuning would be impossible. This is shown in broken line arrows in Figure 19. By way of example, if δf is 3.75 kHz and f is 4.2 kHz then an oscillator drift of 14 ppm can be tolerated. Figures 20 to 22 are the various transfer characteristics for the digital equivalent of Figures 17 to 19. In the digital embodiment of Figures 20 to 22 it is convenient for paging applications to sacrifice a small amount of tuning range then some advantages can be obtained. Instead of using a clock frequency of 4.5 kHz as may be used in obtaining the transfer characteristics of Figures 9 and 10, an alternative clock frequency of 4n x 4kHz will enable the new criteria to be met with f δf which equals 4kHz. An oscillator drift of 13ppm can then be tolerated. The use of the alternative criteria therefore gives an arrangement a greatly increased tuning range for no extra circuit complexity although some slight mistuning may occur if there is an unequal number of 1 s and 0 s. In many of the embodiments of the invention described above, it has been assumed that the local oscillator frequency increases if a positive AFC voltage is applied. However if one had the case where the local oscillator frequency decreases then a positive AFC voltage is applied then alternative discriminator transfer functions with the opposite polarity should be used. If an alternative transfer function is used then the receiver tunes to δf rather than δf .