# METHOD AND APPARATUS FOR DECODING THE OUTPUT SIGNAL OF A PARTIAL RESPONSE COMMUNICATION OR RECORDING DEVICE CHANNEL

## Claims
Verfahren zum Decodieren des Ausgangssignals eines Kommunikations oder Aufzeichnungsgerätekanals nach der Methode der Folge mit höchster Wahrscheinlichkeit, wobei der Kanal synchron eine Folge binärer Symbole a

## Description
Present invention is concerned with the decoding of a binary symbol sequence a Partial response signaling allows a better handling of intersymbol interference and allows a more efficient utilization of the bandwith of a given channel. In partial response PR systems a controlled amount of intersymbol interference can be allowed. As the intersymbol interference then is known, the receiver can take it into account. PR signaling in communications allows transmissions at the Nyquist rate, and provides an attractive trade off between error probability and the available spectrum. The partial response systems described by the polynomials 1 d, 1 d, and 1 d² are also called duobinary, dicode, and class IV, respectively. Maximum likelihood sequence estimation, in particular the Viterbi algorithm, is an effective tool in receivers for improving the detection of symbol sequences in the presence of intersymbol interference. It was described e.g. in the articles by G.D. Forney The Viterbi Algorithm , Proceedings of the IEEE, Vol. 61, No. 3, March 1973, pp. 268 278, and by G. Ungerböck Adaptive maximum likelihood receiver for carrier modulated data transmission systems , IEEE Transactions on Communications, Vol. COM 22, No. 5, May 1974, pp. 624 636. These articles also show some basic form of MLSE receivers or portions thereof. The utilization of MLSE or Viterbi Algorithm in connection with partial response signaling systems was already suggested by a publication of H. Kobayashi Application of probabilistic decoding to digital magnetic recording systems , IBM Journal of Research and Development, Vol. 15, No. 1, January 1971, pp. 64 74. The problem of maximum likelihood sequence estimation can be stated as follows. Given a received sequence z It is assumed that the channel synchronously transmits or records a sequence of binary symbols a It is an object of present invention to devise a method and apparatus for reliably decoding a signal representing a sequence of time discrete binary symbols received from a transmission channel or read in a recording device, which allow to reduce the necessary circuitry to a minimum and enable operation at high speed. It is a further object to generate tentative decisions with a minimum delay with respect to the time at which the signal representing the symbol is presented to the receiver. The invention for achieving the desired improvements is defined in the claims. The foregoing objects are satisfied in that the invention uses only two survivor sequences, and only the difference between the two metrics associated with these survivor sequences is computed and stored. Simplicity and efficiency results because less computing and storage resources are required to process the one difference metric that would have been required to process the two path metrics, and the difference metric cannot grow without bound as the path metrics can. Reliability results from the fact that the detected sequence is chosen by maximum likelihood sequence estimation. It is the one most likely to cause the observed sequence of sampled values at the receiver. In the case of 1 d² channel, interleaving and pipelining contribute to simplicity and speed of operation. The difference metric provides a convenient means of generating tentative decisions with very little delay. A limiter decision circuit can be used to facilitate the calculation of the difference metric and the survivor sequences. The method steps include a partitioning the sample values y Embodiments of the invention are described in the following with reference to the drawings. The drawings show Partial response signaling is a technique which enforces spectral properties by allowing a controlled amount of intersymbol interference. A survey of partial response signaling is given in the above mentioned article by P. Kabal et al. With maximum likelihood sequence estimation MLSE , most partial response schemes perform practically as well as a system without intersymbol interference, cf. the above mentioned article by H. Kobayashi Application of probabilistic decoding to digital magnetic recording systems .Hence, no penalty has to be paid for the benefit of spectrum shaping, except for the higher complexity of the MLSE decoding hardware which performs the Viterbi decoding process. Partial response class IV PR IV signaling leads to spectral nulls at DC and at half of the signaling rate. PR IV is therefore well suited for channels with baseband like characteristics, which do not transmit DC. Magnetic recording channels are of this type and PR IV is therefore regarded as a promising technique to achieve higher storage density in digital magnetic recording systems. In the following, first the theory of MLSE for PR IV signaling is reviewed. In the next section, two types of MLSE receivers with identical performance are discussed, called the whitened matched filter WMF version and the matched filter MF version. They differ in the receiver filters used before sampling the received signal at signaling rate, and in the computation of survivor metrics in the Viterbi decoding process. In another section explaining basic invention features, it is shown that PR IV sequences can be viewed as two dicode sequences which are interleaved, and that each dicode sequence can be decoded independently. For binary systems, as in saturation recording, the state transition diagram of each dicode scheme exhibits then only two states. Instead of two survivor metrics it is possible to compute only one difference survivor metric. In a further section, embodiments are disclosed which are digital implementations of Viterbi decoders utilizing pipelined handling of interleaved PR IV sequences, some of them using difference survivor metrics. Simplicity and capability for operation at high speed is achieved by decoding the two dicode sequences in an interleaved and pipelined fashion. A dicode decoder is the same as the partial response class IV decoder with the interleaving and pipelining removed. A duobinary decoder is similar to a dicode decoder with the signs of certain quantities changed. The discussion focuses on the partial response class IV decoder. The changes necessary for the dicode and duobinary cases are given at the end of each section. Fig. 1 is a schematic representation of a transmission system in which present invention finds application. A sequence of binary values a It should be noted that channel 11 can also be a magnetic recording device, that the white noise w t is added during recording and reading, and that x t is the output signal of a magnetic reading transducer. Signal x t is applied to a receiver filter 13. For the present case, this may be either a Whitened Matched Filter WMF, or a Matched Filter MF, as will be explained later. The filter output is a continuous signal y t or z t , depending on the type of filter. The filter output signal is sampled at regular intervals T by sampling means 15. The result is a sequence of time discrete samples y These samples are furnished to a Viterbi decoder 17 in which they are used in a maximum likelihood sequence estimation MLSE process to obtain binary output values b Present invention is concerned with the means for MLSE decoding contained in Viterbi decoder 17. In the sequel, some theorectical explanations will be given prior to the detailed description of the invention and the selected embodiments. As shown in Fig. 1, PR IV signaling results from sending a data sequence a In the frequency domain, this corresponds to the channel transfer characteristics At the output of the channel the received signal becomes where w t is assumed to be additive wide band white noise. The above description of a PR IV transmission system applies as well to a magnetic recording system where in the case of saturation recording the data amplitudes are binary a The function h t is shown in Fig. 2 a . The transmission characteristic of the channel is depicted in Fig. 2 c . Two receiver versions for PR IV signals are described. They are equivalent in that both perform true maximum likelyhood sequence estimation MLSE . As mentioned above already, they differ in the receiver filters used. The whitened matched filter WMF version is more commonly known. In the particular case of the signal being given by 3 , the WMF to be used as a receiver filter is just an ideal low pass filter with cut off frequency 1 2T. Its transmission characteristic is shown in Fig. 2 d . The output of this filter is given by where h t was defined by 1 and has a shape as shown in Fig. 2 a , and r t denotes white noise band limited to 1 2T. For the matched filter MF version, the receiver filter is matched to the channel characteristic given by 2 i.e., it has a characteristic as shown in Fig. 2 c . Thus, if causality is ignored, the receiver filter exhibits the transfer function The overall response of the channel and MF to an isolated input a and the signal observed at the output of the MF becomes The noise p t is band limited to 1 2T and correlated. The function s t is shown in Fig. 2 b . Sampling the outputs of the WMF and the MF at times nT, leads, respectively, to the sampled signals The last equality in 9 expresses the fact that the MF output samples could also be obtained by digital filtering of the WMF output signals. In the WMF case, the noise samples r a k designates here an undetermined value. It may be either 1 or 1. The most likely sequence a and The squared terms of the right hand side of 10 are identical for all sequences a For the MF case an equivalent cost function is obtained by replacing in the term y In the sequel, the following notation is used for the cost function where the auxiliary function v The sequence which maximizes J is determined by the Viterbi decoding alogrithm. The cost function J can be rewritten as Hence its maximization can be carried out separately for JE with respect to a As illustrated in Fig. 3, this point of view corresponds to treating PR IV sequences characterized by the polynomial 1 d², where d refers to a delay T, as two independent interleaved dicode partial response sequences with polynomial 1 d, where d refers to a delay of 2T. For an explanation of dicode sequences cf. above mentioned article by P. Kabal et al. Partial response signaling . A Viterbi decoder operating in an interleaved fashion on the two dicode schemes requires for each scheme only two states. The Viterbi algorithm is now developed as it applies to one of the two interleaved dicode systems. Hence, in the following derivation indices are either even or odd. A general description of the Viterbi algorithm is given in the above mentioned article by G. Forney The Viterbi algorithm , and in a publication by J.F. Hayes The Viterbi algorithm applied to digital data transmission , Communication Society Magazine, Vol. 13, March 1975, pp. 15 20. The Viterbi algorithm for one dicode system is illustrated in Fig. 4. It determines in a two state trellis diagram the sequence .., a and which represent the maximum cost up to time n, for an hypothesized last symbol a The survivor metrics and associated survivor sequences are extended by the recursion where a and The Viterbi decoding process for binary dicode sequences can be significantly simplified by considering not the pairs of explicit survivor metrics but only the difference between the survivor metrics, i.e., From Fig. 4, it can be seen that four possible extensions of the survivor sequences are to be considered The corresponding path selections are indicated on the right. Considering the above four cases, and observing 21 25 , allows the determination of the following recursions for the difference survivor metrics The conditions in the above recursions reveal that extension d can never occur. The non occurence of this extension can be seen in Fig. 4. The theoretical background for the dicode 1 d and the duobinary 1 d systems is similar to that given in equations 1 28 . The following summarizes the differences and gives the final results. The equations corresponding to 27 and 28 are directed to the dicode and duobinary cases. The processing of samples from a dicode channel is the same as the processing of the even or odd subsequence described for partial response class IV. The dicode versions of equations 8 through 28 are obtained by changing all occurrences of time indices n 2, k 2, n 2, and k 2, n 1, k 1, n 1, and k 1, respectively. Splitting into even and odd subsequences as described by equation 16 is omitted. The recursions for the survivor metrics corresponding to equations 27 and 28 are The duobinary versions of equations 8 through 28 can be obtained from the dicode versions by changing the signs of certain terms. For example, 8 and 9 become The recursions for the difference survivor metrics for duobinary are In the following section, embodiments of the Viterbi decoder or MLSE decoder 17 which incorporate the invention are described. As shown generally in Fig. 1, the Viterbi decoder consists of a first section 19 for determining survivor metrics and for obtaining intermediate and tentative values for the receiver output signal, and a second section 21 for storing and updating the survivor sequences furnished by section 19, and for making the final selection of output values. Three embodiments are disclosed for Section 19, in connection with Figs. 5, 6, and 7. A suitable implementation of a limiter decision circuit used in the second and third embodiment will be disclosed with reference to Fig. 8. Finally, one implementation of section 21 is explained and shown in Fig. 9. Each of these embodiments is described first for the partial response class IV channel. The modifications necessary to convert them to dicode and duobinary are described at the end. It should be noted that the digital circuitry discussed in the following generates binary output quantities which assume either value O or 1, and are therefore designated as b The transition from one form to the other is formally given below in equations 29 and 30 . In Fig. 5, an embodiment of section 19 of the Viterbi decoder is shown which determines two survivor metrics for the two states of the decoder, and which furnishes intermediate values b It comprises V unit 25 which computes for an applied input value y Four adders 35, 37, 39, and 41 are provided for adding the contents of registers 27...33, i.e. the four previously stored values of v The formal relationship between decoded values a and With the aid of multiplexers or gating circuits 63 and 65, the sign bits available at the outputs of subtractors 51 and 53 select the maximum of each pair of values stored in registers 43 45 and 47 49, respectively and furnish the resulting two values as metric values J The formal relationship between survivor metrics J It should be noted that the survivor metrics are not normalized but are allowed to wrap around the maximum values in their two s complement representation. With a sufficient word length, the add and subtract operations will still produce correct results. At the bottom of Fig. 5, boxes with indices are shown which illustrate the fact that the circuitry has separate stages. Each of the double vertical lines indicates where the circuitry comprises storage units that separate stages. At any time, each section contains only values either with even indices or with odd indices. At each clock time, the whole contents is shifted from one stage to the next for further processing, but no mixing between odd and even indexed values occurs. This shows that in the whole cirucitry, two sub sequences with odd and even indices, respectively, are handled completely separately as indicated in Fig. 3, but in an interleaved and pipelined manner. Nevertheless, the sequence of input values and the sequence of output values are continuous, i.e. they need not be expressly separated into two sub sequences because this splitting occurs automatically within the circuit of Fig. 4 due to the separation of stages by clocked storage units, and due to suitable feedback between stages. Fig. 6 shows an embodiment of section 19 of the Viterbi decoder which does not explicitly determine the two survivor metrics but only their difference. This second embodiment is suited for the WMF whitened matched filter version of the receiver, i.e. the version producing receiver samples y The quantity shown next to each line in Fig. 6 indicates the number of bits transferred on that line in parallel. In the absence of noise, the samples y For soft decoding, the value for L should be chosen between 2 and 4. An important portion of the circuitry of Fig. 6 is the limiter decision unit 81. With the aid of this unit, intermediate values b Referring again to Fig. 6, an input value y Limiter decision unit 81 also furnishes the two binary intermediate values b Similar as for Fig. 5, also at the bottom of Fig. 6 boxes with indices are shown. These boxes indicating separate stages and intermediate clocked storage units also illustrate the interleaved and pipelined handling of two sequences of alternating samples. A comparison between Fig. 5 and Fig. 6 reveals that less stages are required for the circuitry of Fig. 6, thus it has less delay and needs less hardware. A third embodiment of section 19 of the Viterbi decoder is illustrated in Fig. 7. It also directly determines the survivor metric difference value DJ In the MF case, sample values z The circuitry of Fig. 7 comprises the same limiter decision unit as the circuitry of Fig. 6. Here, this unit has reference number 81a detailed embodiment shown in Fig. 8 . The output sample Q Two outputs of limiter decision unit 81 furnish the binary intermediate values b Contents of these flipflops are furnished as intermediate values b The blocks at the bottom of Fig. 7 with indices inserted illustrate also for this case the different stages of the circuitry separated by clocked storage units, which enable the pipelined and interleaved processing of the two dicode sub sequences. A comparison of Figs. 5, 6, and 7 immediately reveals that among the three metric computation schemes presented, the MF version with difference metric calculation Fig. 7 offers the lowest circuit complexity, capability of operation at highest signaling rate from a circuit delay consideration , and shortest delay in producing binary decision values. Another advantage of the second and third embodiments over the first is that the difference metric is automatically normalized. Equations 27 and 28 show that it does not accumulate as the individual survivor metrics do. There is no need to provide extra word length to allow for wrap around. Fig. 8 shows an embodiment of limiter decision unit 81 81a for the case L 4 comprising discrete logic circuits. As mentioned previously, this unit implements equation 31 . It has eight inputs for the eight bits of a sample P The five input lines for the most significant bits of P The two output lines for the most significant digits of Q The output line for the first binary intermediate value b Details of section 21 of the Viterbi decoder 17, for the storage and updating of survivor sequences are shown in Fig. 9. It consists essentially of two shift registers 137 and 139 each comprising 2m 1 flipflop stages arranged in sequence. Every second flipflop is connected to its successor through a multiplexer or gating circuit that allows to selectively transfer to the successor flipflop either the bit from the preceding flipflop stage of the same shift register or the bit from the corresponding flipflop stage of the other shift register. The control inputs of all multiplexers gating circuits of one shift register are commonly connected to the input of the respective shift register, i.e. the binary value of the bit just inserted into the first stage of a shift register also determines the selections made by all multiplexers gating circuits of the respective shift register. The output flipflop stages of both shift registers are connected to an additional multiplexer gating circuit 141 which is controlled by a binary signal on selection control line 143. The output value of multiplexer gating circuit 141 is stored in a final flipflop stage 145 having output line 147 for finally selected output bits b and As shown in Fig. 9, inputs of the two shift registers 137 and 139 are connected to the two intermediate value outputs b Operation is as follows The two shift registers store the two binary sequences which have the highest probability of being similar to the transmitted sequence a The finally selected bits are furnished sequentially on line 147 which is the output line of the whole Viterbi decoder 17. Section 21 shown in Fig. 9 has an additional portion 149 for providing a sequence of tentative output values which are required for timing recovery and gain control in the receiver. This section comprises an additional group of 2m 1 flipflops, each corresponding to one flipflop stage in the two shift registers 137 and 139 except the last stage . The flipflops are arranged in pairs as shown, and the input of each pair except the first one is connected to a multiplexer gating circuit whose two inputs are connected to the output of an associated flipflop stage in the first 137 and second 139 shift register, respectively. The control inputs of all multiplexers in portion 149 as well as the input to the first pair of flipflops are connected to control line 149, i.e. to output line 79 or 79a, 79b of survivor metric section 19. Thus, the outputs of all flipflops in portion 149 together with the output of flipflop 145 deliver, at each sampling time, a sequence of tentative output values b and As was mentioned earlier, indices j and j 1 at the inputs of Fig. 9 correspond to indices n 4 and n 5 at the outputs of Fig. 5, to indices n 2 and n 3 at the outputs of Fig. 6, and to indices n 1 and n 2 at the outputs of Fig. 7, respectively. Thus, in Fig. 9, the index j can be replaced by n 4, n 2, or n 1, depending on whether the binary decision values b If circuit delay permits, the single bit registers flipflops 55 57 75, 93 95 99, and 107, 109, 113 which in Figs. 5, 6 and 7 buffer the output values can be omitted, thus reducing processing delay by one signaling period. Similar simplifications are also possible in connection with deriving tentative decisions from portion 149 and the final decision, if circuit delay is not critical in the further operations performed with these signals. The partial response class IV embodiments described above can be converted to dicode embodiments by removing the registers and flipflops used for interleaving and pipelining. Removing a register or flipflop means deleting it from the circuit and connecting its inputs directly to their corresponding outputs. The elements to be removed are 43, 45, 47, and 49 in FIG. 5 with elements 83, 89 in FIG. 6, 101 in FIG. 7 and 151, 153, 155, 157, 159, 161, 163, and 165 in FIG. 9. The dicode embodiments can be converted to duobinary embodiments by the following modifications. The V unit 25 in FIG. 5 should generate an output according to the duobinary versions of equations 14 and 15 Subtractor 85 in FIG. 6 should be changed to an adder, and adder 91 should be changed to a subtractor. The designations of 61a and 59a should be interchanged. Further, the adder in FIG. 7 should be changed to a subtractor. The designation 61b and 59b should also be interchanged.