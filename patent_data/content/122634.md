# POLYPHONIC ELECTRONIC MUSICAL INSTRUMENT

## Claims
Polyphonisches elektronisches Musikinstrument mit

## Description
This invention relates to a polyphonic type electronic musical instrument of a type which produces a tone by converting tone waveshape data generated in digital into an analog signal and, more particularly, to an electronic musical instrument of such type in which construction of a digital to analog conversion circuit is simplified and an aliasing noise, which may be caused in produced tones by processing waveshape sample point data of a tone, is removed by a relatively simple construction. In typical prior art polyphonic type electronic musical instrument as shown for instance in the United Kingdom Patent No. GB A 2,091,469 particularly its Fig. 5, digital tone signals for plural channels are generated in time division, digital tone signals of all channels in one sample point are added together in a digital accumulator and the added digital tone signals are converted into analog signals by a digital to analog converter hereinafter called D A converter and thereafter are supplied to a sound system. Such construction, however, has the disadvantage that the accumulator must be composed of a digital circuit to add digital signals of multiple bits together resulting in a large hardware structure. Besides, since the D A converter receives a sum of tone signals for plural channels provided by the accumulator which necessarily becomes a multiple bit data , the D A converter must be a large one of a multiple input type. Furthermore, in the above described type of electronic musical instrument which generates digital tone signals for plural channels in time division, the sampling frequency corresponding to the time division timing and the tone frequency are generally non harmonic with each other and, accordingly, an aliasing noise which is non harmonic with the tone frequency is produced as will be apparent from the sampling theorem. Some arrangement must be made to eliminate this aliasing noise and, in the prior art electronic musical instrument, the arrangement was made by a digital circuit with a result that the circuit construction becomes large and complicated. It is, therefore, an object of the present invention to simplify the hardware structure of the D A conversion circuit in a digital polyphonic type electronic musical instrument. It is another object of the invention to simplify the hardware structure of the tone adding circuit by simplifying the D A conversion circuit. It is another object of the invention to remove a time division sampling clock component which is non harmonic with the tone by a relatively simple construction and thereby eliminating the aliasing noise. It is still another object of the invention to enable the electronic musical instrument to employ a low cost D A converter by reducing necessity for high speed processing of the D A converter. In a case where the channel time division rate is made high in order to increase the processing efficiency of the digital circuit, the D A converter also is required to operate at a high time division rate and such D A converter naturally is expensive. The invention aims at resolving this problem, too. For achieving these objects, the electronic musical instrument of the invention does not employ the digital accumulator but applies digital tone signals supplied by tone generation means in a time division multiplexed state directly to a D A converter which is common to respective channels thereby effecting D A conversion of the signals individually for the respective channels in the time division multiplexed state. By this arrangement, the D A converter receives not a sum of plural tones but a digital amplitude value for a single tone so that the number of input bits of the D A converter is reduced and the circuit construction thereby is simplified. This enables addition of analog tone signals of respective channels by an analog adder accumulator is necessity arises. Since the analog accumulator is simpler in construction than the digital accumulator having multiple bit input and output terminals, the simplification of the hardware structure can be realized. Also, a plurality of analog memories are provided in correspondence to the respective channels and analog amplitude signals for the respective channels supplied in time division from the D A converter are sampled channel by channel i.e., demultiplexed and individually held. Thus, the time division multiplexed analog amplitude signals for the respective channels are parallelized and sustained. The memory contents of these analog memories may be read out always in parallel and a sustained manner. For achieving the other object of the invention, however, reading means may be further provided for individually reading out the respective analog amplitude signals held in the analog memories of the respective channels in synchronism with note pitches assigned to the respective channels. For example, the reading in synchronism with the pitch is made by effecting reading in synchronism with change in phase data for the respective channels. Thus, by effecting reading of the analog tone amplitude signals in synchronism with the note pitches assigned to the respective channels, the time division sampling clock component which is non harmonic with the tone can be removed whereby the aliasing noise can be removed. Besides, the analog memories and the reading circuits can be made of a very simple construction consisting, for example, of capacitors and analog gates. According to another aspect of the invention, phase data of tones assigned to the respective channels are generated in time division at a predetermined first time division rate high rate time division timing and this time division rate for the phase data is converted into a second time division rate low rate time division timing which is lower than the first time division rate. In the tone generation circuit, tone waveshape sample amplitude data is generated in digital in time division for the respective channels in accordance with the phase data which has been converted to low rate one. In the above described manner, the digital tone amplitude data for the respective channels generated in time division at the low time division rate is converted to analog data in the time division multiplexed state and thereafter the analog tone signals for the respective channels are added together for synthesizing, when necessary, by sampling and holding. In the accompanying drawings, An embodiment of the present invention will now be described with reference to the accompanying drawings. Referring to Fig. 1, a key switch circuit 10 includes key switches corresponding to respective keys of the keyboard. A key assigner 11 assigns a depressed key to one of a specified number of tone generation channels according to the output of the key switch circuit 10. The key assigner 11 produces a key code KC representing the key assigned to the specific channel and a key on signal KON indicating whether said depressed key is still depressed or has been released in time division in synchronism with a given time division channel timing. A frequency data generator 12 produces data which indicates the tone frequency according to the key code KC supplied from the key assigner 11. A phase data generator 13 produces phase data based on the frequency data supplied from the frequency data generator 12. The phase data indicates the instantaneous phase which changes at a rate corresponding to that frequency. Fig. 2 a shows an example of the time division channel timing of the key code KC and the key on signal KON produced by the key assigner 11 8 channels in this example . One slot according to this timing synchronizes with one period of the system clock pulse ₀. The time division timing of the phase data produced by the phase data generator 13 in the respective channels is the same as shown in Fig. 2 a . A time division rate change latch circuit 14 is provided to change the time division rate of the phase data of each channel produced by the phase data generator 13 to a lower rate timing e.g. as shown in Fig. 2 b than that shown in Fig. 2 a . To control this timing conversion to a low rate, a timing generator 15 produces a plurality of strobe pulses STB The analog tone signals of the respective channels produced in time division from the D A converter 18 are applied respectively to a plurality of sample and hold circuits 19 1 through 19 8 corresponding to the respective channels. The sample hold circuits 19 1 through 19 8 sample the analog tone signals of the respective channels in response to the channel pulses CH The sampling circuits 23 1 through 23 8 for pitch synchronization are provided to remove the time division timing components which are out of synchronism with the respective pitches of the individual tone signals to be produced. That is, the time division channel timing generally remains constant at all times irrespective of the tone signal pitch and therefore may cause noises which are not in harmony with the tones to be produced. Its influence poses problems particularly in the higher tones. The outputs of the sample hold circuits 19 1 through 19 8, even though released from the time division mode, still contain such inharmonic time division clock components because of the sample holding synchronized with the time division timing . Hence the output signals of the sample hold circuits 19 1 through 19 8 of the respective channels are allowed to undergo resampling through the sampling circuits 23 1 through 23 8 in synchronism with the pitches of the tones assigned to the respective channels, thereby removing the inharmonic time division clock components. The phase data generator 13 is used to channelwise produce the sampling pulse PS An example of the sampling circuit, for instance, the circuit 23 3, consists of an FET gate 28 controlled by the sampling pulse PS₃ corresponding to the third channel. The analog adder circuit 24, consisting of resistors R1 through R8 for mixing the outputs of the sampling circuits 23 1 through 23 8 and an integration circuit 29, integrates the analog tone signals of the respective channels sampled in synchronism with the pitches by the integration circuit 29 and adds the analog tone signals of the respective channels. Fig. 3 shows an example in detail of the phase data generator 13 and time division rate change latch circuits 14, 16 and 26. The phase data generator 13 comprises a shift register 30 with stages corresponding in number to the channels and an adder 31 for adding the output of the shift register 30 and the frequency data supplied from the frequency data generator 12, and forms an accumulator which repeatedly adds the frequency data at regular time intervals. In this case, a frequency number indicating a phase increment in unit calculation time is used as the frequency data. This frequency number is numerical data composed of a decimal section and an integer section. Out of the accumulation result produced from the shift register 30, only the integer section data is delivered to the latch circuit 14 as the phase data. When a carry over signal has been given from the decimal section to the integer section following the addition in the adder 31, the carry signal CA is produced. Accordingly the carry signal CA is produced every time the phase data value changes. The latch circuit 14 has latch units equal in number to the bits of the phase data typically shown by a latch unit 14 1. The strobe pulses STB₁ STB₈ corresponding to the low rate time division timing of the respective channels are supplied to an OR gate 32 whose output is used as the latch control pulse. An AND gate 33 in the latch unit 14 1 receives one bit of the phase data and the output of the OR gate 32. When any one of the strobe pulses STB₁ STB₈ is 1 , the phase data of the corresponding channel is taken in by the AND gate 33 and applied to a delay flip flop 35 through an OR gate 34. When the output of the OR gate 32 has become 0 , an AND gate 36 is enabled so that the output of the delay flip flop 35 returns to the input side. Thus the high rate phase data is latched in synchronism with the strobe pulses STB₁ STB₈ and the time division rate of the phase data is changed to the low rate time division timing. The latch circuit 26 for forming the sampling pulse PS The latch circuit 16 for the low rate change of the key on signal KON comprises a latch unit for one bit like the latch unit 14 1 and operates similarly to change the timing of the key on signal KON to the low rate time division timing. The phase data generator 13 is not necessarily limited to the type which accumulates the frequency number at regular time intervals but may be of any other type. For example, the generator 13 may be of a type as described in the United States Patent Application No. 390,830 filed on June 22, 1982 and assigned to the same assignee with the present application, which is supplied, as the frequency data, with frequency division data corresponding to the tone pitches and which produces the phase data by counting the frequency variable clock pulses corresponding to that frequency division data. Alternatively, the generator 13 may be of a type in which the note clock pulse itself is supplied as the phase data to the tone generation circuit. In this case, the note clock pulse itself may be used as the pitch synchronizing pulse in place of the carry signal CA and the sampling pulse may be generated in response the note clock pulse. The tone generation circuit 17 may be of any type, provided that it produces digital tone signals based on the phase data. For example, the generator 17 may be of a type which reads out the tone waveshape data stored in one or more waveshape memory as shown in the United State Patent No. 4,383,462 or of another type which performs tone synthesis by frequency modulation operation as shown in the United States Patent No. 4,018,121. In Fig. 1, the sampling circuits 23 1 through 23 8 may be altered so as to be similar to the circuits 19 1 through 19 8. In that case, the integration circuit 29 in the analog adder circuit 24 is unnecessary and only the mixing resistors R1 R8 suffice. Also where the sampling circuits 23 1 through 23 8 for pitch synchronization are not provided, the integration circuit 29 in the analog adder circuit 24 is unnecessary and only the mixing resistors R1 R8 suffice. Conversely, it is feasible to remove the capacitors 21 and buffer amplifiers 22 of the sample hold circuits 19 1 through 19 8, using instead the hold function of the integration circuit 29.