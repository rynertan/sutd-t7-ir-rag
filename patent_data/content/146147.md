# SECTIONING APPARATUS AND METHOD FOR OPTICAL CHARACTER READER SYSTEM

## Claims
Zeichentrennvorrichtung zum Trennen von Zeichenfolgebildern in einzelne Zeichen auf der Basis einer Projektionsverteilung, die erhalten wird entlang einer Serie von Zeichenfolgeabbildungen, wobei die Projektionsverteilung einem Histogramm einer Summierung von Nichtleerstellen Bildpunkten in einer Richtung senkrecht zu der Schreibrichtung der Zeichenfolgeabbildungen entspricht, mit einer Einrichtung zum Extrahieren von mehreren Zeichenstücken, die als Nichtleerstellen Räume definiert sind und durch Leerstellen Räume von der Projektionsverteilung getrennt sind 3 in Fig. 4 , einer Einrichtung zum Schätzen eines Zeichenabstands mittels der Zeichenstücke 4 in Fig. 4 , einer Einrichtung zum Bestimmen eines möglichen Trennintervalls oder abschnitts auf der Basis der Projektionsverteilung des Zeichenabstands 5 und 7 in Fig. 4 , eine Einrichtung zum Berechnen eines Abstands zwischen einer möglichen Trennposition innerhalb des möglichen Trennabschnitts und einer möglichen Trennposition innerhalb des benachbarten möglichen Trennabschnitts 7 in Fig. 4 und eine Einrichtung zum Berechnen einer Reihe von optimalen möglichen Trennpositionen, wobei ein Schätzstandard der Varianz über die Zeichenfolgeabbildungen minimiert wird 8 in Fig. 4 , wobei der Schätzstandard aus der Summe einer gewichteten Varianz des Abstands zwischen den möglichen Trennpositionen in den Zeichenfolgeabbildungen über alle möglichen Trennabschnitte und einer gewichteten quadratischen Differenz zwischen einem Mittelwert des Abstands über alle möglichen Trennabschnitte und dem Zeichenabstand besteht, wobei die Summe der Gewichtungskoeffizienten eins entspricht.

## Description
The present invention relates to optical character reader systems. More particularly, it is concerned with a sectioning apparatus for sectioning a character string image given on a paper into individual characters. In order to recognize a series of printed characters, the optical character reader systems are required to separate the characters one by one. Further, the optical character reader systems are desirable to manage printed characters of many font types and poor print quality which are printed on general mails and documents. In a character string printed on general documents, there is a case where the characters to be separated touch each other, or one character is separated into more than one images due to the poor print quality. Further, in the case of alphabet, each character width varies according to a variance in the font or character category. Therefore, a sectioning apparatus is necessary, which can properly section the character string into individual characters under the above mentioned conditions. This type of sectioning apparatus has been proposed in U.S. Patent No. 3,629,826. The proposed sectioning apparatus scans a character image vertically and sets a character segmentation position by detecting a position where a vertical scan bit is minimized. Besides, in order to segment the touching characters, this apparatus stores many touching images for every character in advance, and a segmentation position is determined by comparing the touching character image with the stored touching images. That is, this apparatus performs the character segmentation referring to the local images of the character string. However, such sectioning apparatus cannot properly segment the character splited into two or more images as one character. Additionally, this apparatus requires a vast memory capacity for storing many touching images of every character touching other characters. Furthermore, a special function for character segmentation in accordance with an individual case may invite a considerable deterioration in precision and speed of the character segmentation. Besides, this type of sectioning apparatus can use a character pitch as information for segmenting a character string. The character pitch can be given to the sectioning apparatus as known information by limiting printed matters to be read by an optical character reader. However, since characters printed or written on a general document have an unspecified character pitch as described above, the character pitch cannot be known beforehand. Accordingly, the character pitch must be estimated from a character string image on the paper. Heretofore, a mean value of character widths of various characters is used as estimated value for the character pitch. However, in the case that an individual character width largely varies according to a font or a character category, or touching characters increase in number, an error between the mean value of character widths and an actual character pitch can no more be negligible. Due to the error, the sectioning apparatus mistakes the number of touching characters or cuts off the character string at an incorrect position for segmentation. Further, as described above, the optical character reader is desired to manage both the characters printed at constant pitch and printed at variable pitch including hand written characters. In such a case, the sectioning apparatus must change the algorithm for character segmentation according to the constant pitch printed characters and the variable pitch printed characters. Therefore, it is also important to identify whether the pitch of the obtained character data is constant or variable before performing segmentation of character string. IBM Technical Disclosure Bulletin, Vol. 23, No. 3, August 1980, page 1194 C.R. JIH Segmentation method for fixed pitch and machine printed documents shows a method for separating individual characters from a character line image based on a given standard pitch. Since each character width on the character line image is normally different and the starting point of the character line image is not fixed, the method for separating the character simply using the standard pitch cannot contribute to the accuracy improvement. To solve this problem, this method performs separating the character from the character line image based on the standard pitch and pitch deviation information. For the detection of the pitch deviation, the leading edge, the trailing edge and the center line of the character lump are generated. The pitch deviation is then calculated as a distance between the reference grid location given by the standard pitch and the center line of the character lump. Since the pitch deviation corresponding to the incorrect data has a great value, the incorrect data is deleted by simple threshold processing based on the experimental value. As a result, the increased number of the incorrect data, the number of correct data to be measured is decreased, and the pitch deviation information does not come to function for the compensation for the standard pitch. Therefore, an object of the present invention is to provide a sectioning apparatus and a sectioning method, resp. capable of separating a character string into individual characters with precision even in the case that the character string includes touching characters, or one character is splited into two or more images. This object is achieved by an apparatus comprising the features of claim 1 and a method comprising the features of claim 7. The subclaims are directed to preferred embodiments of the invention. The sectioning apparatus according to the present invention is in particular capable of stably detecting an optimum character pitch even in the case that the character string includes touching characters, or one character is splited into two or more images and of identifying whether an obtained character data has a constant pitch or variable pitch, and thereby, carrying out a character segmentation in accordance with a property of character pitches. The sectioning apparatus according to the present invention determines a character segmenting position through setting segmentation candidate sections in sequence by means of a character pitch and a blank space information of character image, and workes out a sequence of character segmentation positions in accordance with a dynamic programming. The sequence of character segmentation positions are so determined that they minimize the variance of distance between the segmentation candidate positions and the variance of dislocation between an average distance and a character pitch. Further, the sectioning apparatus according to the present invention estimates a character pitch. This sectioning apparatus separates a frequency distribution of a character lump on a distance between the character lumps into a plurality of sections by means of a candidate character pitch. The character lumps are separated by the blank space information of character image. The candidate character pitch is set by means of a character height information or others. The sectioning apparatus works out an optimal linear form sum appreciation standard variance criterion of the error between a representative point of the separated section and the candidate character pitch. The most appropriate character pitch is so determined that it minimizes the optimal linear form sum appreciation standard variance criterion . The above mentioned and other objects, features and advantage of the present invention will be better understood from the following detailed description of preferred embodiments of the present invention taken in conjunction with the accompanying drawings, wherein Fig. 1 a shows a character string image including touching characters and one character solited into two images in oblique lines. A character pitch P may be obtained by a character pitch detector described hereinafter, but if it is known already, then the known value can be used. A projection distribution shown in Fig. 1 b is obtained through projecting vertically the character string image of Fig. 1 a . In order to separate the touching characters a m u and make the split character h into a correct unit of individual character, a segmenting start position of the character must be predicted correctly. For example, in the touching character images a and m , a is slightly smaller. Therefore, the segmenting start position should be set slightly leftward from a leading end of the touching character images a m u . First of all, positions and sizes of a white area hereinafter called a blank space and a black area hereinafter called a character lump are extracted from the projection distribution shown in Fig. 1 b . Next, sections for setting the character segmentation positions hereinafter called permissible section are set by means of the character pitch P and preset thresholds T₁ and T₂ under following conditions 1 and 2 . The permissible section satisfying the above conditions 1 and 2 comes in, as shown in Fig. 1 d , sections A₀, A₁, A₂, A₃, A₄ and A₅. Here, the above thresholds T₁ and T₂ may be given as functions of the character pitch P. Moreover, the threshold T₁ may be set according to an estimate error arising from estimating the character pitch P as described later. Next, segmentation candidate sections k k 0 shown in Fig. 1 e are set in the permissible sections A₁, A₂, A₃, A₄ and A₅ by using the character pitch P and preset threshold T₃. Referring to Fig. 1 e , first scan bits W₀ indicated by white dots are set in the blank space W₀. Next, a section k 0 in which a distance from the arbitrary scan bit W₀ satisfies P T₃ is set. Next, the section including both the permissible section A₁ and the section k 0 is set as the segmentation candidate section k 0. In the embodiment, only one scan bit indicated by a black dot exists in the first segmentation candidate section k 0. The scan bit indicated by a black dot is called a segmentation candidate position hereinafter, which is expressed as x k, i Next, a section k 1 in which the distance from the segmentation candidate position x 0, 1 is within P T₃ is set, and the section including both the permissible section A₃ and the section k 1 is set as a segmentation candidate section k 1. The segmentation candidate section k 1 includes two segmentation candidate positions x 1, 1 and x 1, 2 . Then, the section in which the distance from a segmentation candidate position x 1, i₁ is P T₃ , namely, the section from x 1, 1 P T₃ to x 1, 2 P T₃ is set as a section k 2. All the section k 2 is included in the permissible section A₄, therefore, the segmentation candidate section k 2 is identical with the section k 2. The segmentation candidate section k 2 includes four segmentation candidate positions x 2, 1 , x 2, 2 , x 2, 3 and x 2, 4 . A section k 3 is then set according to the segmentation candidate section k 2 likewise, and a segmentation candidate section k 3 and a segmentation candidate position x 3, i₃ i₃ 1, 2, 3, 4, 5, 6 are set by a logical product with the permissible section A₄. A segmentation candidate section k 4 and a segmentation candidate position x 4, i₄ i₄ 1, 2, 3, 4 are set according to the segmentation candidate section k 3. Then, a segmentation candidate position x 4, 1 is created by a logical product of a section k 4 and the permissible section A₄, and positions x 4, 2 x 4, 3 and x 4, 4 are created by a logical product of the section k 4 and the permissible section A₅. As will be apparent from the above description, if the distance x k 1, i Here, the above described threshold T₃ can be given as a function of the character pitch P like the threshold T₁. Further, the segmentation candidate section k can also be set under another condition by means of the character pitch P, the character lump width Vi, and the blank space Wi. A method for detecting a trailing end of the character string image will be described hereinafter. As will be described later, the trailing end detection is necessary for determining a segmentation position of the character string. Referring to Figs. 2 a and 2 b , the character image is disintegrated into the character lump V Next, the product T₅ P, i.e., the product of a preset parameter T₅ T₅ T₄ and the character pitch P is calculated. The section from a leading end of trailing end candidate section W A trailing end section E is determined by working out the logical product of the first candidate section W The trailing end section can be set in other manner. For example, the blank space of a trailing end of the character line may be set as a trailing end section. Further, when a segmentation candidate section k 1 is set by using of the segmentation candidate section k, and if the segmentation candidate position x k 1, i Next, a process for determining the character segmenting position will be described hereinafter. In Fig. 3, positions indicated by a black dot represent each segmentation candidate position x k, i First, symbols to be used for the description will be defined A symbol µ Character segmenting positions from the segmentation candidate section r r 0 in Fig. 3 working as a leading end to the segmentation candidate section n n 4 in Fig. 3 working as a trailing end are obtained by determing segmentation candidate positions x r, i The segmentation candidate position for minimizing the formula 2 can be determined according to the following dynamic programming. An optimum segmentation candidate position x k, i The segmentation candidate position x k, i Here, with reference to each segmentation candidate position x 0, i₀ i₀ 1 in Fig. 3 of the segmentation candidate section k 0 working as a leading end, the optimum mean value µ Next, a calculating process of the formulas 3 1 and 3 3 is described referring to Fig. 3. In the drawing, R µ, U represents the mean value µ d 0, 1 i₀, i For example, the segmentation candidate position x 2, 1 exists at a position 39, and a distance d 1, 2 1, 1 from the segmentation candidate position x 1, 1 is 19. Accordingly, a mean value µ Similarly, an appreciation standard U 0, 2 at the segmentation candidate position x 2, 1 in a path through the segmentation candidate position x 1, 2 , is 1.26. The start point of the path toward the segmentation candidate position x 2, 1 , namely the segmentation candidate positions x 1, 1 or x 1, 2 is selected such that the appreciation standard U takes a minimum value. Accordingly, an optimum segmentation candidate position of the segmentation candidate section k 1 toward the segmentation candidate position x 2, 1 is x 1, 1 because U 0, 2 is smaller than U 0, 2 . Further, the mean value µ d 0, 2 19.5 and the appreciation standard U 0, 2 0.38 are selected. Thus, an appreciation standard U 0, k k 0, 1, 2, 3, 4 at each segmentation candidate position x k, i As described previously, the trailing end section E includes the segmentation candidate positions x 4, 2 , x 4, 3 and x 4, 4 of the segmentation candidate section k 4. One of the segmentation candidate positions x 4, 2 , x 4, 3 and x 4, 4 whose appreciation standard U 0, 4 is minimum is selected as an end position of the character segmentation. Accordingly, the position x 4, 2 is selected as the end position because its appreciation standard is 20.3 while others are 20.5 and 20.8. Finally, x 4, 2 81, x 3, 3 60, x 2, 2 40, x 1, 1 20, x 0, 1 0 are selected as segmenting positions by tracing the path of optimum segmentation candidate positions reversely from the character segmentation end position x 4, 2 . Namely, positions 0, 20, 40, 60 and 81 are determined as sectioning positions. A logical block for the above processing is shown in Fig. 4. A scanner 1 scans a character string image printed on a sheet of paper optically and transforms it into an electrical signal. The character string image is binary quantized and stored in a character string image memory 2. A character lump extraction unit 3 extracts character lumps of the character string image out of the character string image memory 2 in sequence and stores position, width and height of each character lump Vi to a character lump information register 21. Such character lump extraction unit 3 can be realized according to a known technique. A character pitch detector 4 estimates the character pitch P by means of position, width and height of each character lump Vi stored in the character lump information register 21. The estimated character pitch is stored to a character pitch information register 22. The character pitch detector 4 will be described in detail hereinafter. Here, the character pitch P is already known, the known character pitch P may be used. A parameter information register 30 stores parameters T₁, T₂, T₃, T₄, T₅, β which are various thresholds and weighting factor as described hereinbefore. A permissible section extraction unit 5 extracts the permissible sections Ai satisfying the above described condition 1 and condition 2 . The position and height of the section Wi are extracted by a comparator or others referring to the position and width Vi of a plurality of character lumps stored in the character lump information register 21. Next, each character lump width Vi is compared with the sum P T₁ of the character pitch P stored in the character pitch information register 22 and the parameter T₁ stored in the parameter information register 30. If the width Vi is larger than the sum P T₁, a value T₂ stored in the parameter information register 30 is excepted from both ends of the character lump width Vi, and the permissible section satisfying the condition 2 is extracted. The position and width of the permissible sections Ai are stored in a permissible section information register 23. A trailing end candidate section extraction unit 6 calculates the product T₄ P of the parameter T₄ stored in the parameter information register 30 and the character pitch P. Then, the unit 6 compares the product T₄ P with the blank space Wi stored in the permissible section register 23. The blank space W A segmentation candidate section extraction unit 7 extracts each segmentation candidate position x k, i Contents of the segmentation candidate position information register 25 are transferred to an appreciation standard arithmetic operation unit 8. When the segmentation candidate position x k 1, i When the segmentation candidate position x k 1, i Then, the minimum value of the appreciation standard U 0, k 1 is defined, and the segmentation candidate position x k, i . Further, minimum value of the appreciation standard U 0, k 1 , mean value µ d 0, k 1, i₀, whereat the appreciation standard U 0, k 1 is minimized in value, and square cumulative sum D k 1 of the distance are stored to the optimum segmentation position information register 26 together with the segmentation candidate position x k 1, i Next, the control unit 10 instructs the segmentation candidate section extraction unit 6 for extraction of the segmentation candidate positions x k 2, i The control unit 10 then checks whether or not the segmentation candidate position x k 1, i Next, the control unit 10 detects the segmentation candidate positions x e, i The control unit 10 further detects a sequence of optimum segmentation candidate positions reaching the segmentation candidate position x n, i Next, the control unit 10 detects a constant range set according to the character pitch P within the blank space from the trailing end position x n, i Thus, character segmenting positions of the character string image Fig. 1 a are stored to the character segmenting position register 27. The character string image is segmented per character by means of the height of each character lump stored in the character lump information register 21 and the character segmenting position stored in the character segmenting position register 27. Segmented characters are read by a known character recognition system. The appreciation standard arithmetic operation unit 8 will now be described in detail with reference to Fig. 5. When the segmentation candidate positions x k 1, i A statistic calculation unit 82 calculates a mean value µ Next, a comparator 85 compares an appreciated value put out from the appreciated value calculation unit 84 with a content of a minimum appreciated value register 86. If the output of the appreciated value calculation unit 84 is smaller than the content of the minimum appreciated value register 86, an output signal 851 turns ON . Initially, a sufficiently large value is set in the minimum appreciated value register 86. When the output signal 851 turns ON , a gate circuit 53 opens, and an output of the appreciated value calculation part 84 is transferred to the minimum appreciated value register 86. Further, when the output signal 851 turns ON , a gate circuit 52 opens, and the mean value µ The above operation is applied to all segmentation candidate positions x k, i That is, at this time, the optimum mean value µ 0, k 1 i₀, i The optimum appreciated value and the optimum segmentation path relating to all the segmentation candidate positions x k 1, k The character sectioning apparatus as described above can section a character string into individual characters easily and stably even if the character string includes touching characters and one character is splited into two or more images. Next, the character pitch detector 4 will be described in detail. Fig. 6 represents a character string image for describing a distance between character lumps. The character lump is indicated by oblique lines and is given in a rectangular area broken line . A reference symbol F Besides, the distance between character lumps for the observed value constituting the frequency distribution can be limited as far as the distance F Referring to Fig. 7, which is one example of a frequency distribution of the distance between a series of character lumps having a constant pitch character as shown in Fig. 6. An axis F of abscissas indicates a value of the distance F Figs. 8 a and 8 b represent an example of a frequency distribution of the distance between a series of character lumps in a constant pitch data and an alphabetical variable pitch data, respectively. A principle of detecting a character pitch will be then described. With reference to Fig. 7 and Figs. 8 a and 8 b , the mean character height H Next, the frequency distribution is divided into areas f ₁, f ₂, ... f An estimated character pitch P and can be obtained by means of an optimal linear estimating technique. In this technique, a plurality of differences between a value 1 k P k n Accordingly, the following pitch estimation error appreciation standard variance criterion T which works as the appreciation standard for optimal estimation is employed. where the coefficient C k, n As an example of this coefficient, can be used. Further, the estimation error appreciation standard T of the formula 4 is a variance of estimation error. However, an appreciation standard based on an absolute value 1 k Next, a character pitch identifying technique will be described with reference to Figs. 7, 8 a and 8 b . The frequency distribution of the distance between character lumps having a constant pitch printed character Fig. 8 a is different from that having a variable pitch printed character Fig. 8 b . The difference can be identified by appreciating a plurality of variances σ² f where the coefficient C k, n As an example of this coefficient, can be employed. Here, an error appreciated value ε can be used instead of the above described variance appreciated value ε². If the variance appreciated value ε² or the error appreciated value ε is greater than a preset threshold α₄, the character string can be segmented by means of the estimated character pitch P and as a main component, namely, the character string has a constant character pitch. If the variance appreciated value ε² or the error appreciated value ε is less than the threshold α⁴, the character string cannot be segmented by means of mainly the estimated character pitch P and, namely, the character string has a variable character pitch. Thus, a property of the character pitch can be identified. A stable character segmentation will be ensured by the character sectioning apparatus shown in Fig. 4, in the case that the character string has a constant character pitch. On the other hand, if the character string has a variable character pitch, the characters can be segmented according to other character segmentation technique based on a blank space of the character line image, for example. Fig. 9 is a block diagram of a character pitch detector. A leading edge position and a size of each character lump are stored to the character lump register 21 by means of the scanner 1, the character string image memory 2 and the character lump extraction unit 3. The size of the character lump means a width and a height of the character lump. An another control unit 41 calculates a distance between character lumps by means of a leading end position and a trailing end position of the character lumps. The leading and trailing end positions are transferred in sequence from the character lump register 21. Then, the control unit 41 increases a frequency corresponding the distance between character lumps. The frequency is stored in a frequency distribution table 42 at an address position indicating the distance between character lumps. Thus, the frequency distributions of the distance between character lumps as shown in Figs. 7, 8 a and 8 b are generated in the frequency distribution table 42. Initially, the frequency distribution table 42 is initialized at 0 at first. Next, the control unit 41 calculates the mean height H A presence section arithmetic operation unit 45 calculates values 1 α₃ F 1 and 1 α₃ F 1 by means of the distance F 1 by means of the presence section detector 43 and the coefficient α₃ from the constant register 44. Then, the arithmetic operation unit decides MAX α₁ H Then, the lower bound value P A minimized estimation error appreciated value T is stored to an appreciated value register 50. Initially, a sufficiently large value is set in an optimum character pitch register 54 as the estimation error appreciated value. A comparison unit 55 compares the estimation error appreciated value T transferred from the estimation error appreciated value arithmetic operation unit 49 with a content of the appreciated value register 50. When an output value of the estimation error appreciated value arithmetic operation unit 49 is smaller than the content of the appreciated value register 50, the comparison unit 55 writes the output value of the estimation error appreciated value arithmetic operation unit 49 in the appreciated value register 50, and writes a value of the candidate character pitch P When the optimum estimated character pitch P and is set in the optimum character pitch register 54, a variance appreciated value arithmetic operation unit 56 calculates a range of n pieces of areas of the frequency distribution, namely, a lower bound value k P and 1 2 P and and an upper bound value k P 1 2 P and of the area f A threshold register 58 stores a threshold α₄ for identifying the character pitch. A comparator 59 identifies a property of the character pitch by comparing the variance appreciated value ε² stored in the variance appreciated value register 57 with the threshold α₄ stored in the threshold register 58. That is, if the variance appreciated value ε² is larger than the threshold α₄, the comparator 59 decides that a method for determining the character segmenting position with the estimated character pitch P and as a main component cannot be applied if the variance appreciated value ε² is smaller than the threshold α₄, the comparator 59 is decided that the method for determining the character segmenting position with the estimated character pitch P and as a main component can be applied. In the latter case, the estimated character pitch P and stored in the optimum character pitch register 54 and the variance appreciated value ε² stored in the variance appreciated value register 57 are transferred to the character pitch information register 22. In the former case, a plurality of character lump images stored in the character lump register 21 are segmented according to another character segmenting method. In the character pitch detector, a character pitch can be measured accurately even if the character string includes touching characters or splited characters. Further, a property of the character pitch can be grasped securely, thereby selecting a character segmenting method with high adaptability.