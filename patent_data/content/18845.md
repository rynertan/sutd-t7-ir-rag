# Data handling circuits.

## Abstract
A telephone system with central processor control has telephones including respective data circuits. Each data circuit scans a respective keypad and stored data relating to the state of the keys thereon. The stored data is forwarded to the central processor on demand from the processor. The data circuit scans the keys of the keypad and then scans a data input connected to the central processor. On detection of a prefix pulse from the central processor the data circuit makes repeated samples of this data input until detection of a start pulse. Once the start pulse has been detected the data circuit scans the data input at the bit rate. If a key of the keypad changes state more than once between each demand from the processor, the respective data relating to the subsequent change is not modified by the data circuit.

## Claims
1. A data handling circuit comprising means for receiving bursts of pulses, means to sample an input of said receiving means at a first periodic rate, means to increase the sampling rate to a second periodic rate on detection of the presence of a first pulse of one of said bursts of pulses and means to alter said sampling rate to a third periodic r e on detection of a further pulse of said burst of pulses. 2. A data handling circuit as claimed in Claim 1 in which the first periodic rate is substantially slower than the rate of transmission of said pulses, the second periodic rate is substantially higher than the rate of transmission of said pulses and the third periodic rate is substantially the same as the rate of transmission of said pulses. 3. A data handling circuit as claimed in Claim 1 or Claim 2 in which the means to sample an input of the receiving means is a microprocessor. 4. A data handling circuit as claimed in any preceding Claim including means to scan a plurality of variable state means at a substantially periodic rate to detect the status thereof and to store datas in respect of the detected status of each of said variable state means and means to transmit said stored data over a data path to receiving or control means. 5. A data handling circuit as claimed in Claim 4 in which the stored data is transmitted over the data path in response to signals received from the receiving or control means. 6. A data handling circuit as claimed in Claim 5 in which the means to scan a plurality of variable state means includes means to inhibit alteration of the data stored in respect of any one of said plurality of variable state means if a plurality of changes of status of the respective one of said plurality of variable state means occur between successive transmissions of the stored data to the receiving or control means. 7. A data handling circuit as claimed in any preceding Claim in which each burst of data pulses received determines which if any of a plurality of electrically operable means shall be activated. 8. A data handling circuit comprising means to scan a plurality of variable state means at a substantially periodic rate to detect the status thereof and to store data in respect of the detected status of each of said variable state means, and meansaibsequently to transmit said stored data over a data path to receiving or control means. 9. A data handling circuit as claimed in Claim 1 in which said stored data is transmitted over the data path in response to signals received from the receiving or control means. 10. A data handling circuit as claimed in Claim 8 or Claim 9 in which the means to scan the plurality of variable state means includes means to inhibit alteration of the data stored in respect of any one of said plurality of variable state means if a plurality of changes of status of the respective one of said plurality of variable state means occur between successive transmissions of said stored data to the receiving or control means. 11. A data handling circuit as claimed in any one ofClaims 8 to 10 in which said means to scan the plurality of variable state means is a microprocessor. 12. Telephone apparatus comprising a plurality of manually operable switches, means to scan said plurality of switches at a substantially periodic rate to detect the status thereof and to store data in respect of the detected status of each of said plurality of switches, and means subsequently to transmit said stored data over a data path to receiving or control means. 13. Telephone apparatus as claimed in Claim 12 in which said means to scan the plurality of switches includes means to inhibit alteration of the data stored in respect of any one of said switches if a plurality of changes of status of the. respective switch occur between successive transmissions of said data. 14. Telephone apparatus as claimed in Claim 12 orClaim 13 in which the means to scan the plurality of switches is a microprocessor and a first contact of each of a first plurality of the switches is connected to one of a plurality of outputs of the microprocessor and a second contact of each of the first plurality of switches is connected to a respective one of a plurality of inputs of the microprocessor. 15. Telephone apparatus as claimed in Claim 14 in which a first contact of each of a second plurality of the switches is connected to a different one of said plurality of outputs of the microprocessor and a second contact of each of the second plurality of switches is connected to a respective one of the plurality of inputs of the microprocessor. 16. A data handling circuit substantially as hereinbefore described with reference to Figures 2 and 3 of the accompanying drawings. 17. Telephone apparatus substantially as hereinbefore described with reference to the accompanying drawings.

## Description
This invention relates to data kindling circuits and, in particular but not exclusively, to such circuits used to receive bursts of data pulses from data processing devices in telephone apparatus. In telephone apparatus comprising a central control unit and a number of associated telephone stations, the telephone stations are often quiescent for long periods between calls. It is, however, necessary for the central control unit to respond quickly to any change occurring at any one of the telephone stations. It is therefore desirable for each telephone station to be continuously monitored and for data relating to changes occurring at the telephone stations to be communicated to the central control unit within a reasonable period of time. Furthermore if the telephone system sets up required speech connections between telephone station in response to operation of push buttons care must be taken to ensure that the control unit does not fail to respond to operation of a push button which is only depressed for a short period of time. According to one aspect of the present invention a data handling circuit comprises means for receiving bursts of pulses means to sample an input of said receiving means at a first periodic rate, means to increase the sampling rate to a second periodic rate on detection of the presence of a first pulse of one of said bursts of pulses and means to alter said sampling rate to a third periodic rate on detection of a further pulse of said burst of pulses. Preferably, the first periodic rate is substantially slower than the rate of transmission of said pulses, the second periodic rate is substantially higher than said rate of transmission and the third periodic rate is substantially the same as said rate of transmission. According to another aspect of the present invention a data handling circuit comprises means to scan a plurality of variable state means at a substantially periodic rate to detect the status thereof and to store data in respect of the detected status of each of said variable state means, and means subse quently to transmit said stored data over a data path to receiving or control means. Preferably the stored data is transmitted over the data path in response to signals received from the receiving or control means. Alternatively the stored data may be transmitted over the data path to the receiving or control means at periodic intervals. The means to scan the plurality of variable state means may include means to inhibit alteration of the data stored in respect of any one of said plurality of variable state means if a plurality of changes of status of the respective one of said plurality of variable state means occur between successive transmissions of said stored data to the receiving or control means. According to a further aspect of the present invention telephone apparatus comprises a plurality of manually operable switches, means to scan said plurality of switches at a substantially periodic rate to detect the status thereof and to store data in respect of the detected status of each of said plurality of switches, and means subsequently to transmit said stored data over a data path to receiving or control means. Preferably said means to scan the plurality of switches includes means to inhibit alteration of the data stored in respect of any one of said switches if a plurality of changes of status of the respective switch occur between successive transmissions of said data. One example of telephone apparatus including a data handling device in accordance with the present invention will now be described with reference to the accompanying drawings of which Figure 1 shows the apparatus in block diagram form, Figure 2 shows a part of Figure 1 in greater detail, and Figure 3 shows waveforms illustrating the operation of a data interface and central control unit of Figure 1. Referring first to Figure 1 there is shown telephone apparatus comprising a central control unit 1, a concentrator 2 and three telephone stations 3, 4 and 5. Each of the telephone stations 3, 4 and 5 comprises a data handling circuit or data interface 6, a telephone instrument 7, a display panel 8 and a keypad 9. Each telephone instrument 7 has access via a respective speechpair 11 and the concentrator 2 to an exchange line 10 under control of the central control unit 1. Referring also to Figure 2, each data interface 6 comprises a microprocessor 13 the speed of operation of which is controlled by a frequency controller 14, an input buffer circuit 15 and an output buffer circuit 16. The microprocessor 13 receives data from the central control unit 1 via a respective data pair 12 and the input buffer circuit 15. The received data is used by the microprocessor 13 to determine which, if any, of a set of lamps or light emitting diodes 21..28 shall be illuminated. An audible alarm not shown may also be controlled in similar manner. The microprocessor also detects which, if any of contacts 41 to 48 to keys or switches of the kaypad 9 are operated and stores data relating to the operation of these keys in an internal memory not shown 0 The data relating to the operation of the keys is transmitted via the output buffer 16 and the data pair 12 to the central control unit 1 after receipt of the data from the central control unit 1.One of the contacts 41 to 48 may in practice be contacts of the switch hook of the associated telephony instrument 7. When no data interchange is occurring between the central control unit 1 and the data interface 6, the microprocessor 13 scans the contacts 41 to 48 of the keypad 9 to determine which,if any, of the keys are operated the microprocessor 13 applies a signal to each of the outputs 50 to 53 in sequence and examines inputs 17 and 18 for the return of the signal.If, for example, only the key associated with the contacts 42 were operated then a signal on output 52 would appear at input 17 only. Signals on outputs 50, 51 and 53 would not appear at either of the inputs 17, 18. On completion of the scanning of the keypad 9, the microprocessor 13 samples input 19 to determine whether a burst of data is about to be received from the central control unit 1. This is indicated by a prefix pulse, which is a change in the binary state of the input 19 and which precedes the burst of data.If this prefix is not present the microprocessor 13 returns to scanning the keypad 9 as previously described. If a prefix pulse is present at the input 19, the microprocessor 13 ceases scanning the kaypad 9 and takes repeated samples of input 19 until a further change in the binary state of that input 19 indicates the conclusion of the prefix and the commencement of the start bit of the incoming burst of data0 The microprocessor 13 now alters its rate of sampling input 19 so that it samples this input at substantially the bit rate of the incoming burst of data. The microprocessor 13 of each data interface 6 runs under the control of its respective internal clock not shown which clock is conrolled by a respective frequency controller 14. The respective clock of each microprocessor 13 is arranged such that when data is being received from the central control unit 1 the sampling of the respective input 19 occurs at substantially the same rate as the rate of transmission of the bits by the central control unit 1. This rate is referred to herein as the bit rate. The time taken by the central control unit 1 to transmit one data pulse is referred to as a bit periode Before the microprocessor 13 takes its first sample of the incoming data stream, that is upon detection of the conclusion of the prefix pulse, it delays for half of one bit period. As the microprocessor 13 is sampling the input 19 at substantially the bit rate this ensures that each bit of the incoming data burst is sampled substantially half way through the respective bit period. Having received the incoming data burst, the microprocessor 13 delays for approximately two bit periods and then transmits to the central control unit 1 the stored data relating to the operation of contacts 41 to 48. On completion of the transmission of the stored data, the microprocessor 13 uses the data received from the central control unit 1 to illuminated or extinguish designated lamps of the display panel 8 or to sound or cancel the audible alarm not shown . Referring now to Figure 3 the signalling sequence between the central control unit 1 and each of the telephone stations 3, 4 and 5 will now be described in greater detail. The central control unit 1 scans each respective data pair 12 of the telephone stations 3, 4 and 5 in sequence. When the central control unit 1 commences a scan of the data pair 12 of, for example, the telephone station 3 it causes a signal 60 representing a binary 1 to be applied to the data pair 12. The signal 60, referred to herein as the prefix pulse, is maintained by the central control unit 1 for three bit periods. As previously described the data interface 6 is sampling the data pair 12 at a slow sampling rate of, say, between once very two bit periods and once every 2.75 bit periods, and times at which sampling of the data pair occurs at the slow sampling rate are shown as sampling points 68. Since the prefix 60 is maintained on the data pair 12 for three bit periods, at least one of the sampling points 68 must occur before the prefix 60 is removed.When the prefix 60 is detected by the data interface 6 the sampling rate is increased, as indicated by sampling points 69, to six times the bit rate. When the three bit periods have elapsed, the central control unit 1 causes a binary 00 signal to be applied to the data pair 12. This signal, referred to as the start bit 61, is maintained by the central control unit 1 for one bit period. The change in the binary state of the data pair 12 is detected by the data interface 6 within one sixth of a bit period and the interface 6 then alters its sampling rate to substantially the bit rate as indicated by sampling points 70. On completion of the start bit 61 the central control unit 1 causes binary data signals 62 to be applied sequentially to the data pair 12 representing eight data bits. The data signals 62 will be received and stored by the data interface 6 as previously explained. The central control unit 1 must now receive data relating to the operations of contacts 41 to 48 of the keypad 9 of the telephone station 3 Transmission of this data commences after a period 20 of approximately two bit periods. During this period 20, the central control unit 1 takes repeated samples of the data pair 12 at a rate of approximately six times per bit period, indicated by sampling points 71.The data interface 6 applies a signal 64 representing a binary tlf to the data parr 12 to indicate the start of a burst of data pulses to the central control unit 1 representing the stored data relating to the operation of keys of the kaypad 9. The signal 64 is detected by the central control unit 1 which then alters its sampling rate to the bit rate as indicated by sampling points 72. On completion of the start signal 64 the data interface 6 applies binary signals 65 to the data pair 12 representing eight data bits relating to the operation of the keys of the keypad 9. The signals 65 will be received and stored by the central control unit 1. The central control unit 1 now delays for one bit period 66 and then commences a scan of the respective data pair 12 of the subsequent telephone station 4 by causing a binary Ilt signal 67 to be applied to that data pair followed by a respective burst of data for the telephone station 4. When all of the respective data pairs 12 of the telephone stations 3, 4 and 5 have been scanned in the manner described above the central control unit 1 reacts to the data it has received by for example causing the concentrator 2 to set up a connection between one of the telephone stations 3, 4 and 5 and the exchange line 10. During this period, which is not necessarily of fixed duration no scanning of the data pairs 12 takes place. When the central control unit 1 has completed all tasks required of it by the data received from the telephone stations 3, 4 and 5 the scanning sequence described above is repeated. Access to the exchange line 10 from, for example, the telephone station 3 is achieved in the following manner the handset of the telephone instrument 7 is raised and a key of the respective keypad 9 indicating that connection to exchange line 10 is required, is operated. The raising of the handset and operation of the key is detected by the respective data interface 6 which, when scanned, transfers data relating to these actions to the central control unit 1. On completion of scanning of all of the telephone stations 3, 4 and 5 the central control unit 1 causes the concentrator 2 to set up a connection between the exchange line 10 and the respective speechpair 11 of the telephone instrument 7 of the telephone station 3. Transfer of dial impulses and speech may then take place in known manner. On its subsequent scan of the telephone stations 3, 4 and 5, the central control unit 1 sends data to the respective data interface 6 of each telephone station indicating te the data interfaces 6 that the exchange line 10 is in use. On receipt of this data, the data interface 6 causes a lamp on its associated display panel 8 to be illuminated, indicating that the exchange line 10 is in use. When the telephone handset of the telephone station 3 is replaced, this is detected by the associated data interface 6 which signals this information via its respective data pair 12 to the central control unit 1 in the manner previously described. On com pletion of its scan of the data pairs 12, the central control unit 1 causes the concentrator 2 to release the connection between the exchange line 10 and the respective speech pair 11 of the telephone station 3.On the subsequent scan of the data pairs 12, the central control unit 1 sends data to the respective data interfaces 6 of each telephone station 3, 4 and 5 to cause them to extinguish the lamp indicating that the exchange line 10 is in use. Other keys on the kaypad 9 may, for example, be used, to request connection to one of the other telephone stations or to request that incoming calls are not connected to the respective telephone station associated with that keypad. Other lamps on the display panel 8 may serve to indicate which, if any, of the telephone instruments 7 is in use or to indicate that calls intended for another of the telephone stations 3, 4 and 5 are being automatically directed to the telephone instrument associated with this display panel. In a larger system not shown of a similar kind to that described above there may be a greater number of telephone stations. The scanning cycle of the central control unit 1 will therefore be longer and in a system including, say, ten such telephone stations the time taken to scan all of the data pairs 12 is of the order of 37.5 milliseconds. Between the scanning of the last of the data pairs and the subsequent scanning of the first of the data pairs there is a period of the order of 25 milliseconds during which the central control unit 1 carries out its control functions. Thus between any one scan of thedata pair 12 of the telephone station 3 for example and the next scan thereof, a period of the order of 62.5 milliseconds elapses. This period of 62.5 milliseconds is longer than the minimum operate and release time of the contacts 41 to 47 of the keys of the keypad 9, which is of the order of 40 milliseconds. Therefore if the data relating to the contacts 41 to 48 is directly communicated to the central control unit 1 a minimum operation of a key of the keypad 9 may be missed. The microprocessor 13 is arranged to sample the contacts 41 to 48 at intervals much shorter than the minimum operate and release time of those contacts.The microprocessor 13 applies signals in sequence to its outputs 50 to 53 and then determines which, if any, of the contacts 41 to 48 are closed by examination of its inputs 17 and 18. If for example only contacts 44 were closed then a signal applied by the microprocessor 13 to its output 50 would appear at input 17 only. Signals on outputs 51, 52 and 53 would not appear at either of the inputs 17 and 18. On detection of the closure of a set of contacts the microprocessor 13 sets a respective bit in the internal memory not shown relating to the set of contacts which have been detected as closed. The microprocessor 13 continues to scan the contacts 1 to 48 for any further change in condition until a change in the binary state of input 19 indicates receipt of a start signal which precedes the transmission of a burst of data from the central control unit 1. If the microprocessor detects a further change in the state of a set of contacts before it has transferred data relating to a first change in the state of that set of contacts, the microprocessor does not amend the respective bit in its internal memory until after the transfer of data to the central control unit 1. Data relating to the further change in status of the set of contacts will be transferred to the central control unit 1 on its subsequent scan of the respective data pair 12.