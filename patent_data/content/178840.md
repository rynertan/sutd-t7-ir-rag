# TONE SIGNAL PROCESSING DEVICE

## Claims
Elektronisches Musikinstrument mit einer Taktgebereinrichtung zum Bereitstellen eines Taktsignales ø₀ relativ hoher Frequenz, das eine zugehörige Taktperiode hat,

## Description
This invention relates to a tone signal processing device suitable for use in resampling at a lower rate a tone signal which has been sampled once with a sampling frequency of a relatively high rate. An electronic musical instrument which has overcome the problem of an aliasing noise produced in the sampling process by harmonising the sampling frequency of a tone signal to be generated with the pitch of the tone signal is well known as a pitch synchronous type electronic musical instrument. An example of such a pitch synchronous type electronic musical instrument is disclosed in Japanese Patent Publication No. 171395 1982 particularly Fig. 5 . Since, in this type of electronic musical instrument, the sampling frequency is different for each note, the frequency of a basic sampling clock used commonly for establishing the respective sampling frequencies must be the least common multiple of these sampling frequencies, which naturally is a fairly high frequency e.g., 800 kHz . The fact that the sampling frequency of a tone signal generated by a pitch synchronous type electronic musical instrument is of a high rate gives rise to the problem that the sampling frequency is too high when this device is applied to a device such as a digital effect device which operates with a clock frequency of a lower rate. Hence an arrangement is adopted so that a digital tone signal supplied at a high frequency is resampled at a lower frequency and the digital tone signal thus converted to a digital signal of lower rate frequency is applied to a digital effect circuit. With such an arrangement, however, there arises the problem that high frequency components contained in the original tone signal of the high rate sampling frequency appear as an aliasing noise with respect to the low rate sampling frequency. DE A 3226600 discloses, in Figure 24, a digital filter which allegedly serves to eliminate aliasing noise. Whilst this reference fails to disclose the detailed construction of the digital filter, it is believed that this will have the disadvantage that the tone signal outputted by the filter will be at a considerably lower sampling frequency, e.g. 12.5 kHz, than the sampling frequency of 50 kHz of the succeeding effect imparting device. Although it may be possible to match the two frequencies by resampling of the tone signal sample data at a clock frequency of 50 kHz, the precision of the output tone signal will be maintained at 12.5 kHz since the resampling will simply result in repetition of the same sample data. Accordingly the tone signal will be greatly degraded in quality by undue reduction of the sampling rate. It is an object of the invention to provide an improved tone signal processing device for an electronic musical instrument. According to the present invention, there is provided an electronic musical instrument comprising Thus the high frequency components which are likely to produce an aliasing noise with respect to the low rate sampling frequency are removed from a digital tone signal by the digital filter. Accordingly the problem of the aliasing noise is eliminated in the case where a device using a relatively low clock rate such as a digital effect device is connected to a stage after the sampling means for imparting various tone effects. The invention also provides a tone signal processing device comprising at least clock means for providing a clock signal having a relatively high frequency ø₀ and having an associated clock period, tone signal generation means for providing a digital tone signal having a plurality of channels and having a first sampling period which corresponds to a first sampling frequency ø₁ and based on which each cycle of said digital tone signal is formed by sampling at a specific number of sample points, and sampling means for resampling said digital tone signal at a second sampling frequency which is lower than said first sampling frequency ø₁ , characterised in that the device further comprises The invention further provides a tone signal processing method comprising providing a clock signal having a relatively high frequency ø₀ and a clock period associated therewith, processing a digital tone signal having a first sampling period which corresponds to a first sampling frequency ø₁ , and resampling said digital tone signal at a second sampling frequency which is lower than said first sampling frequency, characterised in that said processing comprises In order that the invention may be more fully understood, a preferred embodiment of the invention will now be described, by way of example, with reference to the accompanying drawings, in which Referring to Fig. 1, tone signal generation means 1 generates tone signals corresponding to respective tone pitches i.e., note names in digital according to the pitch synchronizing system. Tones to be generated are designated by a keyboard not shown or other suitable means. This tone signal generation means 1 generates one or more digital tone signals of different tone pitches note names in a mixed state and, accordingly, the sampling frequency corresponds to the least common multiple of sampling frequencies which are synchronized in pitch with the respective tone pitches when these digital tone signals are viewed as a whole, which sampling frequency therefore is of a fairly high rate e.g., 800 kHz . For such tone signal generation means 1 of the pitch synchronizing type, the device shown in the above mentioned Japanese Preliminary Patent Publication No. 171395 1982 or Japanese Patent Application No. 2667 1984 corresponding to EP 85100233.7 can be utilized. A digital tone signal produced by the tone signal generation means 1, i.e. a high rate sampled wave signal, is supplied to a sound system 3 via a digital to analog converter 2 and sounded therefrom. The digital tone signal provided by the tone signal generation means 1 is supplied also to a system including a digital effect imparting device 4. The digital effect imparting device 4 is a digital circuit for selectively imparting the digital tone signal with effects such as vibrato, chorus, ensemble and reverberation effects. Digital tone signals which are subjects of this digital effect imparting device 4 are of a relatively low rate sampling frequency e.g., 50 kHz . For such digital effect imparting device 4, the device shown in Japanese Preliminary Patent Publication No. 50595 1983 corresponding to US P4,472,993 or other suitable device can be used. The digital tone signal provided by the digital effect imparting device 4 is supplied to a sound system 6 via a digital to analog converter 5. A resampling device 7 is provided between the tone signal generation means 1 and the digital effect imparting device 4 for converting the sampling frequency of the digital tone signal provided by the tone signal generation means 1 from a high rate one e.g., 800 kHz to a low rate one e.g., 50 kHz . The digital tone signal which has been resampled with the low rate sampling frequency in this resampling device 7 thereafter is applied to the digital effect imparting device 4. A digital filter 8 is provided between the tone signal generation means 1 and the resampling device 7. This digital filter 8 filters the digital tone signal which are subjected to a high rate sampling frequency with such filter characteristics as to be able to substantially remove an aliasing noise with respect to the low rate sampling frequency e.g., 50 kHz . As will be apparent from the sampling theorem, the aliasing noise occurs in the frequency region over 1 2 of the sampling frequency so that the filter characteristics of the digital filter 8 should preferably be set to a low pass filter with a cut off frequency equivalent to one half the low rate sampling frequency for removing the aliasing noise. A specific example of the device will be described hereunder on the assumption that the high rate sampling frequency of 800 kHz and the low rate sampling frequency of 50 kHz are used. A sample value of the digital tone signal of the high rate sampling frequency provided by the tone signal generation means 1 is designated by x A sample value of the digital tone signal provided by the resampling device 7 is designated by Z Fig. 2 shows a specific example of the digital filter 8 and the resampling device 7. The digital filter 8 employs a single multiplier 9 on a time shared basis for multiplying filter coefficient h Thus, the sample value x In the foregoing manner, each term h The latch circuit 17 has a function of resampling the output tone signal of the digital filter 8 in accordance with the low rate sampling frequency of 50 kHz and also a function of latching an accumulated value a filter output value of one sample point of the accumulator 17. As will be apparent from the foregoing description, the digital filter 8 performs a filter operation for one sample point by spending 64 periods of the clock pulse ø₀, i.e., 16 periods of the high rate sampling, i.e., one period of the low rate sampling. Accordingly, the filter output is obtained not at each sample point of the high rate sampling but every 16 sample points thereof in a skipping manner. No inconvenience, however, is caused by this arrangement, for the resampling in the latch circuit 17 has only to be performed in a skipping manner every 16 sample points and the filter output has only to be obtained at a sample point required for effecting this resampling. It is of course possible to obtain a filter output at each sample point by modifying the device in such a manner that speed of the time division operation of the digital filter 8 is increased or, conversely, providing plural multipliers 9 in correspondence to the respective delay stages and resample this filter output in a skipping manner in accordance with the low rate sampling frequency. For better understanding of the invention, an example of signals appearing in some parts of the circuit shown in Fig. 2 are shown in Fig. 3. In the figure, A, B, C and D represent sample values x For further understanding of the invention, examples of the waveshape and frequency characteristics of the tone signal are illustrated. Fig. 4 is a waveshape diagram showing an example of the digital tone signal supplied in accordance with the high rate sampling frequency of 800 kHz. Fig. 5 is a diagram showing frequency component characteristics of the waveshape shown in Fig. 4. In Fig. 5, all frequency components are not shown due to the limitation in illustration and it should be understood that components exist even in a high frequency region over 100 kHz. Fig. 6 shows low pass filter characteristics realized by the digital filter 8 consisting of an FIR filter of 64 stages with its cut off frequency being set at 25 kHz. A waveshape obtained by passing the waveshape of Fig. 4 through the digital filter 8 of the low pass filter characteristics of Fig. 6 is shown in Fig. 7. Frequency component characteristics of the waveshape of Fig. 7 are shown in Fig. 8 from which it will be noted that components below 25 kHz have substantially been cut off. Frequency component characteristics of a waveshape obtained by resampling the waveshape of Fig. 7 with the low rate sampling frequency of 50 kHz are shown in Fig. 9. It will be seen from Fig. 9 that the waveshape has no aliasing noise but consists only of harmonic components. For the sake of comparison, frequency component characteristics of a waveshape obtained by resampling the waveshape of Fig. 4 at the low rate sampling frequency of 50 kHz without using the filter are shown in Fig. 10. The black beard like portions are crowded frequency components caused by an aliasing noise. The digital filter employed in the present invention is not limited to the above described FIR filter of 64 stages but any type of filter including an FIR filter of other number of stages or an IIR filter infinite impulse response filter may be used. The above embodiment has been described with respect to the example in which the high rate sampling frequency of 800 kHz is converted to the fixed low rate sampling frequency of 50 kHz. Relationship between the high rate frequency and the low rate one is not limited to this but other ratio may be selected as desired. The low rate sampling frequency for the resampling is not limited to a fixed one but may be one which varies with time for producing a modulation effect. The tone signal generation means is not limited to a polyphonic type device but a monophonic type device may also be employed. The invention is applicable not only to a device including the pitch synchronous type tone signal generation means but to any device in which the high rate sampling frequency is converted to a low rate sampling frequency. According to the invention, a digital tone signal of a high rate sampling frequency is converted to one of a low rate sampling frequency after passing the digital tone signal through the digital filter 8 and an aliasing noise thereby can be removed with respect to the low rate sampling frequency. Accordingly, the invention is useful in a case where a modulation effect device in which an input tone signal is required to be of a relatively low rate sampling frequency is added to the electronic musical instrument, for coupling of the devices is realized without causing the problem of aliasing noise.