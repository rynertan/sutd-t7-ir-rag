# SERVO CONTROL OF A MOTOR SPEED BY USING A PHASE LOCKED LOOP

## Claims
Digitale Phasenverriegelungsschleife mit

## Description
This invention relates to phase locked loops, to servo control of motor speed by the use of a phase locked loop, and particularly to a closed loop servomechanism which includes a phase locked loop. Phase locked loops are well known in the art. In such a loop network or circuit, the phase of a reference alternating signal, as provided by a reference clock, is compared to the phase of an alternating input signal of usually variable phase. Detection of a phase difference between these two signals originates an output error signal. In the use of such a loop to control the speed of a motor, the frequency of the reference clock constitutes the command speed at which the motor should run, and the actual speed of the motor is represented by a feedback signal in the form of the aforesaid input signal. The aforesaid error signal is used to control the magnitude of motor energization, so as to bring the motor to the correct speed, thus reducing the phase error, and the error signal, to substantially zero. As can be appreciated, the servo may go out of frequency lock, i.e. the frequency of the reference clock and the feedback signal will be very different, and the phase error will be very large or saturated, during acceleration of the motor from rest to a running speed, or when a large motor speed change is requested. In this condition, the motor receives full energization. The magnitude of motor energization is now no longer closely related to the difference between the motor s actual speed and its desired speed. Eventually the circuit will come out of saturation. However, at this time the motor s speed is usually much higher than the desired speed, and although the servo subsequently brings the motor to the correct speed, this is usually accomplished only with speed overshoot and oscillation about the desired speed. The present invention corrects this problem found in prior art devices. Exemplary prior art is US A 3.936.762 where a digital phase locked loop is provided. In this device, the reference clock signal is derived by dividing a signal which is generated by a fixed frequency clock. The reference clock is compared to an input signal, and a phase error signal is generated. The phase error signal operates to delete pulses normally issued by the fixed clock source, and in this way the frequency of the reference clock signal is changed in response to phase error. This patent does not teach continuously controlling the time of occurrence of the reference clock s pulses, to be synchronized to the input signal frequency, during the time interval that the phase error remains at a maximum magnitude, such as occurs during saturation, followed by controlling the reference clock to be essentially in phase when saturation no longer exists. GB A 2 005 869 relates to a digital servo system for a rotating member which detects a difference between phases of a reference signal and a signal representating the rotation phase of the rotating member to thereby control its rotation. This document does not teach resetting the reference signal to be in phase with the input signal when a maximum phase error condition exists. It does not allow to solve the problem of overshoot by generating only a limited phase error signal when the phase detector reaches saturation. The IBM TECHNICAL DISCLOSURE BULLETIN of April 1981, at pages 5171 5173, describes a network wherein the frequency and phase of a reference clock is adjusted as a function of phase error. Here again, the network does not detect the occurrence of saturation, and the modification of the reference clock s operation as a result thereof. This invention relates to phase lock loop control systems, and has particular utility in controlling DC motors. During large speed changes of a DC motor, the phase error signal, which operates to produce changes in the motor s energization, will become very large, causing the system s phase detector to reach saturation. Due to this saturation, the prior art s motor speed is usually too high at the time that the phase detector comes out of saturation. As a result, the motor speed overshoots the desired speed. After a time, the variation in motor speed settles down and locks at the desired speed. This invention solves this speed overshoot problem by generating a much smaller phase error signal when the phase detector reaches saturation. A level of motor energization is, however, maintained to insure that the motor reaches running speed in a short time interval. This is accomplished in a digital phase lock loop by generating a new reference number NREF , to limit motor energization, so long as the phase detector remains in saturation. A feedback number TEDGE is generated, indicative of motor speed, upon the occurrence of each motor tachometer pulse. As long as the servo is saturated, this actual speed number TEDGE has not as yet caught up with the new reference number NREF , and there remains a large phase error ERRA when the next tachometer feedback pulse arrives. As a result, the detected phase error continues to cause the new reference number NREF to be adjusted to a value which would produce a phase error number ERRA equal to the constant value of RANGEL or RANGEH, whichever is in effect due to the saturation mode, when the next feedback pulse TACH occurs, under the assumption that the motor is up to speed. When the phase error number ERRA no longer exceeds some maximum value i.e. the predetermined values RANGEL and RANGEH which have been chosen as an indication of saturation , the new reference number NREF is reset to be equal to the old reference number NREF , plus the predetermined number REF whose magnitude is indicative of the command motor speed. The phase lock loop thereafter operates in the normal manner to bring the reference number and feedback number into phase sync. The numerical value of saturation constants RANGEL and RANGEH are chosen to provide a predefined and desired behavior criteria from phase compensator 13, buffer amplifier 14 and DC motor 10 FIG. 1 . For example, RANGEL and RANGEH could be chosen to avoid saturation in phase compensator 13 when a large step phase error ERR occurs. Alternatively, RANGEL and RANGEH may be chosen to provide maximum output from the phase compensator when the phase error ERR is equal to either RANGEL or RANGEH. Other possible criteria will be evident to those skilled in the art. This invention is particularly useful in the microprocessor control of motors, and represents a simple digital technique for rapidly phase locking an input and output signal together. This invention provides a digital phase detector wherein the phase error output is limited in magnitude so long as the phase detector remains in saturation. Once the phase detector is no longer saturated, the phase error becomes proportional to the actual phase error. A feature of this invention is the use of such a phase detector in a phase lock loop. A further feature is the use of such a phase lock loop for DC motor speed control. FIG. 1 is a block diagram showing use of the present invention used to control the speed of DC motor 10. Motor 10 is connected, for example, to the spindle of a floppy disk drive not shown . The spindle of such a disk drive spins a floppy disk, and can be driven at a constant speed, or the spindle s speed may change as the drive s magnetic head is moved to different tracks on the disk. For example, it may be desirable to maintain the linear head to disk speed constant for all tracks, in which case it is necessary to reduce the rotational speed of the disk as the head moves to the disk s outer tracks. The present invention is useful in controlling acceleration of motor 10 from a rest condition to a full speed condition, and can also be used to achieve motor speed change. The novel phase lock loop portion of the control system of FIG. 1 can be implemented using a number of different technologies, all of which will be apparent to those of skill in the art. A preferred means to accomplish the present invention is to use a programmable micro computer having an onboard timer. As will also be understood, a custom semi conductor chip can be produced to achieve the present invention, or discrete logic circuits or blocks can be interconnected to achieve the present invention. For the purposes of explaining the present invention, a discrete logic block arrangement will be described in detail. From this description, one of skill in the art will be enabled to program a microcomputer, or provide a custom chip, as desired, in order to reproduce the present invention. The present invention, in its broadest aspects, resides in phase detector limiter 11 and reference generator 12. Portions 11 and 12 are entirely digital. Phase compensator 13, buffer amplifier 14 and squaring circuit 15 are all well known, conventional circuits and can be either analog or digital circuits. For example, phase compensator 13 can be implemented, using sampled data techniques, by software programming which controls the same microcomputer used to implement the reference generator and the phase detector limiter, while buffer amplifier 14 may be an analog device having a digital to analog converter DAC combined therewith. The following structured program module enables one skilled in the art of programming to program a micro computer in order to achieve the device of FIG. 2. This statement is also helpful in understanding the operation of this Figure. In this statement, the program module, entitled PHIDET , begins upon the occurrence of each tachometer feedback pulse TACH 22 of FIG. 2 , and thereafter the three clock pulses CTL1, 2 and 3 clock the logic through the program module. The frequency of the feedback pulses is always low enough, relative the frequency of these clock pulses, such that the program module is ready to repeat when the next feedback pulse occurs. The value of the number REF is a constant, and determines the motor s desired running speed. If the running speed is to be increased, REF is decreased to a new constant value number. The values of RANGEL and RANGEH are also constants, and are selected to determine when the system is in saturation. In this module, the phase error number ERRA is a function of the time difference between the occurrence of the feedback pulse TACH of FIG. 2, as represented by the time number TEDGE TEDGE is a summation of the cycles of clock 21, FIG. 2 , and the value of the time number NREF at which this feedback pulse was expected to occur. NREF is initialized to the value of REF. A new time number NREF is thereafter generated upon the occurrence of each feedback pulse so that if the next feedback pulse were in phase lock, the phase error number ERRA would indicate a zero phase error upon the occurrence of said next feedback pulse. However, during acceleration of the motor, or during large speed changes of the motor, the phase error will be large. The time number TEDGE continues to increase, as the content of counter 200 of FIG. 2 continues to increase. The value of the time number in counter 200 is transferred to data latch 26 of FIG. 2 upon the occurrence of a feedback pulse 22 of FIG.2. When the system is in saturation, ERRA is either too large or too small, as compared to the low value of RANGEL or the high value of RANGEH, respectively. In this case, the reference number NREF is set to a value which varies as 1 the constant number REF, the constant number RANGEH during acceleration of the motor, for example and the ever increasing number TEDGE. So long as the system is in saturation, the value of the phase error ERR will be either RANGEL or RANGEH, a constant, and this value is effective to produce energization of the motor so long as the system remains in saturation. When, however, the phase error ERR is detected as being within the range bounded by RANGEL and RANGEH, ERR becomes equal to ERRA, the actual phase error, and the motor is energized accordingly. In this case, NREF is reset and made to be equal to its old value plus the constant REF. Stated in another way, the output ERR produces motor energization. When the system is in saturation, the motor s energization is determined primarily by either RANGEH or RANGEL, depending upon the polarity or sense of the saturation. When the system comes out of saturation, and so long as it remains out of saturation, the motor s energization is proportional to the phase error ERRA. FIG. 2 is a discrete logic implementation of one aspect of the present invention, i.e. reference generator 12 and phase detector 11 of FIG. 1. The portion of FIG. 2 which is above broken line 20 implements reference generator 12, whereas the portion below this line implements phase detector 11. The timing basis of the network is a high frequency clock 21. The period of this clock is, for example, 3.2 microseconds. The occurrence of TACH pulse A, and more specifically its negative going edge, selects clock pulse B. This clock pulse then generates clock pulses CTL1, CTL2 and CTL3. The timing diagram of FIG. 3 shows the relationship between these five signals. While the manner of clocking a control network is well known, it should be said that enough time must elapse between the clock pulses to enable the results of the arithmetic and compare operations of the discrete logic blocks to be valid, and all computation, etc. must be complete prior to the occurrence of the next feedback pulse, i.e. TACH 22. At the fastest speed of motor 10, the period of pulses 22 is about 2.5 milliseconds, for example. In 2.5 msec about 800 cycles of clock 21 will occur. In this description, a number in quotation marks will designate a decimal number. The total accumulation of cycles of clock 21 are counted by 16 bit counter 200, i.e. the counter continues to increment so long as the servo is active. Upon overflow, counter 200 resets to zero, and begins counting again. Assume that the servo is now activated, and starts accelerating motor 10 from rest. Counter 200 begins with a count of zero. Also assume that when the motor is up to speed, 800 cycles of clock 21 occur between adjacent motor feedback pulses TACH. In this assumed situation, counter 200 will contain a count of about 2000 when the first TACH pulse occurs, due to the fact that the motor is running slow, but is accelerating. The input command speed is determined by number generator 23, designated REF. The number REF represents the number of cycles of clock 21 which will occur between TACH feedback pulses 22, when the motor is up to speed. For this example, REF is approximately 800 , this being in the range of about 2.5 milliseconds worth of pulses of clock 21. When the motor is running at the desired speed, the count in counter 200 will increase by 800 between adjacent TACH pulses. If it is desired to change the motor s speed, the number REF is changed, for example it is decreased in magnitude in order to increase the motor s speed. As a result of a motor speed increase, the period of feedback signal 22 also decreases, as the motor speed assumes the new speed commanded by the change in the magnitude of REF. With reference to the above mentioned program module, the first event to occur is a feedback pulse 22. Data latch 24 at this time contains an initialized time number NREF whose magnitude is chosen based upon the assumption that the motor is running at the desired speed commanded by number generator 23 in this case 800 . This time number is present on bus 25. Upon the occurrence of the first pulse 22 of tachometer 26 see FIG. 2 , a count, for example 2000 , is set into data latch 26. This latch now contains a time number TEDGE which is a count of the number of pulses of clock 21 which have occurred since the motor began accelerating. The amount by which this number has increased since the previous TACH pulse is a measure of the motor s actual speed. In this assumed condition, where the motor is accelerating from rest, TEDGE is much greater than NREF. Specifically, TEDGE 2000 and NREF 800 . The number TEDGE appears on bus 28. The phase error ERRA can now be computed. This computation is performed by subtract circuit 27, a 16 bit ALU. Circuit 27 computes a time number TEDGE NREF, i.e. 2000 800 1200 . This number represents the phase error ERRA, and appears on bus 29 upon the occurrence of clock pulse CTL1. The network is now ready to compare the phase error number ERRA, in this case 1200 , to both a high and a low preset number, RANGEH and RANGEL, respectively, which define a number range outside of which the phase error is such that a special mode of operation is implemented, in accordance with the present invention, to prevent the motor from being energized in a manner to overshoot and ring about the desired steady state speed, which speed is commanded by REF number 23. The high number, RANGEH, tests for the magnitude of TEDGE being high relative to NREF. This is an indication that the time period between TACH pulses 22 is excessively long, i.e. the motor is running very slow. In the present case of motor acceleration, ERRA will be greater than RANGEH. It will further be assumed that RANGEH and RANGEL are of the absolute decimal magnitudes XXX 400 and XXX 400 , respectively. This means that it has been predetermined 1 that the magnitude of TEDGE NREF XXX represents zero phase error, and 2 the system will be considered, by definition, to be in saturation when the result of this subtraction is 400 higher or lower than the zero phase error number XXX . When the motor s phase is lagging, comparator 35 operates, and RANGEH, of an exemplary magnitude XXX 400 , is effective. When the motor s phase is leading, comparator 34 operates, and RANGEL, of an exemplary magnitude XXX 400 is effective. FIG. 4 shows the relationship between the phase error ERRA which can exist and the time numbers RANGEH and RANGEL. While in this figure the two preselected values are spaced generally equidistant from a zero phase error number XXX , such need not be the case, since these two values can be independently selected. The two time numbers RANGEL and RANGEH are preset into latches 30 and 31, respectively, and they appear on buses 32 and 33, respectively. Comparator 34, a two s complement comparator, is provided to compare the phase error number ERRA to the lower limit range number RANGEL, whereas comparator 35, also a two s complement comparator, compares the phase error number to the upper limit range number RANGEH. Multiplexor 36 operates to gate one of the three time numbers ERRA, RANGEL or RANGEH to bus 37. Multiplexor 36 is controlled to perform this function by one of three input conductors 38, 39 or 40, only one of which can be active at any given time. For example, assume that the time number ERRA is less than time number RANGEL. In this case only conductor 38 will be active, since by definition ERRA must now be also less than RANGEH, and output conductor 39 of comparator 35 is not active. When the system is not in saturation, i.e. ERRA lies between RANGEL and RANGEH, both of conductors 38 and 39 will be inactive. In this case the operation of inverting AND gate 41 provides an active signal on conductor 40. When conductor 40 is active, the output of multiplexor 36 becomes time number ERRA. At clock interval CTL2 the number on bus 37 is placed in data latch 42 and appears on bus 43. This number is applied to phase compensator 13 of FIG. 2 and operates to control motor energization. With reference now to subtract circuit 44, a 16 bit ALU, this circuit receives as input the two time numbers TEDGE and ERR. The difference between these two numbers, i.e. TEDGE ERR, appears on bus 45. Recall that ERR will be one of the three possible time numbers ERRA, RANGEL or RANGEH. Since this is true, the corresponding three possible outputs of subtract circuit 44, a 16 bit ALU, are 1 TEDGE ERRA, 2 TEDGE RANGEL, and 3 TEDGE RANGEH. The time number output of circuit 44 appears on bus 45, and is applied to the A input of multiplexor 46. The time number NREF is applied to the B input of multiplexor 46. This multiplexor operates to apply one of these two inputs A or B to bus 47, under the control of whichever of the two conductors 40 or 48 are active. As mentioned above, conductor 40 is active whenever the phase error time number ERRA lies within the limits defined by the time numbers RANGEL and RANGEH, that is whenever the system is not in saturation, as this term is defined by the magnitude of RANGEL and RANGEH. Invertor 49 operates to produce an active conductor 48 whenever conductor 40 is not active. i.e. whenever the system is in saturation. The operation of multiplexor 46 is such that when conductor 40 is active, multiplexor input B is applied to bus 47, and whenever conductor 48 is active, input A is applied to bus 47. Conductor 48 is active when the system is in saturation, and conductor 40 is active when the system is not in saturation. In the present assumed condition of acceleration, the system is in saturation. In this case, the time number on bus 47 is TEDGE RANGEH. Adder circuit 50, a 16 bit ALU, operates to add the signal on bus 47 to the time number REF, i.e. the constant number 800 , which is on bus 51. At clock time CTL3, the new time number NREF REF TEDGE RANGEH is set into data latch 24. Note that this number is made up of two constant values REF and RANGEH. The value TEDGE continues to increase in magnitude as the motor speeds up, however the rate of increase in the value of TEDGE decreases as the motor speeds up, and at running speed the value of TEDGE increases by the value of REF 800 upon the occurrence of each TACH pulse 22. This new time number is now used when the next TACH pulse 22 occurs, and the above described operation repeats, i.e. the operation of the above described program module repeats. This new time number, REF TEDGE RANGEH, is a number that assumes that the motor is running at the desired speed, but is lagging the previous time number NREF by RANGEH counts of clock 21. Stated somewhat differently, this new time number NREF equal to TEDGE REF RANGEH is a number that assumes that the motor is running at the desired speed, that the next value of TEDGE will be equal to the current value of TEDGE plus the constant value REF, and that the next value of ERRA will be equal to RANGEH, thus keeping the phase detector at its saturation limit until the motor is up to speed. For example, under the assumed condition of acceleration, the previous value of TEDGE was 2000 . When the motor is running at the desired speed, counter 200 will advance 800 by the time the next TACH pulse occurs. In this case, the next value of TEDGE would equal 2800 , i.e. the value of the previous TEDGE, plus REF. In this assumed case, however, the next value of TEDGE is greater than 2800 , because the motor is still accelerating, and is running slow. Therefore, once again the time number NREF is made equal to this next generated TEDGE, plus the constant value of REF, minus the constant value of RANGEH. By way of a general description, consider three consecutive TACH pulses, identified as pulses N 1, N and N 1, respectively. As the system awaits the arrival to TACH pulse N, the value of NREF waiting in data latch 24 is a function of the value of TEDGE which occurred at TACH pulse N 1, i.e. the value of TEDGE which was placed in data latch 26 by the occurrence of TACH pulse N 1. TACH pulse N now occurs. The TEDGE value now placed in data latch 26 is equal to the previous value of TEDGE XXXX , where XXXX is the number of pulses of clock 21 which have occurred between TACH pulses N 1 and N. A new value of NREF, is now placed in data latch 24. When the motor s phase is lagging, and the system is saturated, this new value of NREF equals that value of TEDGE REF RANGEH. When the motor s phase is leading, and the system is saturated, this new value of NREF equals that value of TEDGE REF RANGEL. When the system is not in saturation, this new value of NREF equals the previous value of NREF REF. In this way, the motor s energization is maintained at a level, as determined by the constant values of REF and RANGEH and the new value TEDGE, i.e. a new value for each TACH pulse 22. , so long as the system remains in saturation. As the motor s speed approaches the desired speed, the value of TEDGE approaches the value of NREF, and the motor s energization accordingly is reduced, to prevent overshoot of the motor s speed. According to the present invention, the saturation mode feedback is implemented in such a way that the system assumes that the motor is running at the desired speed, but that the phase error is just at one of the saturation boundaries defined by RANGEL and RANGEH. In this way, the motor is quickly brought to its running speed, as determined by the clock signal REF, without speed overshoot. In a similar manner, the system operates to reduce the motor s energization, for example assume that the magnitude of the number REF is doubled, as a command to reduce the motor s speed by one half. In this case, the system would likely also go into saturation, but in this case the value of RANGEL would be used to control motor energization as the motor decelerated. While the invention has been particularly shown and described with reference to preferred embodiments thereof, it will be understood by those skilled in the art that various changes in form and details may be made therein without departing from the spirit of and scope of the invention.