# CONVOLUTION ARITHMETIC CIRCUIT FOR DIGITAL SIGNAL PROCESSING

## Claims
Arithmetische Konvolutionsschaltung, die umfaßt

## Description
This invention relates to a convolution arithmetic circuit for a digital signal processing system such as a digital filter. In recent years, widespread use has been made of digital recording and playback units such as PCM recorders or DAD digital audio disc players utilizing PCM pulse code modulation techniques to enable audio equipment to have as high fidelity as possible. Fig. 1 is a diagram of a digital recording and playback system according to prior art configurations. An analog signal, such as an audio signal, is input through terminal 11 and low pass filter 12 removes unwanted high frequency components from that signal. The output of filter 12 is supplied to sample hold circuit 13, which samples the analog signal at a sampling frequency prescribed for the unit e.g., 44.1 KHz in the case of a DAD player , for conversion into a digital signal by A D analog to digital converter 14. Digital processing circuit 15 adds an error correction code and digital modulation to the digitized signal which is then recorded on a recording medium 16 such as a tape or a disc. The original digital signal is recovered by digital demodulation processing circuit 17 which demodulates the playback signal from recording medium 16 and performs error correction for error resulting from, for example, defects in the recording medium 16. The digital signal is extracted as a continuous analog signal, i.e., the original audio signal, from the output terminal 20, after removing the high frequency noise component by low pass filter 19, and after step wise conversion to an analog signal by D A digital to analog converter 18. When the analog signal is recovered by sampling using this digital recording and playback unit, high frequency components biased about the sampling frequency are generated resulting in a high frequency distribution near the upper limit of the original frequency band. Low pass filter 19 must therefore have a steep filter characteristic to remove these components. If a digital filter 21 is interposed after the A D converter 14 or before the D A converter 18 to remove the high frequency components in the digital signal stage, the filter characteristic of the low pass filter 19 need not be so steep. Generally, there are two operations for providing digital data with a filtering characteristic. One is in the frequency domain and another is in the time domain. The former filtering operation is accomplished first by a fast Fourier translation FFT of an input digital data sequence x t in the time domain into digital data X w in the frequency domain. Then, by multiplying the digital data X w with a transmission function G w having a desired characteristic in the frequency domain, and finally by applying on inverse fast Fourier translation IFFT of the product Another filtering operation uses a convolution algorithm between the input data sequence in the time domain x t and an impulse response sequence g i i 0, 1, ..., m . The convolution algorithm for this filtering operation is expressed as follows Conventional circuit arrangements for implementing the convolution algorithm are illustrated in Figs. 2 and 3 and have been described in a paper entitled FIR Filter and Digital signal Processing , The circuit in Fig. 3 has been proposed in the previously mentioned November 1979 paper for improving the basic circuit shown in Fig 2, and includes memories for storing an input data sequence x t and corresponding filter coefficients g i . In Fig. 3, the set of coefficient data factors g k , which are set beforehand, are stored in ROM read only memory 31. These coefficient data factors g k are sequentially read from addresses provided by address counter 37 and the coefficient data are fed to multiplier accumulator 33. The input signal x t , which constitutes the other data sequence of the convolution arithmetic calculation, is supplied to input I from an external source at prescribed intervals. As shown in the drawing, the input signal x t may be applied to multiplier accumulator 33 through switch 35 or to a data input terminal D The calculation of will be considered to help explain the operation of the circuit shown in Fig. 3. First, timing control circuit 32 and counters 34 and 37 indicate the addresses to enable sequential output of the coefficient data factors g 2 , g 4 , ..., g 2m stored in ROM 31 and of the input signals x t 1 , x t 2 , ...x t m stored in RAM 36 according to the proper correspondence between g 2k x t k . These data are supplied to multiplier accumulator 33 where corresponding elements of both sequences are successively multiplied and the products added. During this time, a R W designating read write signal from the timing control circuit 32 is at the L low level so RAM 36 is in the read mode. The R W signal is also applied to a control terminal not shown of switch 35, so that the path of the input signal x t from the external source is disabled. Before timing control circuit 32 performs the above operation, or at a suitable time during its progress, the R W signal changes to the H high level, putting RAM 36 into the write mode, and setting switch 35 to connect multiplier accumulator 33 to the external source device so that the current input signal x t is fed both to multiplier accumulator 33 and to RAM 36. Timing control circuit 32 simultaneously identifies the addresses of ROM 31 and RAM 36 so that the coefficient data factor g k corresponding to the input signal x t is read out from ROM 31 and the current input signal x t is stored at the prescribed address in RAM 36 ready for use in the next calculation. When the convolution algorithm x t k has been performed, multiplier accumulator 33 outputs the result of its convolution calculation in response to an output control signal from timing control circuit 32. Furthermore the article Digitales FIR Filter für die Messwertverarbeitung by H. J. KOLB in ELEKTRONIK, vol. 32, no. 3, February 1983, pages 85 88 shows in Figure 3 a circuit diagram of a convolution arithmetic circuit for the convolution algorithm being expressed by Thus, the conventional convolution arithmetic circuit involves storing, in prescribed locations in the memory, two sets of data relating to the convolution calculation between the input signal x t and the coefficient data g k , and supplying these sequentially to a multiplier accumulator in accordance with a correspondence relationship, all these operations being controlled by a programmed microcomputer. The above conventional convolution arithmetic circuit has a certain flexibility in that it makes use of a programmable microcomputer, but, if it were to be applied as a digital filter in, for example, a DAD system, problems would arise regarding the processing speed of the microcomputer software rendering the convolution arithmetic circuit unable to cope with the data flow. This problem can have very dire consequences. Specifically, in a digital filter used in a digital recording and playback unit as described above, the input signal x t is sampled at the sampling interval before being input sequentially, so the convolution algorithm must be performed in real time. This causes higher order calculation since the sampling frequency of the coefficient data g k that is used in the convolution algorithm must be fairly high, due to the need to set a transmission function, i.e., a filter characteristic, for the digital filter that will enable it to deal with signals containing a large number of high frequency components. Since, as mentioned above, all the address signals and operations must be controlled by the programmed microcomputer, the load on the CPU central processing unit of the microcomputer becomes too great to carry out the arithmetical processing in the required time intervals. Such problems increase as the complexity of the calculations increase, and these problems set limits on the signal processing capabilities that can be achieved in practice using such conventional convolution arithmetic systems. One object of the invention is to provide a convolution arithmetic circuit suitable for real time processing of digital signals. Another object of the invention is to provide a convolution arithmetic circuit having a simple construction for selecting different convolution formulae for data to be calculated. A first embodiment of a convolution arithmetic circuit is claimed in Claim 1. A second embodiment of a convolution arithmetic circuit is claimed in Claim 6. Fig. 1 is a block diagram of the essential construction of a prior art digital recording and play back unit. Figs. 2 and 3 are circuit diagrams showing convolution arithmetic systems that have been previously proposed. Fig. 4 is a circuit diagram of an embodiment of a convolution arithmetic circuit according to this invention. Fig. 5 is a graph showing impulse responses representing coefficient data factors of a digital filter. Fig. 6a is a timing diagram given in explanation of the operation of the Fig. 4 embodiment in response to select signal U D being at the H level. Fig. 6b is a graph showing the relation of ROM addresses to the counts of the system counter, illustrating the operation shown in Fig. 6a. Fig. 7a is a timing diagram given in explanation of the operation of the Fig. 4 embodiment in response to select signal U D being at the L level. Fig. 7b is a graph showing a different relation of ROM addresses to the counts of the system counter, illustrating the operation shown in Fig. 7a. Fig. 8 is a tabulation of the storage location within ROM 42 Fig. 4 of the various filtering coefficient data factor values depicted in Fig. 5. Fig. 9 is a schematic circuit diagram of an alternate embodiment of a convolution arithmetic circuit constructed in accordance with a different aspect of the invention. Figs. 10 and 11 are diagrams showing the storage locations of the various filter coefficient data factor values stored at the storage locations of ROM 42a and ROM 42b, respectively, as shown in Fig. 9. Fig. 12 is a timing diagram illustrating the operation of the Fig. 9 embodiment in response to select signal U D being at the H level. Fig. 13 is a timing diagram illustrating the operation of the Fig. 9 embodiment in response to select signal U D being at the L level. Embodiments of the present invention are described below with reference to the accompanying drawings. Fig. 4 shows a circuit configuration of an embodiment of a convolution arithmetic circuit according to this invention. In this embodiment, the sampling frequency of the coefficient data g k is set at a prescribed value as described hereinafter. In Fig. 4, the set of input terminals Ig Another set of input terminals Ix The R W signal specifies the operating mode of RAM 46 and is applied directly to a mode change terminal R W of RAM 46 and to gate 45 through an inverter 48. The R W signal, when low L , changes RAM 46 to a write mode and permits the supply, to RAM 46 and multiplier accumulator M A 41, of the input signal x t that is then present at the input terminals of the tri state buffer 45. While the R W signal is high H RAM 46 is in read mode and permits the supply, to M A 41, of the signal stored in RAM 46. Gate 45 is disabled to prohibit the passage of the input signals x t to the input of M A 41. The counter control signal Sc is applied to a control terminal of RAM address counter 47 and changes the count mode of RAM address counter 47 in response to the state of the counter control signal Sc. RAM address counter 47 performs an ordinary counter operation, i.e., incrementing the count by 1 with every CLOCK signal, while the counter control signal Sc is at level L. However, when the counter control signal Sc is at level H the count of RAM address counter 47 is incremented by 2 for each CLOCK signal. Since counter 44 is a scale of 24 counter it has a 24 count sequence as follows 0, 3, 2, 5, 4, 7, 8, 11, 10, 13, 12, 15, 16, 19, 18, 21, 20, 23, 24, 27, 26, 29, 28, 31. This sequence automatically repeats itself as long as clock pulses are applied. This is represented in the SYSTEM COUNTER line of Fig. 6a. ROM address altering circuit 43 includes four EX OR gates 43a₁ to 43a₄ and an inverted EX OR gate 43b. Inverted EX OR gate 43b receives the output Q4 of system counter 44 and a select signal U D. The control signal U D is also applied to control signal generating circuit 49. EX OR gate 43a₄ also receives the output Q4 and receives as a second input the second most significant bit output Q3 of system counter 44. The rest of EX OR gates 43a₁ to 43a₃ receive respectively the outputs Q0 to Q2 of system counter 44 as well as the output of inverted EX OR gate 43b. Outputs AD₀ to AD₃ of EX OR gates 43a₁ to 43a₄ are respectively applied to input terminals IAD₀ to IAD₃ of ROM 42. When the output of X OR 43b is 1 , EX OR s 43a₁ 43a₄ invert the Q0 Q3 outputs from counter 44. When EX OR 43b is 0 the Q0 Q3 counter outputs are passed unchanged. As a result, the second twelve count states represented by the AD₀ AD₃ signals are a mirror image of the first twelve AD₀ AD₃ count states. This is illustrated in the ROM ADDRESS line of Fig. 6a. The operation of the system will now be explained with reference to Figs. 4 7b. ROM 42 stores twelve coefficient data factors g k . However, twenty four coefficient data factors are necessary for one convolution processing cycle in digital filtering. As shown in Fig. 5, the impulse response values 0 23 comprising the coefficient data factors present a symmetrical pattern such that each response in a symmetrical half is the same in amplitude as a corresponding one in the opposite symmetrical half. Accordingly, impulse response factors for one symmetrical half, in this case twelve impulse responses from the center of the symmetrical pattern, represent the coefficient data factors g k stored in ROM 42. The twenty four coefficient data factors are stored at ROM addresses 0, 3, 2, 5, 4, 7, 8, 11, 10, 13, 12 and 15 as shown in Fig. 8. The outputs AD₀ to AD₃ of address altering circuit 43 respectively change as shown by signal waveforms AD₀ to AD₃ in Fig. 6a. The relationship of AD₀ AD₃ to the count of system counter 44 is indicated by comparing the SYSTEM CTR line of Fig. 6a with AD₀ AD₃. The ROM addresses generated by the outputs AD₀ to AD₃ for ROM 42 change as shown in the ROM address line of Fig. 6a. The relationship between the ROM addresses and the count of system counter 44 is represented by the diagram shown in Fig. 6b. Each of the ROM addresses 0 to 15 is generated twice in a cycle of the system counter 44 from 0 to 31. The twelve coefficient data factors g k corresponding to the ROM addresses 0 15 are therefore read out and supplied to M A 41 twice during one cycle of the count of system counter 44. First the coefficient data factors g k corresponding respectively to the ROM addresses 0 to 15 are read in turn for the count of 0 to 15 and then the coefficient data factors g k corresponding to the ROM ADDRESSES 15 to 0 are read in turn for the count of 16 to 31. On the other hand, the input signal x t is applied to input terminals Ix The convolution operation is executed four times while the input signal x t is sampled once, thereby making the effective sampling frequency of the output data y t four times the sampling frequency of the input signal x t . Actually, the variable 4t α of the output y 4t α where 0, 1, 2, 3 of the above equations is on the time domain, so the output data is, in fact, y This convolution operation is described in connection with the timing diagram shown in Fig. 6a. Input signals received prior to x 5 are omitted. Each time the system counter reaches count 7 R W signal goes to L to sample the next x t input and write it into RAM 46 while also supplying it to multiplier accumulator 41. System counter 44 counts up in synchronism with the rising edge of the input clock signal CLOCK and the ROM address for ROM 42 changes from 0, 3, 2, ..., 15, and then from 15, 12 ..., 0 in accordance with the count of system counter 44 as mentioned before. With the same timing, the output of RAM address counter 47 is applied to address terminals AD Multiplier accumulator M A 41 sequentially calculates the products of these coefficient data and multiplicand data and keeps a running total of the products. M A 41 thus calculates While the count of system counter 44 is between 0 and 4 , the R W signal is at the H level. When the count of system counter 44 reaches 7 , H level outputs Q₀ to Q₂ of system counter 44 are applied to control signal generating circuit 49, and the R W signal switches to the L level, causing RAM 46 to change to write mode and gate 45 in the high impedance state to be opened to allow the most recent input signal x 5 presently at the input of gate 45 to be written in the RAM address 5 of RAM 46. The input signal x 5 is also supplied to M A 41 in place of the output of RAM 46, and the input signal x 5 is multiplied by the coefficient data factor g 0 corresponding to the ROM address 7 and present at the ROM output. In this way, M A 41 makes the final calculation for calculating the output data y 20 corresponding to the input signal x 5 . After the output data y 20 has been calculated, the R W signal changes to the H level and RAM 46 returns to the read mode. The read mode resumes until the count of system counter 44 becomes 8 . When this happens, the RAM addresses shift through 0, 1, ..., 5 under control of RAM address counter 47, causing the multiplicand data x 0 , x 1 , ...., x 5 corresponding to the RAM addresses to be read, the input signal x 5 in the preceding cycle having already been stored in the RAM address 5. The corresponding coefficient data factors g 21 , g 17 , g 13 , g 9 , g 5 and g 1 whose ROM addresses 8, 11, 10, 13, 12 and 15 are outputted from ROM 42, so multiplier accumulator 41 calculates These operations are carried out continuously. While the count of the system counter 44 is shifting from 16 through 23 , the coefficient data factors g 22 , g 18 , ...., g 2 stored at ROM addresses 15, 12, ...., 8 are read out from ROM 42, and the multiplicand data x 0 x 5 are read out from RAM 46 again in accordance with the address specified by RAM counter 47. M A 41 therefore calculates These operations are also carried out continuously for the coefficient data factors g 23 , g 19 , ...g 3 and the multiplicand data x 0 x 5 while the count of system counter 44 is shifting from 24 through 31 , and the output data In the above convolution operation, when the count system counter 44 is 31 , all of the outputs Q0 to Q4 of system counter 44 become H level. The counter control signal Sc generated from control signal generating circuit 49 changes to the H level. Consequently, in RAM address counter 47, the next RAM address is incremented by 2 with respect to the previous address, shifting from 5 to 1. In the following convolution calculation, therefore, while the ROM address counts shift from 0 through 4, the RAM address shifts from 1 to 5. Further, when the count of system counter 44 becomes 7 , the R W signal goes to the L level, and the next input signal x 6 is fed to RAM 46 and is stored at RAM address 0. Input x 6 is also fed to M A 41. Multiplier accumulator 41 therefore receives as its inputs the coefficient data factors g 20 , g 16 , ....g 0 and the multiplicand data x 1 , x 2 , ..., and x 6 . M A 41 calculates After calculating the output data y 24 as above, the same sequence of operations occurs as when the series of convolution calculations was performed using the input signal x 6 and the coefficient data read out from the corresponding ROM addresses. The corresponding RAM addresses are repeated in the cycle 1, 2, ..., 5, 0 every time the convolution calculation is performed in each of the stages until the count of system counter 44 again reaches 31. The multiplicand data are therefore successively read out as x 1 , x 2 , ...., x 6 . Accumulator 41 performs the convolution calculation with x 6 as the most recent multiplicand data. The outputs are obtained when the count of system counter 44 reaches 15 , 23 , and 31 , respectively. When the count of system counter 44 again becomes 31 the counter control signal Sc changes to H level and the RAM address shifts from 0 to 2. When the count of system counter 44 becomes 7 , the R W signal goes to the L level and the most recent data x 7 is written in the RAM address 1 in place of the oldest multiplicand date x 1 . Subsequent operation repeats the operation as previously described. The RAM address shifts by 1 every time the input signals x t are successively processed. The convolution algorithm is executed four times with the respective input signal constituting the most recent multiplicand data in each case. The operation of the convolution circuit of Fig. 4 with the select signal U D being at the L level is explained hereinafter with respect to the modified operation illustrated in Figs. 7a and 7b. The outputs AD₀ to AD₃ of address altering circuit 43 respectively change as shown in Fig. 7a according to the count illustrated in the SYSTEM CTR line. The ROM addresses produced by the outputs AD₀ to AD₃ change as shown in Fig. 7a at ROM Address. The relation of the ROM addresses with the count of system counter 44 is represented in the diagram of Fig. 7b. Each of the ROM addresses 0 to 15 is designated twice in a cycle of the count of system counter 44 from 0 to 31 similar to the cycle shown in Fig. 6b for the case when the select signal U D is at the H level. But, the ROM addresses corresponding to the counts 0 to 7, 8 to 15, 16 to 23, and 24 to 31 in this case are replaced respectively with the ROM addresses corresponding to the counts 24 to 31, 16 to 23, 8 to 15, and 0 to 7 in the graph of Fig. 6b. The twelve coefficient data factors g 0 to g 11 are therefore read out and supplied to M A 41 twice during one cycle of the count of system counter 44, according to the order of the ROM addresses as shown in the timing diagram of Fig. 7a. The U D signal switches the RAM address counter to a scale of 23 counter that continuously cycles through a count of 0 22 decimal equivalent and repeats, as shown in Fig. 7a. Control signal S The input signal x t is applied to input terminals Ix The convolution operation is executed one time while the input signal x t is sampled four times, thereby making the effective sampling frequency of the output data y t one fourth of the sampling frequency of the input signal x t . Actually, the variable 4t 1 of the output date y 4t 1 of the above equations is in the time domain, so the output data is, in fact, y This convolution is described with reference to the time chart shown in Fig. 7a. The input signal prior to the stage of x 20 is partially omitted. System counter 44 counts up in synchronism with the rising edge of the input clock signal CLOCK and the address sequence for ROM 42 changes as shown in Fig. 7a at ROM address. In this case, control signal generating circuit 49 changes the R W signal to the L level every time system counter 44 advances six counts, i.e., 0 to 7, 8 to 15, etc., due to the select signal U D being at the L level. Then, the input signals x 20 , x 21 , x 23 ...are stored continuously in RAM 46 at the respective RAM addresses 5 , 11 , 17 ... in place of the oldest data stored there. On the other hand, accumulator 41 delivers its convolution output when the timing system counter 44 reaches a count of 31 . That is, accumulator 41 delivers The detailed explanation of Fig. 7a for the operation during the select signal U D being at the L level is omitted hereunder inasmuch as its operation may be understood from the explanation given above in connection with Fig. 6a, taking into consideration the above mentioned basic differences in the count sequences and sampling frequency. Figs. 9 13 illustrate an alternate embodiment employing a different aspect of applicants invention. The system shown in Fig. 9 employs a multiplier accumulator 41, a RAM 46, RAM address counter 47, control signal generating circuit 49, and a system counter 44 identical to those same components shown and described above in connection with the Fig. 4 embodiment. However, instead of employing a single ROM, the Fig. 9 system employs a pair of ROMs 42a and 42b. Further, the count conversion circuit 43 employed in the Fig. 4 system is not utilized and, instead, the five output lines Q0 Q4 of scale of 24 counter 44 are fed directly to the address inputs AD Selection signal U D shown in Fig. 9 operates a pair of gate circuits 43a and 43b to activate either the outputs from ROM 42a or the outputs from ROMs 42b, depending upon the state H or L of the U D signal. When U D is high, gates 43a are enabled such that the outputs from ROM 42a are fed to the inputs I As shown in Figs. 12 and 13, the system operation achieved by the circuit of Fig. 9 is identical with the operation achieved in the circuit of Fig. 4 for the two states of the U D signal. When the U D is at the H level, the Fig. 9 system performs digital filtering at the high sampling rate identically with the operation previously described in connection with Fig. 6a. While the operation depicted in Fig. 12 indicates that the ROM addresses sequence in sync with the outputs of the system counter, the outputs from the ROM 42a are exactly the same as the ROM outputs of the Fig. 4 system Fig. 6a , whereupon the same filtering function and sampling rate operation are achieved. When U D of the Fig. 9 system is at the L level, operation identical to that previously described in connection with Fig. 7a is achieved. Again, as shown in Fig. 13, the sequence of ROM addresses is synched to the output of system counter 44 but since the filtering coefficient data factors stored in ROM 42b produce a ROM output identical to that illustrated in connection with Fig. 7a, the identical low sampling frequency operation previously described in connection with Fig. 7a is achieved. As shown in Fig. 13, the RAM address counter 46 functions as a scale of 23 counter at this time, just as in the case of the operation depicted in Fig. 7a.