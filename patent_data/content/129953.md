# Method and apparatus for digitizing the maximum amplitude and time occurrence of an acoustic signal.

## Abstract
Digitizing and transmitting the maximum amplitude and time of occurrence of an analog signal is proposed for borehole televiewing apparatus to reduce the amount of data transmitted from a borehole tool to surface imaging equipment. During at least one established time window, the analog signal is amplitude sampled with an analog to digital converter 11. Each sample value is fed to a comparator 15 and compared with a previously stored maximum amplitude sample value and, if the present sample is greater than stored, it is stored as the new maximum amplitude sample value. Whenever a new maximum amplitude sample value is stored, its time of occurrence is also stored. At the end of each time window digital data representing the maximum amplitude and its time of occurrence are available for transmission so as to allow reconstruction of the original analog signal.

## Claims
CLAIMS 1. A method for determining tne maximum amplitude and its time of occurrence of an analog signal comprising defining at least one time window within wnicn saij analog signal is expected to occur generating a timing signal representing elapses time from a predetermined start time analog to digital converting and sampling said analog signal during said time window to produce successive digital sample values representing the amplitude of said analog signal comparing during said time window a present digital sample value Sn with a previously stored digital sample value Sn x storing value Sn x when said present sample value Sn is greater than said previously stored sample value and, storing the present value of said timing signal wnen a said present sample value Sn is stored as said previously stored sample value Sn x 2. The method ofiClaim 1, wherein said analog signal is a reflection signal caused by the generation of an acoustic pulse scanning signal within a borehole and said time window is defined at a time subsequent to generation of said scanning signal. 3. A method for reconstructing the maximum amplitude and time of occurrence of an analog signal wnerein said maximum amplitude and time of occurrence are determined by the method ofClaim 1, comprising receiving said stored sample value representing tne maximum amplitude of the analog signal occurring during said at least one time window receiving said stored present value of the timing signal representing the time of occurrence of saia maximum amplitude during said time window and, digital to analog converting the received sample value a predetermined period of time after a reference start time, said predetermined period of time being determined by the value of the received timing signal. 4. The method of Claim 3, further comprising the steps of storing said sample value after its receipt, loading said timing signal as preset data into a counter after its receipt, said counter counting a clocking signal, and operating a digital to analog converter which converts said stored sample value into an analog signal when said counter reaches a predetermined count value. 5. The method of Claim 3, further comprising the steps of storing said sample value and said timing signal after their receipt, comparing said stored timing signal with the output of a counter counting a clocking signal and generating a control signal when the output of the counter has a predetermined relationship with respect to the stored timing signal, and digital to analog converting the stored sample value when said control signal is generated. 6. An apparatus for determining the maximum amplitude and its time of occurrence of an analog signal comprising means for defining at least one time window within which said analog signal is expected to occur means for generating a digital timing signal representing elapsed time from a predetermined start time means for analog to digitally converting and sampling said analog signal during said timing window, to produce successive digital sample values representing the amplitude of said analog signal means for comparing a present sample Sn value with a previously stored sample value Sn,xi means responsive to said comparing means for storing a present sample value 5n as said previously stored sample value Sn x when said present sample value 5n is greater than said previously stored sample value and, means responsive to said comparing means for storing the present value of said timing signal when said present sample 5n is stored as said previously stored sample value. 7. The apparatus of claim 6 and further comprising means for digital to analog converting said stored sample value a predetermined period of time after a reference start time, said predetermined period of time being determined by said stored timing signal.

## Description
METHOD AND APPARATUS FOR DIGITIZING THE MAXIMUM AMPLITUDE AND TIME OCCURRENCE OF AN ACOUSTIC SIGNAL The present invention relates to a method and apparatus for digitizing the maximum amplitude and time occurrence of an acoustic signal and, more particularly, of an acoustic signal produced in a borehole televiewing apparatus. Borehole televiewing apparatus is commonly used to produce an image representing the physical characteristics of the inside surface of a borehole. Typically, a borehole transducer positioned within a borehole tool transmits an acoustic pulse into the borehole in a scanning period. The acoustic pulse is reflected by the borehole wall and received by a receiver detector in the tool, which, in turn, transmits the envelope of the reflected signal to a recording and or imaging apparatus located at a surface location.Incremental rotative movement of the transducer about the borehole for each of a plurality of successive scanning periods produces reflection signals which can be used to produce a representative image of the borehole wall structure, which may be recorded and or displayed on a cathode ray tube. Representative borehole televiewer devices are described and illustrated in U. S. Patent Nos. 3,668,619 and 3,369,626. In a borehole televiewing apparatus, an analog signal path is provided from the envelope detector in the borehole tool to the surface recording and or image display devices. Analog signal transmission presents problems in that the attenuation characteristics of the transmission lines limit the dynamic range of, and thus distort, the transmitted signal, making it difficult to obtain high quality raw data at the surface equipment. One way of improving the fidelity of the transmitted signal is to digitize it at the borehole tool and transmit only digital data to the surface equipment. However, the scanning frequency of the transmitter receiving apparatus is typically quite high, e.g., 2,000 scanning periods per second, and a high sampling frequency is also required, e.g., 500 sampling pulses per scanning period, to faithfully reproduce a high quality image at the surface.If 8 Dits of data are required for each sample, then 8 bits x 500 samples period x 2,000 periods sec 8M bits sec of data must be transmitted to the surface, wnich considerably exceeds the capability of present digital wire pair telemetry systems, making digitization of the detected reflection pulse signal impractical.An object of the present invention is therefore to obviate or minimize this proolem. Accordingly, tne invention resides in one aspect in a method for determining the maximum amplitude and its time of occurrence of an analog signal comprising defining at least one time window within which said analog signal is expected to occur generating a timing signal representing elapsed time from a predetermined start time analog to digital converting and sampling said analog signal during said time window to produce successive digital sample values representing the amplitude of said analog signal comparing during said time window a present digital sample value 5n with a previously stored digital sample value S,,x storing value Sn x when said present sample valueSn is greater than said previously stored sample value and, storing the. present value of said timing signal when a said present sample value 5n is stored as said previously stored sample value Sn x In a further aspect, the invention resides in apparatus for determining the maximum amplitude and its time of occurrence of an analog signal comprising means for defining at least one time window within which said analog signal is expected to occur means for generating a digital timing signal representing elapsed time from a predetermined start time means for analog to digitally converting and sampling said analog signal during said timing window, to produce successive digital sample values representing the amplitude of said analog signal means for comparing a present sample Sn value with a previously stored sample value Sn x means responsive to said comparing means for storing a present sample value Sn as said previously stored sample value Sn x when said present sample value 5n is greater than said previously stored sample value and, means responsive to said comparing means for storing the present value of said timing signal when said present sample 5n is stored as said previously stored sample value. In the accompanying drawings in which Fig. 1 is a signal amplitude vs. time diagram useful in explaining the invention Fig. 2 is a block diagram representing digitizing apparatus according to one example of the invention Fig. 3 is a signal amplitude vs. time diagram useful in explaining a modified digitizing apparatus Fig. 4 is a block diagram illustrating a borehole televiewing apparatus Fig. 5 is a block diagram representation of a first embodiment of surface apparatus for reconstructing a properly timed analog amplitude signal Fig. 6 is an amplitude vs. time diagram of a reconstructed analog signal Figs. 7a, 7b and 7c are timing diagrams useful in explaining a second embodiment of surface apparatus for reconstructing a properly timed analog amplitude signal Figs. 8a, 8b and are signal formal diagrams useful in explaining the second embodiment of the surface reconstruction apparatus Fig. 9 is a block diagram showing a modification of theFig. 2 digitizing apparatus for use with the second embodiment of the surface reconstruction apparatus and Fig. 10 is a block diagram representation of the second embodiment of the surface reconstrt tion apparatus. Referring to Figs. 1 and 4, in a borehole televiewing apparatus an acoustic pulse signal P Fig. l is transmitted from a transducer 5 located in a borehole tool 1 Fig. 4 by means of a pulse generator 3 at a time t0, which defines the beginning of a scanning period to tohl The transmitted signal P is reflected by the borehole peripheral surface back to the borehole tool as a reflected acoustic pulse signal R during the scanning period and is detected by transducer 5. An additional echo signalR generated from reflections beyond the borehole wall also typically occur during the scanning period and it too is detected by transducer 5.Other reduced amplitude miscellaneous reflection signals and noise components R may also be present in the signal received and detected by transducer 5. Both the maximum amplitude of the reflected pulse signal R, as well as the time of its occurrence during each scanning period to...tohl, are digitized and transmitted to surface equipment 10 by a digitizing apparatus 7. The maximum amplitude and time of occurrence data are sequentially transmitted to surface equipment 10 over conventional well logging transmission lines 9 by means of a multiplexer 6 and data encoder 8, e.g., a manchester data encoder. Apparatus at the surface receives the maximum amplitude and time of occurrence data and reconstructs an analog signal therefrom, which can be used in a conventional borehole televiewer display apparatus to construct an image of the borehole interior wall structure. Fig. 2 illustrates in greater detail the digitizing apparatus 7 for digitizing the maximum amplitude and time of occurrence of the reflected acoustic pulse signal R. The reflected acoustic pulse signal R detected by acoustic transducer 5, is applied to the analog input of a high speed sampling analog to digital converter 11. A high frequency sampling input signal consisting of typically lOOns pulses, is applied to the sampling input of converter 11, while a window control signal is applied to an enabling input of converter 11 from a programmable decoder 33. The window control signal enables converter 11 and establishes a time window W from time tl to time t2 in Fig. 1 , during which the apparatus of Fig. 2 operates to look for the reflected acoustic pulse signal R. The time window W is established where the reflected signal R is expected to occur.The time of its beginning, as well as its duration, are empirically determined to ensure that it encompasses the reflected acoustic pulse signal R.The window W may be as wide as a scanning period, i.e., to...to t0 1 but as a practical matter, it is typically shorter, as shown in Fig. 1. The window control signal is generated automatically a predetermined period of time after an acoustic pulse P is transmitted into the borehole by the borehole tool, i.e., a predetermined period of time after to, for example, by a counter 31 counting a clock frequency fc and feeding the programmable decoder 33 which decodes the output of counter 31 and generates, at the appropriate time, the window control signal. The timing cycle for operation of counter 31 and decoder 33 is the scanning period to.. .to 1. Accordingly, counter 31 is reset at the beginning of each scanning period by a signal to generated thereat by the pulse generator 3. The programmable decoder 33 may be, for example, aHarris HM 7616 PROM, or a programmable logic array.Decoder 33 produces the window control signal and other output signals described below at predetermined times, in accordance with program selection inputs thereto and the monitored output of counter 31. To change the timing of the window control signal and the other output signals, the program selection inputs are changed. For convenience, the program selection inputs to decoder 33 are controlled by the surface equipment 10 which interconnects with decoder 33 by transmission lines 9 Fig. 4 of a well logging cable. The timing signals generated by decoder 33 include the window control signal, as well as latch control and reset control signals discussed in greater detail below. The digitizing apparatus also includes a digital comparator 15 which continually compares a current amplitude sample value Sn from converter 11 the A input to comparator 15 with a previously stored amplitude value Sn,x tè B input to comparator 15 stored in a latch 17. Wnenever the current sample value 5n exceeds the previously stored value 5n x input A input B , the comparator applies an enabling signal to latches 17 and 19 which causes latcn 17 to store the current sample value 5n as the stored sample value1 which is then used for comparison with subsequent current sample values 5n occurring during tne time window W. As a result of the continued and combined operation of converter 11, comparator 15 and latcn 17, latch 17 will, at the end of time window W2 contain an amplitude value representative of the peak amplitude of reflected signal R. The time of occurrence of the peak amplitude is determined by counter 21 which counts the output pulses from an oscillator 23. Counter 21 is reset at the beginning of a scanning period by means of the signal to, so that the counter 21 contains a value representing the instantaneous time or running time following the time to. The output of counter 21 is applied to latch 19 and, whenever comparator 15 determines that a present amplitude value sample Sn is to be stored in latch 17, it causes latch 19 to store the time of occurrence of that sample value in latch 19.Accordingly, at the end of time window W, latch 19 contains time of occurrence information for the maximum amplitude sample value then stored in latch 17. At the end of time window W7 the window control signal from decoder 33 is removed from the enable input to converter 11, which effectively stops operation of the Fig. 2 circuit as no new sample values can be generated. The data stored in latches 17 and 19 is stored for transmission to surface equipment 10 after the end of time window W by a latch control signal applied to latches 25, 27 which respectively receive and store for transmission the contents of latches 17 and 19. The latch control signal is generated by decoder 33 after the transmission of time window W. Although Fig. 2 illustrates an apparatus in which a single time window W is employed, the illustrated apparatus can also be used with a plurality of time windows W1. n of, for n of, for example, the same duration within a scanning period to... to 1, as shown in Fig. 3. For operation with a plurality of time windows Wl...Wn, a different programming of decoder 33 is selected by the programming inputs thereto so that suitable time window control, latch control and reset control signals are generated for each timing window. Counter 21 need not be reset for each time window, but is reset once for each scanning period to... t0 1, at time t0, as described earlier. The use of successive time windows for a scanning time period .....t0 1 allows for isolation and digitization of not only the maximum amplitude and time of occurrence of the principle reflected signal R, but also of additional reflected signal components, such as the echo signal R and other later reflections R Fig. 3 , should digitization and transmission of these signals be desired. For transmission to surface equipment 10, the paired digital amplitude and time of occurrence data stored in latches 25 and 27 are multiplexed by multiplexer 6 Fig. 4 and encoded by an encoder 8, e.g., a manchester encoder, and then sent over transmission lines 9. In the borehole tool, one bit of an encoded data word is encoded by encoder 8 as a flag bit in response to operation of multiplexer 6 to indicate whether the encoded word contains amplitude data, e.g., a 1 flag bit encoding, or time of occurrence data, e.g., a 11011 flag bit encoding. Fig. 5 illustrates the apparatus employed in surface equipment 10 for reconstructing an analog signal having an amplitude and time of occurrence corresponding to the digital amplitude and time of occurrence data produced by the Fig. 2 apparatus. The surface apparatus incudes a decoder 41, e.g., a manchester decoder which receives the encoded data from the apparatus and which produces a conventional valid word output whenever it recognizes that a valid encoded data word either amplitude or time of occurrence data has been received. The valid word output of decoder 41 enables a flag detector 43, which examines a flag bit in the decoded word, to determine whether it contains amplitude or time of occurrence information.The flag detector 43 loads the decooed data word into a down counter 45 by enabling the counter 45 if the data word represents time of occurrence data, and loads the data word into a latch 47 by enabling latch 47 if the data word represents amplitude data. When loaded with a new aata word, down counter 45 immediately begins deincrementing tne loaoed count value by means of a clocking signal input thereto until a predetermined count value, e.g., zero, is reached, at which time a one shot multivibrator 49 is enabled. The output of one shot multivibrator 49 is used to enable a digital to analog converter 51, which converts the digital amplitude data stored in latch 47 into an analog signal value on output line 53. The reconstructed analog signal is shown in Fig.6. The analog signal generated on output line 53 has an amplitude value corresponding to the maximum analog signal amplitude value digitized in the borehole tool, with time of occurrence from a predetermined start time, e.g., to, corresponding to the time of occurrence of the maximum analog signal amplitude digitized in the borehole tool. A characteristic of the Fig. 5 reconstruction apparatus is that it is not necessary separately to transmit or receive information representing the start time of a scanning period, e.g., tos as this information is implicitly contained in the time of occurrence data.That is, whenever down counter 45 is loaded with new timing data it restarts a time period which expires when counter 45 counts td a preset value, which represents the time of occurrence of the maximum amplitude data signal from the scanning period start time to. The analog output on line 51 may be used Dy a conventional borehole televiewing apparatus to record and reconstruct an image representing the physical characteristics of the inside surface of a borehole. The reconstruction apparatus illustrated in Fig. 5 is intended to operate with one time window in a scanning period to... to 1, and cannot easily be adapted fon use with a plurality of time windows. An alternative reconstruction apparatus for use with one, two or four time windows during a scanning period is shown in ig. 10. The Fig. 10 apparatus is used in conjunction with the data transmission format shown in Fig. 8, which will De described first, The signal transmitted from the borehole tool to surface receiving equipment 10 for use with the one, two or four window reconstruction of Fig. 10 has the data format illustrated in Fig.8. Each scanning period t0...t0 1 of, e.g., 50Ous, is divided into a frame of the same time period, e.g., 500ups, containing four equal duration data block Dl... D4. Each data block contains paired maximum amplitude A data and corresponding time of occurrence T data. For a one window system, illustrated in Fig. 7a, the maximum amplitude and time of occurrence data A1, T1 is repeated during transmission to the surface in each of the data blocks D1...D4. For a two window system, illustrated inFig. 7b, the paired amplitude and time of occurrence data A1,T1 for the first window is repeated in the first two data blocks D1 and D2, while the same data for the second window A2,T2 is repeated in the last two data blocks D3 and D4. For a four window system, illustrated in Fig. 7c, each data block .... .04 contains pair amplitude and time values corresponding to respective windows, e.g., A1, T1 A2, T2 A3 T3 A4 T4. The data frames illustrated in Fig. 8 are formed by the apparatus illustrated in Fig. 9, which is a modification of the Fig.4 borehole tool apparatus 1. The data frame is formed in a parallel to serial frame register 63. Sequential paired amplitude and time data from encoder 8 are loaded into the various stages of register 63 by way of loading gates 61. The program selection inputs to decoder 33, which select the numDerrof timing windows in the Fig. 2 digitizing apparatus are used to operate loading gates 61 so that one of the data formats illustrated in Fig. 8a, 8b or 8e is created in frame register 63, corresponding to a surface selection of one, two or four timing windows. The serial output of frame register 63 is applied to transmission lines 9 for transmission to the surface apparatus illustrated in Fig. 10. The Fig. 10 apparatus is designed to receive any one of the selected data formats shown in Figs. 8a, 8b or 8e and reconstruct therefrom, the maximum amplitude and time of occurrence data for each of the time windows used in the system. Incoming encoded data is decoded by decoder 83 and then loaded frame by frame serially into a frame receiver register 67. To simplify further discussion, it will De assumed, for the moment, that four windows have been selected by tne programming inputs to decoder 33 and loading gates 61. The causes register 67 to have a loaded data format, wnerein each data block D1...D4 contains paired amplitude and time data for a respective time window W1.... .W4.The parallel outputs of register 67 are applied to a data select circuit 69 having ganged switches 71a and 71b. Switch 71a sequentially connects each of the amplitude values A1...A4 to an output line 01, while switch 71b sequentially connects each of the timing values T1...T4 to an output line 02. Consequently, as switches 71a, 71b sequentially move, paired amplitude A and timing T data are applied to output lines Ol and 02 of data select circuit 69. Switches 71a and 71b move in unison in response to a command signal from sequencer 73, which is generated with a period of t0 4, that is, four times in a scanning period to... to 1 Assuming a scanning period of 500 s, the command signals occur every 125 s. Thus, during the frame time of 0 50Cs data is available at the output lines 01, 2 of selector 69 as follows 01 02 0 l25 s A1, T1 125 250 s A2, T2 250 375 s A3, T3 375 500,us A4,T4 The command signals begin when sequencer 73 is informed by the output of frame detector 81 that a frame of data is present in register 67.To reconstruct both the maximum amplitude and its time of occurrence for each of the four windows W1...W4, a comparator 71, time base counter 73, oscillator 85, coincidence gate 75 and digital to analog converter 77 are employed. Time oase counter 73 is reset by a signal tB at the beginning of a scanning period of the signal reconstruction apparatus. This scanning period is equal in duration to that used in the borehole tool, i.e., t0...t1, but its initiation need not coincide with that of the scanning period in the borehole tool. Once reset by signal tB, time base counter 73 begins counting the output of oscillator 85. Comparator 71 receives the count value from counter 73 and compares it witn a timing value then present at the 02 output line of data select circuit 69.Whenever comparator 71 detects a coincidence between a timing value and the output of counter 73, it supplies an enable signal to gate 75 which allows a maximum digital amplitude value A corresponding to the timing value to pass to digital to analog converter 77, where the maximum amplitude value is reconstructed at a proper time with respect to the beginning tB of a scanning frame in the reconstruction apparatus. For a four window system, the paired digital values A1, T1 A2, T2 A3, T3 and A4,T4 will be sequentially connected to the data selector 69 outputs by the command signal and the maximum amplitude values A1... A4 will be reconstructed, in properly timed sequence in a scanning period by the timing values T1...T4. As noted, the Fig. 10 apparatus can also be used with a one or two window system as well. For a one window system, each of the four data blocks loaded into register 67 will have the same dataA1, T1, as shown in Fig. 8a. As a result, although the data select circuit 69 sequentially applies the A1 and T1 data from each of the data blocks to output line 01 and 02, comparator 71 will still only provide one output signal when it determines coincidence between T1 and the output of counter 73, no matter which data block D1...D4 switch 71 is then examining, so that a maximum amplitude output properly timed with respect to the beginning tB of a reconstruction scanning frame is produced by digital to analog converter 77. Similarly, when two windows are employed and the transmitted data format for the four data olocks D1...D4 is as shown in Fig. 8b, comparator 71 will recognize only two timing values T1 and T2 and will appropriately enable gate 75 so that corresponding maximum amplitude values A1 and A2 will be applied at the proper time to converter 77 and reconstructed. For proper operation of the Fig. 10 apparatus, counter 21 in the digitizing apparatus is reset only at the beginning of a new scanning period, i.e., at t0, so that each timing value T in a scanning period to...to l has a different value. As is apparent, the Fig. 10 reconstruction apparatus is capaole of use in a system employing one, two or four timing windows during a scanning period to...to l. It should óe apparent that other reconstruction apparatus could be easily devised for other numbers of timing windows.