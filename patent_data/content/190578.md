# CLOCK PHASE DISCRIMINATOR

## Claims
Phasendiskriminator zum Verringern einer Phasendifferenz zwischen einem Eingangstaktsignal fs und einem Referenztaktsignal fvco mit variabler Frequenz, der aufweist

## Description
The present invention relates to a phase discriminator that detects the difference in phase between a pair of clock signals and produces an output for changing the frequency of one of the clock signals to a frequency that reduces the measured phase difference. Existing phase discriminators for detection of the difference in phase between a pair of clock signals typically use circuitry that is sensitive to race conditions when the clock edges used to indicate phase arrive at substantially the same time. Stated differently, in such circuits, the closer in phase the clocks become, the less stable are the circuits. A typical discriminator used to measure the phase difference between a pair of clock signals, C₁ and C₂, is illustrated in Figure 1 and includes a pair of latches, L₁ and L₂. Each latch is set by a respective one of the gates G₁ and G₂. Each gate receives one of the clock signals through a pulse shaper PS and the output of the other latch. Either latch is set when the output of its gate is changed by a change in state of the associated input clock. The leading clock will set its associated latch first, causing an error signal E to be produced that indicates the time by which that clock leads the other. The set latch will remain set until reset by the lagging clock. However, if a change in state of the lagging clock is presented to its gate before the lead clock latch is set, the output of the circuit will be indeterminate and can incorrectly reflect the relative phase between the signals. As the speeds of data transfer and data processing equipments increase with each new generation of computers, the destabilizing effects of race conditions will only grow in magnitude. Thus, there is an obvious and urgent need to reduce, and ultimately eliminate, race conditions in phase detection circuitry. GB A 2 097 617 discloses a two state phase comparator circuit including two latch circuits. The IBM Technical Disclosure Bulletin Vol. 26, No. 3B, August 1983, discloses a phase detector comprising gate circuits for increasing or decreasing the frequency of a voltage controlled oscillator VCO . An object of the present invention is to provide a phase discriminator in which race conditions are substantially eliminated. A further object of the invention is to provide a phase discriminator having a latch circuit that measures a phase difference between two clock signals by performing a multi state transition cycle in which each state transition results from the change of a single respective state variable. A still further object of the invention is to provide an improved phase discriminator for measuring the phase difference between a pair of clock signals. In accordance with the present invention, there is now provided a phase discriminator, for reducing a phase difference between an input clock signal and a variable frequency reference clock signal, comprising a start latch responsive to the input clock signal and an enabling signal for producing a start cycle signal and latch circuit means responsive to a reference clock signal transition following the start cycle signal and to an input clock signal transition following the start cycle signal, for detecting the phase difference between the input clock signal and the reference clock signal, and for generating a phase correction signal for changing the frequency of the reference clock signal so as to reduce the phase difference characterised in that the latch circuit means comprises a first latch for producing a first phase difference signal in response to, and representative of a phase difference between the reference clock signal and the start cycle signal a second latch for producing a second phase difference signal in response to, and representative of a phase difference between the input clock signal and the start cycle signal a third latch responsive to the first and second phase differences signals for producing a gate control signal reset means for generating first and second reset signals to reset the first and second latches in response to the first and second phase difference signals, the reference clock signal, the input clock signal, and the gate control signal and gate circuit means responsive to the phase difference signals and the gate control signal for generating the phase correction signal. The present invention thus suppresses the occurrence of race conditions in a clock phase discriminator used to detect phase differences between a pair of clock signals. The circuit is designed for elimination of race conditions from the measuring circuitry of the discriminator. In eliminating race conditions, a clock phase discriminator of the present invention uses a latching circuit that measures the relative phase between a pair of input clock signals by following a multi state transition path in which each state transition results from the change of only one respective state variable. A phase discriminator of the present invention measures the difference in phase between an input clock signal of nominal frequency and a variable frequency reference clock signal. In response to the phase difference measurement, the discriminator produces an error signal for changing the frequency of the reference clock signal in a direction tending to eliminate the phase difference. The discriminator includes a start latch, responsive to a transition of the input clock for producing a start cycle signal and a frequency divider responsive to the start cycle for dividing the reference clock frequency to produce a comparison clock signal having substantially the same frequency as the input clock signal. The latch circuit of the discriminator of the present invention responds to the start cycle signal, and an input clock transition following the start cycle signal by measuring the relative phase between the signals by means of a multi state transition cycle in which each state transition results from the change of a single respective variable, and producing a phase difference signal indicative of the measured phase difference. A gate circuit is provided that responds to the phase difference signal by producing a correction signal to change the frequency of the reference clock signal to a frequency that reduces the phase difference. A preferred embodiment of the present invention will now be described with reference to the attached drawings, where The phase discriminator of the invention relates to a novel and improved apparatus for performing phase and frequency synchronization necessary in a data processing system wherein a reference clock signal must be synchronized to the rotational velocity of a storage disk. In turn, a reference data clock signal used to stage data to and from the disk must be synchronized to the servo clock to be sure that the data is written at the correct density on the disk. Without the synchronization of the clocks, the density of the data would vary as the speed of the disk varies. Typically a reference data clock in a magnetic storage access system that uses rotating disks to store data is provided from a phase locked loop such as is illustrated In Figure 2. The reference data clock is provided by a voltage controlled oscillator VCO 10 that produces the reference clock f Charge pumps and low pass filters are known in the art, and such devices are taught in U.S. Patent No. 4,034,309, which is assigned to the Assignee of this patent application and is incorporated herein by reference. The charge pump of the incorporated patent consists of two differentially driven, emitter coupled transistor pairs. The charge pump drives the low pass filter, which performs an integrating function. One of the charge pump pairs is enabled by a phase difference signal to provide a charge current to the low pass filter, which increases the magnitude of the voltage provided to the VCO, thereby increasing the frequency of the reference clock signal. The other charge pump pair responds to another phase difference signal by drawing current from the low pass filter, thereby reducing the reference clock frequency. In a typical phase locked loop, the charge pump is fed by a phase discriminator that produces a pair of phase correction signals, one to increase the charge held by the low pass filter and thus the frequency of f The operation of the phase discriminator 16 is illustrated by the waveforms of Figure 3. In Figure 3, the waveform f 4 represents a clock signal that is derived directly from f In the case denoted by a of Figure 3, the phase detector 16 will produce the DEC signal for a time t₁ that is proportional to the phase difference between f 4 and f If f As is shown in portions a and b of Figure 3, the phase correction signal initially output by the phase discriminator 16 to the charge pump 12 is effectively neutralized when the other correction signal is also placed in the positive state. This is because the second charge pump circuit is turned on and the increase and decrease frequency currents eliminate each other. This is necessary in order to prevent the occurrence of a deadband region in the response of the phase locked loop system that would result from the finite time required to switch the charge pump current circuits. After providing both phase correction signals in their positive states for an amount of time, the phase discriminator will simultaneously deactivate them. The phase discriminator 16 is shown in greater detail in Figure 4. The reference data clock signal f The phase discriminator of the invention further includes a START latch 32. The inputs to the START latch 32 include an ENABLE signal and the servo clock signal f A multi state latch circuit includes latches 34 42. The latch circuit transitions through a selected one of a plurality of multi state phase measurement cycles, with cycle selection depending upon the relative phase of the clock signal and the result of the adjustment of f The outputs of the latches 34, 36, 38, 40, and 42 are labelled V, W, Z, Y, and X, respectively. These outputs, together with f 4, G, and f As illustrated in Figure 4, the output V of the CLOCK latch 34 is determined by the state variables Y, f 4, G, and Z. The output W of the SERVO latch 36 depends upon the state variables X, G, f The output Z of the CYCLE DONE latch 38 is dependent upon the condition of state variables W and V. The clock clear variable Y provided by the CLOCK CLEAR latch 40 results from the condition of state variables V, f 4, and Z, while the variable X output by the SERVO CLEAR latch 42 is controlled by the state variables f The DEC and INC signals are provided by a DEC gate 44 and an INC gate 46. The DEC signal output by the DEC gate 44 depends upon the state variables V and Z that are input to the gate. The INC signal output by the INC gate 46 is determined by the state variables Z and W. The operation of the phase discriminator of Figure 4 is illustrated by the state transition diagram of Figure 5. Each state of the Figure 5 diagram is determined by a particular combination of the state variables produced by the latch circuit latches 34 42. Transitions between the states are determined by the state of the start latch 32 and transitions of the servo clock f In Table 1, conventional digital notation is used for the state variables. Thus, for example, the phase discriminator latch circuit is in state 0A when all of the latches 34 42 are reset. Similarly, the latch circuit is in state 0B when all of the latches 34 42 are set. As will be understood by those skilled in the art, the reset state of a state variable is indicated by a bar over the variable, while the set state is indicated by the absence of a bar. The conditions for setting and resetting the latches 34 42 are given in Table II. Again, the notation of the state variable equations in Table II is conventional and equivalent to that utilized in Table I. Finally, the phase correction signals output by the phase discriminator of Figure 4 are given by equations 1 and 2 . As is evident, the variable terms of equations 1 and 2 are produced by the action of the latches 34 42. Thus, each variable term of the equations can be considered to be a phase difference signal equivalent to the result of a phase measurement cycle, with the duration of the variable corresponding to the measured phase difference between f 4 and f To begin operation, the start latch 32 and the latch circuit latches 34 42 are all initially reset. Next, the ENABLE signal is placed in a high digital state. This may be provided by conventional circuitry when, for example, data is transferred to or from a rotating magnetic disk to which the servo clock f At the first positive transition of the servo clock f Assuming now that the start cycle signal G is positive, the latch circuit is in state 0A, and that a transition of f While in state 0A, if the first transition of f When the first positive transition of f 4 following the f Once the phase detector latch circuit enters state 3A, the transition to state 4A is automatic because the set conditions for the CYCLE DONE latch 38 exist. In state 4A, the outputs of the gates 44 and 46 transition substantially simultaneously to a low state. This happens because the state variables V, W, and Z are all in their positive conditions, which prevents any of the terms in equation 1 or equation 2 from being satisfied. Following the entry into state 4A, the frequency of f The transitions just described are summarized in Table III. Both columns of the Table represent measurements of a phase difference by which f It should be evident that the cycle just described is completed between the positive transition 22 and the later of either the negative transition 24 in the comparison clock f 4 or the negative transition 25 of the servo clock f Returning to state 0A, in the event that the first positive transition is the comparison clock signal f 4, the set of conditions illustrated by the a portion of Figure 3 will remain. That is, the comparison clock f 4 and, therefore, the reference data clock f It should be evident that transition cycles proceeding from state 0A through state 2A can be constructed from the transition cycles of Table III simply by substituting state 2A for each occurrence of state 1A. Once in state 0B, the response of the latch circuit from state 0B back to state 0A will be exactly the same as the response from state 0A, except that, at the beginning of a transition cycle from state 0B, all of the latches 34 42 will be set. Then, a transition cycle will be followed through state 1B corresponding to state 1A to increase the frequency of f It should be evident from Table I that the B suffix states are the complements of the A suffix states. Thus, all of the transitions from 0B to 0A are the complements of the corresponding transitions from 0A to 0B. This permits the phase discriminator to oscillate back and forth between two equivalent standby states, 0A and 0B, without having to initialize the latch circuit at the end of each transition cycle. This is convenient because it eliminates an extra state transition, which would otherwise reduce the phase discriminator s speed of operation. To stop the operation of the phase discriminator, the ENABLE signal is removed, which resets the START latch 32 and puts the start cycle signal into a low logic level state G. Although not illustrated in the transition diagram in Figure 5, it should be evident upon inspection of Table II that G will cause the phase discriminator to go from state 0B to state 0A by resetting the CLOCK and SERVO latches 34 and 36, which will force the circuit to go to state 4B, and from there, with successive transitions of f 4 and f Although a variety of circuit technologies exist for implementing the latches 32 42 and the gates 44 46, the inventor has found that conventional cascaded emitter coupled logic CECL provides several advantages over conventional single ended lock circuitry such as TTL. The use of differential logic circuitry such as CECL reduces the effects of noise and other external influences in causing a variation in the delay characteristics of the latch circuits. Further, the variations due to differences between rise and fall times are reduced since every state transition involves one or more pairs of differential signals. Finally, as is known, differential logic circuits provide a better noise margin than is obtained with single ended logic circuits. This permits smaller signal swings to be used, which results in a better speed power product for the latch circuits. Another example of implementing the latches 32 42 in CECL is provided in Figure 6, which is a schematic representation of a CECL circuit that is functionally equivalent to the CLOCK latch 34. As is typical with CECL circuits, two cascaded sets of emitter coupled transistor pairs 60 66 and 70 76 are used to implement logic internal to the latch that will provide the response to the input state variables required to set and reset the variable V that is output by the latch. Thus, when the latch is reset, each of the positive sense state voltages V1, V2, and V3 will be at a lower voltage than the corresponding one of the negative sense output voltages One further addition to the CECL circuits of the latches 32 42 is the provision of trickle current transistors, one of which is indicated by 84 in Figure 6. Each of the trickle transistors is biased by a voltage V Of course, it is within the capability of a skilled circuit engineer to convert the state variable signals in Figure 4 to the multi level, differential signals required to operate CECL. Obviously, many modifications and variations of the phase discriminator of the invention are possible in light of the teachings of this description. Therefore, it is to be understood that, within the scope of the following claims, the invention may be practiced in a manner that has not been specifically described.