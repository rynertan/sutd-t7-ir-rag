# Multi processor system.

## Abstract
A multi processor system in which processors 5, 6 communicate via a bus 7 with ordered access of the proces sors to the bus. After receipt of a trigger signal e.g. via 1, 2, 3, 4 each triggered processor times its access to the bud depen dent on its unique code which may be its address and the function the processor is to perform. In a special case in a first phase several processors transmit information along the bus in a queued manner to a receiving processor which infers the processor transmitting the information it is reading from the time lapse from the trigger signal in a second phase a proces sor transmits information onto the bus in a queued manner and each receiving processor by timing its reading of the bus reads the information intended for it. An application of the invention in intra shelf communication in a private branch telecommunications exchange is described.

## Claims
CLAIMS 1. A processor system comprising trigger signal generation means, a common information bus, a plurality of processor stations having respective unique codes and being arranged to read, when triggered, information from the bus after respective periods of time from the application of a trigger signal dependent on their respective codes whereby readings by the stations are due to start at respective predetermined spaced times after said trigger signal thereby providing respective reading intervals, and a further processor station arranged to transmit information for a plurality of recipient stations onto the bus after said respective periods of time from said trigger signal dependent on the codes of the recipient stations whereby each recipient station reads information intended for it, in which system, in operation, a trigger signal from said means is simultaneously applied to the transmitting further station and to at least said plurality of recipient stations. 2. A system according to Claim 1 wherein said plurality of processor stations are arranged to transmit, when triggered, information onto the bus after respective periods of time from the application of said trigger signal dependent on their respective codes whreby transmissions from the stations are due to start at respective predetermined spaced times after said trigger signal thereby providing respective transmission intervals, and comprising a further processor station arranged to read information in a series from transmitting stations and to Xf which station had transmitted which information by knowing the time lapse from said trigger signal at which that information was read, in which system, in operation, a said trigger signal from said means is also applied to the reading further station, which is arranged to read in one phase, and the trasmitting further station is arranged to transmit in another phase. 3. A system according to Claim 2 wherein said reading further station that reads in said one phase is said transmitting further station that transmits in said another phase. 4. A system according to any of the preceeding claims wherein said period is a knawn factor multiplied by said code. 5. A system according to Claim 4 wherein the duration of an information transmission from any station and for any station is limited to a maximum and the known factor is the same for all stations. 6. A system according to Claim 2 or Claim 3 wherein said one phase is the first phase and said another phase is the second phase and in the first phase the transmission duration from each transmitting station is the same and in the second the reading duration of each reading station is the same and each station on completion of transmission in the first phase waits a second period before reading the information intended for it in the second phase and the second period is the same for all such stations. 7. A system according to any one of the preceding claims wherein the range of the unique codes of the stations is 0 to N l where N is the number of stations on whose codes said periods depend. 8. A system according to any one of the preceding claims wherein the code for a station is the station s address. 9. A system according to Claim 8 wherein the stations are in the form of substantially identical cards and the station addresses are determined by the wiring of back plane slots in which the cards are mounted. 10. A system according to any one of the preceding claims wherein the period relevent to a station s action is calculated by that station. 11. A system according to Claim 10 wherein the period is calculated by causing the station to execute a series of program steps the execution of which lasts the required period. 12. A system according to Claim 11 wherein the steps are no operation steps for stations waiting either to read or transmit onto the bus. 13. A system according to any cne of Claims 2, 3 and 6 wherein each station has a normal transmission interval set by the due start of transmission from the station with the next succeeding code, each of said plurality of stations is triggered and transmits a signal indicating the deviation in transmission length from its normal interval, and each SLYE1 station receiving a deviation signal or signals changes its start of transmission in accordance with the net deviation of the respective preceding stations such that the transmissions follow one after another. 14. A system according to Claim 13 wherein a recipient triggered station can determine from the deviation signals the net deviaiton from its respective period of time from said trigger signal at which it reads information from the bus. 15. A system according to Claim 1 wherein station has a normal reading interval set by the due start of reading by the station with the next succeeding code, each of said plurality of stations is triggered and the transmitting station transmits respective signals indicating the deviation in transmission length from normal interval, and each recipient triggered station receiving a deviation signal or signals changes its start of reading in accordance with the net deviation of the respective preceding stations such that the readings follow one after another. 16. A system according to any one of the preceding claims wherein said means is included in a station. 17. A system according to any one of the preceding claims wherein said bus is a bidirectional bus. 18. A system according to any one of the preceding claims wherein said trigger signal comprises a double pulse and the first pulse causes a station to which it is applied to complete the operation the station is then engaged on and thereafter to commence and continue repeatedly n peration steps and application of the second pulse occurs after such commencement and causes the station to cease the no operation steps and commence the relevant activitity so that all stations receiving the signal are synchronised to within one instruction cycle. 19. A processor system as herein described with reference to the accompanying drawing. 20. A private branch exchange employing a processor system according to any one of the preceding claims.

## Description
DESCRIPTION The invention relates to processor systems in which there are several interacting processor stations and information is passed from one station to another. There are several well known processor systems which allay information to be passed from one station in the system to another. These kno Jn systems include 1 ring structures in which stations are all connected to a common information bus in the form of a ring and 2 a structure in which there is a common information bus which is not in the form of a closed Ting but allay bi directional transfer of information. Such systems, in which several stations have access to a common bus, give rise to the problOjn of non collision. This is the problem of ensuring that information is put on and retrieved from the bus in an ordered manner so that one station does not, in trying to interact with the bus, corrupt information already on the bus. There are several can protocols which so order the bus iifteraction to allow one station to put information on the bus to be read off the bus by another.In these known protocols the stations may be run synchronously or asynchronously, that is, the timing of the start of the instruction cycles in each station may be coincident synchronous or may r t be coincident asynchronous . Another problein with such inulti station systems is to ensure that the station whicb is to receive the information actually receives it. In a synchronous system this can he done by timing and arranging for a each station to read the bus at a particl r time and b the information on the bus at that time to be the information for that reading station i.e. ar Ji.ier station is transmitting synchronously for the receiving station .This can be done, fcr example, by a controlling processor instructing the relevant stations at the relevant times to read or write as required or by eacil station program requiring reading or writing at relevant times. This latter solution may involve each station reading an address from a packet of information and only reading the rest of the information if the address coincides with the reader s address and similarly only writing information into a free packet slot e.g. this could be signalled by the absence of an address at the beginning of a package slot . In asynchronous or synchronous arrangements the above can he achieved by arranging for the transmitting station to send an interrupt to the intended recipient which then stops what it is doing and reads the information.In an asynchronous system the interrupt may also be used to bring the intended recipient into phase with the transmitting station. Thus synchrorous systems require the provision of an extra controlling processor or a reading stage in each station program. The asynchronous system requires an interrupt protocol. Gerllan Patent No. 2259223 discloses an example of a synchronous system in which each of a number of stations connected to a bus is allocated a respective time slot in a frame for transmitting information onto the bus. HOwever, the stations are grouped in pairs with the two stations of a pair allocated time slots spaced by half the frame duration and each station is arranged to reed only the transmission from its paired station. Depending on the function the system is to perform there may be aclvantages in adopting asynchronous or synchronous schemes. According to the present invention there is provided a processor system comprising trigger signal generation means, a common information bus, a plurality of processor stations having respective unique codes and being arranged to read, when triggered, information from the bus after respective periods of time from the application of a trigger signal dependent on their respective codes whereby readings by the stations are due to start at respective predetermined spaced times after said trigger signal thereby providing respective reading intervals, and a processor station arranged to transmit information for a plurality of recipient stations onto the bus after said respective periods of time from said trigger signal dependent on the codes of the recipient triggered stations whereby each recipient station reads information intended for it, in which system, in operation, a trigger signal from said means is simultaneously applied to the transmitting station and to at least said plurality of recipient stations. The transmitting further processor station may be a special purpose control station with a permanent transmitting function, or it may he similar to the other processor stations and have a respective code, but in which case this transmitting function is temporary and inhibits the normal read function, and is transferable to another processor station. Preferably the plurality of processor stations are arranged to transmit, when triggered, information onto the bus after respective periods of time from the application of said trigger signal dependent on their respective codes whereby transmissions from the stations are due to start at respective predetermined spaced times after said trigger signal thereby providing respective transmission internvals, and the system comprises a further processor station arranged to read information in a series from a plurality of trilsmitting stations and to know which station had transmitted which information by knowing the time lapse from said trigger signal at which that information was read, in which system, in operation, a said trigger signal from said means is also applied to the reading further station which is arranged to read in one phase, and the transmitting further station is arranged to transmit in another phase. It will he appreciated that a series can be continuous like a train when the several transmitting stations or the several reading stations have consecutive allotted intervals, or it can be broken where such intervals are not consecutive as, for example, where not all the stations of the system want to transmit information and a silent station has its allotted interval between the alloted intervals of active stations. The reading further processor station may be a special purpose control station with a permanent reading function, or it may be similar to the other processor stations and have a respective unique code, but in which case this reading function is temporary and inhibits the normal transmit function, and is transferable to another processor station. Wbre preferably said reading further station is said transmitting further station. The period is preferably directly prcportional to the code and therefore is a number of processor clock cycles equal to a knawn factor multiplied by the code.Also the duration of an information transmission from any station and for any station is, for preference, less than a maximun value and the knows factor is the same for all stations. The range of the unique codes of the stations is suitably 0 to N l ere N is the number of stations wishing to transmit information in a train or wishing to receive information from a train of information. The code for a station may suitably be the address of the station. The calculaticn of the period may he performed within the relevant station, and this calculation may be performed by causing tile station to execute a series of program steps which execution lasts the required period for that station. The program steps which the station may he called to execute ray he no operation steps. The trigger signal generating means may be included in one or more of the stations.The bus may be a bi directional bus Preferably the one phase is the first phase and the another phase is the second phase and in the first phase the transmission duration from each transmitting station is the same and in the second phase the reading duration of each reading station is the same and each station on completion of transmission in the first phase waits a second period before reading the information intended for it in the second phase and the second period is the same for all such stations. An embodiment of this invention will now be described by way of example only, with reference to the accoEpanying drawing in which Figure 1 is a block diagram of a processor system according to the invention, andFigure 2 is a schematic diagram of part of the card and back plane arrangement. In this embodiment the invention is employed in a PBX Private Branch Exchange which provides, inter alia, for several extensions for telephones and or other equipment, e.g. computer terminals and for several exchange lines connections from the PBX to the outside world, e.g. the local exchange of the public switched telephone network . The PBX therefore has at least to provide connections through itself to connect 1 a calling extension to the called extension 2 a calling extension to the exchange line and to pass on to the outside world the desired number and 3 an exchange line to the called extension for incoming calls. The PBX described here is a digitally operated PBX in which analogue signals are sampled and encoded in digital form using well known techniques. The PBX described here is a digitally operated PBX in which analogue signals are sampled and encoded in digital form using well knovn techniques. The PBX comprises a control shelf which1 inter alia, controls the switching through the PBX and houses the time switch , and a line shelf which houses line units which group together the line circuits to the extension lines and the exchange lines . The line shelf also has a shelf interface unit SIU which interfaces between the line shelf and the control shelf. As shown in Figure l each line unit contains a micro cowputer 5 which functions as a canton control for the line circuits in the unit not shown The SIU, which performs the overall control function for the shelf, also contains a micro computer 6 for control purposes. Communication between the SIU and the line units is effected over an 8 wire shelf signalling bus 7, used at different times in each direction. Communication between the SIU and the control shelf is effected over a communication link not shown . The control shelf controls the time switch, arranges correct connection and generally processes the calls. The invention is employed in the communication between the line units and the SIU. The system operates on an 8 msec cycle. All the line unit microvomputers 5 and the SIU microcomputer 6 herein referred to as stations receive an interrupt signal from the control shelf via the interrupt signal line 1 every 8 msec. Each microcomputer 5,6 on receipt of the interrupt signal ceases its processing, performs an alignment to synchronise the microcomputers 5,6 on the line shelf and then commences the following sequence msecs 0 and 1 line unit microcoçputers 5 transmit data and SIU microcomputer 6 reads the transmitted data. msecs 2 and 3 SIU microcomputer 6 transmits data and line unit microcomputers 5 read the data. Lri msecs 4 to 7 all mlcrocomputers 5,6 return to their own asynchronous internal functions and no information is passed along the bus 7. The synchronisation may be performed by simply completing the operation the microcomputer is carrying out at the time of receipt of the interrupt. However, some microcomputers1 e.g. an Intel 8049 microca ter, , have operations which may involve either one or t instruction cycles. Thus synchronisation by completion of an operation only synchronises the microcoq uters to within two instruction cycles. In such a case each byte of information put on the bus must be on the bus for at least two instruction cycles to ensure that it is read by the required station. This therefore can slow the operation of the system. In this embodiment the interrupt line 1 feeds an interrupt logic block 2 which is on the same card as theSIU microcomputer 6. The interrupt logic block 2 passes the interrupt signal undelayed to the microcomputers 5,6 along microcomputer interrupt line 3 and generates a second synchronisation pulse, delayed from the interrupt pulse, which is fed to the microcomputers along both the microcomputer interrupt leads 3 and microcomputer synchronisation lines 4. on receipt of the first pulse the microcomputers 5,6 in the line units and in the SIU complete whatever activities they are engaged on at the time it arrives, and then wait for the second pulse on the microcomputer interrupt line 3.When the second pulse arrives, and provided it is accompanied by a pulse on the microcomputer synchronisation line 4, all microcomputers 5,6 commence the 8 msec cycle described aove synchronised to within one instruction cycle. This synchronisation is achieved by causing the microcomputers to wait by repetitively executing the single instruction cycle operation of no operation . The requirement to recognise pulses on both the microcomputer interrupt lines 3 and the microcomputer synchronisation lines 4 at the same time provides a means of distinguishing between first and second interrupts. After receipt of the second of the double interrupt signals, each line unit microcomputer 5 executes R do loops where R is the unique s TiWlic address of the particular line unit microcomputer. The do loop of each microcomputer comprises a series of no operation program steps such that one do loop operation occupies the same time that is required for the line unit microcomputer 5 to transmit its information onto the bns 7. Thus the information from all line units appears on the bus in a train and the SIU microcomputer 6 reading the information ont ehbus 7 can identify which line unit microcomputer put which information on the bus 7. Upon completion of transmission of its information each line unit microcputer 5 reads information from the bus 7 after a period defined by M do loop operations where M 1 is at leat the number of line unit microcomputers 5 in the sytem. The SIU microcomputer 6 reads the information put on the bus 7 by the line unit microcomputer 5 and knows which information was put on the bus 7 by which line unit microcomputer from the time lapse from the second interrupt signal. After receipt of information from all line unit microco p1uter 5, the SIU microcomputer 6 puts information on the bus 7 intended for the line unit microcomputers 5. Czech line unit micro omputer 5 reads the information on the bus 7 after waiting a specified period as explained above from the completion of the transmission of information onto the bus 7 by that microcomputer. Thus each microcomputer 5 reads the information intended for it. After the SIU microcomputer 6 has read all the information from the line unit microcomputers 5 and each line unit microcomputer 5 has read the information intended for it from the SIU microoomputer 6 all of the microcorip uters return to their internal functions until receipt of the interrupt as described above. As the line unit microcomputers 5 each have a unique sym zlic address in the range 0 to N l, where N is the number of line unit microcomputers 5 in the system, the information from the line unit microca puters are transmitted in a queued manner onto the information bus. The line unit microcomputers 5 can be identical and can operate using identical software. The symbolic address in this case is obtained from the physical position a parti ular microcomputer 5 has with respect tO the other microcomputers 5. The microcomputers 5 are informed of this position by the wiring 8 of the back plane slots 9 in which the microcomputer cards 10 are located Figure 2 . The embodiment so far described by way of example allows a microcomputer to receive information from a number of microcomputers in a first phase, to transmit information to each of these microcomputers in a second phase and in a third phase to allow all microcomputers to asynchronously continue with their internal processes.The microcomputers communicate by a parallel bus and are brought into synchronism using an externally generated interrupt. However, the principle of receipt of an interrupt and timing transmisison and reading of information by execution of a software program, in order to achieve non collision of access to the bus, can be applied to ring buses as well as to bi directional buses.Also the principel can be applied to the case when the interrupt is not generated externally to the system, but may be generated by any of the co mmznication microcomputers and may be applied to only two or more of the microcomputers. In this latter case, all microcomputers other than those actually communicating must be inhibited from attempting to initiate communication. This can be achieved by, for example, an initiating microcomputer inhibiting all other microcomputers froin initiation of communication for the period required for the communication required by the initiating microcomputer.This period could, for example, be fixed in the design stage of the system, or could be variable, in which case the initiating microconlputer would have to inform the non communicating microcomputers h long the communication will take, and require them to wait at lest that time, before initiating a communication request. In the embodiment described, the packages of information for each line unit microcomputer 5 have the same duration. Bwever, the principle above may be applied to systems in which the microcomputers do not have information packages of the same length, provided the transmitting and the reading microcomputers kIx the length of the packages and therefore can, by timing, ensure non collision, infer from the time when the information was read the address of the transmitting microcomputer and time when to read information intended for it. Furthermore, in a modification of such a system the information packages, whether all the same length or not, can be varied dynamically by the microcc puters, but in this case the microcomputers will have to inform each other about the lengths of their packages, and the microcomputers may have special inputs for this purpose.All the microcomputers will have a normal respective package length also referred to as transmission period , and can indicate any deviation from this, and each microcomputer will be responsive to the indicated deviations for ta, purposes. The first purpose is to adjust the start of transmission in accordance with the net deviation of the preceding microcomputer i.e. those with lower codes , and the second Lxnpcse is to adjust the start of reading in accordance with the net deviation of all the nicroco puters. In this sNTay, the system can make efficient use of communication time with the transmissions following one after the other. If a microcomputer has no information to transmit then it can indicate a deviation of the total length of its normal information package. Alternatively, the system may be arranged such that a microcomputer having no inform iticr LO Thransmit can provide a signal to the other microcomputers to alter their unique codes, thus indicating the deviation by a unity value signal rather than a high value signal. The microcomputers begin the read phase having taken into account the net deviation in the transmit pahse, and the same idea of dynamic length adjustment can be applied with the transmitting microcomputer indicating any deviation of the package length. The embodiment has been employed to provide concentration within the PBX. This has been achieved by the line shalf having ports for up to 96 line circuits, the line circuits being grouped together such that 8 are served by one line unit microcomputer, and the resultant 12 line unit microcomputer interfaces with a 32 channel communication link with the control shelf. Thus at any one time only 32 of the 96 line circuits may be used. TheSIU microcomputer receives information from the line unit microcomputers and allocates the line circuits to the control shelf allaying twxvway communication on each of the 32 channels in the communication link. For an incoming call the control shelf initiates action by the SIU microcomputer for establishing ts D way cosmurlication.