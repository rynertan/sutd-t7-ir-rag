# MICROCOMPUTER

## Claims
Mikrocomputer, der Instruktionen ausführt, um Ausgabedaten zu erzeugen, der wirkugsmäßig verbunden mit einem ersten externen Stift 12 ist, zum Empfangen eines externen Rücksetzsignals V

## Description
The present invention relates to a microcomputer operated with a reset instruction, more particularly a microcomputer in which a reset operation can be effectively carried out not only during the rise of a power level, but also the fall of the power level. For a microcomputer below computer to start execution of desired jobs, it generally requires a reset operation when power is first applied thereto, especially during the rise of the power. This operation initializes the computer. To achieve such a reset operation, the computer usually incorporates an external reset port. An external reset circuit, such as a capacitor resistor CR circuit, is connected to the pin leading to the external reset port. A recent trend is for execution of a similar reset operation when the power is cut off, especially during the fall of the power level. Erroneous operation often occurs during the fall of the power level, especially when the level drops below the lower limit of a guaranteed operational range of the computer, for example 4.5 V 5 V 0.5 V . Specifically, the computer may jump to a totally different routine and run out of control. The prior art has used both conventional and additional external reset circuits for the reset operation so as to cover both the rise and fall of the power level. That is, a computer has been equipped with both conventional and additional external reset circuits at its relevant pin. The external reset circuits in current use compare in size with the computer itself, however. This accordingly increases the size of the computer assembly. With very small systems, for example, an electronic camera system, not that much room is available. DE B 2 936 683 discloses a reset circuit for a microprocessor, having features corresponding to those of the preamble of accompanying claim 1. A reset signal is generated externally to the microprocessor, in response to the level of a power supply voltage. JP A 58 12034 discloses an information processor having an internal reset circuit which generates a reset signal in response to a decoded instruction. According to the present invention there is provided a microcomputer which executes instructions to produce output data, operatively connected to a first external pin for receiving an external reset signal to initialize said microcomputer and a second external pin for providing a power on signal to hold said microcomputer in a power on state characterised by Reference will now be made, by way of example, to the accompanying drawings, wherein The structure and operation of a computer embodying the present invention can be best made clear by beginning with a general description of a usual computer. Figure 1 is a general view of a currently used microcomputer provided with a typical external reset circuit. That is, Fig. 1 shows an external CR circuit, which is particularly effective during the rise of the power level V The switch 14 is illustrated schematically as a mechanical switch but, in actuality, is an electronic controlled semiconductor switch. When the computer operation is to be stopped, the switch 14 is supplied with a power off signal from a power control pin 15. The switch 14 is self sustained to be conductive once an external start signal ST is given thereto and until the power off signal is generated in the computer 11. The external start signal ST may be suitably produced. For example, in an electronic camera system, the start signal ST may be generated every time an operator touches a shutter release button. Alternatively, in a so called multifunction telephone set, the start signal ST may be generated by a off hook signal. Incidentally, in the example of an electronic camera system, a peripheral circuit 18, to be used with the computer 11, functions to perform auto focus AF , auto exposing AE , auto winding, auto date setting, auto flashing, and so on. Figure 2 depicts waveforms of signals appearing at major portions in the circuit of Fig. 1. The reset operation to be achieved in the computer unit 11 will be clarified with reference to Fig. 2. Row a exhibits the waveforms of the power level V Execution of the job ends with a power off instruction. In response to an instruction for changing the logic of one of the output ports in order to achieve a power off operation, a control signal, i.e., a power off signal, is produced from one of the output ports, for example, the power control pin 15, to turn off the switch 14. Thus, the power is cut off and the power level V In this regard, the reset operation of the computer at a final stage must be commenced at the time t2 to time t3. In actuality, however, the reset operation often cannot be completed from time t2 and time t3. That is, as seen from Fig. 2, the reset voltage level V In view of the above problem, the conventional reset circuit i.e., CR circuit 13, is not sufficient by itself for the computer unit 11 when an operational sequence of the overall system includes a series of alternate power on and power off steps performed frequently. Figure 3 is a circuit diagram of a prior art external reset circuit used with the microcomputer unit of Fig. 1. In Fig. 3, members the same as those of Fig. 1 are represented by the same reference numerals and characters same for later figures . The external reset circuit 30 of the prior art is constructed by the conventional CR circuit 13 and an additional reset circuit 31. The circuit 31 works to cancel the interval between the time t3 and time t4 Fig. 2 in which the reset operation is not yet activated. As shown in Fig. 3, the additional reset circuit 31 includes transistors Q₁ , Q₂ , Zener diode ZD, and resistors. The Zener voltage V A summary of the operation is as follows. During the fall of the power level V During the fall of the power level V Figure 4 depicts waveforms of signals representing the level V In an embodiment of the invention, no additional external reset circuit 31 is needed yet, the reset operation can still be performed in the computer without error. Means are provided for generating an internal reset instruction by the computer itself at a timing close to generation of the power off instruction. The power off instruction is an instruction for changing the logic of the power control pin 15 and indicates the end of each job and is specifically expressed as the power off signal from the power control pin 15 Fig. 1 , which works to turn off the switch 14 Fig. 1 . The internal reset instruction can be generated either just preceding or just following the generation of the power off instruction. Figure 5 is a circuit diagram representing part of a computer embodying the present invention together with a part of the peripheral members already existing in a computer unit. In Fig. 5, the circuit 51, other than the pins 12 and 52, is formed inside the computer unit 11 Fig. 1 . The pin 12 is the previously mentioned external reset pin. Reference numeral 52 represents the aforesaid power control pin 15 Fig. 1 and input output I O pins 19 Fig. 1 connected to the peripheral circuit 18 Fig. 1 . During the rise of the power level V Assuming that the level V The internal reset instruction is further incorporated in the usual instruction set. The internal reset instruction is set up in the program to form a pair together with the usual power off instruction, which is generated at the end of each job executed in the computer. Thus, the computer can create a reset state by itself at each final stage of the jobs. The internal reset instruction is stored in advance in a program memory not shown in Fig. 5 but in Fig. 7 along with the series of usual instructions for executing the jobs. The internal reset instruction is transferred on an internal bus 58 and stored first in an instruction register IR 59 and then decoded by an instruction docoder 67, as with usual instructions. Thus, the instruction decoder 67 provides a corresponding internal reset instruction signal I The thus synchronized internal reset instruction signal I Before the receipt of the internal reset instruction signal I Thus, the internal reset instruction is generated at a timing close to the instruction indicating the end of the job, i.e., the power off operation. In response to the thus generated internal reset instruction, the internal reset instruction signal I Figure 6 depicts waveforms for explaining such reset timing. In Fig. 6, times t2, t3, and t4 correspond to those shown in Fig. 2. Character te denotes the time when the job comes to an end, and therefore, the power off instruction is generated. In response to the power off instruction, the switch 14 Fig. 1 is turned off by the output signal from the pin 15 Fig. 1 . The output signal is usually produced from the instruction decoder 67 Fig. 5 and supplied at the pin 52 Fig. 5 , assuming that the pin 52 represents the pin 15 in this case refer to Fig. 7 . In Fig. 6, the signal line for transferring the output signal 67 52 is not illustrated. The internal reset instruction signal I The time tr can be made immediately after the time te by setting the internal reset instruction close to the power off instruction. The internal reset instruction can be positioned either before or after the power off instruction. The former case will be explained hereinafter. Referring still to Fig. 5, a master reset may be classified into two major modes. In the first mode, the computer is rendered in the master reset state when the reset voltage level V The first mode is a usual mode performed in a microcomputer. In this mode, the I O pins, represented by the pin 52 of Fig. 5, are fixed at the L level, which mode is considered as initialization of the computer. Under the initialization mode, the flip flop 56 produces an H level output for master reset of the related computer elements 57 Fig. 5 . In the first mode, on the other hand, the flip flop 61 does not produce an internal reset instruction signal I Under the second mode, the resultant data of the finished job is held as it is. The resultant data is supplied, from a random access memory RAM in the computer and via the internal bus 58, to the OR gate 64 as a data DT, when a transfer gate 68 Fig. 5 is opened by a write signal WR Fig. 5 given from a related computer element among the elements 57 Fig. 5 . Then, if data DT is the H level the flip flop 66 is set by the data DT from the OR gate 64. Conversely, if data DT is the L level, the flip flop 66 is reset by the data DT by means of an inverter 65. The inverter 65 inverts the L level to the H level and then supplies the inverted H level signal to the reset terminal R of the flip flop 66. The resultant data DT, including the power off signal L , is accordingly maintained as it is at the pin 52, because the write signal WR is inhibited by the internal reset instruction. Thus, the transfer gate 68 is closed. In this case, it is important to note that the power off signal from the pin 52 15 must be maintained as it is at the L level after the internal reset instruction signal I Generally speaking, it is preferable to employ another means, cooperating with the previously mentioned means for generating the internal reset instruction signal I Figure 7 is a block diagram of an example of a microcomputer unit according to an embodiment of the present invention. In Fig. 7, a block 71 indicated by chain dotted lines features the present invention. That is, the block 71 functions as a reset processing circuit. The members 12, 52, 58, 59, and 67 are the same as those shown in Fig. 5. Other members are a timing control circuit CNT 72, arithmetic logic unit ALU 73, temporary register REG 74, program counter PC 75, the RAM 76 for storing processed data momentarily, read only memory ROM 77 for storing a variety of instructions, i.e., the program memory including the power off instruction and the internal reset instruction , and an I O buffer 78. These members, with some modifications, are well known and commonly used in current microcomputers. The modifications are as follows. First, the reset processing circuit 71 is further employed in the computer, which is comprised of preexisting members, i.e., members 53, 55, and 56 of Fig. 5, and newly employed memoers, i.e., members 54, 61, 62, 63, 64, and 65 of Fig. 5. One of the remaining members, the flip flop 66 is newly mounted in the I O buffer 78. Another of the remaining members, the AND gate 60 of Fig. 5, is realized by the usual timing control circuit 72 and connected to a flip flop 61 via a signal line L₁. Other of the remaining members, the computer elements 57 of Fig. 5, are specifically illustrated as the members 59, 72, 73, 74, 75, 76, and 77. All these members are reset by a signal R, which is indicative of either the external reset signal or the internal reset instruction signal and produced from the flip flop 56 of Fig. 5 contained in the circuit 71. The output pair from the OR gate 64 and the inverter 65, both shown in Fig. 5, is transferred, as a signal r, to the I O buffer 78. Figure 8 is a general flow chart of processing performed in a computer embodying the present invention. In step a, the power on off switch 14 Fig. 1 is turned on by the start signal ST, and the power source of V Regarding step e of Fig. 8, the internal reset instruction and the power off instruction are executed sequentially. In this case, there are two possible sequences. In one, the power off instruction is executed first and, soon after, the internal reset instruction is executed, as depicted in Fig. 6. In the other, the internal reset instruction is generated first at a timing I of Fig. 6, and then the power off instruction is executed at the time te of Fig. 6. This sequence is not possible in a usual reset operation utilizing the prior art reset circuit 30 of Fig. 3, but is possible in this embodiment of the invention. In this sequence, it should be noted that the internal reset instruction signal I As mentioned above, a microcomputer unit embodying the present invention does not need any additional reset circuit such as the circuit 31 in Fig. 3. That is, a reset operation at the final stage activated by the additional reset circuit of the prior art is started by the computer itself.