# Transaction system

## Claims
Transaktionssystem mit einem Berechtigungszeichen mit einem eingebauten Datenprozessor und einer einzelnen induktiven Schleife 30, 31 , einem Terminal mit einem induktiven Kopplungsmittel 9 zur Kopplung mit der einzelnen induktiven Schleife, um Terminaldaten und leistung zum Berechtigungszeichen über ein moduliertes Trägersignal zu übertragen, Mitteln 3, 4, 5 zum Modulieren der Frequenz des Trägersignals mit den Terminaldaten, wobei das Berechtigungszeichen Mittel 51, 55 , um das frequenzmodulierte Trägersignal für den Datenprozessor zu empfangen, und Mittel 37, 38 umfaßt, um die Berechtigungszeichen Daten zum Terminal zu übertragen, indem eine Impedanz 38 geschaltet wird, um die Amplitude des Trägersignals am Terminal zu modulieren, und das Terminal Mittel 15 18 umfaßt, um die verarbeiteten Daten aus der Amplitudenmodulation des frequenzmodulierten Trägersignals zu gewinnen.

## Description
This invention relates to a transaction system in which a portable token is used in conjunction with another device, often termed a terminal, to perform a transaction of some kind. At present commonly available portable tokens are of a very simple passive kind and are often termed credit cards or service cards, the latter being usable in conjunction with data terminals to permit the withdrawal of cash from a bank account or the like. Tokens which are presently in common usage are passive, in the sense that they do not possess on board processing or computing capability but instead carry an identity code which is compared by the co operating data terminal with a code which is entered manually by the bearer of the token. This identity code comparison acts merely as a security check to confirm that the bearer of the token is indeed entitled to conduct the transaction. A typical security check of this type is described by DE OLS 2634303 which discloses an electronic lock apparatus comprising an electronic lock unit and an electronic key. The electronic lock unit comprises a high frequency oscillator of which the output is coupled through an amplifier to a transmit receive coil and also to a signal evaluation unit through a low pass filter. The electronic key has a transmit receive coil, for inductive coupling with the transmit receive coil of the electronic lock unit, to receive the high frequency signal which is rectified to provide power for a signal generator having a 24 bit code. A transistor is controlled by the signal generator to switch a resistor, thereby inducing current or voltage oscillations in the transmit receive coil of the electronic key. These oscillations are of a lower frequency than the high frequency signal and constitute coded impulses which are filtered by the low pass filter in the electronic lock and are applied to the signal evaluation unit. The signal generator in the key is constructed as a shift register having permanently stored information which, when the key is introduced to the lock. is compared against a permanently stored pulse sequence in the signal evaluation unit. The electronic lock is operated if the information stored in the signal generator completely corresponds with the pulse sequence in the signal evaluation unit that is a simple identity code comparison serving merely as a security check to confirm that the key is appropriate for operating the lock. The possibility is also mentioned of the key being interrogated by a code from the lock, and being inhibited from transmitting its own sequence if the lock code is incorrect. Thus DE OLS 2634303 teaches a transaction system in the form of a key and lock. identity card or cheque card including a key having permanently stored data and a single inductive loop, and a lock having an inductive coupling means for coupling with the single inductive loop to transmit a high frequency signal to power the token and to transmit the permanently stored data from the key to the lock. There is no teaching regarding the provision or use of any data processor in the key which functions merely to supply the appropriate fixed data to release the lock. The high frequency signal is supplied by an oscillator and is essentially of fixed frequency. There is no teaching regarding the manner in which the lock can pass a security code to the key to enable the release of the permanently stored key data only to the correct lock. It has been proposed to enhance the usefulness and sophistication of such a token by including within it a data processing capability which would greatly extend the range of transactions and functions which it could be used to perform. The presence of such a capability on board the token makes the interaction between it and the terminal much more critical and introduces difficulties which are not of real significance for a conventional passive credit card or cash dispenser card. The present invention seeks to provide an improved transaction system. Document EP A 0089087 discloses a communication system access station. external station which uses frequency modulation in both directions. EP A 0147099, which forms part of the state of the art by virtue of EPC Article 54 3 , describes a vending apparatus which will accept payment by coin or by token. In operation, tokens are separated from coins and are held at an interrogation station until the completion of a transaction or series of transactions. The interrogation station is provided with separate transmission and reception coils for inductive coupling with a coil in the token which is coinsized and shaped. The token includes a resonant circuit, for selectively absorbing the energy transmitted by the transmission coil, which includes a coil and a first parallel connected capacitor, and a second parallel connected capacitor which can be switched in and out of the resonant circuit by a semiconductor switch to vary the resonant frequency of the circuit. Data is transmitted to the token by amplitude modulating the signal applied to the transmission coil. This amplitude modulated signal has a frequency which is either fixed, or sweeps from a low value to a high value, and is picked up by the resonant circuit which has an output connected to a detection circuit operable to derive data from the received waveform and to deliver such data to a memory circuit. The token is said to be powered by an internal battery. Data can be read out of this memory circuit and delivered to a transmission circuit to operate the semiconductor switch selectively, thereby varying the impedance of the resonant circuit which is detected through the reception coil of the interrogation station by a microprocessor arranged to note the time interval between pulses caused by the switching of the resonant circuit. Thus EP A 0147099 teaches a transaction system including, a token having an on board data processor and a single inductive loop, and a terminal having an inductive coupling means that is the separate transmission and reception coils for coupling with the single inductive loop to transmit terminal data and power to the token via an amplitude modulated carrier signal. and to transmit processed data to the terminal by switching an impedance that is the semiconductor switch controlling the impedance of the resonant circuit . According to the present invention there is provided a transaction system including, a token having an on board data processor and a single inductive loop, a terminal having an inductive coupling means for coupling with the single inductive loop to transmit terminal data and power to the token via a modulated carrier signal, means for modulating the frequency of the carrier signal with the terminal data, the token including means to receive the frequency modulated carrier signal for said data processor and including means to transmit the token data to the terminal by switching an impedance to modulate the amplitude of the carrier signal at the terminal, the terminal including means for deriving the processed data from the amplitude modulation of the frequency modulated carrier signal. In this manner the on board data transmitter is entirely passive in the sense that it is merely necessary for it to modulate the load of a circuit tuned close to the frequency of the carrier signal which is transmitted to it by the terminal. The system can take many forms, and the terminal may be a fixture associated with a retail outlet, a bank, or possibly mounted on a vehicle for the purpose of collecting fares or exacting tolls. It is envisaged that the transaction token itself will be very small, in the form of a thin device akin to the dimensions of a credit card so that it is easily portable and can be carried by a user without causing any inconvenience. To enable its bulk and weight to be minimised and to extend its useful operating life, preferably the power utilised by the on board processor is obtained via said inductive coupling from the terminal, although if the token carries a volatile memory a small back up electric cell may be needed to ensure preservation of the data during intervals between transactions. The system may be provided with stand by means for energising the inductive coupling means at a relatively low stand by level and means are provided to energise the inductive coupling means at a higher operating level when a token inductively couples with the terminal. The terminal may be provided with means for transmitting the frequency modulated carrier signal on detection of a variation in the power demand thereof which is indicative of the presence of an inductively coupled token. This provision avoids the need for the terminal to continuously radiate the carrier signal at full power regardless of whether the token is present. The terminal can normally operate on a very low level stand by power and it is only when its inductive coupling system detects the presence of a token seeking to communicate with it that the power is raised to the operational level. Since the power needed to energise the on board processor of the token is derived from the terminal, the token may include means such as voltage detection means for monitoring the reception of the power operative to initiate operation of the on board data processor when the detected voltage rises above a threshold level, thereby enabling an orderly start up of the processor to be initiated, and means operative to shut down in an orderly manner, operation of the on board data processor when the detected voltage falls below a threshold value. In this manner data preservation can be ensured even in the event that the supply of power abruptly ceases due to the withdrawal of the token during the course of a transaction. The invention is further described by way of example with reference to the accompanying drawings. in which Referring to Figure 1 there is shown therein in schematic form a terminal which forms part of the system. The terminal is a permanent fixture in a building or vehicle and is intended to co operate with a token or card having processing capabilities, and which is therefore sometimes referred to as a Smart Card. Parts of the token itself are shown in some detail in Figure 3. Only those circuit parts of the terminal relevant to the way in which it co operates with the token, and transmits and receives data therebetween, are shown in Figure 1. Terminal data which is to be transmitted to the token is received at an input port 1 and is fed to a level shifter and amplifier 2 which renders the data, which is in a binary format, suitable for transmission to a variable frequency tuned circuit 3 so as to provide a frequency modulation of an output frequency, with the frequency modulation being representative of the information content of the terminal data. The output of the tuned circuit 3 feeds an amplifier 4, the output of which is fed back via a feed back loop 5 to the input of the variable tuned circuit 3 so as to constitute an oscillator arrangement. The frequency modulated output of the amplifier 4 is fed to a power amplifier 6, and thence to a tuned circuit 7 which consists of a capacitor 8 and an inductive loop 9. The inductive loop 9 is of some importance as it is this which co operates with the token. In practice, the loop is fairly large, possibly of the order of 15 cms by 15 cms, and consisting of a considerable number of conductive turns so as to enhance the inductive coupling with a similar but smaller coil carried by the token. The loop is set into the surface of the terminal on which the token is to be placed. If necessary, a location recess or the like is formed on the surface to ensure correct positioning of the token with respect to the loop. The terminal data is transmitted to the token as a frequency modulation, that is to say for binary digital data, a logic 1 state is represented by the transmission of one frequency from the tuned circuit 3, and a logic 0 state is represented by the transmission of a different frequency from the tuned circuit 3. It is arranged that the resonant frequency of the tune circuit 7 lies between those two frequencies which represent the two logic states, so that the voltage level at point 10 is the same whichever frequency is being transmitted. This condition can be achieved by adjusting the value of the capacitor 8, and it has the effect of preventing the transmitted frequency modulation being converted directly into an amplitude modulation which could interfere with or be confused with the amplitude modulation signals originating with the token. Prior to the transmission of the terminal data which is applied to port 1, the terminal senses the proximity of a token by monitoring the power drawn by the token from the tuned circuit 7. The way in which the token modifies the power demand is explained in greater detail with reference to Figure 3, but for the present purpose it is sufficient to note that the voltage at the point 10 decreases when a token is brought into close proximity with the inductive coil 9. During stand by periods. a low power oscillator 11 energises the tuned circuit 7 but being of low power. its output voltage at point 10 drops significantly when the power radiated from the inductor 9 is absorbed by the token. The voltage at point 10 is monitored by a voltage monitor 12, which in response to a dip in voltage level, energises the amplifier 6 so as to enable full power to be transmitted via the inductive loop 9. To guard against the possibility of the voltage monitor inadvertently being triggered in response to passing bodies which are not a co operating token, it is convenient to include a time reset within the voltage monitor 12 so that after a period of a second or two the power is returned to that of the stand by low power oscillator 11 in the event that a transaction is not commenced. Terminal data is therefore transmitted from the terminal to the card by means of frequency modulation of the carrier signal generated by the tuned circuit 3. By way of contrast, token data passing from the card to the terminal consists of amplitude modulation of the same carrier signal which is radiated by the inductive loop 9. Token data received in this way by the tuned circuit 7 is fed via a low pass filter 15 to an amplifier 16. The following amplifier 17 acts as a comparator to compare the amplitude variation from the amplifier 16 with an integrated average level at point 18. The resulting variation in output level is fed via a switch 14 to a token data output port 19. The switch 14 is implemented in the form of a comparator which is rendered inoperative when terminal data is present on input port 1. It is necessary to render the switch 14 inoperative whilst terminal data is being transmitted from the terminal to the card, since although the data is transmitted nominally in the form of a frequency modulation, nevertheless some degree of amplitude modulation may inadvertently occur and this may cause interference with, or corruption of, information being provided at the terminal 19. The organisation of the data processing capability on the token is illustrated in Figure 2 in which a central processor 20 communicates with a program memory 21 via a latch 22 and with a data memory 23. An address decoder 24 links the processor 20 with the memories 21 and 23. The organisation and operation of this processing arrangement may be fairly conventional. The processing system derives its power from the energy transmitted by the inductive coil 9 of the terminal illustrated in Figure 1, but to permit retention of volatile memory whilst a token is not within range of the terminal, a small back up electric battery cell 25 may be provided. As its sole function is to simply preserve memory, its power requirements are minimal, and a small cell will have a very long useful lifetime. Use of a non volatile memory, such as an electrically alterable read only memory EAROM , obviates the need for the cell 25. Data processed by those parts of the token which are to be described subsequently with reference to Figure 3 are present on lead 26 as input data, whereas processed output data is provided on lead 27. Because the processor 20 derives its operational power from its proximity with the terminal. it is necessary to ensure an orderly start up and shut down of the processing arrangement as power becomes available and as power is withdrawn from it. Thus when the proximity of the terminal is detected, a signal is provided over reset lead 28 to initialise the processor 20 and to permit an orderly commencement of processing activity and communication with the terminal. Conversely, when the supply of power ceases, possibly by the token being abruptly withdrawn from the terminal by a user, an interrupt signal is presented over lead 29 and this gives a short interval enabling the processor 20 to close down without inadvertent loss of data. An orderly shut down procedure need only take a millisecond or two during which power is available from a capacitive storage system, which is also illustrated diagrammatically in Figure 3. With reference to Figure 3, the token consists of a small piece of rectangular plastic card shaped after the manner of a currently available cash card or the like. It contains two inductive loops 30 and 31 connected in series. one of which is placed upon the upper surface of the card and the other of which is placed upon the lower surface of the card, the coils being rectangular and running around the perimeter of the card itself. The coils are preferably provided with a thin protective plastic coating. The size of the loops and the card which carries them are arranged to be somewhat smaller than the cooperating coupling inductive loop 9 of the terminal, so that it is merely necessary for the card to be placed on a receiving surface of the terminal with the coils 30 and 31 lying within an area bounded by the loop 9. In this way, the token receives the power which is radiated by the loop 9, and it is this absorption of power which is detected by the voltage monitor 12 of the terminal, thereby causing the terminal to transfer from low power stand by to full power operation. The energy received by the token shown in Figure 3 is accepted by a tuned circuit 32 consisting of a capacitor 33 in addition to the coils 30 and 31. The power so obtained is passed to a rectifier and voltage regulator 34 which is operative to generate a regulated voltage which is made available to other parts of the token shown in Figure 3 and also at port 35 for utilisation by the processor system illustrated in Figure 2. A large smoothing capacitor 36 is provided at the output of the voltage regulator 34 to give some degree of power storage. This energy is utilised during shutdown of the processor as indicated previously and permits a required regulated voltage level to be available at port 35 for a millisecond or so after reception of inductively coupled power ceases. As previously mentioned, token data is transferred from the token to the terminal by causing an amplitude modulation at point 10 of the level of the carrier frequency radiated by the terminal. This is achieved by applyng the token data for transmission to port 39 which operates a transistor switch 37 to bring a load 38 into and out of circuit in shunt with the coils 30 and 31, thereby modifying the impedance of the tuned circuit 32. In this example. load 38 is a capacitor, so as minimise resistive losses, and when it is switched into circuit as the switch 37 is made conductive it modifies the resonant frequency of the tuned circuit 32. Under both conditions, the tuned circuit 32 has fairly sharp resonance curves. These are shown in Figure 4, the curve 60 corresponding to the condition existing when the switch 37 is non conductive, and curve 61 applying when switch 37 is conductive. The carrier frequency received by the tuned circuit 32 from the terminal is indicated by point 62 on the frequency axis of Figure 4, and this is equivalent to the transmission of the carrier having no frequency modulation. It is arranged that this frequency lies between the peak resonant frequencies of the two curves 60 and 61, so that at this frequency the signal level 63 produced across the capacitor 33 is the same whether or not the capacitor 38 is switched into circuit. This avoids an unwanted additional amplitude variation being imposed on the signal level which is sensed by the regulator 34. However, as the level 63 corresponds to different phase values depending on whether the tuned circuit is operating on curve 60 or 61, the effect on the tuned circuit 7 at the terminal is different in the two cases, as a different resultant phase vector is produced at the tuned circuit. Thus the signal level fed to the low pass filter 15 will vary as an amplitude modulation representing the received token data, in response to the modulation imposed on the power which is drawn from the tuned circuit 7 by the tuned circuit 32 although the level of the power drawn will remain substantially constant whilst the signal level at point 10 varies due to the modulation of the phase. The signal received by the tuned circuit 32 from the terminal is also fed to a power detection circuit 40 which consists primarily of two threshold comparators 41 and 42, the first of which monitors the received input voltage at a point 48 of a potentiometer 43, 44. When the potential on point 48 exceeds a reference value, a reset signal on output port 39 is altered to initiate operation of the processor 20. Thus the port 39 of Figure 3 is connected to the lead 28 of Figure 2. Comparator 41 has hysteresis so that it does not respond to minor or momentary changes or interruptions in the power received by the tuned circuit 32, and so that the reset signal reverts to its original state at a much lower input voltage level than that at which it initiates operation of the processor. It reverts at a voltage value which is less than that at which an interrupt signal is generated on port 49. In effect, therefore, the comparator 41 has a hysteresis loop in the sense that the state of the signal at port 39 reverts to its original value at an input voltage level which is lower than that at which operation of the processor is initiated. The threshold comparator 42 monitors the potential 45 on potentiometer 46, 47 to detect withdrawal of the applied power. On detection of loss of voltage, the interrupt signal is generated at port 49 which is connected to lead 29, thereby causing an orderly shutdown of the processor whilst residual power is still available on capacitor 36 to permit this to be done. Thus the interrupt signal occurs at a voltage within the hysteresis loop of the comparator 41. The power received by tuned circuit 32 also of course, contains frequency modulation during those periods when terminal data is being transmitted from the terminal to the token, and this is fed to the signal detector 50. which consists of a phase lock loop 51, comprising a phase detector 52, a low pass filter 53 and a voltage controlled oscillator 54. The phase lock loop 51 is operative in known manner to extract the received token data. The level of the received token data is controlled by means of the adaptive threshold comparator 55 which consists of an integrator circuit 56 feeding into a comparator 57. The demodulated token data output is provided on port 58 which in effect is the same as lead 26 which is shown in Figure 2. It will be appreciated therefore. that the token is almost wholely autonomous, requiring no major power supply and being operative whenever it is placed in close proximity to an inductively radiating terminal having the correct frequency. This permits both the token and the terminal to be constructed in a very robust fashion having a very high degree of electronic integrity rendering it resistant to physical attack or fraud. These considerations may be of some significance if the token is used for transactions having appreciable values. The invention need not, however, be used for transactions having a monetary value, and the token can be used as a security pass or the like to enable the bearer to operate a door or automatic barrier to gain access to a restricted area. In this instance, the token can, if desired, record the nature of the area entered and the time of entry.