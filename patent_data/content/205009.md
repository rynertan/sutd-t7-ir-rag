# System for encoding a data stream into a run length limited symbol string.

## Abstract
A system for encoding consecutive parallel bytes of source data into an RLL 1,7 output symbol string and decoding an input RLL 1,7 symbol string to produce an output sequence of parallel bytes of data. The system accepts an input sequence of parallel data bytes occurring at a byte rate and provides, in response, the output RLL symbol string at a symbol string rate which is twelve times the byte rate. Similarly, the output byte sequence has a byte rate which is 1 12 of the input RLL symbol string rate. The system performs RLL encoding and decoding at the byte rate, thus eliminating the odd 2 3 f

## Claims
1. A system for encoding an input byte wide data stream into an output run length limited RLL symbol string or for decoding an output byte wide data stream from an input RLL symbol string, characterized by RLL encoder means 16, 30 34 responsive to consecutive, unencoded parallel bytes occurring at a byte rate in an input byte wide data stream for producing a first RLL 1,7 symbol sequence including consecutive groups of parallel RLL symbols, the RLL 1,7 run length code being defined as a bit string in which each one in the bit sequence is separated from the nearest adjacent one by at least one, but no more than seven zeros, format means 36,38 connected to said RLL encoder means for receiving said first RLL symbol sequence at said byte rate and for converting said first RLL 1,7 symbol sequence into an output RLL symbol string having a symbol string rate which is a whole multiple of said byte rate, and responsive to an input RLL symbol string having said symbol string rate for providing, at said byte rate, a second RLL 1,7 symbol sequence including consecutive groups of parallel RLL symbols and RLL decoder means 20 responsive to the second RLL 1,7 symbol sequence for providing an output byte wide data stream including consecutive, decoded parallel bytes of data occurring at the byte rate.

## Description
This invention relates to a system for encoding an input byte wide data stream into an output run lenth limited RLL symbol string or for decoding an output byte wide data stream from an input RLL symbol string. As is known, conventional computer systems utilize magnetic disks for data storage. In order to maximize the amount of data stored on a disk, many such systems normally employ some form of run length limited RLL coding to encode data prior to entry onto a disk, which provides particularly dense packing of disk stored data. In the family of RLL codes, the 1,7 format is gaining increasing acceptance in the industry as the preferred RLL coding format for present magnetic disk technology. In emplying the RLL 1,7 coding format, a sequence of unencoded binary data is converted into an encoded bit string in which each one in a coded bit sequence must be separated from the nearest adjacent one by at least one, but no more than seven zeros. In this format, the most efficient coding rate results when every two unencoded data bits are converted into three coded bits. Conversely, in the decoding process, three coded data bits are converted into two decoded data bits. This technique is taught in detail in U.S. Patent No. 4,413,251 to R. L. Adler et al, which is assigned to the assignee of this patent application. A typical prior art architecture employing RLL 1,7 coding in a magnetic disk storage system is illustrated in Figure 1. As is typical, unencoded data from a data processing system is provided to the encoder section of an encoder decoder ENC DEC through a serializer deserializer S D . When provided to the serializer deserializer, the data is normally in parallel byte form, which must be serialized into a sequence of 2 bit groups. Each 2 bit group provided to the encoder results in the provision of three encoded bits that go to a buffer B for serialization into an encoded, bit wide data string that is processed by drive circuitry for writing onto a magnetic disk. In the industry, this is referred to as bit by bit encoding. When data is read from the disk, a bit wide encoded data string is provided through the buffer B in the form of successive groups of three encoded bits to the decoder section of the encoder decoder. Each successive group of three encoded bits is decoded to a group of two data bits bit by bit decoding . The succession of bit pairs from the decoder are converted by the serializer deserializer into a succession of bytes that are forwarded to the data processing system. An artifact of the bit by bit coding system of Figure 1 is the requirement for at least two conversion clocks an f The f The 2 3 f Moreover, the Figure 1 architecture requires an extra format conversion for unencoded and decoded data passing between the serializer deserializer and encoder decoder, further adding complexity to the system. Further, the typical prior art RLL 1,7 encoder consists of a finite state machine whose internal state is described by three state bits. Plural state bits increase the logic and storage hardware requirements of the encoder, which make it awkward for being cascaded in parallel to provide byte wide encoding. The present invention is defined in the attached claims. The technical problem that is solved by the system of the invention is the elimination of the need for an odd 2 3 f In particular, the system is one for encoding an input byte wide data sequence into an output run length limited RLL symbol string and for decoding an output byte wide data sequence from an input RLL symbol string. The system includes an RLL encoder that responds to consecutive parallel unencoded bytes occurring at a byte rate in an input byte wide data sequence by producing an output RLL symbol sequence including consecutive groups of parallel RLL symbols. A format converter is connected to the RLL encoder for converting the output RLL symbol sequence into an output RLL encoded symbol string having a symbol string rate which is a whole multiple of the byte rate. The format converter further responds to an input RLL symbol string having an input symbol string rate, by providing an input RLL symbol sequence including consecutive groups of parallel RLL symbols. An RLL decoder responds to the input RLL symbol sequence onstructed by the format converter by producing, at the byte rate, an output byte wide data sequence including consecutive parallel bytes of decoded data. The primary objective of the system is to provide a bi directional code conversion interface between a channel conducting a sequence of consecutive parallel bytes of data at a byte rate and a data channel conducting strings of RLL 1,7 symbols at a symbol string rate. An advantage of the present invention is the elimination of the need for an odd clock signal having 2 3 the frequency of the symbol channel. Other objectives and advantages of the present invention will become more apparent when the following detailed description is read in light of the below described drawings. In the description which follows, a byte of data is taken, as in the usual sense, to denote a sequence of eight adjacent binary digits bits that are operated upon as a unit. A parallel byte refers to the eight bits transferred simultaneously on a data channel including 8 parallel transmission paths. A string refers to a linear sequence of bits. A coded symbol consists of a group of three consecutive bits resulting from an encoding operation performed on two bits of unencoded data. A symbol string is a string of encoded bits in which successive groups of three bits form successive symbols. In the magnetic disk storage art, weight is assigned a bit in a data string according to its place in the string. The first bit is accorded the most significance MSB and is assigned the lowest numerical subscript, e.g., x₀. Bits occurring after the MSB have correspondingly less significance, but subscripts of higher magnitude. Thus, in a serial byte, bit x₀ the first bit is the MSB while bit x₇ the last bit is the LSB. In the following description, this significance convention is observed for unencoded bits x , encoded bits y , and symbols Y . As illustrated in Figure 2, the system of the invention, enclosed in the dashed outline indicated by reference numeral 10, accepts an input byte sequence constituting a succession of parallel bytes on a data channel that is eight bits wide. Each byte consists of eight simultaneously transferred bits. The byte sequence is fed to the system 10 for being encoded into an output consisting of a string of RLL 1,7 encoded symbols. An input byte sequence can be provided from a conventional data processing system not shown for being entered written onto a magnetic disk also not shown for storage and later retrieval. The input byte sequence is converted by the system of the invention to an output symbol string, in which form it is stored on the disk. When data stored on the magnetic disk is to be retrieved read , an input symbol string is obtained from the disk and provided to the system 10 for conversion into a decoded output byte sequence that is forwarded to the data processing system. As is conventional, the system 10 operates in conjunction with conventional disk control logic 12 that provides a read write R W gate signal for defining the mode of operation for the system 10. In one state, the R W signal denotes a disk read operation, and in another state, a disk write operation. The control logic includes a VFO not shown to generate a symbol channel clock f The system 10 is a byte wide encoder and decoder for RLL 1,7 code and includes an RLL encoder 16 that accepts consecutive bytes of an input byte sequence at a byte rate f The write symbol group sequence is provided to a serializer deserializer circuit 18 that, during a write mode of operation, performs parallel to serial format conversion to convert the 12 bit wide write symbol group sequence into a bit wide output symbol string having a string rate f The serializer deserializer circuit 18, during a read mode of operation, receives a bit wide input symbol string at the string rate f In the operation, explained below, of the system 10 in converting between symbol strings and parallel byte sequences, only 2 clock signals, f Referring now to Figures 3 and 4, the system 10 preferably operates in a conventional magnetic disk storage unit for encoding a parallel byte sequence of data to be written to a magnetic disk. The parallel byte stream is provided as write data from a data processing system not shown and is delivered unencoded to the system 10. The write data is converted by the system of the invention to an RLL 1,7 encoded bit string comprising symbol channel write data which is submitted to disk drive electronics not shown for being entered on a magnetic disk also not shown . This mode of operation is referred to hereinbelow as the WRITE mode and is signified by a WRITE state of the R W signal produced by the control logic 12. In a READ mode of operation signified by a READ state of the R W signal , an RLL 1,7 encoded bit string comprising symbol channel read data obtained from the disk drive electronics for delivery to the data processing system is delivered to the system 10 for conversion to a decoded parallel byte sequence which is transferred by conventional means to the data processing system. In the WRITE mode of operation, the byte wide encoder and decoder system for RLL 1,7 code pictured in Figure 3, a sequence of parallel bytes that are to be encoded for being written onto a magnetic disk are staged, byte by byte into the system through a first input latch 30, which is enabled by the WRITE state of the R W signal. Once entered into the latch 30, a byte of unencoded data is available from the output of the latch 30 to a second latch 32 and to the RLL 1,7 byte wide encoder 16. The encoder 16 is capable of accepting a byte byte N of unencoded data comprising eight parallel bits, x₀ x₇ x₀ MSB , together with the least significant two bits, x ₆ and x ₇, of the preceding byte byte N 1 and encoding byte N according to a known RLL 1,7 conversion algorithm having a coding rate of 2 3. As a result of the 2 3 coding rate, encoding byte N results in the production by the encoder of a write symbol group WSG N of twelve encoded bits, Y₀ Y₁₁ Y₀ MSB . In keeping with convention, each group of twelve encoded bits comprises 4 symbols, Y₀ Y₃ where Y₀ is the most significant symbol , with each symbol defined by a respective set of three encoded bits. Thus, for example, symbol Y₁ is defined by encoded bits Y₃ Y₅. The sequence of parallel bytes staged into the encoder 16 from the input latch 30 results in the provision by the encoder of a corresponding sequence of write symbol groups termed a write symbol group sequence WSGS that is fed simultaneously to a pair of conventional serializer deserializers S D 36 and 38 that constitute the S D circuit 18. Each of the S D s 36 and 38 has a P During a write operation, after entry of one write symbol group, say WSG N , into a respective S D through its P As explained below, before WSG N is shifted serially through multiplexer 40, the decoder 20 receives the six encoded symbol bits of WSG N and uses them, together with the least significant ten bits of WSG N 1 stored in the latch 48, to decode the byte byte N 1 from which WSG N 1 was encoded. The decoded byte N 1 is provided by the decoder 20 to a conventional digital comparator 52 where it is compared with the unencoded form of byte N 1 stored in the latch 32. The output of the comparator 52 comprises a WRITE CHECK signal which, in one state, indicates correspondence between the decoded byte available from the decoder 20 and the stored byte available from the latch 32. The other state of the WRITE CHECK signal indicates noncorrespondence and can be used to institute standard error correcting procedures in other components of the disk interface with which the system of the invention is used. When data is to be obtained in encoded form from the magnetic disk and returned decoded to the data processing system, the control logic 12 changes the R W signal to its READ state and the disk drive circuitry provides symbol channel read data obtained from the magnetic disk in the form of an input encoded symbol string. The input symbol string is fed through a shift register 54 to the S The sequence of operations undertaken by the system 10 during write and read related operations can be understood now with reference to Figures 3 5. In Figure 4, which shows the timing of the write and read operational sequences, the symbol string clock is labelled f In Figure 4 all of the operative signals provided to the system 10 are produced conventionally by the control logic 12. Disk controllers having the ability to provide signals corresponding to those illustrated in Figure 4 are well known in the art, the disk controller in the IBM disk storage system having the product number 3380 being one example. The write mode begins with the provision of the WRITE state of the R W signal to the system 10. The WRITE state of the R W signal enables the operations of the latches 30 and 32, the multiplexer 40, the pre compensation circuit 42, and the comparator 52. The signal is provided in inverted form to the shift register 54 and the output register 56 to prevent their operating during write mode operation. During write operations, the R W signal gates f The positive state of the MUX 2 signal couples the parallel output of the S D 36 to the output of the multiplexer 44 where, as explained above, the most significant six bits of write symbol group N are made available to the decoder 20. The decoder then decodes WSG N 1 . At the negative level of f During the just described encoding cycle for byte N , twelve shift pulses of the gated clock signal CLK 2 will be provided by the controller 12 to S D 38 to enable it to serially shift write symbol group N 1 to the multiplexer 40. The negative state of the MUX 1 signal passes the serialized write symbol group N 1 to the precompensation circuit 42. Next, when byte N 1 is available to be written to the magnetic disk, the just described encoding cycle is performed again, with the exception that the roles of the S D s 36 and 38 are reversed. That is, byte N 1 is entered of f While write symbol group N is being serially shifted from the S D 36, the negative state of the MUX 2 signal causes symbol group N 1 to be provided through the multiplexer 44 and used in the decoding of symbol group N . This permits a decoded version of byte N to be compared with the unencoded version stored in the latch 32. Reference to Figure 5 will provide an understanding of the operation of the serializer deserializers 36 and 38. Figure 5 illustrates the S D 36 and includes an array of AND gates 60 It should be evident that the S D 38 can be implemented in exactly the fashion illustrated for the S D 36 in Figure 5 simply by exchanging the MUX 2 and signals, with the positive state of the MUX 2 signal provided to enable the gates 60 Read mode operations comprise a sequence of decoding cycles, each defined by one succession of the four phase byte clocks B1 B4. The READ state of the R W signal disables latches 30 and 32, multiplexer 40, and comparator 52 it enables the registers 54 and 56. The WRITE state of the R W signal gates f In a read mode operation, the control logic 12 will have been alerted by the provision of a read request or command from the data processor to search for a standard pattern of encoded bits comprising a preamble in the data field to be read. As is conventional, when the addressed storage segment is initially read from the magnetic disk, the read data is shifted serially into the shift register 54 from the disk drive electronics. The contents of the shift register 54 are continuously read in parallel by the control logic 12 so that when the preamble denoting the beginning of the addressed storage sector is recognized, the control logic 12 can synchronize the provision of the gated clocks CLK 1 and CLK 2 to the S D s 36 and 38. Thus, the first pulse of the twelve shift pulses of one of the gated clocks will be made available to one of the S D s 36 or 38 in phase with the availability, at the serial output of the shift register 54, of the first encoded bit of the input bit string. When the preamble is detected, the S D s are driven out of phase to capture alternate groups of twelve serial bits from the input symbol string. While one S D is receiving twelve encoded bits, the other is loading the previous twelve bits in parallel as an input symbol group ISG through the multiplexer 44 to the decoder 20. Thus, in Figure 5, when MUX 2 is negative and CLK 1 is gated on, symbol bits are shifted serially from the register 54 into the devices 60 Assuming now that input symbol group N has been entered into the S D 36, a byte decode cycle will commence just after the rising edge of the first pulse of gated clock CLK 2 . The twelve shift pulses of the gated clock and the positive state of the MUX 2 signal will shift the twelve encoded bits of input symbol group N 1 into S D 38. During the first byte clock phase B1 of the decoding cycle, the positive state of the MUX 2 signal permits input symbol group N to be available on the output of the multiplexer 44. This provides 6 most significant bits of symbol group N to be available to the decoder, thereby enabling the decoding of symbol group N 1 . During the first phase of the byte clock, the READ state of the R W signal gates f The use of the R W signal to gate byte clocks to the registers 46 and 48 can be understood by reference to Figure 9. In Figure 9, one state of R W permits f With reference now to Figures 6 and 7,the structures and operations of the RLL byte wide decoder 20 and the RLL byte wide encoder 16 can be understood. In the discussion which follows, U.S. Patent No. 4,413,251 to Adler et al and assigned to the assignee of this patent application, is incorporated herein by reference for the purpose of establishing the mathematical basis for the coding conversion operations of the decoder and the encoder. The tabular expression of an RLL 1,7 coding algorithm that encodes bit by bit at a 2 3 rate is found in Table IV of the incorporated patent. As taught in the incorporated patent, the hardware implementation for an RLL 1,7 decoder that obtains bits x The NOR expressions 1 and 2 are implemented by the decoder NOR gate sections 60 and 62, respectively, in Figure 6. It should be evident that the pair of NOR sections 60 and 62 can be replicated four times to provide simultaneous decoding of a byte eight decoded bits from sixteen encoded bits spanning 6 adjacent symbols, Y₀ Y₁, thus providing a look ahead to the two future channel symbols Y ₀ and Y ₁. In Figure 6 the sixteen encoded bits are provided from the ten least significant bits of symbol group N stored in the latch 48 and the six most significant bits of symbol group N 1 that are available to the decoder from the output of the multiplexer 44. The byte wide encoder might also be implemented by replicating the encoder taught in the incorporated Adler et al. patent four times to produce twelve encoded bits 4 symbols at a time. However, as is known, the encoder in the incorporated patent relies upon the generation and storage of an intermediate 3 bit state for producing each coded symbol. Replication of circuitry for generating and storing the intermediate 3 bit states would result in a complicated and relatively slow operating encoder. The encoder of Figure 7 avoids concatenation of 3 bit state circuitry by enlarging the dependence of each encoded bit from two to four bits of unencoded data. This permits the realization of an RLL 1,7 encoder that provides simultaneous encoding of a parallel byte of data in which each resulting symbol is dependent upon only one state bit in addition to four unencoded bits for each encoding operation. To understand the operation of the encoders of Figures 7 , consider any current symbol Y that comprises three encoded symbol bits Y₀, Y₁, Y₂ and that is encoded according to the algorithm of the Adler et al. patent from unencoded bits x₀ and x₁ contained in the bit string fragment ...x₀ x₁ x₂ x₃.... According to the encoding algorithm of the Adler et al. patent the current symbol Y has the functional dependence given in equation 3 Y f z₁, z₂, z₃, x₀, x₁ 3 where z₁, z₂, and z₃ are current state bits resulting from the encoding of the symbol immediately preceding Y, and x₀ and x₁ are the two unencoded bits to be used in encoding Y. For the prior art encoder, the Boolean expressions defining the coded bits forming the symbol Y are given by equations 4 6 below. As is known, while the symbol Y is being encoded, the state variables z ₁, z ₂, and z ₃ for the next symbol to be encoded Y are, in the prior art encoder, determined by equations 7 9 . z ₁ x₀ z₃ 7 z ₂ x₀ 8 Finally, expressions for the next symbol Y Y ₂, Y ₁, Y ₀ following Y may be obtained from equations 4 6 by substituting equations 7 9 for z₁, z₂, and z₃, respectively, and by substituting the two unencoded bits x₂ and x₃ for the bits x₀ and x₁. The next symbol expressions are given by the reduced Boolean equations 10 12 . It is noted that, in the next state expressions 7 9 and in the next symbol equations 10 and 12 , a z₃ variable always appears with x₀ in the form . It has been defined a new state variable w that is given by equation 13 . This permits the further reduction of equations 10 12 to the equations 14 16 given below. Y ₀ w x₀ 14 The set of equations 14 17 define an encoding operation that produces an RLL 1,7 symbol Y based upon four unconstrained, unencoded bits x₃ x₀ and a single state variable w. In Figure 7, the portion of the encoder 16 that is enclosed by the dotted line indicated by the reference numeral 70 implements, in a modular logic circuit, the encoding equations 14 16 . A conventional 1 bit data storage device 72 provides the current state variable w to the modular circuit 70. As shown in Figure 7, the unencoded bits x ₀ x ₇ constitute a byte N 1 stored in latch 32. The unencoded bits x₀ x₇ constitute the byte N following the byte N 1 and are stored in latch 30. The bits x₀ x₂ are provided both to the encoder 16 and to the input of the latch 32. As required by equations 14 16 , the adjacent bits x ₆x ₇x₀x₁ are provided, together with w, to the modular circuit 70, which performs the encoding operation resulting in encoded bits Y₀, Y₁, and Y₂ that form the most significant symbol Y₀ of the write symbol group WSG N . To encode the less significant symbols Y₁ Y₃ of WSG N , state variables w , w , and w are produced by NAND gates 74 78, each of which implements the state variable equation 17 . Each of the state variables produced by the NAND gates 74 78 are combined in a respective modular circuit equivalent to the modular circuit 70 with the proper bits in byte N to produce the remaining symbols, Y₁, Y₂, and Y₃ of WSG N . A next state variable w is produced by the NAND gate 80 and provided as an input to the storage device 72 into which it is entered during a write mode encoding cycle by the occurrence of f It is to be understood that the particular embodiment of the invention herein described and shown in the drawings is merely illustrative and not restrictive of the fundamental invention. For example, the byte wide operation of the system of the invention can be changed to operate on larger or smaller data groups. Thus, the encoder, decoder, and S D s can be expanded to accommodate word wide data groups.