# MULTI PHASE SYNCHRONIZING CIRCUIT

## Claims
Mehrphasiger phasenstarrer Oszillator für den Empfang eines Zeitmultiplexsignals, das eine Vielzahl phasenverschobener Kanäle aufweist, mit einem Feststellmittel 11, 12 zum Feststellen eines Empfangsrahmens, einem Regenerierungsmittel 14 zum Erzeugen eines Taktes aus dem festgestellten Empfangsrahmen und einem Ausgabemittel 15 zum Ausgeben des erzeugten Taktes, der durch das Regenerierungsmittel gewonnen wurde, dadurch gekennzeichnet, daß das Feststellmittel geeignet ist, ein erstes Bit des Empfangsrahmens festzustellen, der die Vielzahl von Kanälen enthält, wobei das erste Bit durch Feststellen eines Verletzungszeichens eines empfangenen Signals, das eine Abtasttaktpulsfrequenz benutzt, die höher als eine Taktpulsfrequenz eines Kanals des empfangenen Signals ist, festgestellt wird, daß das Feststellmittel ferner ein Torauftastsignalerzeugungsmittel 12 zum Erzeugen von Torauftastsignalen für jeden der Kanäle aufweist, wobei die Torauftastsignale individuell auf der zeitlichen Steuerung durch das erste Bit des Feststellmittels basieren, so daß eine Torschaltung 13 , die durch jedes Torauftastsignal gesteuert wird, ein Kanalsignal durchläßt, daß das Regenerierungsmittel geeignet ist, einen Takt, der einem der Vielzahl von Kanälen zugeordnet ist, aus einem abgetrennten Kanalsignal zu erzeugen, das durch das zugehörige der Torauftastsignale des Torauftastsignalerzeugungsmittels 12 gewonnen wurde, und daß der regenerierte Takt, der durch das Ausgabemittel 15 ausgegeben wird, mit dem Empfangsrahmen der Vielzahl von Kanälen synchronisiert ist.

## Description
The present invention relates to a polyphase phase locked oscillator in which a plurality of signal channels with some phase difference are transmitted with time division multiplex system, and a reception side receives the particular channel signal with phase synchronization. When a sampling clock is to be derived in a time division multiplex transmission line in which a plurality of channel signals are multiplexed with some phase difference, the clock signal with the phase locked with the signal channel having high mark ratio is obtained. Accordingly, it has the disadvantage that the margin for recognition in other signal channels is decreased. The present invention provides a sampling clock signal locked with each signal channels so that the recognition margin is increased. A new kind of transmission system in which a plurality of signal channels are multiplexed with some phase difference is considered as a subscriber transmission system in an Integrated Service Digital Network ISDN . In the ISDN transmission system, a bus line system between a digital service unit as a master station and a terminal apparatus as a slave station is considered promising in the number of necessary lines, the simple process for expanding, and less quantity of necessary hardware. Fig.1 shows a subscriber coupling system with a bus line schematically. In the figure, the numeral 1 is a digital service unit DSU , 2 1 through 2 N are n number of terminal apparatuses, 3 is a T line transmission line , 4 is an R line reception line , 5 is a termination circuit. As shown, a plurality of terminal apparatuses are coupled with one another in a bus line. The T line and the R line show bus lines, and the R line is directed from the DSU to each terminal apparatuses, and the T line is directed from each terminal apparatuses to the DSU. In a bus system for subscriber system, a simple bus system as shown in Fig.2A length between DSU and DT₁ is 0, and the length between DT₁ and DT The phase lock operation between a transmission side and a reception side in Figs.2A through 2C has been carried out as described below. The DSU transmits a data to an R line like a broadcasting manner, and each subscriber apparatus derives clock component in reception data train for phase lock purposes. However, the reception phase at the DSU through the T line is not uniform, because the length between the DSU and each terminal apparatus differs for each terminal apparatus. Of course, it is preferable that a common DSU is used for the systems of Figs.2A through 2C. Accordingly, a 100 AMI code is used as a transmission code, and each terminal apparatus transmits not only an information data but also a frame bit which indicates the beginning of a frame, so that the DSU may derive a sampling clock by a conventional phase lock circuit. Fig.3 shows the configuration of a prior digital phase lock circuit. In the figure, the numeral 6 is a binary level quantized phase comparator, 7 is a sequential loop filter, 8 is a fixed oscillator, 9 is a circuit for pulse add and or pulse delete, and 10 is a frequency divider. In Fig.3, the phase comparator 6 compares the phase of an input signal with the output signal phase for every input bit, and provides output as 1 or 1, which is applied to the sequential loop filter 7 for improving the control reliability to control the circuit 9. The sequential loop filter 7 is usually composed of an up down counter which is incremented by 1 input signal and is decremented by 1 input signal. The up down counter provides an output signal when the content of the up down counter reaches the predetermined value N or 0 zero . The circuit 9 inserts a pulse to the output signal of the fixed oscillator 8, or removes a pulse from said output signal, according to the output of said up down counter. The output of the circuit 9 is applied to the divider 10 which divides the pulses to provide a phased locked output signal. Fig.4 shows a prior phase lock system in a DSU unit having a prior phase lock circuit of Fig.3. In the figure, Fig.4A shows the configuration of the coupling, and the same reference numerals as those of Fig.1 shows the same member, DT₀ is the closest terminal apparatus to the DSU, DT It is assumed that the length between DSU and DT₀ is 0, and the length between DSU and DT Considering that the retiming margin is larger than 1 4 time slot 0.25 T₀ for the deterioration of waveforms in a transmission line, the following equation must be satisfied so that said margin is provided to the data phase 8 As shown in equation 2 , the length to a subscriber is severely limited in the prior art. That limitation is a serious disadvantage when an ISDN system is applied to a wide area of offices. JP A 5698962 discloses a carrier signal regenerator in a multiple access time divisional system. Each burst signal is received at a fixed time. Two voltage controlled oscillators are provided and a number of memories for storing phase differences, one for each burst signal. Further, the prior art has the disadvantage that the margin of a sampling clock is small for the data phase 8 In accordance with the present invention, a polyphase phase lock oscillator for reception of a time division multiplex signal which has a plurality of channels with phase difference, the oscillator comprises detecting means for detecting a reception frame regeneration means for generating a clock from the detected reception frame and output means for output of the regenerated clock obtained by the regeneration means and is characterised in that the detecting means detects a first bit of the reception frame which includes the plurality of channels, the first bit being detected by detecting a violation pattern of a received signal using a sampling clock pulse which is higher than a clock pulse of a channel of the received signal in that the detecting means further comprises gate signal means for providing gate signals for each one of the channels, the gate signals being individually based upon timing of the first bit from the detecting means so that a gate circuit, controlled by each gate signal, passes a channel signal in that the regeneration means generates a clock of a related one of the plurality of channels from a separated channel signal which is obtained by a related one of the gate signals from the gate signal means and in that the regenerated clock output by the output means is synchronised with the reception frame with the plurality of channels. The invention enables a data transmission system to be provided having a master station and a plurality of slave stations coupled with the master station through a bus system, the master station has means for separating signal channels transmitted from each slave station, means for generating a sub clock signal for each separated channel, and means for providing a sampling clock which is the sum of the sub clock signals. Details are described below in accordance with the drawings. Fig.6 shows the brief block diagram of the present invention. The apparatus of Fig.6 handles a signal format as shown in Fig.5. In Fig.6, the numeral 11 is a violation detector for detecting a violation for frame synchronization, 12 is a gate signal generator, 13 is a reception channel separator, 14 1 through 14 3 are phase lock loops, and 15 is a clock combiner. Fig.7 shows the operational timing sequence of the apparatus of Fig.6, and in Fig.7, 1 is a frame synchronization signal provided by the violation detector 11, 2 , 3 and 4 are gate signals for B₁ channel, B₂ channel, and D channel, respectively, 5 , 6 and 7 are sampling clocks for B₁ channel, B₂ channel, and D channel, respectively. The same numerals as those of Fig.6 are used in Fig.7 for showing the signals indicated by said numerals. It is assumed that the present system is used in one room for a dwelling house, or a business office, and has the channel configuration 2B D, B 64 kbps, D 16 kbps . It is also assumed that the length between terminal apparatuses is in the range between 100 m and 150 m. However, it is preferable that the system is applicable when the length between terminal apparatuses is 200 250 m, considering a worse noise environment. The signal phase shown in Fig.7 shows the signal phase at the DSU when the closest DT₀ uses the B₁ channel, the closest DT Fig.8 shows a block diagram of the practical embodiment according to the present polyphase phase lock oscillator. The apparatus of Fig.8 handles the signal with the frame format of Fig.5. In Fig.8, the numeral 11 is a violation detector, 14 1 through 14 3 are phase lock loop circuits, 16 is a counter, 17 is a ROM read only memory , 18 1 through 18 3, and 19 1 through 19 3 are AND circuits, 20 1 through 20 3, and 21 1 through 21 3 are signal rise detectors, 22 1 through 22 3 are RS flip flops, 23 1 through 23 3 are AND circuits, 24 is an OR circuit with three inputs, and 25 is a fixed oscillator. Fig.9 shows the operational timing sequence of the apparatus of Fig.8, and in Fig.9, the numeral 1 is the frame synchronization signal provided by the violation detector 11, 2 is the gate signal for the B₁ channel, 3 is the gate signal for the B₂ channel, 4 is the gate signal for the D channel, 5 is the sampling clock for the B₁ channel, 6 is the sampling clock for the B₂ channel, 7 is the sampling clock for the D channel, 8 , 9 and 10 are gate signals for combining the clocks for B₁ channel, B₂ channel, and D channel, respectively, 11 , 12 and 13 are regenerated clocks for B₁ channel, B₂ channel, and D channel, respectively, and 14 is the combined sampling clock signal which is the sum of the signals 11 , 12 and 13 . A numeral in Fig.9 shows the waveform at the location indicated by the same numeral in Fig.8. The signal phase in Fig.9 is the phase at the reception side at the DSU when the B₁ channel relates to the closest DT₀, the B₂ channel relates to the closest DT The outputs 0₀, 0₁ and 0₂ of the ROM 17 in Fig.8 depend upon the address signal to the ROM, and are shown below. Fig.10 shows the frame configuration which is used in the second embodiment of the present invention, and B₁ and B₂ are channels with 64 kbps, D is the channel with 16 kbps, and F is the frame bit which indicates the beginning of a frame. The feature of Fig.10 as compared with that of Fig.5 is that Fig.10 has no guard bit G nor spare bit S. It is assumed in the present embodiment that each frame has 20 bits in 125 micro seconds, and the transmission speed is 160 kbps. Fig.11 is a block diagram of another embodiment of the present polyphase phase lock oscillator. The same numerals as those in Fig.8 show the same members as those in Fig.8, and the operation of those members is the same as those of Fig.8. Further, the numeral 26 1 through 26 3 in Fig.11 is delay circuits, 27 1 through 27 3 are fall time detectors, 28 1 through 28 3 are counters, 29 is a NOR circuit 30 is a delay circuit, 31 is a monostable multivibrator, 32 1 through 32 3 are OR circuits. Fig.12 shows the operational timing sequence of the apparatus of Fig.11. The embodiment of Figs.11 and 12 has the assumption of Fig.4 as is the case of the previous embodiment. In Fig.12, the signals 1 through 10 are the same as those of the same numerals in Fig.9. The signal 15 in Fig.12 is the last bit detection signal in each channel, 16 is the delayed signal delayed by 1 4 phase from the signal 15 , 17 is the sampling clock for the last bit, 18 is the combined sampling clock. The signals in Fig.12 relate to the same numerals in Fig.11. The process for obtaining the signals 1 through 7 is the same as that of Fig.9. The differential circuit 20 1 detects the rise time of the gated clock in the B₁ channel phase, and the output of said differential circuit 20 1 is applied to the flip flop 22 1 to set the same through the delay circuit 26 1 which delays an input signal by 1 4 phase. The reset signal of the flip flop 22 1 is obtained similarly to the case of Fig.9. Accordingly, the rise time of the gate signal 8 is delayed by 1 4 phase as compared with that of Fig.9, and then, the rise time of the first bit of the clock which is obtained through the AND circuit 23 1 is also delayed by 1 4 phase. Similarly, the gate signal 9 for the sampling of the B₂ channel, and the gate signal 10 for the sampling of the D channel are delayed by 1 4 phase as compared with those of Fig.9. Those gate signals 9 and 10 are applied to the AND circuits 23 2 and 23 3, respectively. Therefore, the first bit of the clock pulse obtained at the outputs of the AND circuits 23 1, 23 2 and 23 3 is delayed by 1 4 phase as compared with that of Fig.9. On the other hand, another differential circuit 27 1 detects the fall point of the sampling clock for the B₁ channel obtained at the output of the AND circuit 23 1, and the output of the differential circuit 27 1 is applied to the counter 28 1, which applies an output signal to the NOR circuit 29 when the counter 28 1 counts the input signal by 7 number of bits in B₁ channel 1 . Similarly, the counters 28 2 and 28 3 apply the last bit phase detection signals of the B₂ channel, and the D channel, respectively, to the NOR circuit 29. The NOR circuit 29 provides the output signal 15 , which is delayed by 1 4 phase in the delay circuit 30 which provides the delayed signal 16 . The signal 16 is applied to the monostable multivibrator 31 as a trigger signal. The duration of the output signal of the monostable multivibrator 31 is adjusted to be 1 2 time slot beforehand. The output of the monostable multivibrator 31 is the sampling clock for the last bit for each channel B₁, B₂ and D . Said output signal for the sampling of the last bit from the monostable multivibrator 31 is applied to the OR circuits 32 1, 32 2 and 32 3, which also receive the sampling clocks for each channel B₁, B₂ and D . The outputs of the OR circuits 32 1, 32 2 and 32 3 are applied to the OR circuit 24 which combines those clock signals to provide the combined clock signal 18 . The output clock signal 18 is synchronized with all the reception channels B₁, B₂ and D . As described above, the output clock 18 has the feature as compared with the embodiment of Fig.8, that the first bit for each channel is delayed by 1 4 time slot, and the last bit for each channel is lead by 1 4 slot time so that the last bit of a former channel does not overlap with a first bit of a following channel even when no guard bit is provided as is the case of Fig.10. It should be appreciated that the amount of the lead and or the lag of the last bit and or the first bit is adjusted according to distortion of reception signal, although the embodiment assumed the amount of 1 4 time slot. Fig.13 is a block diagram of still another embodiment of the polyphase phase lock oscillator according to the present invention. Fig.13 uses the frame format of Fig.5. In Fig.13, the numeral 11 is a frame bit detector, 12 is a PLL reset signal generator, 13 is a four inputs OR circuit, 14 is an instantaneous follow type PLL phase lock loop circuit, 15 1, 15 2 and 17 are two inputs OR circuits, 16 1 and 16 2 are clock output circuits, and 18 is a fixed oscillator. Fig.14 shows the operational timing sequence of the apparatus of Fig.13. In Fig.14, the signal 1 is an input signal to the present polyphase phase lock oscillator, the signal 2 is a frame bit detection signal provided by the frame bit detector 11, the signals 3 , 4 , 5 and 6 are reset signals just before the PLL 14 receives the signals of the frame bit, the D channel, the B₁ channel, and the B₂ channel, respectively. The signal 7 is a clock pulse which is provided by the PLL 14, 8 is a sampling clock for a frame bit and D channel, 9 is a sampling clock for B₁ channel and B₂ channel, 10 is an output clock which is the combination of 8 and 9 . The numerals in Fig.14 correspond to the same numerals in Fig.13. The channel structure 2B D, B 64 kbps, D 16 kbps of the present embodiment is suitable for the application to a dwelling house and or one office room, in which the requested maximum length between terminal apparatuses is 100 150 m. Therefore, it is preferable that the system is applicable up to 200 250 m, considering the deterioration of noise environment. The signal phase shown in Fig.14 shows the case that the system configuration as shown in Fig.4 is used, each phase is the one at the reception end at DSU, the closest terminal apparatus DT₀ is allocated to B₁ channel, the closest DT Fig.15 is a block diagram of the fourth embodiment of the polyphase phase lock oscillator according to the present invention. The frame structure utilized in the present embodiment is the same as that shown in Fig.10. In Fig.15, the same numerals as those in Fig.13 show the same members as those in Fig.13. The numerals 19 1 and 19 2 in Fig.15 are clock phase shifters. Fig.16 shows the operational timing sequence of the apparatus of Fig.15, which is used in the system of Fig.4A. The same numerals in Fig.16 as those in Fig.14 have the same meaning as those in Fig.14. In Fig.16, the signal 8 is obtained by deriving a frame clock and a D channel clock in the clock 7 , and delays the clock phase of the first bit of each channel and leads the clock phase of the last bit of each channel. The signal 9 is obtained by deriving a clock for B₁ channel and B₂ channel from the clock signal 7 , and processing the derived signal for the first bit and the last bit similar to the signal 8 . The signal 10 is the combination of the signals 8 and 9 , and is used as the sampling clock of the whole reception channels. The clock 10 coincides with the phase of the reception channels for each channel. And, the signal 10 has the feature that the clock phase of the first bit in each channel is lag, and the clock phase of the last bit in each channel is lead, so that the present system can be used for the frame structure of Fig.10 which has no guard bit between channels. The amount of the lag of the first bit, and or the lead of the last bit is designed according to the distortion of each reception channel. In the above embodiments, when the recognition margin of a sampling clock at the DSU apparatus is 1 4 time slot, the allowable phase distortion of the input signal to the DSU is 1 2 time slot. Accordingly, the following equation is obtained, corresponding to the previous equation 1 . Fig.17 is a block diagram of the violation detector 11 in each previous embodiments. In the figure, the numeral 33 1 and 33 2 are comparators, 34 1 and 34 2 are leading edge detectors, 35 1 and 35 2 are RS flip flops, 36 1, 36 2, 38 1 and 38 2 are AND circuits, 37 1 and 37 2 are shift registers, 39 1, 39 2 and 40 are OR circuits, 41 is a monostable multivibrators, and 42 is a delay circuit. The operation of the violation circuit of Fig.17 is shown in Fig.18. Fig.18A shows the case that there are more than 1 bit duration before a violation occurs, and Fig.18B shows the case that the violation occurs immediately. Fig.18 shows the case that the violation occurs in positive side, and it should be noted that the operation is similar when the violation occurs in negative side. When there are more than one bit duration before violation Fig.18A , the signal 19 which is the leading edge indicator of an input signal, is applied to a set input of the RS flip flop 35 1, which also receives the trailing edge indicator at the reset input of the same. Therefore, the signal 20 at the output Q of the RS flip flop 35 1 is H high level from the reception of the positive side signal to the reception of the negative side signal. If a positive rise signal exists during said Q output 20 is in H level, the violation detection signal 21 is provided. That signal 21 causes the signal 23 which has the L level at the latter half portion of the F bit, through the monostable multivibrator 41 and the delay circuit 42. On the other hand, when the violation occurs immediately Fig.18 b , the positivie rise signal 19 of an input signal is applied to the shift register 37 1, which has N number of steps when the high speed clock is N times as high as the input signal. Then, the delayed positive rise signal 22 which is delayed by one bit, is applied to the AND circuit 38 1, which also receives the positive signal of the input signal. The output of the AND circuit is the violation detection signal. Fig.19 is a block diagram of the instantaneous follow type PLL which is conformed of a digital circuit. In the figure, the numerals 30 1 and 30 2 are trailing edge detection circuits, 31 1 and 31 2 are RS flip flops, 32 1 and 32 2 are AND circuits, 33 1, 33 2 and 37 are dividers, 34 1 and 34 2 are shift registers, 35 is a selector with a plurality of inputs, and 36 is a selector with one input. The operational time chart of the apparatus of Fig.19 is shown in Fig.20, in which a shows the case that the output clock phase leads to the input phase, and b shows the case that the output clock phase is lag to the input phase. When the output clock phase leads to the input signal phase Fig.20 a , the trailing edge indicator 16 of the output clock is applied to the set input of the RS flip flop 31 1, and the trailing edge indicator 17 of the input signal is applied to the reset input of the same. Therefore, The Q output 18 of the RS flip flop is in H level during the difference between the input signal phase and the clock phase. The number of the master clock pulse whick is masked by the Q output 18 and the AND circuit 32 1 is adjusted by the divider 33 1. The output 20 of the divider 33 1 is converted to a parallel form by the shift register 34 1, then, applied to the divider 37 as a preset value through the selector 35. The clock phase lags by said preset value. When the output clock phase is lagged to the input signal phase Fig.20 b , the trailing edge indicator 17 of the input signal is applied to the set input of the RS flip flop 31 1, which also receives the trailing edge indicator 16 of the input signal at the reset signal. Therefore, the Q output 19 of the RS flip flop is in H level by the lag time of the output clock phase as compared with that of the input signal phase. The master clock pulse which is masked by said Q output 19 and the AND circuit 32 2 is applied to the divider 33 2, which adjusts the number of the pulses of said master clock. The output 21 of the divider 33 2 is converted to a parallel form by the shift register 34 2, then, applied to the divider 37 as a preset value through the selector 35. The clock phase leads by said preset value. The division ratio M₁ N₁ of the divider 33 1, and the division ratio M₂ N₂ of the divider 33 2 determine the amount of lag phase, and the amount of the lead phase, respectively of the output clock phase. Since it has no sequential loop filter, the clock phase for a next bit is determined by difference between a reception signal bit phase and a clock phase, and therefore, an instantaneous follow operation is achieved. Fig.21 is a block diagram of a clock phase shifter 19 2 for B₁ channel and B₂ channel. In the figure, the numeral 38 is a delay circuit, 39 is an RS flip flop, 40 and 44 are AND circuits, 41 is a counter, 42 is a monostable multivibrator, 43 is a trailing edge detector, and 45 is an OR circuit. The operational time chart is shown in Fig.22. Although Fig.21 shows the case for B₁ channel and B₂ channel, the apparatus for F, and D channel is obtained merely by changing the counter 41 to the single step counter, and the operation is the same as that of Fig.22, except for the full count number of the counter. The reset signal 5 of the PLL is delayed by about 1.5 time slot in the delay circuit 38, and is applied to the set input of the RS flip flop. Exactly speaking, the amount of the delay is determined by the clock phase delay for the first bit of a channel and the phase of the reset signal 5 . The Q output 23 of the RS flip flop 39 becomes to H level at the same time as the signal 22 , and then, the AND circuit 40 opens. The clock 7 which passes the AND circuit 40 is counted by the counter 41 up to 7. The Q output of the counter 41 becomes to L level after counting, and the change point from H level to L level is applied to the reset input of the RS flip flop 39, and the signal 23 returns to L level. Then, the AND circuit 40 is closed, and the clock pulse 42 corresponding to the 8 th bit of the monostable multivibrator 42 is obtained. The OR circuit 45 combines the signal 24 and seven clock pulses, and the clock 9 for B₁ channel and B₂ channel is obtained. The clock phase for the last bit of the channel is determined by the clock pulse phase provided by the monostable multivibrator 42. As described above in detail, according to the present polyphase phase lock oscillator used in a bus coupling system, a master station DSU generates a gate signal for selection a plurality of channels in a received signal through frame synchronization, and a clock for each channel is regenerated by using a reception signal which is separated for each channel by said gate signal, irrespective of presence or non presence of a guard bit. A final desired sampling clock is obtained by combining clock for each channels. As an effect of the present invention, the length between a master station and a slave station may be increased, and a transmission error rate is decreased because of the complete coincidence of a regenerated clock phase with a reception signal. Accordingly, the present invention is advantageous when it is used in high speed digital Information Network System INS .