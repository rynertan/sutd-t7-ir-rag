# Image processing.

## Abstract
An image processing apparatus has a frame store 0 for storing a matrix of digital words each representing the bright ness or colour of a picture element of a stored image. Image enhancement, which may be used in conjunction with a method for enlarging or reducing the image is provided by processing means 6 arranged, for each element, to compare the value of the corresponding word with those correspond ing to the image elements adjacent in a selected direction or both coordinate directions and, if it lies between the adjacent values to change its value by amount of the same sign as, and dependent on, its deviation from the means of the adjacent values. The invention may be used in still frame editors.

## Claims
CLAIMS Image processing apparatus having a frame store for ring a matrix of digital words each representing the brightness or colour of a picture element of a stored i m age, and processing means for image enhancement, arranged in operation, for each element to compare the value of the corresponding word with those corresponding to the image elements adjacent in a selected direction, and, if it lies between the adjacent values to change its value by amount of the same sign as, and dependent on, its deviation fror the mean of the adjacent values. 2. Image processing apparatus according to claim 1 in which the change in value is proportional to the said deviation. 3. Image processing apparatus according to Claim 2 in which the processing means Is arranged to limit the increase or decrease in value of a word such that it shall not lie outside the range defined by the adjacent values. 4. Image processing apparatus according to claim 1, 2 or 3 in which the processing means is arranged in operation to carry out the said comparison and value change procedure twice, with first and second mutually perpendicular selected directions. 5. Image processing according to anyone of the preceding claims including magnification or reduction means for producing a larger or smaller set of digital words representing an enlarged or reduced scale image by repetition or omission of selected words, the magnification or reduction means having means, arranged in operation to compute, for each element the integer part of the values of z l y x and zy x, where x and y are the number of elements in the original and processed image, measured in the direction in which triagnification or reduction is to be made, and z is the number of the element in that direction, and to compare those integer parts to establish whether that corresponding word is to be selected for repetition omission. 6. Image processing apparatus according to any one of the preceding claims including store means having bit locations for each picture element, means for setting or resetting bit locations thereof, and means responsive to the state of those bit locations to set the corresponding words in the frame store to predetermined values. 7. Image processing apparatus having a frame store for storing a matrix of digital words each representing the brightness or colour of a picture element of a stored image, store means having bit locations for each picture element, means for setting or resetting bit locations thereof, and means responsive to the state of those bit locations to set the corresponding words in the frame store to predetermined values. 8. Image processing apparatus having a frame store for storing a matrix of digital words each representing the brightness or colour of a picture element of a stored image, and magnification or reduction means for producing a larger or smaller set of digital words representing an enlarged or reduced scale image by repetition or omission of selected words, the magnification or reduction means having means, arranged in operation to compute, for each element the integer part of the values of z l y x and zy x, where x and y are the number of elements in the original and processed image, measured in the direction in which magnification or reduction is to be made, and z Is the number of the element in that direction, and to compare those Integer parts to establish whether that corresponding word Is to be selected for repetition omission.

## Description
IMAGE PROCESSING The present invention is concerned with image processing apparatus, in which a frame store is provided for storing a matrix of digital words each representing the brightness or colour of a picture element of a stored image. Although of general application, the invention finds particular application in the context of a still frame editor suitable for example for the preparation of material for a photovideotex system. According to one aspect of the present invention there is provided Image processing apparatus having a frame store for storing a matrix of digital words each representing the brightness or colour of a picture element of a stored image, and processing means for image enhancement, arranged in operation, for each element to compare the value corresponding word with those corresponding to the image elements adjacent in a selected direction, and, if it lies between the adjacent values to change its value by amount of the same sign as, and dependent on, its deviation from the mean of the adjacent values. One embodiment of the invention will now be described, by way of example, with reference to the accompanying drawings, in which Figure 1 is a block diagram of a photovideotex editor embodying the invention Figure 2 and 3 are diagrams illustrating respectively reduction and enlargement methods employed In the editor of Figure 1 and Figures 4a, b and c are diagrams illustrating an image enhancement method. The still frame editor shown in Figure 1 comprises a video frame store 1 capable of storing one or more television frames typically the store may have a capacity of 1 or 2 frames each consisting of 270x240 pixels. A graphics store 2 has the same spatial resolution, but reduced brightness resolution. It need not be physically distinct in e prototype version each frame of the frame store provided twenty four bits per pixel eight bits each for the red and green planes and five bits for the blue, the remaining three bits providing a three RGB graphics planes with one bit per pixel. Such an arrangement is not In itself new, and a commercially available frame store such as the Gresham Lion could be used to provide the facilities indicated with the broken lines in Figure 1.Associated with the stores 1, 2 are entry logic 3 capable of entering a freezed frame Into the frame store from an RGB and sync video input 4, via a video digitfser 5, or digital data into either store from a control computer 6 output logic 7 supplies selected data from the stores to the control computer 6 and a composite video signal to an output 9. The stores are digitally overlaid before being converted to RGB signals.A local monitor 10 is also shown. Of course YUY storage for the video plane could be used rather than RGB with for some applications a reduction in storage requirement by reducing the spatial and or intensity resolution of the colour difference components. The control computer is provided with operator input output devices eg keyboard 11, analogue input 12 such as a joystick or pad or nouse1 and a VDU 13 if the monitor 10 is not made to serve for the display of control information . Elementary operations which can be carried out under control of the computer, when instructed by the operator are i Entry of a still frame, from a common or other video source connected to the video input 4, into the first frame store page. ii transfer of a still frame or a part thereof from one frame store page to another or within the same page its position in the destination frame being selectable. lit entry of operator input graphics Into the graphics store or transfer of graphics from backing storage such as magnetic disk . iv transfer of graphics from the graphics store into a video store.More sophisticated features are a a 1zoom facility enabling a stored picture or part of a picture to be enlarged or reduced in size. b a crispening or image enhancement facility. c a masking facility for selecting complex shaped parts of an image for transfer or processing. These will now be discussed in further detail. Zoom facility. This could of course be done by applying a two dimensional spatial filtering process to an n x m pixel area, to produce kin x kbn pixel values where kl, k2 are magnification factors in two coordinate directions . For the present function under consideration, viz. an editing terminal, the time taken for the apparatus to carry out any Image processing step is significant, since if it is too slow it will be tiPe consu 1ng and irksome for the operator. We have found that the tine taken to carry out such spatial filtering is excessive for a colour image of the kind of resolution envisaged above, and propose a simpler solution in which pixel values are selected for omission or repetition for reduction or enlargement respectively .Moreover, this solution employs only integer arithmetic, again speeding processing. The criterion for omission of a pixel is that, if the zth pixel of a line of x pixels to be reduced to or enlarged from has an extent falling entirely within one of y equal divisions of the line, then it is omitted repeated . This is illustrated in Figure 2, where the extent of the zth pixel 1 z x of an x pixel line of unit length is indicated, from z 1 x to z x. The number of pixels widths along the line of the new set is a z i y x and b zy x respectively. Note that a and b differ by y x 1 for reduction and are in general not integers. Inspection of Figure 2 shows that the zth pixel lies wholly with a y division If the integer parts of a and b are equal, so that it is necessary to calculate only the integer values of a and b, and compare them to establish whether or not pixel z is to be omitted. For enlargement, y x 1. If the integer parts of a and b differ by 2, then pixel 5 Figure 3 in the enlarged picture falls entirely within pixel z and pixel z is repeated to provided pixel i. The process is of course carried out horizontally for deletionlrepetition of pixels along a line, and vertically for deletion repetition of lines. The following program, written in PASCAL, performs the shrink process described. Certain procedures external to the program are first defined, followed by a procedure to produce a logical array indicating whether the corresponding picture element or line is to be omitted ie a b above , and the main shrink procedure. This latter can be called in order to shrink a picture of say 270x240 pixels down to 90x80 assuming the top left hand corner to be at 45,31 by a statement in a control program shrink 45,31,270,240,90,80 . The program now follows PROGRAM small INPUT, OUTPUT VAR storel,store2,store3 ARRAYE1. arraysize of INTEGER testhorizontally,testvertically ARRAY 1..arraysize of BOOLEAN reads data horizontally from the frame store. It reads from line numbered line starting at pixel c1, and reading c3 pixels PROCEDURE readhorizontally YAR store ARRAY 1. arraysize of INTEGER line,c1,c3 INTEGER EXTERNAL writes data horizontally to the frame store. It writes to line numbered line starting at pixel cl, and writes c3 pixels PROCEDURE wrltehorlzontally VAR store ARRAYF1. arraysize of INTEGER line,c1 c3 INTEGER EXTERNAL reads data vertically from the frame store. It reads from line numbered line starting at pixel c1, and reading c3 pixels PROCEDURE readvertically VAR store ARRAY 1. arraysize of INTEGER line,cl,c3 IWTEGER EXTERNAL writes data vertically to the frame store.It writes to line numbered line starting at pixel cl, and writes c3 pixels PROCEDURE writevertically VAR store ARRAY l..arraysize of iNTEGER line,c1,c3 lNTEGER EXTERNAL This is the bit that produces the array for the test as to whether a line or pixel is to be accepted or rejected.new is the new number of lines or pixels PROCEDURE shrRnktestlVAR test ARRAY 1.. arraysize ofBOOLEAN new,old INTEGER YAR pixel ,previouspixel,J INTEGER BEGIN pixels FOR j 1 TO old DOBEGIN previouspixel pixel pixel j new DIV old test is TRUE if pixel is not equal to previouspixel, otherwise FALSE test j pixel previouspixel END END Shrinks the defined area from being c3 pixels by c4 lines down to being newx pixels by newsy lines. Note that the top left hand corner is at cl, c2 and is cannon to both the original and the final picture PROCEDURE shrink c1,c2,c3,c4,newx, newy INTEGER VAR pixel ,newpixel ,line,newline,colour INTEGER BEGIN produce arrays which Indicate if a certain line is to be accepted or rejected shrinktest testhorizontally,newx,c3 shrinktest testvertically,newy,c4 FOR line l TO c4 DOBEGIN r decides if a line is to be accepted or not IF testverticallyFline THEN BEGIN readhorizontally storedl, line c2 1 ,cl,c3 newpixel O FOR pixel l TO c3 DO BEGIN decIdes if a pixel on a line is to be accepted or not IF testhorizontally pixel THEN BEGIN newpixel newpixel 1 storel newpixel storel pixel END END newline newline l writehorizontally storel, newline c2 i ,c1, newpixel ENDEND The enhancement or crispening , facility is intended to improve the apparent definition of an indistinct image for example where it has been enlarged as described above, or where the source material is of poor quality. Again spatial filtering using transversal techniques could be used, but is slow. The method proposed is as follows. Consider a pixel n Figure 4 , with its amplitutde an which could be the Y, U, Y, R, G or B value clearly in a colour system the process must be carried out 3 times for the three components . Adjacent pixels n l, n 1 have amplitudes an 1, an l. If, as shown in Figure 4a, the graph of a against n is concave lie the second derivative is positive the value of an is reduced. If on the other hand it is convex the second derivative is negative Figure 4b an is increased. If a maximum or minimum is observed Figure 4c d no change is made. In analogue terns, this effectively increases the h.f. component of the image, so that the rounded waveform ofFigure 4d is sharpened as shown in Figure 4e. Thus an is changed to a value of I k an or 1 k an respectively where k is a factor determining the magnitude of the resultant effect. However, the change is clamped , in that if an was between an l and an 1, it is not permitted to fall below or rise above either an 1 or an l. This discrete approach, as well as having the advantage of speed, also avoids the generation of noise on the picture due to undershoot or overshoot. Naturally this process can be carried out in both directions. A suitable program is as follows PROGRAM crisp INPUT,OUTPUT YAR store ARRAY 1 arraysizezof INTEGER value INTEGER EXTERNAL procedures are as above This is the routine that crispens a line PROCEDURE crisp VAR store ARRAY 1..arraysize OF INTEGER xslze, factor INTEGER .VAR i,pixell ,pixel2,pixel3,difl,dif2,correction,high,low, nevpixel INTEGER BEGIN pixel2 store 1 pixel3 stores 2 dif2 pixel2 pixel3 FOR i 2 TO xsize 1 DOBEGIN ESet up variables for the correct three pixels3 pixell plxel2 pixel2 pixel3 pixel3 store Ei 1 difl dif2 dlf2 pixel2 pixel3 If dlfl dif2 O, it is not a maximum or a minimum point, and so a correction is made. The normal crispen routine merely works out the correction as the multiplication of the factor with the sum of the two differences.All the rest of the routine is the conditions I apply to the crispen IF difl dif2 0 THEN correction factor difl dif2 DIV 100 ELSE correction 0 newpi xel pixel2 correction IF correction 0 THEN BEGIN This bit clamps the central pixel between the two on either side of it.Note that if the middle point is not between the two on either side then it is a maximum or minimum and so should not be in this code IF pixel pixel3 THEN BEGIN high pixell low pixel 3 END ELSE BEGIN high pixel3 low pixell END IF newpixel high THEN newpixel high ELSE IF newpixel low THEN newpixel low END store i newpixelENDEND Crispens defined area PROCEDURE crispen ci,c2,c3,c4,x INTEGER VAR line,colour INTEGER BEGIN This will crispen the picture going horizontally3 FOR Line c2 TO c2 c4 1 DO BEGIN readhorizontally store, line, cl, c3 crisp store, c3,x writehorizontally store, line, cl, c3 END This will crispen the picture going vertically FOR line cl TO cl c3 l DO BEGIN readvertically store, line, c2, c4 crisp store, c4, x writevertically store, line, c2, c4 ENDEND The crispen routine can be called up by BEGIN WRITE input crispen factor READLN value The first two numbers define the top left hand corner of the picture. The next is the width, and the next the depth. The value is the amount it is to be crispened crispen 100,100,100,100,value END A useful feature of the editor to is selection of parts of an image. Here the operator uses the input device to enter into the graphic store an outline around the desired part the outline being displayed simultaneously with the picture. Having thus defined an outline, an area may be defined by filling the outline either from within or without , and can be used as a mask to remove unwanted parts of the Image in the frame store, or to transfer selected parts to another frame. This is achieved by controlling the limits of an erasure or transfer process by reference to the contents of the graphics plane used for the mask.