# METHOD AND APPARATUS FOR DETECTING POSITION.

## Abstract
A method of detecting a position comprising a step for generating two sinusoidal wave signals having phases that are spacially different by 90 , corresponding to the move ment of a moving body a step which detects voltages Va, Vb of the two sinusoidal wave signals to calculate a value α which makes the value V Va.cos α Vb.sin α zero and a step which detects the amount of movement of the moving body by using the above calculated value α as data on positions of interpolated division in a cycle of the sinusoidal wave as well as an apparatus for detecting the position, which is used for putting said method into practice. Accord ing to the method and apparatus for detecting position, the moving position of the moving body can be detected with high resolution.

## Claims
CLAIMS 1. A method for detecting a position, characterized by comprising the steps of producing two phase sinusoidal wave signals having a 900 spatial phase difference therebetween upon movement of a moving object detecting the current voltage values V a and Vb of the two phase sinusoidal wave signals and calculating a value of a making a value of V zero, given by V V a cosa Vbsina and detecting a moving amount of the moving object by using the calculated value of a as interpolating dividing position data within 1 cycle of the sinusoidal wave signals. 2. An apparatus for detecting a position, characterized by comprising means for producing two phase sinusoidal wave signals having a 900 spatial phase difference therebetween upon movement of a moving object a cos converter and a sin converter for cosconverting and sin converting a ratio of a count number of an up down counter to an interpolating divisor within 1 cycle of the sinusoidal wave signals two multiplying means for respectively producing a product between the output from said cos converter and the current voltage value V a of one of the two phase sinusoidal wave signals and a product between the output from said sin converter and the current voltage value V of the other of the two phase sinusoidal wave signals, and subtracting means for deriving a difference V between the outputs from said two multiplying means a compensator for compensating the value of the difference V pulse generating means for generating pulses having a frequency proportional to an absolute value of the output from said compensator and a polarity detector for detecting a polarity of the output from said compensator, wherein said up down counter is caused to count up or down by a predetermined number of pulses in accordance with the output signal from said polarity detector, until the difference V becomes zero.

## Description
DESCRIPTION TITLE OF THE INVENTION Method and Apparatus for Detecting Position TECHNICAL FIELD The present invention relates to a method and an apparatus for detecting a position and, more particularly, to a method and an apparatus for detecting a moving position of a working machine e.g., an NC machine or of the arms of a robot. BACRGROUND ART Position detection is conventionally performed by using two phase sinusoidal wave signals referred to as signals Va and Vb hereinafter having a 900 spatial phase difference therebetween, and a position detecting apparatus of this type is generally called an encoder. A conventional encoder irradiates light emitted from, e.g., a light emitting diode, to a rotary encoding plate normally provided with a large number of slits e.g., 2,000 at equal intervals on the periphery thereof mounted on a given rotating shaft, whose rotating position is to be detected. The light passed through a slit formed in the rotary encoding plate and a slit formed in a fixed plate facing the rotary encoding plate is received by a light receiving element e.g., a photodiode to be converted into a voltage, thereby obtaining, in accordance with rotation of the rotary encoding plate, sinusoidal wave signals Va and Vb , one cycle of which corresponds to an interval between two adjacent slits one pitch formed in the rotary encoding plate. In this case, in order to provide the 900 spatial phase difference between the two sinusoidal wave signals Va and Vb , two slits, shifted by 1 4 of a pitch from an integer multiple of the slit interval I pitch of the rotary encoding plate, are formed in the fixed slit plate, and the two sinusoidal wave signals V and Vb are obtained from the electrical a signals generated in the light receiving elements, each of which faces each of the above two slits seeFig. l a . The sinusoidal wave signals Va and Vb are input to comparators for generating output signals AP and BP, which go to HIGH or LOW level in accordance with positive or negative levels of the sinusoidal wave signals. A so called positive pulse for sequentially counting up an up down counter meaning that the rotary encoding plate is rotated in a given direction, e.g., clockwise is produced in the following states GI when the output signal BP is at HIGH level at the leading edge of the output signal AP Q2 when the output signal AP is atHIGH level at the trailing edge of the output signal BP Q3 when the output signal BP is at LOW level at the trailing edge of the output signal AP and when the output signal AP is at LOW level at the leading edge of the output signal BP see Fig. 1 b . On the other hand, a so called negative pulse for sequentially counting down the up down counter meaning that the rotary encoding plate is rotated in the opposite direction, e.g., counterclockwise3 is produced in the following states Ql when the output signal BP is atLOW level at the leading edge of the output signal AP 0 when the output signal AP is at LOW level at the trailing edge of the output signal BP Q3 when the output signal BP is at HIGH level at the trailing edge of the output signal AP and Q4 when the output signal AP is at HIGH level at the leading edge of the output signal BP see Fig. 1 c . In this manner, the rotational angle of the rotary encoding plate, i.e., a rotating position of the rotating shaft on which the rotary encoding plate is mounted, is detected in some cases, the rotational angle of the rotary encoding plate is linearly developed, and the moving position of a linearly moving object is detected . However, in this conventional position detecting method, only four.pulses the positive or negative pulses for counting up or down the up down counter are generated upon rotation of the rotary encoding plate during 1 cycle of the output signal AP or BP corresponding to a l pitch interval of two adjacent slits in the rotary encoding plate , as described above. If 2,000 slits are formed in the periphery of the rotary encoding plate, the resolution of the rotational angle detection is only 1 2,000 x 4 1 8,000 rotation. In other words, upon rotation of the rotary encoding plate, only a detection resolution corresponding to 4 times of a divisor for each rotation of the rotary encoding plate, corresponding to the number of slits, can be obtained. DISCLOSURE OF THE INVENTION The present invention has been made in consideration of the above situation, and its object is to detect a moving position of a rotating member or, in general, a moving object with reference to a moving amount deviation amount of the object from its initial position with a remarkably high detection resolution e.g., 1 2,000 x 1,000 rotation when compared with that obtained in the above mentioned conventional moving position detecting method. In order to solve the above problem, according to an aspect of the present invention, there is provided a method for detecting a position, comprising the steps of producing two phase sinusoidal wave signals having a 90 spatial phase difference therebetween upon movement of a moving object detecting the current voltage values Va and Vb of the two phase sinusoidal wave signals and calculating a value of a making a value of V zero, given by V Va cosa Vbsina and detecting a moving amount of the moving object by using the calculated value of a as interpolating dividing position data within 1 cycle of the sinusoidal wave signals. According to another aspect of the present inven tion, there is provided an apparatus for detecting a position, comprising means for producing two phase sinusoidal wave signals having a 90 spatial phase difference therebetween upon movement of a movingobject a cos converter and a sin converter for cosconverting and sin converting a ratio of a count number of an up down counter to an interpolating divisor within 1 cycle of the sinusoidal wave signals two multiplying means for respectively producing a product between the output from the cos converter and the current voltage value V a of one of the two phase sinusoidal wave signals and a product between the output from the sin converter and the current voltage value Vb of the other of the two phase sinusoidal wave signals, and subtracting means for deriving a difference V between the outputs from the two multiplying means a compensator for compensating the value of the difference V pulse generating means for generating pulses having a frequency proportional to an absolute value of the output from the compensator and a polarity detector for detecting a polarity of the output from the compensator wherein the up down counter is caused to count up or down by a predetermined number of pulses in accordance with the output signal from the polarity detector, until the difference V becomes zero. According to one aspect of the present invention, the value of a making the value of V zero, given by V Va cos Vb sina, is calculated by using V V sine, and Vb VgsinB a 0 b 0 where e is a current rotational angle .As a result, the value of a making the value V given by the following equation zero need only be calculated. V V0 sin.cosa cosesina V0sint4 a In this case, the above equation becomes zero when a e nit where n is an integer . Therefore, when e varies, if a is sequentially obtained within a cycle shorter than the varying rate of Q more specifically, a cycle shorter than a time in which the sinusoidal wave signals change by , a deviation amount of e can be accurately detected by obtaining a change in a.In this case, the value of a making the value of V zero satisfies the above relation of a 6 ns, regardless of the value of Vg , which makes a major cause of detection errors the value of V0 varies during one rotation of the rotary plate since a gap between the rotary encoding plate and the fixed slit plate varies upon rotation of the rotary encoding plate, and also varies due to a variation over time in the amount of light emitted from the lightemitting diode .As a result, 1 cycle of the sinusoidal wave signals corresponding to a pitch interval of the slits in the rotary encoding plate is linearly interpolated and divided i.e., equally divided by a predetermined interpolating divisor e.g., 1,000 by using the value of a, and a deviation amount of the rotary encoding plate in general, a moving amount of the moving object can be detected with a remarkably high resolution e.g., 1 2,000 x 1,000 rotation if the number of slits in the rotary encoding plate is 2,000 and the interpolating divisor is 1,000 when compared with that obtained in the conventional detecting method. According to another aspect of the present invention, when the value of a making the value of V zero is calculated with the above method of the present invention, an output corresponding to the value of V is produced through the up down counter, the cos and sin converters, and the multiplying and subtracting means, and further, the compensator for compensating the value of V, the means for generating pulses having the number corresponding to the absolute value of the output from the compensator, and the polarity detector for detecting the polarity of the output from the compensator are used to cause the up down counter to count up or down by the predetermined number of pulses in accordance with the output signal form the polarity detector, until the value of V becomes zero. Thereby, the rotating deviation amount is detected from the obtained count value. BRIEF DESCRIPTION OF THE DRAWINGS Figures 1 a , l b , and l c are waveform charts for explaining a conventional position detecting method Fig. 2 is a block diagram showing a basic principle of a position detecting method according to the present invention Figs. 3 and 4 are block diagrams of detecting devices when the position detecting method according to the present invention is carried out by means of a computer Fig. 5 is a flow chart of an example of a control program when detection position data is calculated by a computer with the method of the present invention and Fig. 6 is a block diagram of an entire arrangement when the position detecting method of the present invention is carried out by means of a feedback circuit. BEST MODE FOR CARRYING OUT THE INVENTION Figure 2 is a block diagram showing a basic principle of a position detecting method according to the present invention, and Figs. 3 and 4 are block diagrams of detecting devices when the position detecting method is carried out by using a computer. According to the position detecting method of the present invention, voltage values V and V of a b two phase sinusoidal wave signals, which are generated in accordance with the rotational angle of a rotary encoding plate generally, the moving position of a moving object as described in the background art, are fetched at each of constant time intervals e.g., 50 msec , and are used to calculate a, which makes a value V given by the following equation zero V Va CQSa V sina. The obtained a is used as position data in this case, data representing the rotational angle which is obtained by linearly interpolating and dividing equally dividing 1 cycle of the sinusoidal waves corresponding to an interval between two adjacent slits on the rotary encoding plate in accordance with a predetermined divisor. The reason why the position data is obtained with the above method in the present invention will be described hereinafter in more detail. In the above equation V Va cosa Vbsina ... 1 since Va Vowing, Vb VocosO where V0 is the amplitude of the two phase sinusoidal wave signals, and e is the rotating position rotational angle of the rotary encoding plate , when these equations are substituted in equation 1 , V V0 sine cosa cosG sina V0sin G a .Then, the value of a making the value of V zero is a e nit where n is an integer . Therefore, when the rotary encoding plate is rotated and e varies, if a is obtained with a predetermined shorter cycle than a varying rate of e more specifically, a cycle shorter than a time in which the sinusoidal wave signals change by it in accordance with rotation of the rotary encoding plate , Q, i.e., the deviation amount of the rotational angle a moving amount from its initial position can be accurately detected by obtaining a change in a. Figures 3 and 4 exemplify arrangements of detecting devices when the position detecting method of the present invention is carried out by using the computer.In a detecting device shown in Fig. 3, a microprocessor 2 in the computer supplies, in response to timing signals generated by a timer 1 at predetermined intervals, a hold command to sample hold circuits 31 and 32 which respectively receive the sinusoidal wave signals V and Vb so as to sample a and Vb so as to sample and hold the current value of the sinusoidal wavesignals V a and Vb. During this interval, the analog values of the sinusoidal wave signals V a and Vb are converted into digital values by A D converters 41 and 42, respectively, with a predetermined precision, and the digital values are input to the microprocessor 2 with each given cycle, through a bus. In the microprocessor 2, these digital inputs are used as the values of V a and Vb in equation l , and the value of a making equation 1 , i.e., the value of V zero, is then calculated at each cycle. Note that the calculation results for the respective cycles, i.e., position data a for the respective cycles can be sequentially stored in the memory of the computer or in an external output register 5. In an apparatus shown in Fig. 4, instead of the twoA D converters 41 and 42 in Fig. 3, the outputs sampled and held by the sample hold circuits 31 and 32 are sequentially input to a common AID converter 44 by switching a multiplexer 43 in response to a switching command input thereto from the microprocessor 2 during each cycle, and the outputs from the converter 44 are sequentially input to the microprocessor 2, thus allowing use of a single AID converter. Practical methods for calculating the value of a making the value of V given by equation l zero in the microprocessor 2 will now be described. A first method is a so called feedback method, in which a for each detection cycle is calculated by the following operation. When position data a. in a certain detection cycle is to be obtained, V. Vacosai l V Vb sinvi l is calculated based on position data a. 1 obtained at immediately preceding cycle and the digital values Va and Vb newly input from the A D converters 41 and 42 or the converter 44, as described previously, and new position data a. is calculated as follows on the basis of the value of V. so called proportional compensation method a. a. KV. where K is a constant 1 1 1 1 Alternatively, instead of using equation 2 , the values of V. are accumulated to obtain S. i.e., 1 1 EMI9.1 and new position data a. is calculated based on the Vi and Si as follows so called proportional 1 1 integral compensation method a. a. K S. 1 1 1 S 1 where Kp and K5 are constants, and normally, Kp Ks . Note that although the proportional compensation method can be easily realized, when e changes at a constant rate, a detection error proportional to the changing rate of e inevitably occurs. On the other hand, although the proportional integral compensation method requires a complicated circuit, unlike the former, no detection error proportional to the changing rate of e will occur. In a second method, non linear formula V cos a Vb .sin alpha 0 associated with a is solved by theNEWTON s method. In this case, if V a V a cos VbSina, a differentiated value V a for a is given by V cur Vasin Vbcosa. Therefore, an approximate solution of the non linear formula can be calculated by repeating the following procedure. When position data a. of a certain detection cycle is to be obtained, the position data a will of the immediately preceding cycle is used as a initial approxi mate value of a. it is defined that a 1 1 is equal to alpha i10 t as a10 corresponds to 0th approximation of a1 , thus calculating a il cr. Aa il iO iO where Aio V ai0 v ai Vacosa. V sina10 V sin io V cosa10 . Then, ail is used as a first approximation of ai. This operation is repeated, and if the nth approximation is a. , the n lith approximation is in given by. a n 1 ain Aa. n 0, 1, 2, ... 1. in in where again V ain V ain Vacosain Vbsinain Va s ina in V VbcOSain Then, when an absolute value Aa. I of ha. in I in satisfies IAainI where is a predetermined small value corresponding to a required precision , the repetition is stopped, and the position data alpha i. in that detection cycle is given by the approximate solution ai n 1 Figure 5 is a flow chart showing when the microprocessor 2 performs operation processing with the above Newton s method. Timing signals are generated from the timer I at equal intervals, and the microprocessor 2 initiates the next processing in response to each timing signal. After the flow starts in step I, the microprocessor 2 produces the hold command to the sample hold circuits 31 and 32 in step 2, thus sampling and holding the current values of the sinusoidal wave signals Va and Vb at that timing. The current analog values Va and V are converted into the a b digital values of given precision by the A D converters 41 and 42, and the digital values Va and Vb are fetched in step 3. In step 4, the detection value of the immediately preceding cycle position data ai 1 is derived and is used as a. In step 5, the following calculations are performed Aan V a cosan Vbsinan Vasinan Vb cosan and a a Aa n n where n 0, 1, 2, ... , and at the beginning of calculation, n 0 . Next, it is judged in step 6 whether or not IAanI is smaller than where e is a value for defining detection precision, and is given in advance . If NO in step 6, new an is given by an l step 7 , and the same calculation is repeated. However, if an is smaller than , alpha n 1 is output as new detection position data a. for that cycle in step 8, and the hold command is cancelled in step 9, thus completing operation processing for that cycle step 10 . With the method of the present invention, since the value of a making the value of V zero will not be adversely influenced by the amplitude V0 of the two phase sinusoidal wave signals, a major cause of detection errors, an error due to the amplitude V0 will not occur. Also, since the voltage values V a and Vb of the sinusoidal wave signals can be fetched by an A D converter of predetermined bits with high precision, high precision position data obtained by linearly interpolating and dividing 1 cycle of the sinusoidal waves corresponding to a pitch between two adjacent slits on the rotary encoding plate by a predetermined divisor e.g., 1,000 in accordance with the number of bits of the A D converter, can be detected accurately. When the value of a in each cycle is obtained by the second method e.g., the Newton s method , operation processing must be performed by using the computer, as previously described. However, when the value of a is calculated by the first method so called feedback method , the value of a can be substantially continuously obtained by using a feedback circuit, to be described with reference to Fig. 6, even if the apparatus including the computer i.e., the microprocessor 2 shown inFig. 3 or Fig. 4 is not used. More specifically, referring to Fig. 6, reference symbols V a and Vb denote electrical signals obtained such that a rotary encoding plate with a large number of slits is irradiated with light, and the light, passing through the slits of the rotary encoding plate and two slits whose pitch is shifted by 1 4 of a pitch from an integer multiple of a pitch between two adjacent slits of the rotary encoding plate formed in a fixed plate facing the rotary encoding plate, is received by a light receiving element such as photo diode.When the rotary encoding plate is rotated, the electrical signals V a and Vb become sinusoidal wave signals having a 90 spatial phase difference therebetween, and the voltage values are expressed as follows V a VQ sinG V V0cos where Q is a value proportional to a rotational angle of the rotary encoding plate, and Q 2v radians with respect to the interval between two adjacent slits pitch , within which the values V a and Vb change by 1 cycle. Assuming that the count value of an up down counter 7 in Fig. 6 is N at a certain timing, the count value N is input to a cos converter 81 and a sin converter 82 to output cosa and sina, respectively where a 2TN L, and L is an interpolating divisor with respect to the above mentioned 1 cycle and if L 1,000, count values from 0 to 999 are cyclically generated from the counter 7 . Note that the cos and sin converters can comprise an ROM, and the sin and cos outputs can be obtained with reference to a sin code table and a cos code table incorporated in the ROM. In this case, the count value N input to the ROM from the up down counter is used as an address signal with, respect to the ROM. The output cosa from the cos converter 81 is multiplied with the current voltage value V a by a multiplier 83, and the output sina from the sin converter 82 is multiplied with the current voltage value Vb by a multiplier 84. Then, the outputs from the multipliers 83 and 84 are input to a subtractor 61, thus generating a difference therebetween, i.e., V Va.cos alpha V.sina . Note that a multiplier type D A converter is used as a multiplier. The above V a and Vb are input to the D A converter as reference voltages, and the output digital value from the ROM is D A converted in proportion to the reference voltages, thus generating the multiplied values.If a D A converter weighted by cos and sin are used as the D A converter, the cos and sin converters can be arranged integrally with the multipliers. The output V is input to a compensator 62. If the compensator is a proportional compensator, KV where K is a given constant can be obtained from the output side. An absolute value converter 63 derives an absolute value IKV from the output KV, and the value of KV I is input to a voltage frequency converter 64 to be converted into a frequency proportional to the value of KV Thereafter, pulses having the number corresponding to the frequency are generated. A polarity detector 65 produces a code corresponding to the polarity of the output KV. The up down counter 7 receives these two outputs, and counts up or down by the given number of pulses in accordance with the code output, thus generating a new count value. More specifically, if the value of V is not 0, the content of the up down counter is changed by the predetermined number of pulses with a given code, and ifV becomes zero, the pulse output is stopped. Thus, the feedback circuit in Fig. 6 performs a feedback operation so that the value of V becomes zero. In this connection, when the above V V a cosa Vb sina is further developed, Va V0sinG, andVb V0cose, and therefore, V is given by V V0 sin0.cosa cossina V0sin G a .Therefore, when a e, that is, the count value N of the counter is equal to L. 2 , V becomes equal to zero. In other words, a 2sN L obtained when V 0 is equal to the rotational angle of the rotary encoding plate corresponding to that timing. When the relation a 9 is established, assume that Q changes. At that time, when 9 changes to the positive side and 9 a 0 is yielded, the code output generated from the polarity detector 65 goes positive, the up down counter 7 counts up by the predetermined number of pulses, and as a result, a 2sN L changes to the positive side. On the other hand, when 9 changes to the negative side and 9 a 0 is yielded, the code output goes negative, the up down counter 7 counts down by the predetermined number of pulses, and as a result, a 2sNI L changes to the negative side. In this way, a follows a change in 9, and the content N of the up down counter 7 indirectly represents the rotational angle 9 corresponding to that timing. Note that the compensator 62 controls the following rate of a with respect to the rotational angle 9, and need only have a function which performs simple amplification or attenuation with the proportional compensation. In this case, however, a detection error inevitably occurs in proportion to a rotating speed. Contrary to this, if the compensator 62 performs the proportional integral compensation i.e., outputs the sum of a component proportional to V and a component obtained by integrating V, a can follow 9 without causing a detection error as 9 changes at constant rate. According to the method and apparatus of the present invention, a moving position of a moving object can be detected, in accordance with a moving amount of the moving object from its initial position, with a remarkably high resolution when compared with that obtained in a conventional position detecting method.