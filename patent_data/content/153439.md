# Modularly expansible system for real time processing of a TV display, useful in particular for the acquisition of coordinates of known shape objects and method using said system in radiography.

## Claims
Fernsehbild oder Echtzeit Bildverarbeitungssystem, insbesondere für das zeilenweise Ermitteln der Koordinaten einer Mehrzahl von Objekten oder Zielen durch zweidimensionale Mehrfachbit Korrelation mit

## Description
This invention relates to a modularly expansible system for real time processing of a TV image or display, useful in particular for the acquisition of the coordinates of known shape objects or merely contrasting objects with the background, the terms object or target referring herein to targets of limited known size present in a TV field. A currently much felt problem is, in several fields, from the biomedical one to industry, that of assessing with the utmost possible degree of accuracy, the coordinates or either moving or stationary objects, in order to exactly locate the position of the objects or plot a pattern of movement thereof. A pattern recognition system using a video camera connected to means for sampling the image recorded by the video camera and further connected to a clock circuit generating synchronization and timing signals to the video camera and to the system itself is disclosed by GB A 2 029 958. The known system performs a black and white according to a preset conversion threshold. However, as to the black and white distinction, there is a considerable loss of data coupled to a degradation of the video information. Accordingly, the task of this invention to provide a system as indicated which can afford direct in line acquisition of the coordinates of known shape objects or targets by simple bi dimensional correlation techniques. Within that task it is an object of this invention to provide a system as indicated, which can detect with great accuracy both motionless target coordinates and temporarily variable coordinates of moving targets, thus affording an extremely accurate representation of the pattern of movement of the latter. It is a further object of the invention to provide a system as indicated, which has a high resolution, and wherein detection errors can be effectively minimized. Yet another object of the invention is to provide a system as indicated, which can operate both with passive markers and semi active markers, e.g. catadioptric markers. Yet another object of this invention is to provide a system as indicated, which is functionally highly effective, and adapted to be readily expanded to find application in such recently developed industrial fields as robotics, while being suited to implementation at various levels of design sophistication, thereby meeting virtually any requirements involving real time in line acquisition of objects having any shapes. Above tasks and objects as well as other tasks and objects that will become apparent hereinafter are achieved by a television image or display real time processing system, particularly for in line acquisition of coordinates of a plurality of objects or targets by bi dimensional multiple bit correlation techniques as defined in the accompanying claims. In a preferred embodiment of this invention, the correlation means forming the core of the coordinate recognition system is implemented by a plurality of cascade connected stages. At least one of such stages is arranged to parallelize the lines or rows, and comprises plural delay lines whose length corresponds to a preset number of points or spots. Advantageously, the delay lines are implemented by pairs of RAM Random Access Memory memories, respectively, where the contents respectively of a preceding row and current row are read out and written, thereby said lines have programmable length according to the row clock pulse rate, all the delay lines being controlled by a common control unit. At least another of the cited correlation devices comprises column delay lines and cooperates with at least one respective pre adder stage and multiplier stages. Finally, the last of the correlation devices includes totalizing adders receiving the outputs from the other stages at their inputs and outputting the desired correlation function. Advantageously, according to the invention, with applications involving larger size masks, the system can be readily expanded by simply cascade connecting alike modules or systems together as explained hereinafter, the number of the modules being selected to match the number of lines or rows in the TV raster, and the number of multipliers provided in the modules matching the number of columns in the mask. Further features and advantages of the system according to the invention are pointed out in the dependent claims and may be appreciated from the following detailed description of some embodiments thereof, with reference to the accompanying drawings, where Making more specific reference to Figure 1, this TV image or display processing system, for real time acquisition of target or marker coordinates with bi dimensional correlation techniques, comprises essentially a TV camera T, e.g. of the low maintenance CRT tube type, operatively connected as shown. Associated with the TV camera T is a stroboscope ST for display sampling, which in the alternative, may be replaced with a TV camera shutter. The TV camera output is supplied to an analog to digital converter C provided for converting the information from the TV camera into a suitable digital signal for processing in the correlator CR, according to the invention. If desired, the TV camera may be of the CCD type. In particular, the correlator CR has the function of operating a conversion on the input signal such as to output a function of correlation between the input and a settable reference. This settable reference should have a high correlation to the marker and supply low values to the undesired background. In order to perform the correlation operation on the TV signal, one must have available a certain number of the image or display points or spots in parallel, and this according to the invention is accomplished with a series D₂ of long delay lines for one row and series D₁ of short lines from one spot. The field thus individuated is then weighed by the reference mask block M of D₁x D₂ size to provide then the correlation to be supplied to the detector R. In particular, a digital dedicated processor has been employed as correlator CR which can compute in line the correlation between portions of the display recorded by the TV camera T and the expected signal marker and provide the coordinates of the spots whereat the correlation takes a higher value than a preset threshold. The output from the correlator CR is supplied to the detector R, which is adapted to detect that a threashold has been exceeded in the correlation function, so as to pick up the spots of most likely presence of the marker. The system of this invention further includes a minicomputer MC for intelligent processing of the coordinates supplied to the correlator or digital processor CR. Of course, the system resolution will depend on the type of TV camera being used and on the construction of the correlator or digital processor CR and on a suitable calculation algorithm as it will be discussed thereinafter. A trial prototype gave a resolution of one spot out of 312 in the visible field 1 256th of the useful field along the vertical and of one spot out of 320 1 256th of the useful field along the horizontal, at 50 Hz. With both vertical and horizontal interlacing it has been possible to double the resolution for sampled displays at 25 Hz. As may be seen, between the detector R and minicomputer MC, an interface IN is provided which has the function of an interpreter between the machine and minicomputer MC and that of a buffer. It may be seen that the talk takes place on a bus according to IEE 488 Standard. It should also be born in mind that the size of the markers not shown detectable in the viewing field of the TV camera T will depend on the structures of the hardware and the line memories being used. In particular, an overall size D₁x D₂ of 6 x 6 spots has been selected for the prototype. A peculiar feature of this system embodiment is that it can operate with known shape targets, both with passive and semiactive markers, e.g. catadioptric markers. In the instance of known shape targets or passive markers, full use is made of the correlation computation, whereas in the instance of semi active markers that computation is but a safety factor improving the trustworthiness of the recognition. In a modified embodiment of the TV display processing system of this invention, the output from the correlator may be reconverted to analog by a digital to analog converter means not shown and supplied to a monitor not shown for reference optimization. It should be noted that the detector in question is called upon to work on a signal which is in many ways unique. This is, in fact, a function of three variables T x,y,t of which the first two are associated with the time t by two more sawtooth functions A simple way of dealing with the function T f₁ t ,f₂ n₂ F₂ ,t consists of effecting a double sampling of the function f₁ t in time base and of the overall function T, again in time base. To obtain the sampled function T f₁ n₁ F₁ , f₂ n₂ F₂ , n₃ F₃ , where the values for F₁,F₂ and F₃ are 5,000 kHz, 15,625 kHz, and 0.05 kHz, respectively, use may be made as mentioned of either a stroboscope or fast shutter with display acquisition times in the order of about ten microseconds. Thus, the display image will be fixed within a time The signal becomes then a sample sequence in a two dimension space only, as follows For an understanding of the inventive aspect of the correlation, reference may be had to Figures 2 4 and the following definitions By applying 4 , the following integral is obtained Splitting R To then readily find that, As an example, the shape of the detected target A x,y shown in section along the x axis in Figure 2 will be assumed. For convenience of construction, the function will be considered only where it is appreciably different from zero to this aim, A x,y will be taken as the product of A x,y by a suitable clipping window W x,y , 11 . For evident implementation reasons, it appears reasonable and in the hypothesis of a limited size marker even necessary to also clip the function Thus, 13 hereunder is obtained where W is a suitable clipping window selected for convenience of the same size as W. It becomes necessary, at this point, to seek the link existing between the cross correlation function and the coordinates of the spots whereat maxima of it occur, to then associate accurate coordinates with the targets. The quickest way of obtaining that relation is the graphical method, shown in Figures 2 and 3, and requiring no further explanation. Calling With sampling, we obtain, which represents the final formula less quantization proposed as the recognition algorithm. Making now reference to Figures 4 to 8, shown therein are diagrams of a further preferred embodiment of the correlation devices comprising the inventive system, while for the interconnection of such correlation devices to other system components, reference will be made to the already discussed Figures 1 to 3. More precisely, the structure of that correlator embodiment appears in block diagram form in Figure 4, and as may be seen, includes five cascade connected stages. The first stage, which serves the function of parallelizing a certain number of TV raster rows, comprises in that embodiment 5 delay lines having, for example, a length of 320 spots and being serpentine connected as shown best in Figure 5. In the diagram of Figure 5, the 5 delay lines proper and a control unit therefor may be seen. In particular, the need for a common control unit comes from the structure of the single delay line shown in Figure 6. Such lines have been implemented, in fact, through the use of a pair of random access memories or RAM s, wherein the contents are alternately read out and written of the preceding row and current row, respectively. This particular implementation makes these rows length programmable according to the row clock pulse rate. The second correlator stage comprises the column delay lines whose diagrams are shown in Figure 7. It should be noted that that Figure actually shows the association of one pair of delay lines plus a pre adder. The latter arrangement for the objects of that embodiment stems directly from some relations introduced between multipliers which have the dual purpose of simplifying the system and linearizing the phase of the correlator frequency response symmetry of the coefficients . More precisely, such relations are listed hereunder The fifth and final stage of that correlator, the block diagram whereof is shown in Figure 8, represents the so called totalizing adder, at the output whereof the correlation function appears as computed The skilled person will recognize that an important advantage of the present invention resides in the readily expansible correlation system itself. In particular, with an application requiring a larger size mask, the system can be easily expanded, for example, by means of a cascade of systems or modules, one type whereof is shown in Figure 9. In that Figure, the reference characters L.R.R. designate a row delay line, the characters L.R.C. designate a column delay line, and the characters M₁, M₂, .... M With reference to Figure 10, shown therein, to demonstrate the value of the inventive system, is a movement diagram or record, in particular for a long jump by an athlete carrying passive markers of known form at the reference points iliac crest, great trochanter, knee, malleolus, and metatarsus. Quite apparent from that reproduction is the recognition effectiveness of the inventive system, the resolution whereof could be further improved considering a weighed barycenter algorithm, taking the correlation function as the weight, and considering the barycenter of the pixels for which the threshold has been exceeded. Thus, a real time operating system has been provided capable of recognizing and identifying in standard lighting conditions moving objects of known shape. The recognition and identification time is 20 milliseconds. Of these, about 13 ms are taken by display processing, which requires the effectuation of 1,300,000 operations sum and products . Thanks to the very small values of the recognition and identification time, the system is capable, and this forms a part of this invention, of being expanded in conformity with a hierarchical structure with three levels, of which the system described in the cited patent application forms the first level. One possible block diagram of such a hierarchical structure has been shown in Figure 11. With reference to that Figure, the three level hierarchical structure has been configured as follows Levels II and III may be implemented on a General Purpose Computer or dedicated µ Level I operates in real time on an input signal from a standard or solid state TV camera and carries out the identification of the object on the basis of weight parameters and factors provided by level II . Level II has for its input the final outputs from the processing cycle from I 5 to 20 ms and establishes the recognition tactics by supplying level I with the necessary parameters. Cycle of level II 5 to about 500 ms. Level III deals with the general strategies and specific self learning techniques in the different operating situations, including sensor adaptation operations stop, focussing, etc. operations and changes in display resolution through pixel merging and splitting. The system, as implemented at 3 levels, can recognize identify a plurality of objects of varying shapes, spatial orientations, of changing shape, and in motion. The recognition time is in the 5 to 20 ms range using special TV cameras in the instance of preset known shapes, 200 to 500 ms range during the initial phases of recognition of changing and or non univocally preset shape objects. The average recognition time in the instance of object shadowing is of about 20 ms, all the values indicated being extremely small and far lower than those of conventional recognition systems. The system accuracy has been, for the prototype made, of 0.3 , and it is anticipated that, by using special devices already available commercially, that accuracy may be raised to 0.008 . The recognition reliability is high for the bidimensional correlation techniques employed, and may be improved at will with recoursive and self learning processes. It may be appreciated from the foregoing that the invention achieves its objects. While the invention has been described with reference to specific embodiments thereof, it is susceptible to many modifications and variations without departing from the scope of the instant inventive concept. As an example, it will be apparent for the skilled one that the system may be implemented with more than three levels for recognition, at any desired degree of reliability, of the coordinates and shapes of objects having contours and occupying positions of a most varied sort, e.g. pieces on an assembly line, thus opening new prospects for interesting applications in the fields of industrial automation and robotics. Finally, the suitability of the system as a valuable aid to the medical, radiographic, and dental fields, where the need is greatly felt for taking repeated radiographies of a patient in the same posture conditions is indicated in such an application, for radiographies following the first, it will be enough to store, at dedicated memory devices, the marker position applied by the doctor in carrying out the first radiography, and take the following radiographies with the absolute certainty of exactly regaining the patient s original orientation, with great and obvious advantages. Another application may concern radiotherapy, to control the apparatus such as to facilitate and quantitatively control the change in position or repositioning of patients in picking up displays and or radiation therapies, e.g. with the following procedure It may be appreciated that for radiation therapy cycles, additionally to initial positioning, real time monitoring of the patient s instantaneous position, in combination with appropriate mathematic models, enables tracking of the region to be radiated, e.g. tumoral tissues, continuously and in a most accurate way.