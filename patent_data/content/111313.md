# METHODS AND APPARATUS FOR COMPLETING AN INCOMPLETE TRIP IN AN ELECTRONIC POSTAGE METER

## Claims
Verfahren zum Abschließen eines unvollständigen Ablaufzyklusses in einer elektronischen Frankiermaschine, die ein bistabiles Element 84 , welches Im Zyklus In Cycle und Ausgangs Home Zustände annehmen kann, um jeweils anzuzeigen, daß ein Ablaufzyklus abläuft bzw. daß kein Ablaufzyklus abläuft und einen Antriebsmotor 36A aufweist, um mechanische Operationen, die einem Ablaufzyklus zugeordnet sind, zu bewirken, umfassend die folgenden Schritte

## Description
The present invention relates to methods and apparatus for attempting to complete or completing an incomplete trip in a postage meter. The present patent application is related to copending U.S. Application Serial No. 447,815 US A 4 579 054 , a corresponding European application EP A 0 111 322 being filed on even date herewith in the name of the present Applicants, entitled Stand Alone Electronic Mailing Machine , the disclosure of which is hereby incorporated herein by this reference. A program listing for an electronic postage meter such as disclosed in the present application and in the aformentioned related patent application corresponding to U.S. Application Serial No. 447,815 is set forth as part of the file open to public inspection. US A 4 259 902 discloses an electronic postage meter having means for enabling completion of a printing cycle already commenced, even if proper accounting can no longer be performed. An unaccounted printing cycle is registered by means of a bistable element in the form of a mechanical latch. This latch has a position in which drive input to the posage meter is inhibited from being transmitted to the printing mechanism at the start of a printing cycle. However, this position is effective only if the state exists at the time of initiation of a printing cycle. Thus if power is lost during a printing cycle, the cycle will continue but no further cycle can be initiated. The present invention relates to electronic postage meters, and more particularly to electronic postage meters of the stand alone type such as disclosed in the aforementioned European copending application corresponding to U.S. Application Serial No. 447,815. Known electronic postage meters have generally comprised two separate units like their earlier mechanical forerunners, i.e. a postage meter and a base or mailing machine to enable the posage meter to be physically taken to the post office periodically to charge the meter. Such a meter is disclosed in United States Letters Patent 4,301,507, issued on November 17, 1981 and assigned to Pitney Bowes, Inc. of Stamford, Connecticut. With the advent of remote meter resetting systems, it is no longer necessary that the postage meter be separated into two distinct units since the necessity to take the meter to the post office for recharging has been eliminated. Further, it is desirable to have a self contained electronic postage meter that includes the metering function as well as all drive mechanisms to reduce the size and weight of the meter as well as making it more economical to produce. The mechanical construction of such a meter is disclosed in detail in the aforementioned European patent application corresponding to U.S. Application No. 447,815. With such electronic postage meters, it is desirable to attempt to complete a trip cycle should a malfunction occur during the trip cycle. A program for use with the stand alone postage meter of the type disclosed in the aforementioned related patent application of Danilo Buan is disclosed in the filed Program Appendix. There are similarities in the operation of this electronic postage meter and the electronic postage meter disclosed in the aforementioned patent with certain unique exceptions. One such exception is a subroutine for completing an incomplete trip during power up of an electronic postage meter as will be described more fully hereinafter. It is an object of the present invention to provide improved apparatus and method for trying to complete an incomplete trip during a trip cycle of an electronic postage meter. It is a further object of the present invention to provide improved apparatus and method for trying to complete the trip cycle by further initiating a trip. According to one aspect of the invention, there is provided a method for completing an incomplete trip in an electronic postage meter, comprising the steps of claim 1. According to a further aspect of the invention, there is provided apparatus for completing an incomplete trip in an electronic postage meter, comprising the features of claim 6. Other objects, aspects and advantages of the present invention will be apparent from the detailed description considered in conjunction with the preferred embodiment of the invention illustrated in the drawings, as follows Referring to Figure 1, the electronic postage meter includes an 8 bit microprocessor 10 CPU , such as an Intel Model 8085A microprocessor which is connected to various components through a system bus 12. ROM 14 is connected to the microprocessor 10 through the system bus 12. The ROM 14 stores the programs for controlling the postage meter. It should be understood that the term ROM as used herein includes permanently programmed and reprogrammable devices. An integrated circuit 16, which may be Intel Model 8155, is connected to the system bus 12 and includes RAM, input and output lines and a timer. The RAM portion of the integrated circuit 16 has memory space allocated for transient storage of the data for the ascending register and descending register. An external data communication port 18 is connected to the microprocessor 10 through optical isolator 20. The external data communication port 18 allows connection with devices such as an electronic scale, an external computer, servicing equipment and the like. Also electrically connected to the microprocessor 10 through the system bus 12 is the keyboard 22 of the postage meter and a non volatile memory NVM 24. Stepper motors 26, 28 are also in electrical connection with the microprocessor 10 via motor drivers 30 and the integrated circuit 16. A reset and power control 32 is electrically connected between the integrated circuit 16, the NVM 24 and the microprocessor 10. A relay 34 connects the AC printer motor 36 to the integrated circuit 16. A display 38 is also electrically connected to the integrated circuit 16. Trip photosensor 40 is connected to the microprocessor 10 through integrated circuit 16 to indicate the presence of an envelope to be stamped, as described more fully in the aforementioned European patent application corresponding to the U.S. application entitled Stand Alone Electronic Mailing Machine . The electronic postage meter is controlled by the microprocessor 10 operating under control of the programs stored in the ROM 14. The microprocessor 10 accepts information entered via the keyboard 22 or via the external communication port 18 from external message generators. Critical accounting data and other important information is stored in the non volatile memory 24. The non volatile memory 24 may be an MNOS semiconductor type memory, a battery augmented CMOS memory, core memory, or other suitable non volatile memory component. The non volatile memory 24 stores critical postage meter data during periods when power is not applied to the postage meter. This data includes an addition to the serial number of the mailing machine or postage meter information as to the value in the descending register the amount of postage available for printing , the value in the ascending register the total amount of postage printed by the meter , and the value in the piece count register the total number of cycles the meter has performed , as well as other types of data, such as trip status, initialization and service information, which are desired to be retained in the memory even though no power is applied to the meter. When an on off power switch 42 is turned on closed a power supply internal to the mailing machine energizes the microprocessor 10 and the balance of the electronic components. The information stored in the non volatile memory 24 is transferred via the microprocessor 10 to the RAM of the integrated circuit 16. After power up the RAM contains an image or copy of the information stored in the non volatile memory 24 prior to energization. During operation of the postage meter, certain of the data in the RAM is modified. Accordingly, when postage is printed, the descending register will be reduced by the value of the printed postage, the ascending register increased by the value of the printed postage and the piece counter register incremented. When the power switch 42 is turned off opened , the updated data in the RAM is transferred via the microprocessor 10 back into a suitably prepared area of the non volatile memory 24. A like transfer of information between the non volatile memory 24 and the RAM takes place during power failure. Referring to Figure 2, a more detailed block diagram of the arrangement of the electrical components for the postage meter is illustrated generally at 48. Power is supplied to the postage meter from the AC line voltage, typically 115 volts. This line voltage is applied to the meter through a hot switch 50 which cuts off power to the postage meter to protect the electrical components thereof if the temperature rises above a preset limit, nominally 70 C. The hot switch 50 is connected to the AC drive motor 36A through an RF filter 52 and an opto triac 54 which provides isolation between the line voltage and the control logic for the meter. The hot switch 50 is also connected to a transformer 56 protected by a fuse 58. The output of the transformer 56 is coupled to a pre regulator 59 through a cold switch 60. The cold switch 60 cuts off power to the pre regulator 59 if the temperature drops below a preset limit, nominally 0 C. The pre regulator 59 provides an output voltage of a predetermined range to a switcher 62 which generates the output voltage 5V and the voltages for generating 12V and 30V. The 5V is applied to a 3 volt regulator 64 and then to the display 38A. The 5V from the switcher 62 is also applied to a 5V filter 66 which provides 5V for logic circuits. Specifically, the 5V is applied to the keyboard 22A, the display 38A, and bank, digit and trip sensor logic 68 and to the integrated circuits. The 12V is applied to a 12V regulator 70 and then to the non volatile memory 24A. The 30V output from the switcher 62 is also applied to a 30V regulator 74 and then to a 30V switch 76 which switches its output voltage on and off in response to the requirements of writing in NVM as dictated by the program. The output of the 30V switch is applied to the non volatile memory 24A. The 30V supply is connected to the power on reset 72 of the microprocessor 10A. 5V from the switcher 62 is also supplied to one input of the power on reset 72 the other input receives 30V from the regulator 74 as previously described. A low voltage sensor 88 also receives one input of 5V from the switcher 62 and its other input from the pre regulator 59 its output is applied to the microprocessor 10A. The low voltage sensor 88 detects power failure and communicates this to the microprocessor 10A which in turn addresses the RAM through system bus 12A to transfer all security data present in the RAM to the non volatile memory 24A. Another output of the pre regulator 59 in the form of 24V is applied to the digit and bank motor drive 30A for the bank motor 26A and digit motor 28A, which selects the particular printing wheel bank which is to be activated and the particular digit of the selected printing wheel which is to be set. An output strobe from the integrated circuit 16A is buffered through buffer driver 68 and applied to digit sensor encoder 78 bank sensor encoder 80, and trip sensor 40A. The opto strobe applies power to the digit sensor 78, bank densor 80 and trip sensor 40A when needed. The output from the trip sensor 40A is applied to the input output lines 82 which are coupled to the integrated circuit 16A. The outputs from the digit sensor 78 and bank sensor 80 and a cycle switch 84 are applied to a store buffer 86. The cycle switch 84 is a bistable member having Home and In Cycle conditions. During power up, the key switch 42, see Figure 1, is closed, and the AC line voltage energizes the electrical components previously described and an Initialization process will occur. Such initialization may include a hard and or a soft initialization process as disclosed in the aforementioned United States Letters Patent 4,301,507. Preferably, the Initialization process is that described in the copending European application EP A 0 111 321 corresponding to U.S. Application Serial No. 447,913 and filed on even date herewith in the name of the present Applicants, the U.S. Application being entitled Initializing the Print Wheels in an Electronic Postage Meter . In operation, the microprocessor 10A under control of the ROM 14A and possibly the auxiliary ROM 100 communicates over the address bus 94 and control bus 98 with the device select 98. The output of the device select 98 communicates with the particular module to be addressed over select lines 99. The modules to be addressed are the RAM, the ROM 14A, an auxiliary ROM 100, a demultiplexer 102, NVM logic 104 and the buffer 86. The RAM of integrated circuit 16A provides the working memory for the postage mater and the microprocessor 10A. The ROM 14A stores the program the auxiliary ROM 100 may be used to provide additional program storage space. The non volatile memory 24A provides storage of all security information for the meter and retains such information during power down or power failure. The demultiplexer 102 latches the lower eight 8 bits of address information that defines a particular location which is used immediately thereafter. The NVM logic 104 controls the mode of operation of the NVM 24A and also provides ready wait and NVM ready signals to the microprocessor 10A to indicate the presence of the slow speed device NVM as active on the bus 12A. As previously mentioned, the digital sensor 78 optical encoder and bank sensor 80 optical encoder and cycle switch 84 whose current state is read, i.e. Home or In Cycle , apply input signals to the buffer 86 which sends output signals over data bus 108 to the microprocessor 10A for storage in the proper RAM location. The RAM is also electrically coupled to I O lines to transmit or receive data from the trip sensor 40A, the display 38A, keyboard 22A, and privilege access switch 110, if present. The privilege access switch 110 may be used in applications which require manual resetting of meter postage via a switch which is kept under seal. A program listing for the postage meter described in the aforementioned patent application entitled Stand Alone Electronic Mailing Machine is set forth in the filed Program Appendix. Referring to Figure 3, a portion of the DOTRIP Routine is illustrated therein as 120. The complete DOTRIP Routine is set forth in the aforementioned related patent applications, the disclosures of which are incorporated herein by reference. After the postage meter is properly initialized during power up and the desired postage values are set via the keyboard 22A, the postage meter is ready for the trip cycle or the printing of postage on an envelope. See the aforementioned European patent application corresponding to the U.S. application entitled Initializing to Print Wheels in an Electronic Postage Meter . To commence a trip, an envelope is inserted in the throat of the postage meter. The end of the envelope is sensed by the trip sensor 40A which sends a signal to the RAM which communicates with the micro processor 10A under control of the program in the ROM 14A to begin the trip cycle, as illustrated as the DOTRIP Routine 120 in Figure 3. Additionally, the meter may be tripped by an external trip as disclosed in copending European application EP A 0 111 316 corresponding to U.S. Application Serial No. 447,925 and filed on even date herewith in the name of the present Applicants, the U.S. application being entitled Controlling Firmware Branch Points in an Electronic Postage Meter . When the DOTRIP Routine 120 commences, the display 38A is blanked and the timer which provides a blinking display is deactivated. The position of the bistable cycle switch 84 is then read by reading its current state. This current state is then stored in the storage buffer 86 and eventually communicated to the RAM. If the cycle switch is in its Home or off position, the routine proceeds. However, if the cycle switch is In Cycle current flowing , FINTR2 sequence occurs and a fatal error is declared and logged by setting a bit in non volatile memory 24A. The meter is then locked up and rendered non functional. If the cycle switch 84 is Home not in cycle , certain flags or bits are then set. Specifically, the following bits are set The UNKSEL and QUEREG bits are transmitted from the RAM 16A to the non volatile memory 24A. The trip lever 142 of the selection mechanism is then moved under control of the microprocessor 10A from its lock position to its trip position, see Fig. 6. A sensor sends a flag to the microprocessor 10A to indicate whether this movement was accomplished. If it is not accomplished, a fatal error is declared and logged by setting a bit in the non volatile memory 24A. The meter is then locked up and rendered inoperative. If the move is okay, the AC drive motor is energized and the power down interrupt is disabled so that the postage can be accounted for by undergoing a DOACCT Subroutine similar to that disclosed in the aforementioned United States Letters Patent 4,301,507. In the DOACCT Subroutine, the value of the ascending register in the RAM is increased to the value present in the ascending register plus the preset postage value which was just used in printing postage on an envelope. Thereafter a new cyclic redundancy character CRC is computed for the ascending register. The descending register in the RAM is then reduced to the present value in the descending register minus the preset postage value which was just used in printing postage on an envelope. Likewise, a new cyclic redundancy character is computed for the descending register. The value of the piece count register in the RAM is then incremented to the value present in the price count register plus one 1 to account for the piece of mail just stamped with preset postage. The DOACCT Subroutine is then completed and its completion is reported to the superordinate process, e.g., the DOTRIP. After completion of the accounting Subroutine DOACCT, another flag or bit is set INCYC TRUE. If INCYC FALSE, the DOTRIP routine has not progressed far enough to complete the accounting. The INCYC bit is transmitted from the RAM to the non volatile memory 24A. After setting INCYC TRUE, the power down interrupt is then enabled once again. A period is then entered where the cycle switch 84 must change from Home indication to In Cycle indication before a predetermined period of time has elapsed, e.g. 20 milliseconds. If this time period expires and the cycle switch 84 still yields a Home indication, a fatal error is declared and stored in non volatile memory 24A and the remainder of the trip is attempted to be completed by procedure FINTRP. If the cycle switch is found to be In Cycle the normal case the cycle will be continued e.g. according to the FINTRP routine 130. In the FINTRP Routine 130, the AC drive motor 36A is activated. After 200 milliseconds the cycle switch 84 is read. If the cycle switch 84 is Home, the AC drive motor is de energized, INCYC set FALSE, UNKSEL set FALSE and normal status is returned to the executive. If the cycle switch 84 is In Cycle, the cycle switch 84 is read every 100 millisec for a maximum period of 800 millisec. If during this period the cycle switch 84 is Home, the AC drive motor 36A is deactivated, INCYC set FALSE, UNKSEL set FALSE and normal status is returned to the executive. If the cycle switch 84 is still In Cycle at the end of the 800 millisec., the AC drive motor is de energized and a fatal error is declared and logged in the NVM 24A and error status is returned to the superordinate process. From the foregoing description, it is apparent that the subroutine of the present invention provides for completion of the trip cycle in those situations where the cycle switch has stopped is Home during the trip cycle incomplete trip . If the trip cycle is properly completed, further trips may be undertaken. However, if the trip cycle cannot be properly completed after repeated attempts during power up, a fatal error is declared and stored in a particular address of the NVM 24A, effectively locking up the postage meter and rendering it inoperative. However, if during each power up the trip mechanism is moved some small amount toward completion of the trip cycle, after several power up cycles, the trip will be completed and the meter will again be fully functional. Referring to Figs. 5 and 6, the trip selection mechanism for an electronic postage meter of the type disclosed in the aforementioned copending European patent application corresponding to the U.S. application entitled Stand Alone Electronic Mailing Machine , is illustrated generally as 140 and 180, respectively. Further, details regarding the trip selection mechanism and the other mechanical components of such an electronic postage meter may be obtained from this aforementioned patent application, the disclosure of which is incorporated by reference as previously noted. The trip selection mechanism 140 includes a trip lever 142 affixed to a rotatable trip shaft 144 adjacent to one end thereof for engagement and disengagement with a clutch 145. The trip shaft 144 also includes a gear 146 affixed thereto for engagement with and rotation by a gear 148 affixed to a tri lobed shaft 150. A stepper motor 28A includes an output shaft 152 having a gear 154 and an optical encoder disk 156 not to scale mounted on the output shaft 152. The optical encoder disk 156 is received within a sensor 158 so that the position of the stepper motor shaft 152 can be determined. The gear 154 engages a gear 157 affixed to the tri lobed shaft 150. The gear 148 is disposed within an opening of a carriage 160. In operation, as seen in Figs. 5 and 6, the stepper motor 28A is energized to rotate the stepper motor gear 154 and the gear 157 affixed to the tri lobed shaft 150. Rotation of the tri lobed shaft 150 rotates gear 146 affixed to the trip shaft 144 which rotates gear 146 affixed to the trip lever shaft 144 out of engagement with a carriage slot 164, thereby freeing the carriage 160 for movement along the tri lobed shaft 150. As shown in Figs. 5 and 6, the trip shaft 144 and trip lever 142 are in their home or middle position. The down position of the trip lever 142 is the set position. The up position of the trip lever 142 is the trip position. In the middle or intermediate position of the trip lever 142, as shown in Fig. 6, a locked condition exists. Rotation of the trip lever 142 to the set position disengages the locking lever 162 from the carriage slot 164 and allows movement to be imparted to the carriage 160 in either direction along the tri lobed shaft 150 for selecting the appropriate bank of the print wheels not shown in response to energization of bank stepper motor 26A which moves gear 166 via stepper motor gear 168. The individual digit of the desired print wheel is then selected by the stepper motor 28A which rotates the tri lobed shaft 150 and thus gear 148 which is engageable with the teeth of a selected one of four print wheel racks 170. It is known and understood for the purpose of the present application that the term postage meter refers to the general class of device for the imprinting of a defined unit value for governmental or private carrier delivery or parcels, envelopes or other like application for unit value printing. Thus, although the term postage meter is utilized, it is both known and employed in the trade as a general term for devices utilized in conjunction with services other than those exclusively employed by governmental postage and tax services. For example, private, parcel and freight services purchase and employ such meters as a means to provide unit value printing and accounting for individual parcels.