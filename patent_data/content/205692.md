# IMPROVEMENTS IN MICROPROCESSORS

## Claims
Mikroprozessorsystem, das aufweist eine Prozessoreinheit 20 , einen Festspeicher 21 , einen Speicher 22 mit wahfreiem Zugriff und eine Eingabe Ausgabe Einheit 23 , die durch einen Steuerbus 26 angeschlossen ist, einen Datenbus 25 und einen Adreßbus 27 und das zumindest einen ersten Arbeitsmodus und einen zweiten Arbeitsmodus zum Erzeugen von Speicherstellenadressen aufweist, gekennzeichnet durch eine Einheit 22 zum Zuordnen, die zwischen die Prozessoreinheit und den Adreßbus geschaltet ist und Mittel 30 zum Liefern eines Aktivierungssignals an die Einheit zum Zuordnen, wenn Modi geändert werden, wobei die Einheit zum Zuordnen auf das Aktivierungssignal anspricht, um durch den Prozessor erzeugte Adreßworte selektiv zu ändern.

## Description
This invention relates generally to improvements in microprocessors and in particular to apparatus and a method for switching the operating mode of a microprocessor to allow a more efficient use of the machine. Microprocessors are defined as the physical realisation of the central processing unit of a computer system on either a single chip of semiconductor or a small number of chips, New Penguin Dictionary of Electronics. 1979 . Microprocessors usually consist of an arithmetic and logic unit, a control unit and a memory unit. Microprocessors are characterised by speed, word length, architecture and instruction set, which may be either fixed or microprogrammed. The combination of these characteristics determines the performance of the processor. Most microprocessors have a fixed instruction set. Microprogrammed processors have a control store containing the microcode or firmware that defines the processor s instruction set such processors may either be implemented on a single chip or constructed from bit slice elements. The processor s architecture determines what register, stack and I O facilities are available, as well as defining the processor s primitive data types and how addresses are derived from its registers. The data types, which are the fundamental entities that can be manipulated by the instruction set, typically include bit, nibble 4 bits , byte 8 bits , word 16 bits , and on the latest microprocessors, double words 32 bits . A word is usually defined as the number of bits in the processor s internal data bus rather than always being 16 bits. Instructions generally include arithmetic logical, flow of control, and data movement between stacks, registers, memory, and I O ports . The first microprocessor, the four chip set Intel 4004, appeared in 1971. A calculator that could implement a simple set of instructions in hardware but permitted complex sequences of them to be stored in a read only memory ROM . A four chip set consisting of a CPU, ROM, RAM, and a shift register chip. The Intel 4004 had a 4 bit data bus, could address 4.5K bytes of memory, and had 45 instructions. Its 8 bit counterpart, the Intel 8008, was introduced in 1974 and its improved derivative, the Zilog Z 80, in 1976. Current microprocessors include the Zilog Z8000, Motorola 68000, Intel 8086, National 16000, as well as the older Texas Instruments 9900 and Digital Equipment Corporation LSI 11. All of these chips use a 16 bit wide external data bus. Still higher performance microprocessors using 32 bit external data busses are now beginning to appear. An article in the IBM Journal of Research and Development Volume 29, No 2, March 1985 entitled Microprocessors in brief by Robert C Stanley gives an overview of the past, present, and future of microprocessors and describes the key elements of their structure and operation. One of the problems that has arisen through the development of families of microprocessors is maintaining compatibility between succeeding generations so that programs developed to run on earlier machines are also able to run on later processors while, at the same time, new programs are able to make use of extended features, such as larger memory capacity. An example of this problem is found in the IBM Personal Computer IBM PC and compatible machines. IBM is a Registered Trade Mark . The original IBM PC used the Intel 8088 processor and had a random access memory RAM of 640K bytes. A recent version of the IBM PC, the IBM PC AT, uses the more powerful Intel 80286 microprocessor and can have up to 14.6M bytes of RAM. The 80286 has the same instruction set as the 8088 with some extensions, and has two modes of operation, real mode and protected mode. The modes define the method of deriving addresses from the contents of registers. In real mode addresses are derived in exactly the same way as is used in the 8088 with the result that programs written for the 8088 will work on the 80286 in real mode, but with no access to the additional memory. In protected mode a different method of deriving addresses is used which allows access to all memory of the machine, but unfortunately prevents programs not specifically designed to operate on the processor in protected mode from working. It may be noted here that other methods of increasing the addressing capability of a microprocessor have been devised. For example, as reported in PC WEEK 30 April 1985, Intel and Lotus are making available for the IBM PC a special memory card with up to 4 Meg of memory utilizing bank switching , and Lotus is providing special versions of its software that exploit the additional memory. This method has the advantage that it can be used on existing PCs but it too appears to require programs to be changed to exploit the additional memory. It is of course possible to modify programs so that they will run in protected mode, and many programs will be so modified. However, while popular application programs have not been modified the computer system must be able to run these did run modified programs, in other words it must be possible to switch modes. The 80286 provides an instruction to switch from real to protect mode, but does not provide an instruction to switch back. Therefore to switch from protected to real mode requires circuitry external to the 80286 to cause a reset of the 80286. Reset of a microprocessor is caused by applying a pulse to its RESET input. The microprocessor clears all its internal registers and begins to fetch, instructions from a fixed address. This address will usually be a Read only Memory of the computer system and will contain the first instruction of the power on routine which checks out the basic operation of the processor and other parts of the computer system. When the computer is first turned on, external circuitry generates a RESET pulse for the microprocessor after all power levels are stable. After RESET, 80286 begins execution in real mode. The IBM PC AT uses reset for mode switching, and incorporates Step 1 here takes considerable time and is unnecessary when mode switching, so it might be suggested that this routine could be improved by reversing the order of steps 1 and 2. This would be considered poor practice in modern computer systems because an error that would cause a diagnostic check in step 1 may lead to an invalid outcome of Step 2. US 4,228,502 describes an electronic computer system with means for inhibiting automatic program load which would otherwise be carried out in response to power on or system rest. It does not, however, address the problem of switching addressing modes in microprocessors. It is an object of the present invention to provide a solution to the problem of switching modes of operation for the generation of memory location addresses in microprocessor systems that is faster than the solution described above and embodied in the IBM PC AT. Accordingly, in accordance with a first aspect of the present invention there is provided a microprocessor system comprising a processor unit, a read only memory, a random access memory and an input output unit connected by a control bus, a data bus and an address bus and which has at least a first mode and a second mode of operation for the generation of memory location addresses, characterised by a remapper unit connected between the processor unit and the address bus and means for providing an enable signal to the remapper unit when changing modes, the remapper unit being responsive to the enable signal to selectively change address words generated by the processor. The additional speed results from the use of the remapper which changes some addresses before they reach the memory. This additional hardware circuitry enables the mode switch registering circuits to be dispensed with. In particular, the remapper enables a start up address to be changed so that the first address executed after reset is in a mode switching routine rather than in a power on routine. Preferably, therefore, a power on start up control program is stored at an address which is generated by the processor unit on receipt of a reset signal and the remapper, when enabled, causes said address generated by the processor unit to be mapped onto the address at which a mode switching control program is stored. The mode switching control program is preferably stored at an address which differs by one bit from the address of the power on start up program the remapper unit being preferably being connected to receive one bit of each address word generated by the processor unit and, when enabled, replacing the value of said one bit with a different value. In accordance with a second aspect of the present invention, there is provided a microprocessor system comprising a processor unit, a read only memory, a random access memory and an input output unit connected by a control bus, a data bus and an address bus and which has at least a first, real, mode and a second, protected, mode of operation for the generation of memory location addresses, the processor unit issuing an instruction to change from the first mode to the second mode, characterised by a remapper unit connected between the processor unit and the address bus and means for providing an enable signal to the remapper unit when changing from the second mode to the first mode, the remapper unit being responsive to the enable signal to selectively change address words generated by the processor. In order that the invention may be fully understood a preferred embodiment thereof will now be described with reference to the accompanying drawings in which Figure 1 is a block schematic of a microprocessor central processing CPU chip. Figure 2 is a simplified block schematic of a microprocessor system embodying the invention. Figure 3 illustrates the preferred embodiment of the remapper. Referring now more particularly to the drawings, a typical microprocessor CPU chip consists of several separate logical sections as shown in Figure 1. A control ROM read only memory 1, decodes instructions one at a time and directs the operation of the rest of the CPU chip. A timing and sequence logic unit 2 steps each operation through in its proper order. An ALU arithmetic logic unit 3 performs basic arithmetic and logical operations on operands that are fed through it. There are normally a number of registers of various sizes located on the CPU chip itself. Address pointer registers 4,5,6 the width of which is dependant on the size of memory the system is designed to handle and on whether the memory being addressed is in the CPU or external to it. There are data registers 7,8,9,10, for storing and transferring data, and at least one of these registers is normally a special purpose working register called an accumulator 10. The accumulator 10 is involved in most of the data oriented activity on the CPU. The results of most of the ALU operations are sent to the accumulator, and its contents are quite often used as one of the operands. Connecting all of these elements is a data bus 11 whose width is determined by the microprocessor word size. The data bus, with bidirectional buffers 12 at the boundary of the CPU chip, becomes the local system data bus and acts as the information path connecting all data related elements in the system. The contents of the active address pointer register generally, follow a separate path 14 to the boundary of the CPU chip, where it passes through address buffers 13 to become the local system address bus. A 16 bit address bus allows addressing of 65,536 often referred to as 64K separate memory locations, and a 20 bit address bus allows for over a million or 1M . A 24 bit address gives 16M possibilities. In an effort to reduce the number of pins on the CPU package, some microprocessors multiplex some portion of the address bus and data bus on the same group of pins as they leave the CPU chip. This saves pins on the CPU, but requires that extra hardware be added to create individual address and data buses to serve the rest of the system. This is of little consequence in larger systems, however, because the local address and data buses must be buffered again before being distributed to a large number of memory and peripheral chips, and the demultiplexing and buffering can both be done by the same devices. The address bus is unidirectional only, out of the CPU, but the data bus is bidirectional and must be buffered in both directions. Figure 2 shows the processor of Figure 1 20 connected to read only memory ROM 21, Random Access Memory RAM 22, and a set of input output control units 23. The data buffers 12 of the processor are connected through the data bus 25, the control bus 26 connects the ROM, RAM and I O units to the control and timing unit 2 and the address buffers 13 are connected through a bus 27 to an address remapper unit 24 Fig 3 and then through bus 28. A reset line 29 connects the I O unit 23 to the processor and a set line 30 connects the I O unit to the address remapper. In the preferred embodiment of the invention, the ROM, 21 responds to addresses in the ranges 936K 1Meg and 15.936 Meg to 16 Meg. The RAM responds to addresses in the ranges 0 640K and 1Meg 15Meg. The ROM contains the power on routine, and the RAM contains the mode switch routine. The address remapper unit 24 is shown in detail in Figure 3. The address bus 27 has 24 bit lines A0 23 of which A20 is connected to the remapper unit which is a two input multiplexor chip 24. The second input to the chip 24 comes from the I O slave processing chip 23. Microprocessor chip 20 also receives an input from chip 23 on the reset line 29. When the microprocessor receives an input signal to indicate that it should start operation its first action is go to its power on address where is found the Power on self test routine POST . The power on address in hexadecimal is expressed as FFFFFO 24 bits . The remapper shown in Fig 3 allows the processor to by pass the POST routines for the purpose of mode switching as follows. A Mode Switching Routine is stored in RAM 22 at the address EFFFFO which is one bit, in the most significant four bits, different than FFFFFO the address of POST . When the remapper is activated by a 1 value on its select input from the I O units, whatever value appears on line A20 is converted to a 0 bit before being passed on to the rest of the computer system. If the I O units now generate a reset online 29 the restart address is converted to EFFFFO which is the mode switching routine address. The mode switching routine performs the following actions The preferred embodiment of the remapper described above is as simple as possible, but remaps half the addresses of the machine. However, it should be clear that a more complex remapper could be devised which changes fewer addresses. In particular, a remapper which changed only the addresses of the first instruction of the start up routine would be ideal, but would require more circuits. The mode switching routine described above activates and releases the remapper on every switch. The preferred embodiment does not do this but leaves the re mapper permanently active after initial start up.