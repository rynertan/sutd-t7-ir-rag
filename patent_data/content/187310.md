# REAL TIME CLOCK SYNCHRONIZATION

## Claims
Verfahren zum Synchronisieren eines digitalen Zeitgebers mit der Frequenz einer Wechselspannungsquelle, wobei der Zeitgeber erste und zweite periodische Zeitsignale erzeugt und die Periodendauer der zweiten Zeitsignale ein ganzzahliges Vielfaches der Periodendauer der ersten Zeitsignale ist und das Verfahren folgende Schritte aufweist

## Description
This invention relates to synchronizing a digital timer with the frequency of a source of A.C. electric power such as is provided by an electric utility. Digital timers which maintain current, or real time, time utilizing clock signals produced by crystal controlled oscillators, or clocks, are well known. Relatively low cost clocks of reasonable accuracy of .05 , for example, are satisfactory for digital timers which are required to maintain real time over shorter periods of time, or where precise accuracy is not a requirement. Longer term stability of the clock signals applied to a digital timer can be achieved by using clocks which are more accurate, but the cost of achieving a significantly higher degree of accuracy over long periods of time, measured in weeks, months, or years, as is required in process control systems is significantly high. Thus, there is a need for a lower cost more reliable way to achieve long term stability with the desired degree of accuracy for digital timers using conventional reatively low cost digital clocks. A very reliable source of real time timing information which is generally available is the frequency of A.C. electric power from public utilities. The utilities, over long periods of time maintain, or control, the accuracy of the frequency of the A.C. power such that it normally does not deviate by more than one cycle per second over long periods. Thus, the frequency of such an A.C. source is available as a timing reference at essentially no cost. However, there are two standard frequencies at which A.C. power is supplied, 60 cycle and 50 cycle. Thus a digital timer, or timing subsystem, that is to be used in equipment essentially worldwide must be able to synchronize itself with a source operating at either frequency if it is to use the frequency of such sources as a timing reference to obtain long term stablility with the desired degree of accuracy. US A 43 22 831 describes a programmed digital secondary clock which functions as a master clock, a sub master clock or a slave clock. The master clock maintains an updated real time count based on a 50 Hz or 60 Hz a.c. line or digital oscillator signal, displays the count, and serially transmits digital information representative of the updated real time count for use by a slave clock. The a.c. power source is used for providing real time clock signals. It is therefore an object of this invention to provide a method of synchronizing a digital timer to the frequency of a source A.C. electric power, in particular which can be used with frequencies of 60 Hz and 50 Hz as well. Long term stability with the required degree of accuracy at minimum cost is a further task. These objects are achieved by the invention as characterized in claim 1. Further details are described in the subclaims. The present invention provides a method of synchronizing a digital timer with the frequency of a source of A.C. power to provide long term stability in accuracy to the real time maintained by the timer with the desired degree of accuracy. The timer produces internal, fine resolution, synchronization, and real time, timing signals, with the real time timing signals having a period of one second. The periods of each of the above timing signals is an integral multiple of the period of the clock signals produced by a crystal control oscillator, or clock. A.C. reference timing signals are produced which are a function of the frequency, 50 or 60 H Other objects, features and advantages of the invention will be readily apparent from the following description of certain perferred embodiments thereof taken in conjunction with the accompanying drawings, in which In Figure 1, timer 10 corresponds to the timing subsystem of a module control processor unit MCPU of a local area network described in concurrently filed EP application 85 116 059.8 EP A 0 185 348 entitled METHOD AND APPARATUS FOR SYNCHRONIZING THE TIMING SUBSYSTEMS OF THE PHYSICAL MODULES OF A LOCAL AREA NETWORK. The key component, or subsystem of timer 10 is a single chip timer microprocessor 12, an Intel 8051 in the preferred embodiment. Timer microprocessor 12 receives commands and data from its accociated MCPU processor, which is not illustrated in Figure 1, over the MCPU processor s local bus 14 by means of command register 16. Timer microprocessor 12 transmits information to its associated MCPU processor utilizing bus 14 and register file 18 and interrupt generator 20. For a complete description of all of the subsystems of timer 10, reference is made to the concurrently filed application identified above. Applied to timer microprocessor 12 are clock pulses, or timing signals, from crystal controlled module clock 22. In the preferred embodiment, module clock 22 produces clock pulses having a frequency of 9.6 x 10⁶ H The frequency of the A.C. reference timing signals is a function of the source of A.C. electric power applied to module power supply 24 from a Conventional source of electric power, such as an electric utility. The frequency of the A.C. power is normally either 50 H Timer 12 maintains its own, or its internal sense of time. To do this microprocessor 12 performs certain operations and stores in designated registers its internal sense of time. In Figure 2 the relationship between the various timing signals and how they are produced is illustrated. In addition, the internal registers of timer 12 utilized in the performance of this invention are also illustrated. Clock signals from module clock 22 having a frequency of 9.6 x 10⁶ .05 H The 100 µ sec. fine resolution signals from counter 28 are applied to accumulated ticks register ATR 33 and course resolution interpolation register CRIR 34. ATR 33 is a two byte register in which is stored the number of 100 µ sec. signals, or periods, in the present synchronization period of 50 m sec. CRIR is also a two byte register in which is stored the number of 100 µ sec. periods, or signals, in the present, or current, or one second period. Synchronization timing signals produced by counter 30 are applied to accumulated synchronization timing signal ASTS register 36. ASTS register 36 is a one byte register in which are stored the number of 50 m sec. period, or synchronization timing signals, produced in the current one second period. One second, or real time, timing signals produced by counter 32 are applied to course resolution accumulated seconds CRAS register 38. CRAS register 38 is a four byte register in which is stored the current, or real time. This data constitutes the current time in terms of years, months, days, hours, minutes, and seconds of the current century expressed in seconds. Figure 3 is a diagram of A.C. reference timing generator circuit 40. Fifty or sixty cycle A.C. power from generator 42 at either 110 or 220 volts is applied across primary coil 44 of step down transformer 46. The wave form A illustrated in Figure 4 is that of the voltage induced across the secondary winding, or coil, 48 of transformer 46. The frequency of this voltage is the same as that produced by generator 42. The voltage across coil 48 is full wave rectified by diodes 50 and 51 and produce the wave forms B as illustrated in Figure 4 across resistor 52. The frequency of the voltage across resistor 52 is twice that of generator, or source, 42. The voltage across resistor 52 is applied to the noninverting input terminal of operational amplifier 54. The inverting input terminal of operational amplifier 34 is connected to a reference voltage source. Operational amplifier 54 produces as its output square waves C as illustrated in Figure 4 the A.C. reference timing signal. The A.C. reference timing signal produced by circuit 40 has a frequency which is twice that of the source of an A.C. power applied to module power supply 24 and circuit 40. Figure 5 is a flow chart of the power line synchronization interruput service routine PLS ISR program that is executed by timer microprocessor 12 on each high to low transition of an A.C. reference timing signal produced by circuit 40 after timer microprocessor 12 is commanded by a command transmitted to it through command register 16 to synchronize on the frequency of its source of A.C. power. Upon initialization which occurs after power is first applied, or after a master clear recovery command has been executed, timer microprocessor 12 determines the frequency of its power supply. To do this it counts the number of A.C. reference timing signals received, more particularly the number of high to low transitions of the A.C. reference timing signal received in a 50 m sec. period. The number so received will be 5 if the source of A.C. power is operating at 50 H When timer microprocessor 12 after inialization is commanded to synchronize to the frequency of its source of A.C. power, it enters into or starts executing its PLS ISR on each high to low transition of the A.C. reference timing signal. On the first entry into the program, the contents of ATR 33, the number of 100 µ sec. periods that have elapsed or occurred in the current 50ms. On the second such transition, and each such transition thereafter, timer microprocessor 12 enters or starts executing it s PLS ISR. The first action taken is to decrement PSYCNT 60 by 1 and to check to see if its contents are zero. If the contents of counter 60 are not zero, the program control is returned to the interrupted routine. Each time the contents of PSYCNT 60 equals zero, timer microprocessor 12 is commanded by the program to subtract the contents of LSMR 58 from that of ATR 33 to determine X . If the absolute value of X is less than 3, the internal sense of time of timer microprocessor 12 is too slow if X is negative, is correct if zero, and too fast if X is positive. If the absolute value of X is 3, an error is deemed to have occurred. If X is negative and less than 3, timer microprocessor 12 sets power synchronization adjustment PSADJ register 62 to instruct timer 12 s 1000 µs interrupt service routine ISR to adjust counter 28 to produce the next 100 µs signal 50 µs earlier and the contents of R5060 register 56 are copied into PSYCNT 60. When these steps are completed, the PLS ISR returns to the interrupted progrm. If X is positive and less than 3, the PLS ISR causes PSADJ register 62 to be set to instruct the 100 µs. ISR to adjust counter 28 to produce the next 100 µ sec. signal 50 µ sec. later, the contents of R5060 register are copied into PSYCNT 60, and the PL ISR returns to the interrupted program until the receipt of tthe next A.C. reference timing signal. If X 0, PSADJ 62 is cleared and no adjustment is made to counter 28 by the 100 µ sec. ISR. The contents of R5060 are loaded into PSYCNT 60 and the PLS ISR returns to interrupted program until the receipt of the next A.C. reference timing signal. If the absolute values of X or exceeds 3, the PLS ISR causes an error flag bit PWRFG of PSADJ register 62 to be set. The contents of ATR 33 are copied into LSMR register 58, and the contents of R5060 are copied into PSYCNT 60. PLS ISR then returns to the interrupted program. If three error conditions, i.e. lXl 3 occur in any one second period, PLS ISR will be disabled and will remain so until timer microprocessor 12 is again commanded to synchronize on the frequency of its source of A.C. power. The PLS ISR checks to determine that every 5th A.C. reference timing signal for 50 H In Figure 2 the registers of timer microprocessor 12 utilized in practicing the method of this invention are illustrated. In the preferred embodiment addressable memory locations of the internal random access memory of microprocessor 12 are used as registers. From the foregoing it is believed obvious that this invention provides a method of synchronizing a digital timer to the frequency of a source of A.C. electric power to permit the timer to maintain its internal sense of time very accurately over long periods of time with the minimum of complexity and cost.