# CIRCUIT FOR DERIVING A GAIN CONTROL AGC VOLTAGE

## Claims
Schaltung zum Ableiten einer Verstärkungssteuerspannung, deren Wert variiert, so daß sie verwendet werden kann, um Veränderungen in der Amplitude einer Wechselspannungswelle entgegenzuwirken, mit

## Description
The present invention relates to a circuit for deriving a gain control AGC voltage in accordance with the preamble to claim 1 EP A 0 161444 . Some circuits for deriving a gain control utilize a rectifying circuit having a diode connected between a source of the alternating current wave and a parallel combination of a capacitor and a resistor. When the amplitude of successive peaks of the wave is increasing, the capacitor is charged by current flowing through the diode so as to increase the voltage across the capacitor and when the amplitude of successive peaks is decreasing, the capacitor is discharged by charge leaking through the resistor so as to decrease the voltage across the capacitor. Whereas the time constant of the charging circuit can be made so short as to enable the voltage across the capacitor to follow rapid increases in the amplitude of the peaks, it is necessary for the time constant of the discharging circuit, which is the product of the resistance of the resistor and the capacitance of the capacitor, to be a compromise between the value required to permit the voltage across the capacitor to follow a sharp decrease in the amplitude between successive peaks and the value required to prevent a significant drop in voltage across the capacitor between peaks in a situation where the amplitude of the peaks remains constant. Thus, the automatic gain control voltage across the capacitor can follow sudden increases in amplitude of the wave but does not follow sudden decreases in its amplitude as well. In relation to the said circuits thus described, the characterizing circuit according to EP A 0 161444 solves the technical problem of improving those circuits in such a way the at the AGC voltage follows a decrease in amplitude of the alternating current wave more rapidly. EP A 0 161444 was published after the application of the present invention. The mentioned aim is accomplished by providing two charging means for respectively charging and discharging the capacitor across which the automatic gain control voltage is to be developed and controlling these charging means in response to the amplitude of the alternating wave in such manner that the ratio of the charges they pass during a a cycle of the alternating wave depends on wether the amplitude of the wave is greater or less than a predetermined value at which the charges passed are the same. The charge and discharge time constants can be made the same and short enough to permit the automatic gain control voltage to follow sudden changes in the amplitude of the wave in either direction while at the same time permitting the voltage to remain constant in a situation where there is no change in the amplitude of the wave. It is also possible to make the time constants long and or different, if desired. The one charging means may be enabled for a shorter period but is capable of supplying more integrated current during its portion of a cycle so that there will be an amplitude of the wave at which the charge supplied by the one charging means will equal the charge removed by the other charging means. A simple way of achieving regulation then is to enable one of the charging means during a period when a half cycle of the wave exceeds a given level and to enable the other charging means during a shorter period when the half cycle exceeds a higher level. As the amplitude of the wave varies, the ratio of the lenght of the periods during which the charging means are respectively made operative will also vary. At the desired amplitude of the wave, the charge added to the capacitor by one charging means during its period of enablement is the same as the charge removed from the capacitor by the other charging means during its period of enablement so that the net change in charge is zero and the voltage across the capacitor has the same value after the periods that it had before they began. Should the amplitude of the wave increase, the ratio of the lenght of the periods changes so that there is a net change in voltage across the capacitor in one direction. Should the amplitude of the wave decrease, the ratio of the lengths of the periods changes oppositely so that there is a net change in charge on the capacitor that causes a change in voltage across it in the opposite direction. If, as in some embodiments, the charging means are current sources controlled by portions of the wave occuring during their respective periods of enablement, the current gain of the source having a shorter period should be greater than the current gain of the source having the longer period. In another embodiment having constant current sources that are enabled for periods of different lenght, the amplitude of the constant current supplied by the source having the shorter period should be greater than the amplitude of the constant current supplied by the other source. Exemplary embodiments of the above circuits will now be described with reference to the accompanying drawings. Figure 1 is a schematic diagram of an automatic gain control AGC system utilizing a circuit that derives an AGC voltage. An unregulated alternating current AC voltage source 2 is coupled to means 4 for controlling its amplitude in accordance with an AGC voltage produced on a lead 6 by an AGC circuit 8. The regulated AC voltage is supplied to any desired load 9 via a lead 10. A capacitor 12 is connected between the output of the amplitude control means 4 and the bases of dual NPN transistors Q₁ and Q₂, and a resistor 14 is connected between the bases and a point of potential V. Q₂ is a current source providing the current I₂. Resistors 16 and 18 are respectively connected between the emitters of Q₁ and Q₂ and V so that the collector currents will be proportional to base voltage above V Operation of the AGC circuit 8 is as follows. As Q₂ turns on during positive half cycles, it draws current I₂ from the capacitor C so as to charge the capacitor C negatively. Initially, Q₁ s collector current merely causes a voltage drop across the resistor 20 and 22, but as this current increases it begins to turn on the current source Q₃. If Q₃ has a sufficient beta, its collector current I₁ will increase more than the incremental increase in Q₂ s collector current I₂ above the point where Q₃ starts to conduct. Therefor, even though it starts to conduct later, Q₃ collector current can quickly exceed that of Q₂. The period of conduction of the current source Q₂ that supplies I₂ is longer than the period of conduction of the current source Q₃ that supplies the current I¹. The current I₃ flowing through the output capacitor C is the difference between I₁ and I₂. There is a given peak amplitude of the AC voltage at the output of the amplitude control means 4 which will cause Q₂ s and Q₃ s integrated collector currents occuring during each positive half cycle to be equal so that no net charge is delivered to the capacitor C. Greater peak amplitude than this will cause Q₃ s collector current to dominate so that the voltage on the capacitor C rises incrementally for each oscillator cycle until the peak of the AC voltage at the output of the amplitude control means 4 is reduced to the given peak amplitude. Lesser peak amplitude will cause Q₂ s collector current to dominate so that the voltage on the capacitor C falls incrementally with each succeding oscillator cycle until the peak amplitude of the AC voltage at the output of the amplitude control means 4 is increased to given amplitude. At a given frequency of the AC voltage, this operation might be described as a proportional charge pump that is, for a given amplitude error, a net increment of charge will be transfered to or from the capacitor C during successive cycles of the input frequency. A larger error will cause a proportionally larger charge increment to be transfered to or from the capacitor C. The waveforms of Figures 1A through 1E will be helpful to further visualize the operation of the AGC circuit. Figure 1A shows the AC waveform at the output of the regulator 4 which is referenced to ground and which is the input to the AGC circuit at the left side of the capacitor 12. It happens to be a little over a volt in peak amplitude. Even though this is difficult to see with the scale used, the amplitude of the AC voltage supplied by the source 2 starts to increase at t 0. Figure 1B shows the same AC waveform at the right side of the capacitor 12 where it is referenced to V. The upwardly extending positive peaks of Figur 1C show the current flowing through the charging source Q₃ and the downwardly extending negative peaks show the current flowing through the discharging source Q₂. The latter are shown with inverted polarity because I₂ is flowing out of the capacitor C. Note that the discharging current source Q₂ is operative during a first central portion of a half cycle of the AC wave and that the charging current source Q₃ is operative during a second central portion of the half cycle that is shorter than the first. The reason for these periods of conduction having different lengths is that Q₃ is not turned on until the current supplied by Q₁ causes the voltage at the junction of the resistors 20, 22 to be sufficient to bias the base of Q₃ for conduction. Figure 1D shows the combined collector current of Q₂ and Q₃ on the same plot. The purpose of the capacitor C is to integrate the currents respectively flowing to and from it and to store a resultant voltage during the portion of the alternating waveform when neither Q₂ or Q₃ are conducting. Figure 1E shows the control signal voltage stored on the capacitor C. One step occurs during each cycle. At one particular amplitude of the wave, which is the desired amplitude, the current source Q₃ will add as much total positive charge to the output capacitor C as the current source Q₂ removes from it. Even though Q₃ conducts for a shorter period, its current gain is sufficiently greater than that of Q₂ that it can supply the same amount of charge. If the amplitude of the wave increases, Q₁ and Q₂ will be turned on earlier in a half cycle so that their periods of conduction are increased but Q₃ will also be turned on earlier in the half cycle so that its period of conduction is also increased. The ratio of the period of conduction of Q₃ to the period of conduction of Q₂ increases as does the ratio of their respective currents. Then, as the AGC circuit begins to reduce the amplitude of the wave, these ratios start to decrease. The effect of this action is shown by the relationship between the area of the positive pulses with respect to the area of the negative pulses in Figure 1C and by the positive steps in Figure 1E that illustrate the voltage across the capaciator C. When the amplitude reaches the desired value, as it nearly does at the right hand end of the graphs, the area under the positive pulse once again equals the area under the negative pulse and there is no net change in the charge of the output capacitor C. Although the conduction periods of the current sources occur during the same half cycle of the applied alternating wave, they may be made to occur during differnt half cycles. It is only desirable that the conduction periods take place during a period having a duration of a half cycle. As previously noted, the effective time constant of the circuit that is related to reducing the amplitude of a wave and the effective time constant of the circuit related to increasing the amplitude of the wave can be made short and equal, but they can be made longer by increasing the values of the resistors 16 and 18, and they can be made unequal by changing the values of the resistors 22 and 24. Figure 2 is a schematic diagram of a circuit embodying the invention in which comparators are used to control the periods of operation of current sources. Components corresponding to those of Figure 1 have the same designations. The AC waves from the regulator 4 are coupled via the capacitor 12 to the positive inputs of comparators C₁ and C₂. Resistors R₁, R₂ and R₃ are connected in the order named between V and ground. The negative input of C₁ is connected to the junction of R₁ and R₂ so as to receive a DC voltage T₂, and the negative input of C₂ is connected to the junction of R₂ and R₃ so as to receive a DC voltage T₁ that is less than T₂. A diode d₁ is connected so as to conduct current from the output of C₁ to a gate electrode of a FET F₁, and a resistor 28 is connected between the gate and drain electrodes of F₁. Similary, a diode d₂ is connected so as to conduct current from the output of C₂ to the gate electrode of a FET F₂, and a resistor 30 is connected between the gate and drain electrodes of F₂. A source 32 of constant current I₁ is connected between V and the source electrode of F₁, and a source 34 of constant current I₂ is connected between the drain electrode of F₂ and V. The current sources can be of any suitable type such as field effect or bipolar transistors but I₁ must be greater than I₂. The drain electrode of F₁ and the source electrode of F₂ are connected to the lead 6 on which the output voltage V₀ of the circuit that is developed across the output capacitor C appears. The start up resistor is connected between V and the lead 6 via a switch s, as in Figure 1. The operation of the circuit of Figure 2 will now be explained with the aid of Figures 2A through 2E. Figure 2A illustrates the AC voltage V If the amplitude of V Figure 3 is a schematic diagram of a circuit embodying the invention in which operational amplifiers operating as voltage to current converters are used as the current sources. Components corresponding to those of Figure 1 have the same designations. The AC wave from the regulator 4 is coupled via the capacitor 12 and a resistor 38 to the non inverting input of an operational amplifier A₁ and via the capacitor 12 and a resistor 38 to the inverting input of an operational amplifier A₂. The inverting input of A₁ is connected via a resistor 40 to a potentiometer 42 connected between V and ground, and the non inverting input of A₂ is connected via a resistor 40 to a potentiometer 42 that is connected between V and ground. The potentiometer 42 supplies a voltage T₁ and the potentiometer 42 supplies a voltage T₂. The output of A₁ is connected via a resistor 44 to its inverting input and via series resistors 46 and 48 to its non inverting input. The output of A₂ is connected via resistor 44 to its inverting input via series resistors 46 and 48 to its non inverting input. Diodes d₃ and d₄ are connected in series with like polarity so that they can conduct current from the junction of the resistors 46, 48 to the junction of the resistors 46 , 48 . The output capacitor C is connected between the junction of the diodes d₃ and d₄ and ground. The current I₁ that is caused to flow through d₃ by A₁ is equal to K₁V The operation of the circuit of Figure 3 will now be explained with the aid of Figures 3A through 3E. Figure 3A illustrates the AC voltage V If, however, the amplitude of V