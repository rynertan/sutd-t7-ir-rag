# METHOD OF CONFIGURING N TH DEGREE SWITCHED CAPACITOR FILTER

## Claims
Verfahren zum Konfigurieren eines geschalteten Kapazitätsfilters n ter Ordnung mit Übertragungseigenschaften bestimmt durch

## Description
The present invention relates to a method of configuring any given n th degree filter, and more particularly to a method of configuring a n th degree filter preferably applied to a switched capacitor filter. Conventionally, LC filters composed of coils and capacitors are well known as filter circuits. However, since these LC filters are large in size and high in cost, it has recently been attempted to configure filters by use of integrated circuits. As methods of configuring such LC filters as described above, the use of gyrators, active filters, digital filters, switched capacitor filters, have been studied. In particular, switched capacitor filters have been highlighted owing to various advantages such as a high possibility of realizing the filters by monolithic ICs using MOS transistors, excellent electric characteristics, wide applicable fields, low cost, etc. However, thus far only leapfrog type and bi quad type have been known as methods of configuring the switched capacitor filters, and no satisfactory method of configuring a filter which can realize any given n th degree transfer function has been known. In particular, in the case where a filter for a video signal band is required to be configured, a switching speed as high as 40 times higher than the reproduction band is required for the leapfrog type switched capacitor filter. Further, in the case of the bi quad type switched capacitor filter, the method of determining the coefficients has not yet been well known, so that deviation in coefficients is readily produced, thus causing problems in that the filter is unstable or it is impossible to realize. A method of configuring an n th degree switched capacitor filter having transfer characteristics expressed by any given n th degree transfer function, can be derived from EP A 58 113, in which the n th degree transfer function is expanded to a state equation expressed by an n element linear simultaneous equation with respect to n state voltages inclusive of an output voltage to configure a filter corresponding to the above state equation. However, such a method does not permit to determine the optimal filter coefficients implementing the desired filter transfer function within the hardware constraints relative in particular to With these problems in mind, therefore, it is the object of the present invention to provide a method of configuring an n th degree switched capacitor filter in which each coefficient of the n th degree filter can be determined readily and reasonably, capable of yielding a unique and optimal answer in the sense of signal to noise ratio if implemented on a computer . To achieve the above mentioned object, it is proposed the method which is defined in claim 1. The features and advantages of the method of configuring an n th degree switched capacitor filter according to the present invention will be more clearly appreciated from the following description of the preferred embodiment of the invention taken in conjunction with the accompanying drawings in which With reference to the attached drawings, reference is now made to the method according to the present invention. The basic principle of the method of configuring an n th degree switched capacitor filter related to the present invention will first be described. In digital filters, in general, configurations for generating an output by linearly coupling n piece past inputs have been well known. However, in such a filter as switched capacitor for implementing analog calculations, the method of using a great past data is not appropriate because the signal conserving capacity is not sufficient. To overcome this problem, in the case of filters for realizing an n th degree transfer function, there has been adopted a so called linear state method such that each state voltage is changed into V₁ N to V By way of example of such a linear state method as described above, a method of configuring a quadratic filter will be described hereinbelow. When the following equation is given as a quadratic transfer function H z and a quadratic filter for realizing the above transfer function 1 is required to be configured it is possible to obtain a two element linear simultaneous state equation with respect to two inner state voltages V₁ z and V₂ z of the quadratic filter as follows where V When the V₁ z , for instance, is determined to be an output voltage V₀ z in the equation 2 or 2 , the output voltage V₀ z V₁ z is obtained by eliminating the inner state voltage V₂ z as follows By transforming this equation 3 as Further, the other inner state voltage V₂ z can be expressed by eliminating V₁ z as follows The above V₂ z may be determined as an output voltage. These equations 3 and 5 indicate that V₁ and V₂ have the same pole. Here, the matrix determined by the first term coefficients a₁₁ to a₂₂ on the right side of the equation 2 is referred to as A matrix or an input matrix and the matrix determined by the second term coefficients b₁₁ to b₂₂ on the right side of the same equation 2 is referred to as B matrix or a pole matrix. The zero point thereof is determined by coupling of these two A and B matrix elements. Here, the equation 2 or 2 is equivalent to a state diagram as shown in Fig. 1, which can be determined as a practical circuit configuration as it is. That is, in Fig. 1, each voltage V₁ or V₂ one is taken out as an output voltage V₀ is self attenuated by the coefficients b₁₁ and b₂₂. In a practical circuit, the circuit is configured by operational amplifiers of self feedback type. The coefficients b₁₂ and b₂₁ indicate the mutual coupling of each voltage V₁ and V₂ and are configured by a so called leapfrog circuit in which one operational amplifier mutually functions as a feedback circuit to the other operational amplifier. The coefficients a₁₁ to a₂₂ indicate the contribution of an input voltage V The method of determining each coefficient a₁₁ to b₂₂ of the above mentioned simultaneous state equation expressed by equation 2 or 2 on the basis of each coefficient α₀ to β₂ of the previously given transfer function expressed by equation 1 will be described hereinbelow. First, it is required that the absolute value of each coefficient a₁₁ to b₂₂ of the state equation should be in a range between the maximum value M Further, as understood by the equation 4 , the coefficient a₁₁ is α₀ itself, and if coefficients a₁₂, a₂₁, and a₂₂, are determined, the remaining coefficients b₁₁ to b₂₂ can be determined unconditionally as follows Therefore, in practice the coefficients a₁₁ to b₂₂ which satisfy the above mentioned conditions can be obtained by variously changing a group of these coefficients a₁₂, a₂₁, and a₂₂ with the coefficient a₁₂, a₂₁, or a₂₂ as an independent variable, respectively. The determination of each coefficient a₁₁ to b₂₂ as described above can be made automatically by use of a computer, which will be described with reference to a flowchart shown in Fig. 2 by way of example. In Fig. 2, first in step 101, control sets the control variable to N 0 and proceeds to the next step 102 to set the lower limit value Q. In the first process, this lower limit value Q is set to a value Q P equal to the maximum absolute value P Vo max of the ouput voltage because a high S N ratio is required. This Q is reduced as described later only where a group of coefficients a₁₁ to b₂₂ satisfying the condition is not obtained in the subsequent steps. In the succeeding step 103, as described above the coefficients a₁₂, a₂₁, and a₂₂ are changed in a range within which each absolute value a₁₂ , a₂₁ or a₂₂ of these coefficients lies between the upper limit Ma and the lower limit M In step 106, the remaining coefficients b₁₁ to b₂₂ are calculated and determined on the basis of the selected coefficients a₁₂, a₂₁, and a₂₂ and the coefficients α₀ to β₂ of the above transfer function in accordance with the above equation 6 . In step 107, control discriminates whether the absolute values of these coefficients b₁₁ to b₂₂ lie within a range between the above upper limit Ma and the lower limit Mi Ma b₁₁ , b₁₂ , b₂₁ , b₂₂ Mi . If NO, control returns to the step 103 to change the combination of the coefficients a₁₂, a₂₁, and a₂₂ if YES, control proceeds to step 108. In step 108, the inner state voltage V₂ is calculated in accordance with the equation 5 and determines the maximum absolute value V₂ max. In the succeeding step 109, control discriminates whether this V₂ max is less than the upper limit P Vo max but more than the lower limit Q. If NO, control returns to step 103 if YES, control proceeds to the next step 110. In step 110, the control variable N is incremented N N 1 and proceeds to the succeeding step 111. In step 111, control determines and stores the maximum coefficient Kmax N and the minimum coefficient Kmin N from among the determined coefficients a₁₁ to b₂₂, returning to the step 103. As described above, after all the possible combinations of coefficients have been completed the change completion by sequentially changing the coefficients a₁₂, a₂₁, and a₂₂, control determines YES in step 104 and proceeds to step 105. In this step 105, control discriminates whether the control variable N is zero or not. If YES N 0 , this indicates that the combinations of coefficients a₁₁ to b₂₂ which satisfy the above condition have not been obtained. Therefore, control proceeds to the step 112 at which the lower limit value Q is reduced, thereafter returning to the step 103. In this case, in step 103, the change operation of each coefficient a₁₂, a₂₁, or a₂₂ is restarted from the beginning that is, the operations from step 103 to step 111 are repeatedly executed of all the possible combinations of coefficients. On the other hand, if NO N 0 is determined in step 105, this indicates that at least one combination of coefficients a₁₁ to b₂₂ which satisfies the condition has been obtained. In the succeeding step 113, control determines a group of coefficients having a minimum difference between the maximum coefficient value Kmax N and the minimum coefficient value Kmin N of each group from among the obtained combinations of coefficients, as an optimum combination of filter coefficients. As described above, since the initial value of Q is determined as P Q P Vo max and the Q is reduced gradually by checking all the combinations of coefficients a₁₂, a₂₁, and a₂₂ realizable by hardware, it is possible to determine the filter coefficients with a relatively high Q value, thus it being possible to obtain a filter having a dynamic range of high S N ratio. The quadratic filter circuit expressed by the two element linear simultaneous state equation having optimum coefficients a₁₁ to b₂₂ determined as described above can readily be configured by hardware on the basis of the state diagram shown in Fig. 1. By way of example, there will be explained an embodiment where a switched capacitor filter is configured in practice by a CMOS complementary metal oxide semiconductor circuit on the basis of the simultaneous state equation corresponding to the above filter circuit. To realize a switched capacitor filter, operational amplifiers, transmission gates, and capacitors, etc. are necessary. In the case where the filter is configured independently, although a clock noise eliminator, an input clamp circuit, a clock forming circuit, a post pre filter and an output circuit are additionally required, the description of these circuits are omitted herein because these are not directly related to the gist of the present invention. On the basis of the state diagram shown in Fig. 1, it is possible to configure a switched capacitor filter as shown in Fig. 3. In Fig. 3, two CMOS operational amplifiers 11 and 12 are configured as a complete differential type to avert the influence of a clock signal. Capacitors C₀ connected in the feedback loops of these operational amplifiers 11 and 12 are so called base capacitors. The coefficient a₁₁ or others is determined on the basis of a ratio C₁ C₀ of the base capacitor C₀ to switching controlled capacitor C₁ or others so called electric charge transfer capacitor C Here, in order to realize the coefficients a₁₁to b₂₂ in the switched capacitor filter circuit, transmission gates and electric discharge transfer capacitors C Either one of the inner state voltages V₁ or V₂ is taken as an output voltage V₀. In the the example shown in Fig. 3, an output voltage V₂ of the inversion output terminal of the operational amplifier 12 is taken out through an output terminal 3 as a filter output voltage. In the quadratic filter circuit as described above, since self feedback loops are provided for each operational amplifier 11 or 12, it is possible to obtain a stable operation. The method of configuring any given quadratic filter circuit on the basis of the linear state method has been described above. In the same way, it is possible to configure any given n th degree filter circuit on the basis of the linear state method. Any given n th degree transfer function H Z can be expressed as Corresponding to this equation 7 , an n element linear simultaneous state equation for n piece state voltages V₁ Z to V where V The above equation can be obtained as follows if the state voltage V In the same way as in the above mentioned quadratic filter, the n element linear simultaneous state equation 8 can be expressed by a state diagram as shown in Fig. 4. As already described, this state diagram can be allowed to correspond to a practical circuit configuration in the same form. Here, in considering the meanings of the simultaneous state equation 8 and the state diagram shown in Fig. 4, if the transfer function H Z of any given linear filter is expressed as the state equation is The state diagram corresponding to this equation 10 becomes as shown in Fig. 5. In Fig. 5, the output voltage V₀ is self attenuated by the coefficient b₁₁. This indicates an attenuation represented by e Further, in the case where an n th degree filter more than quadratic filter is configured, the output voltage V₀ of the basic configuration shown in Fig. 5 is replaced with n piece inner state voltages V₁ to V Further, in the same way as in the already mentioned quadratic filter, each coefficient a₁₁ to a Further, without being limited to the above embodiments, it is possible to apply the present invention to various practical filter circuits such as digital filters other than switched capacitor filters. By the method of configuring n th degree filters according to the present invention, it is possible to reliably configure filter circuits having any given n th degree transfer function on the basis of the linear state method. Further, the coefficients of the filter lie within a range realized by hardware and further the inner state voltages lie within an appropriate range, so that it is possible to realize a high S N ratio and a wide dynamic range. Further, it is possible to resonably and readily select the optimum filter coefficients having the minimum difference between the maximum value and the minimum value.