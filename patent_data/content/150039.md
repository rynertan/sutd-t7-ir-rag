# I O EXECUTION METHOD FOR A VIRTUAL MACHINE SYSTEM AND SYSTEM THEREFOR

## Claims
Verfahren zur Durchführung einer Ein Ausgabe für mehrere Betriebssysteme OS1, OS2, OS3 in Fig. 2 , die gleichzeitig unter Steuerung eines Steuerprogramms auf einem Computersystem laufen, welches mehrere reelle Subkanäle 2090 aufweist, wobei jeder reelle Subkanal eines von vielen von Ein Ausgabegeräten bei einem der Betriebssysteme darstellt,

## Description
The present invention relates to a high speed virtual machine system VMS , and more particularly to method and system for reducing an I O simulation overhead of the VMS. The specifications of the Japanese Patent Application Kokai No. 55 76950 laid open on June 24, 1975, No. 56 19153 laid open on February 23, 1981 and No. 55 42326 laid open on March 25, 1980 and the U.S. Patent No. 4,459,661 Saburo Kaneda et al., April 21, 1982 , which was filed with the Convention priority based on the latter Japanese Patent Application Kokai, disclose virtual machine systems. Fig. 1 shows a configuration of a real computer system 9000. Numeral 1000 denotes a central processing unit CPU , numeral 2000 denotes a main memory, numeral 3000 denotes an I O processor IOP , and numeral 4000 denotes an I O controller IOC . Numeral 100 denotes a signal line between the CPU 1000 and the main memory 2000, numeral 200 denotes a signal line between the CPU 1000 and the IOP 3000, numeral 300 denotes a signal line between the IOP 3000 and the main memory 2000, and numeral 400 denotes a signal line between the IOP 3000 and the IOC 4000. The real computer system 9000 is operated under a control of a resource management CPU, main memory and I O devices of an overall system of an operating system OS on the main memory 2000. A configuration of a virtual machine system VMS is shown in Fig. 2. A real computer system 10000 has a similar hardware configuration CPU, main memory and I O devices as that shown in Fig. 1 but it has a VMS control program VMCP or simply CP on the main memory 2000. A plurality of logical machines called virtual machines VM are logical configuration by a hardware simulation function of the VMCP. The VM s 10000 1 VM1 , 10000 2 VM2 and 10000 3 VM3 each is logically configured to have the same hardware configuration as the real computer system called a host system 10000. OS N N 1, 2, 3 which controls the VM exists on each main memory 2000 N N 1, 2, 3 of each VM, and those OS s run concurrently under one host system. The hardware configuration CPU, main memory, IOP and IOC in each VM of Fig. 2 is logically configured by the VMCP and most portions of the substance thereof exist on the corresponding hardware configuration in each virtual machine configured by the host system. For example, as its main memory, the VM may exclusively occupy a portion of the main memory 2000 of the host system or may show the main memory 2000, and as its I O devices, the VM may share the I O devices of the host system or may exclusively occupy the I O device. Alternatively, there may be no corresponding I O device on the host system and the I O device may be virtually configured by simulation by the VMCP. In any case, the OS on the main memory 2000 N N 1, 2, 3 on each VM can see the same hardware configuration CPU, main memory, IOP and IOC as that the host system has. It should be noted that an architecture hardware configuration and function as viewed from the OS of each VM may be somewhat different from the architecture of the host system. Similarly, the architectures of the respective VM s may be different from each other. For example, a machine instruction set of the host system may not be exactly identical to a machine instruction set of each VM. However, a completely different machine instruction set is excluded from the VMS in the present invention because it increases a load of the VMCP and increases a scale of a host system emulation mechanism. The virtual machine VM in the present invention requires that most of machine instructions can be directly executed with the same performance as that execution speed of the host system on the host system without intervention of the VMCP. Vile only three VM s are shown in Fig. 2, any number of VM s may be included and the upper limit thereof is determined by compromise between a resource capacitance of the host system and the performance of the VM. The host system has a privileged state and a non privileged state. A machine instruction which imparts a significant influence to the system e.g. I O instruction or system interrupt mask change instruction is called a privileged instruction and it can be used only in the privileged state. This is well known in the art. Fig. 3 shows a memory hierarchy of the memory hierarchy of the virtual machine VM1 of Fig. 2. Numeral 2060 denotes a virtual space generated by the OS1 on the VM1. The OS1 exists on the main memory 2000 1 of the VM1. The main memory 2000 1 of the VM1 is copied on the main memory 2002 of the host system. The main memory 2000 of the host system is divided into a hardware system area 2001 and a programmable area 2002 as shown in Fig. 7. . The copy is given by an address translation table 2010. Fig. 4a shows an address translation table 2010 1 . The address translation table contains entries corresponding to addresses v2 on the main memory 2000 1 of the VM1 and corresponding addresses r on the main memory 2002. A start address of the address translation table 2010 1 is stored in one control register Real Address Translation Table Origin Register RATOR 1110 of basic control registers 1100 see Fig. 7 in the CPU 1000 when the OS1 on the VM1 operates on the main memory 2000 1. In the present case, the address translation table 2010 1 exists on the main memory 2000 1 of the VM 10000 1, that is, on the main memory 2002 of the host system, and the start address is set in the register 1110 described by an address in the main memory 2002 of the host system. Numeral 2060 in Fig. 3 denotes a virtual storage generated by the OS1 on the VM1 and a copy thereof to the main memory 2000 1 of the VM1 is given by an address translation table 2040 managed by the OS1. Fig. 4b shows a format of the address translation table. It contains entries corresponding to addresses v3 of the virtual storage 2060 and corresponding addresses v2 of the main memory 2000 1 of the VM1. A start address of the address translation table 2040 is stored in one control register VATOR 1120 of the basic control registers 1100 see Fig. 7 of the CPU 1000 when the OS1 of the VM1 is running on the virtual storage 2060. In the present case, since the address translation table 2040 exists on the main memory 2000 1 of the OS1, the start address is described by an address system of the main memory 2000 1 of the OS1. The address translation table 2010 1 called a translation table A is managed and updated by the VMCP for the VM s, and the address translation table 2040 called a translation table B is managed and updated by the OS on each VM for its own virtual storage. The main memory 2002 of the host system is referred to as a level 1 memory, the main memory 2000 N N 1, 2, 3, ... of each VM is referred to as a level 2 memory, and the virtual storage 2060 generated by the OS on each VM usually the OS generates a plurality of virtual storages are collectively referred to as a level 3 memory. The virtual storage is usually divided into pages of a predetermined size e.g. 4KB and mapped into the main memory for each page, and a certain number of continuous pages e.g. 256 pages, 1MB are called one segment, as is well known in the art. Numeral 2020 in Fig. 3 denotes I O operation command words CCW generated by the VMCP to start its own I O operation. Since the VMCP operates on the level 1 memory, the CCW 2020 is generated at the level 1 memory address. It is called a level 1 CCW. The level 1 CCW need not be address translated, and when an I O start command is issued to the level 1 CCW, it is directly interpreted by the IOP 3000 and sent to the IOC 4000. The IOC 4000 executes each CCW for each I O device. Numeral 2030 denotes a CCW prepared by the OS on the VM and is described by the level 2 memory address. The level 2 CCW is prepared by the OS on the VM. When an I O start instruction is issued to the CCW from the OS on the VM, it may be translated to an equivalent level 1 CCW through the VMCP and the I O start may be effected by the equivalent level 1 CCW through the VMCP. However, this leads to increase an overhead of the VMCP. Accordingly, in an alternative method, the VMCP intervenes to inform an address of the address translation table from the level 2 memory to the level 1 memory translation table A to the IOP 3000, and the IOP 3000, looking up the translation table 2010, translates the data address in the level 2 CCW or level 2 memory address to the level 1 memory address. In this method, the intervention of the VMCP is reduced and the overhead is reduced. The OS on the VM in many cases executes on the level 3 memory and hence the CCW generated by the OS on the VM in many cases exists on the level 3 memory. Numeral 2050 in Fig. 3 denotes a CCW described by the level 3 memory address, that is, a level 3 CCW. When the start I O instruction is issued to the level 3 CCW by the OS on the VM, it informs an address of the address translation table from the level 3 memory to the level 2 memory translation table B and the address of the translation table from the level 2 memory to the level 1 memory translation table A to the IOP 3000 Fig. 7 , and the IOP 3000 looks up the translation table B to translate the data address of the level 3 CCW level 3 memory address to the level 2 memory address and looks up the translation table A to translate the translated level 2 memory address to the level 1 address in order to execute the CCW. Fig. 4c shows an address translation buffer 3030 provided in a local storage in the IOP 3000 Fig. 7 to reduce the address translation overhead in the IOP 3000. A field 1 of the address translation buffer 3030 contains VM numbers VM , a field 2 contains start addresses of the translation table A and the translation table B, a field 3 contains identification flags thereof, a field 4 contains CCW data addresses before translation and a field 5 contains level 1 memory addresses after translation. The IOP 3000 Fig. 7 looks up the address translation buffer to translate the address, and if it is not found, looks up the translation table B and the translation table A to translate the address and register the translated address in the translation buffer 3030. The address translation buffer is a high speed local storage in the IOP 3000 and it is faster than the speed of looking up the translation tables B and A on the main memory 2002. It should be noted that the level 2 CCW, the level 3 CCW and the data buffers thereof should be fixed on the level 1 memory during the I O execution. Fig. 5 illustrates a manner of dividing a continuous area of the main memory 2002 of the host system to use the divided sub areas as the main memories for the respective VM s. When such VM s are used, a predetermined address displacement α is added to the address of the main memory of the VM to obtain the address of the main memory 2002 of the host system. In Fig. 5, the address displacement for the VM1 is α₁ and the address displacement for the VM2 is α₂. In this case, the address translation 2010 from the level 2 memory address to the level 1 memory address may be a mere table to manage lower limit addresses and upper limit addresses of the respective VM s, as shown by 2010 2 . In this case, it is easy to address translate the level 2 CCW and an entry of the address translation buffer 3030 for the level 2 CCW entry of 0 field 3 of the address translation buffer 3030 is not necessary. Alternatively, as shown in Fig. 5, the translation table 2010 2 is read into the local storage in the IOP 3000 Fig. 7 , the address displacement α is obtained by the VM and it is added to translate the address translation from the level 2 memory address to the level 1 memory address . A high speed VM mode is provided for the VM in which the entire main memory of the VM Fig. 3 is resident in the main memory 2002 of the host system and fixed therein or it occupies a continuous area of the main memory of the host system as shown in Fig. 5. In the high speed VM mode, most privileged instructions issued by the OS on the VM are directly executed execution without the VMCP in the almost same performance as that of the host system . However, the I O instruction on the VM requires the intervention by the VMCP as will be described later. Referring to Fig. 6, a manner in which the start IO instruction issued by the OS on the VM is executed by the VMCP is explained. The OS on the VM designates a sub channel number sub channel which corresponds to the I O device to issue the start I O instruction. Since this sub channel Fig. 7 shows a hardware configuration in the prior art VMS and a block diagram concerning the I O execution. A CPU 1000 includes a prefix register 1010 including an address of an area prefix PSA containing hardware interrupt information, CPU control registers 1100 and a program status word PSW 1020 containing a CPU basic status such as an interrupt control bit or a machine instruction address to be executed next . It also includes an I O instruction execute circuit 1030, an I O interrupt circuit 1040, an I O instruction execution microprogram 1050 and an I O interrupt processing microprogram 1060. The V bit representing a VM mode is present in 1090 as a VMS flag. During the run of VM, this bit is set to 1 by the VMCP. The high speed VM mode flag H exists in 1090. The VMS control flag 1090 may be in other form. For example, a VMCP mode hypervisor mode and a VM mode may be provided and the VM mode may include the preferred or high performance VM mode and the non preferred VM mode. They are more or less similar, as described above, the IOP 3000 executes the level 3 CCW or the level 2 CCW see Fig. 3 while using the information of the address translation buffer 3030 see Fig. 4C under the control of the microprogram 3020 in accordance with the address translation information Fig. 6 contained in the sub channel control blocks 2090 and the sub channel registers 3010. The main memory 2000 in Fig. 7 is divided into a hardware system area HSA 2001 and a programmable area 2002. The HSA 2001 contains hardware information to be used by the CPU 1000 and the IOP 3000 and it can be accessed and updated by the microprograms 1050, 1060 and 3020 of the CPU and the IOP but cannot be accessed by a machine instruction opened to a normal user of the CPU 1000. The programmable area 2002 can be accessed by the machine instruction and it is a main memory area as viewed from the OS or the VMCP. Those I O instructions which accompany with the operation of the I O device such as start I O or stop I O are queued in an I O request queue 2070 in a form of request queue. It comprises control blocks 2071 containing I O request real sub channel numbers interconnected by address pointers. After queuing to the I O request queue, a start signal is sent to the IOP 3000 through the line 200. The IOP 3000 accesses to the I O request queue 2070 in the HSA 2001 and sequentially reads out request queue elements 2071 to process the I O request. The I O interrupt request is queued in the I O interrupt request queue 2080 in the priority order of real interruption. A structure therefor is shown in Fig. 9. Eight interruption priority orders 0, 1, 2, 3, 4, 5, 6 and 7 are available and they are assigned by the operands together with the sub channel numbers when the I O instructions are issued. Fig. 10 shows a sub channel control block 2091 in the sub channel control blocks 2090 Fig. 7 . The sub channel control blocks are arranged in the order of the real sub channel numbers and their locations are uniquely determined by the real sub channel numbers. The start address of the sub channel control block 2090 is set in one control register in the control registers 1100 of the CPU 1000 Fig. 7 . The interruption priority order can be assigned to each sub channel. Let us assume that the OS on the VM issues the I O instruction while designating the sub channel number and one of the interruption priority orders 0 7. Since the VM mode bit 1090 in Fig. 7 is 1 , the I O instruction executing µp microprocessor 1050 transfers the control to the VMCP. The control is transferred to the VMCP by a new PSW in the PSA 2100 of the VMCP as a kind of interruption. Since the address of the PSA of the VMCP has been set in the VMCP prefix register 1010 Fig. 7 when the VM was started, it is referred. The VMCP handles the sub channel number designated by the OS on the VM as a virtual sub channel number, translates it to a real sub channel number, manages a real sub channel status and if the real sub channel is available, designates the address translation information 2800 shown in Fig. 6 and issues an I O instruction in place of the OS on the VM. The interruption priority order designated by the OS on the VM is the virtual interruption priority order. The VMCP issues the I O instruction while using the virtual interruption priority order as the real interruption priority order. Accordingly, the real interruption priority order is shared by the OS s on the VM s. Accordingly, the I O interrupt requests from the sub channels of the OS s on the VM s are mixedly queued in the real interruption priority order queue of the I O interrupt request queue 2080 of Fig. 9. The reasons for intervention by the VMCP to the execution of the I O instruction from the OS on the VM are as follows. Fig. 11 shows a manner to control the I O interruption. The I O interrupt request from the sub channel is detected by the IOP 3000 and the corresponding sub channel control block is queued in the I O interrupt request queue 2080 see Fig. 7 . A structure of the I O interrupt request queue is shown in Fig. 9, and the sub channel control blocks are queued in the order of the real interruption priority. A bit of a corresponding real interruption pending register 1042 shown in Fig. 11 is set to 1 . When the bit of the interruption pending register 1042 and the bit of the corresponding real interruption priority order mask register 1041 are both 1 and an I O mask of the PSW 1020 is 1 , the I O interruption is initiated for the corresponding real interruption priority order and the control is transferred to the I O interrupt processing microprogram 1060. The above operation in carried out by a hardware circuit shown in Fig. 11. In the VMS, the real interruption priority order is shared by the OS s on the VM s as described above. Accordingly, during the running of the VM, the bits of the real interruption priority order mask register 1041 are set to the OR function of the interruption priority order masks of the OS s on the VM s or to 1 so that the interruption is always accepted. The I O mask of the PSW 1020 is also set to 1 . Consequently, if a bit of the real interruption pending register 1042 is changed to 1 by the I O interrupt request from the sub channel, an output of one of AND gates 1046 is rendered to 1 , an output of an OR gate 1043 is rendered to 1 and an output of an AND gate 1044 is rendered to 1 so that the I O interrupt processing microprogram 1060 is immediately started by the I O interrupt circuit shown in Fig. 11. The I O interrupt processing microprogram 1060 dequeues the sub channel queued in the corresponding highest interruption priority order I O interrupt request queue Fig. 9 to reflect the interruption to the prefix of the VMCP. If the interrupt request queue of the real interruption priority order is vacant, the bit of the real interruption priority order real interruption pending register 1042 is set to 0 . As a result, the interruption pending is cleared. By the reflection of the interruption to the VMCP, the control is transferred to the I O interrupt processing program of the VMCP. The real sub channel number which requested the I O interruption as the I O interrupt parameter and the corresponding VM number are also transferred to the VMCP. The VMCP carries out the following processing to reflect the I O interruption to the VM. Since the real interruption priority order is shared by the VM s, the mask must be set to an OR function usually 1 of the corresponding masks of the VM s. As a result, the VMCP may be interrupted even for the non interruptable order in the VM. In such a case, the I O interruption is made pending by the VMCP. Accordingly, simulation by the intervention of the VMCP is required for the I O instruction to the sub channel. As described above, in the I O execution of the OS on the VM in the prior art virtual machine system, the function of the IOP for directly executing the level 3 CCW and the level 2 CCW exists but the VMCP always intervenes and the simulation is required. Accordingly, a simulation overhead of the VMCP increases for a load having a high I O issuance frequency. FR A 2 436 443 discloses prior art of the type described with reference to Figs. 1 to 11 of the present application. Specifically, it also discloses hardware supported translation of virtual I O command addresses so as to reduce overhead due to interventions of the virtual machine control program VMCP. In 370 XA principles of operation by IBM, chapter 13, I O Overview, 13 1 to 13 9, a subchannel is disclosed which provides the logical appearance of a device to the program. The subchannel contains the information required for sustaining a single I O operation. I O operations are initiated with a device by executing I O instructions that designate the subchannel associated with the device. It is an object of the present invention to reduce an overhead for simulation by VMCP of an I O instruction issued by an OS. It is another object of the present invention to reduce an overhead for simulation by VMCP of an I O interruption generated as a result of execution of an I O operation required by a previously executed I O instruction. These objects are achieved by the present invention according to a first aspect by the features indicated in the characterizing parts of claim 1 and claim 20, respectively, and according to a second aspect by features indicated in the characterizing parts of claim 12 and claim 30, respectively. The present invention will be apparent from the following detailed description taken in conjunction with the accompanying drawings, in which The preferred embodiments of the present invention are now described. Fig. 12 shows an overall configuration of one embodiment of the present invention. Elements of a CPU 1000 are similar to those of Fig. 7 but some of them are expanded in function. An HSA 2001 includes the same elements as those in Fig. 7. I O request queue 2070, I O interrupt request queue 2080 and real sub channel control blocks 2090 . . However, a prefix control table 2300, a translation table address control table 2400 and a VM control table 2700 include new information. A programmable area 2002 includes the same elements as those of Fig. 7 VMCP PSA 2100, VM1 PSA 2110, VM2 PSA 2120, PSA s of other VM s , VMCP 2200, level 2 memory to level 1 memory address translation tables 2010 and level 3 memory to level 2 memory address translation tables 2040 . However, an interruption priority order number translation table 2500 and sub channel number translation tables 2600 include new information. An IOP 3000 is similar to the IOP 3000 in Fig. 7 in configuration but expanded in function. The new information included in the HSA 2001 and the programmable area 2002 is new explained. Fig. 13 shows the prefix control table 2300. It includes the VMCP PSA address, VM1 PSA address, VM2 PSA address and VM3 PSA address. While not shown in Fig. 13, other VM PSA s may be registered. The PSA addresses are referred by a microprogram of the CPU 1000 and they are addresses in a host system of the programmable area 2002. The VM PSA address is imparted as one of start instruction operands when the VM is started and it is stored in the corresponding entry of the prefix control table 2300 when the instruction is executed. A start address of the prefix control table 2300 is stored in one of the control riegsters 1100 of the CPU 1000 see Fig. 12 . The prefix control table is optional and not essential. A case where it is used will be explained later. Fig. 14 shows the translation table address control table 2400. It controls a start address of the sub channel number translation table 2600 and a start address of the interruption priority order translation table 2500, for each VM. A start address of the translation table address control table 2400 is also stored in one of the control registers 1100 of the CPU 1000 . A method of looking up the sub channel number translation table 2600 and the interruption priority order translation table 2500 is shown in Fig. 14. A virtual sub channel number two bytes is divided into D0 256 and D1, and a first half table 2601 pointed by the content of the corresponding entry of the address control table 2400 is looked up by D0. An address of a second half table 2602 is contained in the D0 th entry of the first half table 2601 so that a D1 th entry of the second half table 2602 is looked up. In this manner, the corresponding real sub channel number D0 256 D1 is obtained. The virtual interruption priority order is translated to the corresponding real interruption order by merely reading the corresponding entry of the translation table 2500. The sub channel number translation table 2600 and the interruption priority order translation table 2500 are prepared by the VMCP when they are designated by the VMCP command or when the VM is defined from the VM defining information, and designated by the start instruction operand when the VM is started, and stored in the corresponding entry of the translation table address control table 2400 when the start instruction is executed. The translation tables 2600, 2500 and 2400 are optional and not essential. Those translation tables are not necessary so long as the VM which uses the I O execution system of the present invention in the VMS obeys a rule of virtual sub channel number being equal to a real sub channel number, and virtual interruption priority order being equal to real interruption priority order. Fig. 15 shows a content of the VM control table 2700. It contains sizes Z0, Z1, ... of the main memories of the corresponding VM s, and address RATOR0, RATOR1, ... of the level 2 memory address to level 1 memory address translation table 2010. Such information is derived from the VM definition information and stored in the corresponding entry of the VM control table 2700 in the HSA 2001 by the start VM instruction. A start address of the VM control table 2700 is stored in one of the control registers 1100 see Fig. 12 in the CPU 1000 . A start address of the control block in the HSA 2001 is stored in the control register 1100 in the CPU 1000 as is done in the prior art system. When the VM which supports the I O execution system of the present invention is limited to one which occupies the continuous area on the main memory 2002 Fig. 5 as a main memory therefor, the VM control table 2700 may be substituted by a translation table 2010 2 which defines upper and lower limits. When the translation table 2010 2 shown in Fig. 5 is used, the upper and lower limit addresses α The dedication of the real sub channel or the dedication of the real interruption priority order is designated when the VM is defined or by the VMCP command. When it is designated, the following fields in the VM information area 2092 are set. In the shared sub channel, such information is set as required when the I O instruction is executed. In this case, it is set in the corresponding field on the VM information area of the I O issuing VM. Fig. 17 shows a format of the start VM instruction. Numeral 2900 denotes the start VM instruction and numeral 2910 denotes an operand. The operand 2910 contains VM number, VM PSW, VM PSA address, start address of the sub channel number translation table 2600 Fig. 14 , start address of the interruption priority order translation table 2500 Fig. 14 , start address RATOR see Fig. 4a of the VM main memory to host system main memory address translation table 2010 Fig. 15 and VM main memory size. For the latter two, when the VM to be started uses the continuous area of the main memory 2002 shown in Fig. 5 as the VM main memory, the upper and lower limits α Figs. 20a and 20b show a method of assigning the real interruption priority orders. 32 real interruption priority orders 0 31 are used. The real interruption priority order 0 is the highest priority order and exclusively used by the VMCP. The real interruption priority orders dedicated to the VM s are assigned to the dedicating VM s in the ascending order starting from the real interruption priority order 1 descending order in the interruption priority order . The shared interruption priority orders are assigned to the VM s in the descending order starting from the real interruption priority order 31 ascending order in the interruption priority order . In Figs. 20a and 20b, the real interruption priority order 1 is assigned to the virtual interruption priority order 0 of the VM1 and it is exclusively used, and the real interruption priority order 31 is assigned to the virtual interruption priority orders 1 7 and it is shared by the VM s. For the VM2 and VM3, the assignment is done as shown in Figs. 20a and 20b. The virtual interruption priority order in the VM1 is actually 0 or 1 7 . Accordingly, there are two real interruption priority orders which can be effectively used by the OS on the VM1. The restriction to the OS can be permitted by operation. The particular interruption priority order to be exclusively dedicated to the VM should be determined under an overall plan of the VMS and controlled by the VMCP. The exclusive 1 shared status of the real interruption priority order thus determined is given by the operand of the start VM instruction see Fig. 17 and set into the real interruption priority order exclusive status register 1049 Fig. 21 when the instruction is executed. Fig. 21 shows the real interruption priority order mask register 1041 , real interruption pending register 1042 , real interruption priority order status register 1045 and real interruption priority order dedication status register 1049. Those are all included in the I O interrupt circuit 1040 of Fig. 12. The registers 1041 and 1042 are similar to those in the prior art system but have increased number of bits. In Fig. 21, they have 32 bits which are four times as large as 8 bits in the prior art system, in order to support the dedication system of the real interruption priority order in the VM. The explanation thereof is omitted because the meaning is same. The meaning of the real interruption priority order status register 1045 is described below. It means that when the bit n 0 31 is 0 , the real interruption priority order n is dedicated to the currently running VM. In other case, it is set to 1 . A content of the real interruption priority order dedication status register 1049 is described below. When a bit Fig. 22 is a circuit diagram of the I O interrupt circuit 1040 of the present invention. For the sake of simplicity, only ten real interruption priority orders are shown in Fig. 22 but there are actually 32 orders connected in a similar manner. Let us assume that the real interruption priority order The manner in which the I O instruction of the OS on the VM and the I O interruption are executed and processed by the hardware, microprogram and information on the main memory is now explained. The following presumptions are made and the VM is in the high speed VM mode. When the VM is started, the VMCP sets the operand of the start VM instruction of Fig. 17 and the bit When the virtual interruption priority order mask is changed during the VM run, the change is immediately reflected to the real interruption priority order mask register 1041 Fig. 21 . Accordingly, the instruction to change the virtual interruption priority order mask of the OS may be simulated via the VMCP or the change may be reflected to the register 1041 by the microprogram processing of the CPU, as is done in the prior art system. When the VM in the high speed VM mode is started, the PSW of the VM is set in the VM run PSW of the operand of the start VM instruction of Fig. 17 and it is set in the PSW 1020 Fig. 12 of the CPU 1000 . Accordingly, the I O mask of the PSW coincides with the I O mask of the running VM. The coincidence is attained because the change of the PSW of the OS during the VM run is immediately reflected to the PSW 1020. The instruction to change the PSW of the OS may be reflected to the PSW 1020 of the CPU 1000 by the direct execution or may be reflected by the simulation via the VMCP. After those settings, the control is transferred to the OS on the VM by the start VM instruction Fig. 17 . As the instruction is executed, the currently running VM number register 1081 of Fig. 18, PSW 1020 Fig. 12 of the CPU 1000 , the corresponding entry of the prefix control table of Fig. 13, the corresponding entry of the translation table address control table 2400 of Fig. 14, the corresponding entry of the VM control table of Fig. 15, real interruption priority order status register 1045 of Fig. 21 and VMS control flags of Fig. 19 are initialized. Let us assume that the I O instruction is issued from the OS on the VM. The I O execute circuit 1030 of the CPU 1000 carries out the following processings under the control of the microprogram 1050 . As described above, when the sub channel is dedicated and has the dedication real interruption priority order, the I O direct execution without the intervention of the VMCP of the OS on the VM is supported for that sub channel. For the I O interruption, only the I O interruption from the sub channel dedicated to the current running VM is directly executed. For the I O interruption from the sub channel dedicated to other VM, the VMCP is to intervene because of necessity for scheduling of the VM s. The direct I O execution mode suppress flag of the status field 2093 in the real sub channel control block of Fig. 16 is normally 0 so that the direct I O execution mode of that sub channel is supported. In the dedicating sub channel, the I O instruction is not issued from the OS on the VM other than the occupying VM but it may be issued from the VMCP. In this case, the direct I O execution mode suppress flag 1 in the status field 2093 is set to 1 until the I O of the VMCP is completed so that the I O direct execution mode for that sub channel is suppressed. Accordingly, this flag is set and reset under the control of the VMCP. In the above I O execution system, the followings are pointed out. As described hereinabove, in accordance with the present invention, the I O instruction issued by the OS on the VM and the I O interruption can be directly executed so that the I O simulation overhead of the VMCP can be substantially reduced. This is an essential function to attain a virtual machine which has a performance very close to that of a real computer.