# METHOD AND APPARATUS FOR CONTROLLING PWM INVERTER

## Claims
Verfahren zur Erzeugung eines Pulsdauermodulationssignals Eu zum Ansteuern eines Pulsdauermodulations PWM Wechselrichters mit den Schritten

## Description
The present invention relates generally to a method and an apparatus for controlling a pulse width modulation PWM inverter which serves as an alternating current AC power supply source of variable voltage and frequency and, more particularly, to a method and an apparatus for producing a PWM signal for the PWM inverter control. A method and an apparatus according to the precharacterizing part of claims 1 and 6 respectively one known from IEEE PROC. VOL. 128, No.6 NOV.1981, PP 293 305. An asymetric PWM inverter process using a microprocessor is further known from Preprints of the Third IFAC Symposium Lausanne , 12 14 September 1983, pp 453 459 Heretofore, the control apparatus for producing a PWM signal for controlling a PWM inverter is composed of a circuit for generating a modulating waveform such as a sinusoidal waveform or a stepped waveform approximating to the sinusoidal wave and having a frequency and an amplitude corresponding to those of the AC voltage to be produced by the PWM inverter, a carrier generating circuit for generating a carrier of triangular or saw tooth waveform, and a PWM signal synthesizing circuit for deriving the PWM signal through comparison of the modulating wave with the carrier, as is described, for example, in the article Intrinsic Harmonics of Idealized Inverter PWM System by James W. A. Wilson and Jerome A. Yeamans, IAS 76 Annual, pp. 967 937. In the carrier generating circuit, the use of an oscillator capable of varying the output frequency thereof over a wide range is necessary for changing the frequency of the carrier in accordance with the frequency of the modulating signal with a view to enhancing the availability or utilization factor of the AC output voltage of the inverter on one hand and for increasing the frequency of the carrier for the purpose of improving the form factor of the AC output voltage on the other hand, resulting in a complicated circuit configuration and expensiveness of the control apparatus. It is an object of the present invention to provide a method and an apparatus for generating a pulse width modulation PWM signal to be used for operating a pulse width modulation PWM inverter system which serves as an alternating current AC power supply source of a variable voltage and frequency, said method and apparatus providing a good response characteristic for the generation of said pulse width modulation PWM signal with high accuracy. In solution of the above object a method for generating a pulse width modulation signal according to the preamble of claim 1 is characterized by its method steps VI to VIII. An apparatus according to the preamble of claim 6 which solves the above object is provided by the characterizing part of claim 6. The subclaims 2 to 5 characterize advantageous developments of the method claim 1. The subclaims 7 to 10 characterize advantageous developments of the teaching characterized by claim 6. The invention will be described in more detail in conjunction with the accompanying drawings, in which Now, the invention will be described by referring to Figure 1 which shows schematically a general arrangement of the control apparatus according to an exemplary embodiment of the invention. A frequency command voltage f The micro computer 13 fetches also a digital signal produced by an analogue to digital or A D converter 12 which serves to convert a voltage command signal KH relating to the amplitude value of the aforementioned sinusoidal modulating wave into a digital signal. On the basis of the values of ϑ and KH, the micro computer 13 arithmetically determines the pulse width of a pulse width reference signal in accordance with an expression 1 mentioned hereinafter, which pulse width reference signal in turn provides a basic quantity in determining the PWM signal. This pulse width is equal to a time interval τ The micro computer 13 generates a rectangular signal Es which takes a high level and a low level alternately every period τ The PWM signal Eu is produced by a latch circuit 16 on the basis of the pulse width reference signal Tu and the signal Es in a manner as mentioned below. The latch circuit 16 is constituted by a D type flip flop having a data terminal supplied with the signal Es and a clock terminal supplied with the signal Tu. At the time point corresponding to the trailing edge of the signal Tu, the latch circuit 16 fetches the signal Es and makes the PWM signal Eu high level when the signal Es as fetched is at high level and low level when the signal fetched Es is at low level. In the case of a polyphase inverter, the programmable timer 15 produces a plurality of the pulse width reference signals different phases, respectively, corresponding to the phases of the inverter and, a number of latch circuits 16 are provided correspondingly to the pulse width reference signals, respectively, to thereby produce the PWM signal for each of the phases of the inverter. For example, in the case of the three phase inverter system as illustrated, the programmable timer 15 is so arranged as to produce in addition to the signal Tu the pulse width reference signals Tv and Tw which are of the same waveform as the signal Tu but are out of phase with the latter by 120 and 240 , respectively, wherein the three phase PWM signals Eu, Ev and Ew are produced by the latch circuits 16 provided in correspondence with the pulse width reference signal Tu, Tv and Tw. A suppression signal Sa supplied to the latch circuits 16 from the microcomputer 13 is utilized for suppressing the outputs of these latch circuits until they have been set in the normal state upon initialization for activation of the control apparatus. The arrangement of the control apparatus according to the invention has been outlined above. Now, the principle of modulation contemplated by the invention will be elucidated in more detail by referring to Figures 2 and 3. Figure 2 illustrates the principle of modulation when the amplitude ratio KH i.e. ratio of the peak value E₁ of the sinusoidal waveform and the peak value H of the virtual triangular waveform is less than 1 unity , while Figure 3 illustrates the modulation when the amplitude ratio is greater than 1 unity . In both figures, the triangular waveforms are not actually produced but depicted for the convenience of description and thus referred to as the virtual waveform. In the following, the process for deriving the PWM signal Eu will be elucidated by using symbols shown in Figure 2. The micro computer 13 is so programmed that interrupt request signals hereinafter also referred to as IRQ signal are produced at time points corresponding to the positive and negative peak points of the virtual triangular waveform X with a periodical time interval or period τ The value of the pulse width τ as calculated in accordance with the above expression 1 differs slightly from the value obtained by the hitherto known modulation system which value is derived from an intersection B between the sinusoidal waveform represented by a broken curve and the triangular waveform . It has been, however, ascertained that such difference provides no problem in practical application by selecting the period or time interval τ In response to the interrupt signal IRQ 1, the micro computer calculates the value of τ in accordance with the expression 1 , and the value thus determined is set in the programmable timer 15 immediately before occurrence of the next interrupt signal IRQ 2. Then, the programmable timer 15 starts counting of the enable signal E, as clock pulse, supplied from the micro computer 13, to thereby produce the pulse width reference signal Tu which is at high level from the start of the counting to a time point when the counted value reaches the set value mentioned above and rendered low level thereafter. In this way, when the interrupt signal IRQ 1 makes appearance, the micro computer 13 calculates the value of the pulse width τ , which is followed by generation of the pulse width reference signal Tu by the programmable timer 15 at a time point substantially corresponding to the next interrupt signal IRQ 2, wherein the generated pulse width reference signal is initially at high level and takes low level after lapse of time equal to τ . For the purpose of facilitating the understanding of relationship between the pulse width τ and the pulse width reference signal Tu, waveforms illustrated in Figure 2 are so plotted that the signal Tu corresponding to the value of τ determined in response to the interrupt signal IRQ 1 assumes high level simultaneously with occurrence of the interrupt signal IRQ 1. It should however be appreciated that the signal Tu takes in reality the high level at the time point substantially corresponding to the next interrupt signal IRQ 2 with a delay almost equal to the period τ As described hereinbefore, the micro computer 13 produces the rectangular signal Es having high level and low level alternating at every time interval τ According to the invention, the PWM signal is produced on the basis of the signals Es and Tu produced through the processes described above. More specifically, data or value of the signal Es i.e. high level or low level is fetched at a time point corresponding to the trailing edge of the signal Tu the time point indicated by an arrow in Figure 2 to thereby produce the PWM signal. In more concrete, reference is again made to Figure 2. It will be seen that the rectangular signal Es is at low level during the time interval between the interrupt signals IRQ 1 and IRQ 2 in correspondence to the negative slope of the virtual triangular waveform. By fetching or sampling the rectangular signal Es of low level after elapse of time τ at the time point corresponding to the trailing edge of the pulse width reference signal Tu outputted by the programmable timer 15, the PWM signal Eu transits from high level to low level which is held until the time point corresponding to the trailing edge of the next pulse width reference signal Tu outputted from the timer 15. Next, description will be made as to how the PWM signal is produced in the time interval between the interrupt signals IRQ 2 and IRQ 3. Also at the time point corresponding to the appearance of the signal IRQ 2, the pulse width τ of the pulse width reference signal Tu to be set in the programmable timer 15 is determined through the procedure similar to that adopted in determining the pulse width τ in response to the interrupt signal IRQ 1. More specifically, in response to the interrupt signal IRQ 2, phase position ϑ₂ of the sinusoidal wave is determined, which is followed by determination of the level C of the sinusoidal wave at a point C corresponding to the phase position ϑ₂ in accordance with C E₁ sinϑ₂. Subsequently, the time interval τ between the point C and a point D which lies on the positive slope of the virtual triangular wave rising up in response to the signal IRQ 2 and at which the virtual triangular wave takes the same level as the level of the sinusoidal wave at the point C is calculated with the aid of the micro computer 13 in accordance with the following expression where K When the expressions 1 and 2 are compared with each other, it is seen that they differ in respect with the sign of the second term on the right hand side. Accordingly, both expressions 1 and 2 can be represented by a generalized form where K The pulse width τ of the pulse width reference signal Tu resulting from the arithmetic determination in accordance with the expression 2 is set at the program timer 15. The pulse width reference signal Tu outputted from the timer 5 through the process similar to that described hereinbefore assumes high level substantially in synchronism with the IRQ signal and returns low level after lapse of time τ . The latch circuit 16 fetches the data of the signal Es i.e. data of high or low level of the signal Es at a time point corresponding to the trailing edge of the signal Tu falling to the low level, resulting in that the PWM signal Eu transits to the level corresponding to that of the signal Es, i.e. high level in the illustrated case. Succeeding to the time point corresponding to the interrupt signal IRQ 2, the processes as described are repeated thereby to produce the PWM signal Eu of the waveform as illustrated in Figure 2. The foregoing description has been made on the assumption that the rectangular waveform signal Es is sampled at the time point corresponding to the high to low level transition of the pulse width reference signal Tu to produce the PWM signal. However, it will be understood that same result can equally be obtained in case the pulse width reference signal Tu is inverted. In this case, the rectangular waveform signal Es is fetched or sampled at the leading edge or the low to high level transition of the inverted signal Next, referring to Figure 3, description will be made concerning a method of increasing the voltage utilization factor by using the PWM system described above. In application where the PWM signal Eu is employed, the output voltage becomes at maximum when the amplitude ratio K Under the condition, a method of forming the PWM signal at these time points will be described. At the time point of appearance of the interrupt signal IRQ 4, the corresponding phase position ϑ₄ of the sinusoidal wave is fetched by the micro computer 13 to determine the value of the pulse width τ of the pulse width reference signal Tu in accordance with the expression 2 . Since the value of KH sinϑ₄ is greater than 1 at this time, the pulse width τ of the pulse width reference signal Tu is greater than the value of the period τ At a succeeding time point corresponding to the IRQ 5, the slope of the virtual triangular wave becomes negative, and the rectangular waveform Es transits to the low level. Accordingly, for determining the value of τ in accordance with the expression 1 , the phase position ϑ₅ at the time point corresponding to the interrupt signal IRQ 5 is read and the value of the term K Next, a process for determining the level of the sinusoidal wave at every periodical time interval T The counter B also counts the pulses derived from the V F converter 11 and produces a pulse signal T₂ when its counts reach a value corresponding to a predetermined phase angle Δϑ. The signal T₂ is applied to a reset terminal R of the counter B thereby resetting the same and also to the gate terminal G of the counter C. The period τ The counter C counts the enable signal 17, as clock pulse, supplied from the micro computer 13 and the counting operation thereof is reset by the signal T₂ so that the content of the counter C just before resetting the same represents as time interval between two successive pulse signals T₂, that is the value of τ In the mode of τ In any case, the micro computer 13 fetches the count value of the counter A in response to the interrupt signal. As mentioned hereinbefore, the count value of the counter A represents the phase position ϑ of the sinusoidal wave at the time point when the interrupt signal appears. The micro computer 13 reads the value of sin ϑ out of a table which is provided in the micro computer and stores the values of sin ϑ for various values of ϑ. The value of sin ϑ thus read out is used for calculation of τ and τ . In the mode of the value of τ Figure 5 shows a relationship between the count value of the counter A and the value sinϑ of the sinusoidal wave, typically in the phase U of a three phase inverter. As mentioned hereinbefore, the counter A produces the pulse T₁ when its counts reach a value The micro computer 13 fetches the value of In the case of the three phase inverter, the PWM signal has to be prepared for each of the phases U, V and W. In that case, the values of ϑ Next, processes executed by the micro computer 13 for producing the three phase PWM signals with the apparatus shown in Figure 1 will be described by referring to flow charts shown in Figures 6A and 6B. When the control apparatus is powered on, a main routine illustrated in Figure 6A is activated, whereupon initialization is effected at a step 601. This initialization process includes initialization of work areas of the memory, initialization of the program timer 15, setting of the mode of τ At first, the level of the signal Es which is set at high level at the stage of initialization is inverted and the level resulting from the inversion is stored at the work area at a step 611. Next, at a step 612, the A D converter 12 is activated to allow the command voltage K At the dummy step 618, the signs of sin ϑ On the basis of the data of sin ϑ and at a step 620. Next, at a step 621, it is decided whether the determined values Tu, Tv and Tw are positive or negative. When positive or 0 zero , the determined values are set at the programmable timer 15 at a step 623, while for the negative values the values placed in the timer 15 until then are held as they are. Simultaneously, data of the signal Es i.e. high level or low level is set at the latch circuit 16. Subsequently, at a step 624, the suppression signal Sa is removed to enable the latch circuit 16. Further, it is confirmed at a step 625 whether or not the commanded frequency f When the data Es, Tu, Tv and Tw are set at the latch circuits and the programmable timer through the procedure described above, there are produced from these set values the signals for determining the levels of the PWM signals Eu, Ev and Ew by the latch circuits 16 in the succeeding interrupt cycle. As will be appreciated from the foregoing description, it is possible according to the invention to produce the PWM signal with a simple circuit configuration without necessity for providing the circuit for generating actually the carrier such as of triangular waveform. Further, the frequency of the virtual carrier can be varied in a facilitated manner through software technique. Besides, by virtue of the fact that the switching frequency which is optimum for the characteristics of power switching elements of the PWM inverter can be selected without modifying the configuration of the PWM control circuit. There is thus provided a PWM inverter which can enjoy an increased flexibility in use, to great advantages.