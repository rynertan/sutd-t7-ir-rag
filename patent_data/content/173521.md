# Automatic signal delay adjustment apparatus.

## Abstract
A method and apparatus for automatically adjusting the propagation time delay of an electrical circuit, such as an integrated circuit chip. In a preferred embodiment, the method and apparatus are employed to de skew the clock outputs provided by a plurality of clock distribution chips having different signal propagation times. In a preferred implementation of the method and apparatus, feedback circuitry including a multi tapped delay line and an accurate constant delay are employed in conjunction with a phase comparator for automatically adjusting the propagation delay of each chip to provide substantially the same constant delay relative to a main system clock or the clock outputs provided by the clock distribution chips.

## Claims
What is claimed is 1. Electrical circuit means for automatically providing a desired propagation delay for an electrical circuit, said electrical circuit means comprising delay means responsive to an input signal for producing a plurality of delayed signals having different delays relative to said input signal means for applying a selected one of said delayed signals to said circuit means for determining whether the propagation delay provided by a selected delayed signal is substantially equal to said desired propagation delay means for automatically selecting a different delayed signal if the propagation delay provided by a currently selected delayed signal is determined not to be substantially equal to said desired propagation delay and means for preventing selection of a different delayed signal when it is determined that the currently selected delayed signal provides a propagation delay which is substantially equal to said desired propagation delay. 2. The invention in accordance with claim 1, wherein said means for preventing includes means for locking in selection of a selected delayed signal when said means for determining indicates that a selected delayed signal provides a propagation delay which is substantially equal to said desired propagation delay. 3. The invention in accordance with claim 1, wherein saia circuit prouuces at least one output signal having a time relationship relative to said input signal which is indicative of the propagation delay of said circuit, wherein said means for determining includes means for deriving a comparison signal having a predetermined delay relative to said input signal, said predetermined delay being chosen based on said desired propagation delay, and wherein said means for determining also includes means for comparing the time relationship between said comparison signal and said output signal for determining whether the propagation delay provided by a selected delayed signal is substantially equal to said desired propagation delay. 4. The invention in accordance with claim 3, wherein said means for deriving a comparison signal includes a fixed delay to which said input signal is applied, said comparison signal being derived from the output signal from said fixed delay. 5. The invention in accordance with claim 4, wherein said fixed delay comprises a conductor of predetermined length. 6. The invention in accordance with claim 3, wherein said means for comparing includes a phase comparator. 7. The invention in accordance with claim 3, wherein said means for automatically selecting includes counting means, means for advancing said counting means in response to said means for determining indicating that the propagation delay provided by a selected delayed signal is not substantially equal to said desired propagation delay, and means for selecting another delayed signal for application to said circuit dependent upon the count of said counting means. 8. The invention in accordance with claim 7, wherein said means for automatically selecting includes multiplexor means responsive to the count of said counting means for selecting one of said delayed signals 9. The invention in accordance with claim 7, wherein said means for selecting another delayed signal operates such that advancement of said counting means causes selection of a delayed signal having a larger delay relative to said input signal than that of the previously selected delayed signal. 10. The invention in accordance with claim 9, including means for setting said counting means to an initial count. 11. The invention in accordance with claim 9, wherein said means for preventing operates to prevent change of the count of said counting means in response to said means for determining indicating that a currently selected delayed signal provides a propagation delay which is substantially equal to said desired propagation delay. 12. The invention in accordance with claim 9, wherein said means for preventing includes means for locking in selection of a selected delayed signal when it is determined to provide a propagation delay which is substantially equal to said desired propagation delay. 13. The invention in accordance with claim 9, including means for producing an error indication when said counting means advances to a predetermined count. 14. The invention in accordance with claim 9, including means for producing an error indication when none of said delayed signals is able to provide said desired propagation delay. 15. The invention in accordance with claim 9, wherein said delay means comprises a multi tapped delay means. 16. The invention in accordance with claim 9, wherein said delay means comprises a plurality of serially connected gates, and wherein said delayed signals are obtained from connections between said gates 17. The invention in accordance with claim 3, wherein said electrical circuit is provided on an integrated circuit chip, and wherein said electrical circuit means for automatically providing a desired propagation delay for said circuit is also provided on said chip. 18. The invention in accordance with claim 17, wherein a plurality of said chips are provided, wherein said input signal is applied to each of said chips, and wherein said predetermined delay for each electrical circuit means is chosen so that the output signals from said circuit means have substantially no skew. 19. The invention in accordance with claim 18, wherein each chip is a clock distribution circuit and said input signal is a clock. 20 A method for automatically providing a desired propagation delay for an electrical circuit with respect to an applied input signal and an output signal to be produced thereby, said method comprising the steps of producing in response to said applied input signal a plurality of input signals having different delays relative to said applied input signal selecting one of said input signals for application to said circuit determining whether the propagation delay provided by a selected one of said input signals is substantially equal to said desired propagation delay automatically selecting a different one of said input signals if the propagation delay provided by a currently selected input signal is determined not to be substantially equal to said desired propagation delay and repeating the steps of determining and automatically selecting until said determining determines that a currently selected input signal results in providing substantially said desired propagation delay. 21. The invention in accordance with claim 20 illS t the tep of preventing selection of a different input signal when it is determined that the currently selected input signal provides a propagation delay which is substantially equal to said desired propagation delay. 22. The invention in accordance with claim 21 wherein the step of preventing includes locking in selection of a selected input signal when it is determined to provide a propagation delay which is substantially equal to said desired propagation delay. 23. The invention in accordance with claim 20 wherein the step of determining includes comparing the time relationship between a first signal derived from said output signal and a second signal derived by delaying said applied input signal by a predetermined amount chosen based on said desired propagation delay. 24. The invention in accordance with claim 20 wherein the step of automatically selecting includes advancing a counter in response to the step of determining indicating that the currently selected input signal does not provide said desired propagation delay and selecting another input signal for application to said circuit dependent upon the count of said counter. 25. The invention in accordance with claim 24 wherein said selecting is arranged such that advancement of said counter increases the propagation delay provided by the selected input signal. 26. The invention in accordance with claim 25 including the step of setting said counter to an initial count prior to application of a selected input signal to said circuit. 27. The invention in accordance with claim 25 wherein the step of determining includes comparing the time relationship between a first signal derived from said output signal with a second signal having a predetermined delay relative to said applied input signal, said predetermined delay being chosen based on said desired propagation delay. 28. The invention in accordance with claim 27 including the step of preventing further advancement of said counter in response to said determining indicating that a currently selected input signal provides a propagation delay which is substantially equal to said desired propagation delay. 29. The invention in accordance with claim 28 wherein tne step of preventing includes locking In selection of a selected input signal when it is determined to provide a propagation delay which is substantially equal to said desired propagation delay. 30. The invention in accordance with claim 25 including the step of producing an error indication when the counter advances to a predetermined count. 31. The invention in accordance with claim 25 including the step of producing an error indication when none of said input signals is able to provide said desired propagation delay. 32. The invention in accordance with claim 27. wherein said method is employed for providing each of a plurality of said circuits with a propagation delay which is substantially equal to said desired propagation delay. 33. The invention in accordance with claim 32 wherein said circuits are clock distribution circuits. 34. The invention in accordance with claim 32 wherein each of said circuits is implemented on a different integrated circuit chip. 35. The invention in accordance with claim 34 wherein said method includes providing circuitry on each chip for implementing the steps of producing, selecting, determining, automatically selecting and repeating.

## Description
AUTOMATIC SIGNAL DELAY ADJUSTMENT APPARATUSBACKGROUND OF THE INVENTION This invention relates generally to data processing systems and more particularly to improved means and methods for overcoming the deleterious effects of propagation time variations in a synchronous digital data processing system. A particular problem which is caused by propagation time variations in a synchronous data processing system occurs in connection with the design of a clock distribution system. For example, propagation time variations can produce significant skewing of the clocks applied to different parts of the system. In order to prevent this skewing from creating timing problems, a conventional solution is to add the maximum skew to the minimum system cycle time so as to thereby guarantee that all data signals arrive at their destination storage elements e.g., flip flops before the clock does. In today s high performance systems either computers or other systems designed using digital devices , this increase in cycle time can have a significant deleterious effect on system speed. A primary cause of skew in a data processing system is a result of propagation time variations which occur between integrated circuit chips due to manufacturing process tolerances. This is a particularly sensitive problem in the case of clock distribution circuitry, since inter chip propagation time delays will produce skews in the clocks distributed throughout the system. One solution to the skew problem is to improve chip fabrication processes to make chips more uniform so that tolerances from chip to chip are smaller. However, the increased cost that would be involved makes this solution economically impractical. Another type of solution which has been employed to minimize skew is to provide for manual or operator controlled adjustment of the clock distribution system, such as disclosed for example in U.S. PatentNo. 4,447,870 for APPARATUS FOR SETTING THE BASIC CLOCKTIMING IN A DATA PROCESSING SYSTEM , issued May 8, 1944,S.A. Tague, et al., inventors. Besides the inconvenience of having to provide manual or operator controlled adjustment, this solution is also expensive because of the increased labor and or set up which would be required. It is to be noted that clock skew can also present problems in connection with communication receiver circuitry where signals may be received at times which are not properly in phase with a system clock.Special synchronizing techniques have been developed for handling asynchronous received signals, such as disclosed, for example, in U.S. Patent No. 3,908,084 for HIGHFREQUENCY CHARACTER RECEIVER issued September 23, 1975,P.R. Wiley, inventor. However, because of the different factors involved, such techniques are not appropriate for solving the inter chip propagation time variation problem to which the present invention is directed.SUMMARY OF THE PRESENT INVENTION A broad object of the present invention is to provide improved means and methods for reducing problems caused by propagation time differences in a data processing system. A more specific object of the invention is to provide improved means and methods for significantly reducing inter chip skew in a digital data processing system. Another object of the invention is to provide improved means and methods for significantly reducing skew in the clocks provided by a clock distribution system. Another object of the invention is to provide improved means and methods in accordance with one or more of the foregoing objects for significantly reducing skew in a relatively simple and economical manner without requiring hand or operator controlled adjustment. A further object of the invention in accordance with one or more of the foregoing objects is to provide improved means and methods for reducing skew which can be implemented with most known logic families. A still further object of the invention in accordance with one or more of the foregoing objects is to provide means and methods for reducing skew which is particularly well suited for use in VLSI very large scale integration technology. In a particular preferred embodiment of the invention, the above objects are accomplished by providing automatic clock de skewing circuitry for each of a plurality of clock distribution chips. In a preferred implementation, this automatic clock de skewing circuitry employs feedback circuitry including a multi tapped delay line and an accurate constant delay for automatically adjusting the chip propagation delay of each clock distribution chip to provide substantially the same constant predetermined delay relative to the main system clock for the output clocks provided by the clock distribution system. The specific nature of the invention as well as other objects, advantages, uses and features thereof will become evident from the following description in conjunction with the accompanying drawings.BRIEF DESCRIPTION OF THE DRAWINGS FIG. 1 is an electrical block diagram generally illustrating a conventional clock distribution system. FIG. 2 is an electrical block diagram illustrating a preferred implementation of a clock distribution chip 5a in FIG. 1 in accordance with the invention. FIGS. 3A and 3B comprise timing graphs illustrating the overall operation of the clock distribution chip 5a of FIG. 2. FIG. 4 is an electrical block diagram illustrating a more specific implementation of the clock distribution chip 5a illustrated in FIG. 2. FIG. 5 comprises timing graphs illustrating operation of the implementation of FIG. 4 for a specific example of automatic clock delay adjustment in accordance with the invention. FIG. 6 is an electrical block diagram illustrating how error checking may additionally be provided for the implementation of FIG. 4. FIG. 7 comprises timing graphs illustrating the operation of FIG. 6. DETAILED DESCRIPTION OF THE INVENTION Like numerals and characters designate like elements throughout the drawings. Referring initially to FIG. 1, illustrated therein is a clock distribution system 5 employing a plurality of clock distribution chips 5a responsive to a main clock C for distributing clock signals Cs to data processing circuitry 8 in a conventional manner. As pointed out previously herein, it is important that the distributed clock signals Cs from all chips 5a be substantially synchronized with one another i.e., have substantially the same constant delay relative to the main clock C so that the system cycle time does not have to be lengthened to accommodate skew variations. Referring next to FIG. 2, illustrated therein is a particular preferred implementation of a clock distribution chip 5a in FIG. 1 incorporating means for automatically adjusting the relative delay between an output clock Cs and the main system clock C to a desired constant value. It is to be understood that the other chips 5a shown in FIG. 1 are preferably implemented in a like manner so that all of the resulting distributed clock signals C applied to the data processing circuitry 8 may be adjusted to provide substantially the same constant delay relative to the main clock C, thereby substantially eliminating any skew therebetween. The preferred implementation of the clock distribution chip 5a shown in FIG. 2 will now be considered in more detail. As shown, a main clock C is applied to a multi tapped delay line 12 which provides a plurality of outputs 12a having successively larger delays relative to the main clock C depending upon their location along the multi tapped delay line 12. As shown, the multi tapped delay line 12 may, for example, comprise a string of gates 12b. The delay line outputs 12a in FIG. 2 are applied to a multiplexor 14 which selects a particular one of the outputs 12a as determined by a count output 18a applied thereto from a delay line counter 18. The resulting selected clock C1 appearing at the output of the multiplexor 14 is applied to conventional clock driver circuitry 16 located on the same chip for producing the output clock signals C8 to be distributed to the data processing circuitry 8 FIG. 1 . Since in the preferred embodiment the clock driving circuitry 16 is all on the same chip, negligible skew occurs among the output clock signals Cs and they may therefore be assumed to have substantially the same constant delay relative to the main clock C.However, clock signals Cs produced by other ones of the chips 5a in FIG. 1 can be expected to have significantly different delays relative to the main clock C because of chip to chip variations. The manner in which the preferred embodiment of FIG. 2 being described provides for automatically obtaining a substantially constant clock delay for the clock signalsCs produced by all of the chips 5a in FIG. 1 will become evident as the description of FIG. 2 progresses. It will be seen in FIG. 2 that, besides being applied to the multi tapped delay line 12, the main clock C is also applied to an accurate fixed delay 24 which produces a delayed clock signal Cd having a delay do relative to the main clock C. This delayed clock signal Cd is applied to one input 26a of a phase comparator 26 while a representative output clock signal C from the clock driver circuitry 16 is fed back to S the other phase comparator input 26b. Basically, operation of the preferred clock distribution chip 5a in FIG. 2 is caused to be such that, each time the phase comparator 26 detects that the clock signals Cd and Cs have different delays relative to the main clock C as illustrated for example by d in FIG. 3A , a count signal is caused to be produced at the phase comparator output 26c.This count signal causes the counter 18 to count from an initial count set by a start signal S applied to the counter reset input R until the count output 18a reaches a count such that the output 12a selected by the multiplexor 14 produces an output clock signal C8 having substantially the same delay do relative to the main clock C as the delayed clock Cd as illustrated for example in FIG. 3B , at which time the count signal is removed so that the then existing delay do provided forCs relative to the main clock C remains constant. Thus, the circuit of FIG. 2 will have automatically been adjusted to provide output clock signals Cs having an accurate delay relative to the main clock C, as determined by the accurate delay 24. Since all of the clock distribution chips 5a in FIG. 1 can be designed in a like manner, the clock signals Cs from all of the chips 5a of the clock distribution system can automatically be provided with substantially the same delay relative to the main clock C in this advantageous manner, which may be accomplished for example during power on initialization. An advantage of the preferred embodiment illustrated in FIG. 2 is that the accurate delay 24 may simply and economically be implemented using a known length of wire or microstrip. In addition, the string of gates 12b used for the multi tapped delay line 12 may also be simply and economically implemented. Although the accuracy obtained using such a string of gates 12b is poor, there is no deleterious effect on circuit performance, since inaccuracies will automatically be tuned out by the feedback action. Referring next to FIG. 4, illustrated therein is a more specific preferred embodiment of a chip 5a inFIG. 1. Components which perform functions similar to those which have already been considered in connection with FIG. 2 have been given the same designations. Also, components in FIG. 4 which are not specifically shown inFIG. 2 have been given numbers greater than 100. As in FIG. 2, the main clock C in FIG. 4 is applied to the multi tapped delay line 12 whose outputs 12a are in turn applied to the multiplexor 14 which operates in response to the count output 18a provided by the counter 18 to select a particular one of these outputs 12a for application to the clock driver circuitry 14 for producing the output clock signals C5. Also as in FIG. 2, the main clock C in FIG. 4 is applied, via the accurate delay 24, to the phase comparator input 26a, while a representative output clock signal Cs from the clock driver circuitry 16 is applied to the other phase comparator input 26b. FIG. 4 shows that this phase comparator 24 may typically comprise a flip flop 124 wherein the flip flop input D serves as the phase comparator input 26a to which the delayed clock signal Cd is applied, wherein the flip flop clock input K serves as the phase comparator input 26b to which the output clock signal Cs is applied, and wherein the flip flop output Q serves as the phase comparator output 26c.As will be noted in FIG. 4, the clock signal Cs is used as the clock applied to the clock inputs K of the clocked components such as counter 18 and flip flop 124 while the start signal S provided for example during power up initialization is applied to the reset inputs R of these components for resetting them to desired initial states. FIG. 5 illustrates typical graphs for the main clock C, the delayed clock Cd, the output clock C, the phase comparator output 26c and other pertinent outputs in the embodiment of FIG. 4 during a typical example of automatic clock delay adjustment. For greater clarity, the waveforms shown in FIG. 5 as well as those shown in FIGS. 3A, 3B and 7 are illustrated in idealized form. As illustrated in FIG. 4, the phase comparator output 26c Graph D in FIG. 5 is applied to an OR gate 110 via a string of two flip flops 111 which provide a two clock delayed phase comparator signal 26d Graph E . The use of this string of flip flops 111 is advantageous in that it reduces meta stability problems in the logic following thereafter. If at the rise of the clock C5 Graph C the delayed clock Cd Graph B is low because the delay of C5 relative to the main clock C does not equal that of Cd as indicated by d1 in Graph C see also FIG. 3A , then the phase comparator output 26c Graph D will also be low. Since this phase comparator output signal 26c is applied to the string comprised of the two flip flops 111, the delayed phase comparator output signal 26d Graph E will correspond to that of the phase comparator output signal 26c two clock periods earlier. As shown in FIG. 4, the delayed phase comparator output signal 26d Graph E is applied to an input of anOR gate 110, while a lock flip flop 112 applies a lock signal 112a which is initially set to a low value to another input of the OR gate 110. The OR gate 110 has two outputs, an OR output 110a and an inverse OR output 110b. Thus, when the phase comparator output signal 26c Graph D is low, the OR output 110a will be low while the inverse OR output 110b will be high, and vice versa, when the phase comparator output signal 26c is high. Still with reference to FIG. 4, the inverse OR output 110b is applied to an input of an AND gate 114 while the OR output 110a is applied to an input of anAND gate 116. Applied to two other inputs of each of theAND gates 114 and 116 are the outputs 117a and 117b of a 2 bit counter 117 whose four counts 0, 1, 2 and 3 are illustrated in Graph F of FIG. 5. It will be understood that the logic performed by OR gate 110 and AND gates 114 and 116 in conjunction with the 2 bit counter 117 is such that, each time the count of the 2 bit counter 117 reaches 3, the AND gates 114 and 116 will be enabled since at the count of 3 both counter outputs 117a and 117b will be high.Thus, each time the AND gates 114 and 116 are enabled as a result of the counter 117 reaching the count of 3 , the AND gate output 114a Graph G will correspond to the state of the inverse OR output 110b, which in turn corresponds to the inverse of the current state of the delayed phase comparator output signal 26d Graph E , while the AND gate output 116a Graph H will correspond to the current state of the OR output 110a, which in turn corresponds to the state of the lock signal 112a. As will be understood from the example illustrated in FIG. 5, when the 2 bit counter 117 Graph F first reaches a count of 3 causing AND gates 114 and 116 to be enabled , the delayed phase comparator output 26d Graph E will be low since the delay of the output clock C5 Graph C is less than that of the delayed clock Cd as indicated by the delay difference d1 in Graph C . As a result, the resulting high level appearing at the inverse OR output 110b will cause the AND output 114a Graph G to become high during count 3 of the two bit counter 117 Graph F , which in turn will cause the delay line counter 18 Graph H to advance from its initial count 0 to count 1, causing the multiplexor 14 to select the next greater delay line tap 12a.This increases the delay of C5 such that a reduced delay difference d2 Graph C is obtained between C5 and Cd. Since the OR output 110a will be low during count 3 of the 2 bit counter 117, the AND gate output 116a Graph I will also be false so that, when applied via an OR gate 120 to the data input D of the lock flip flop 112, the lock flip flop output 112a Graph I inFIG. 5 will remain low. When the two bit counter 117 Graph F in FIG. 5 reaches count 3 for the second time, the delayed phase comparator output Graph E will still be low because of the remaining delay difference d2 Graph C between C5 and Cd. Thus, as described for the previous arrival of the 2 bit counter 117 at count 3 Graph F , the AND output 114a will again become high to now advance the delay line counter 18 Graph H to count 2 while the lock flip flop output 112a again remains low. For the particular example illustrated in FIG. 5, it is assumed that the advance of the delay line counter 18 to its second count causes the delay of C8 to be increased so that the delay of C5 relative to the main clcck C Graph A is substantially equal to the delay ofCd relative to C, as indicated by the d3 0 designation in Graph C of FIG. 5. As a result of having achieved this match between Cs and Cd, the phase comparator output 26a now becomes high, as shown in Graph D ofFIG. 5, which in turn causes the delayed phase comparator output 26d Graph E to become high two clock periods later, which period corresponds to the third arrival of the 2 bit counter 117 at count 3 Graph F .Thus, during this third occurrence of count 3 of the two bit counter 117, the AND output 114a Graph G will now be low while the AND output 116a Graph H will become high Graph I and pass via OR gate 120 to the input of the lock flip flop 112 so as to also set the lock signal 112a high as shown in Graph J. It will be understood that when the lock signal 112a becomes high as just described, it will be locked in this high setting because the lock signal 112a is fed back via OR gate 120 to the data input of the lock flip flop 112. It will also be understood that since the lock signal 112a is also applied to OR gate 110, this locked in high level of the lock signal 112a will thereafter cause a low level output to be applied toAND gate 114 to prevent its being enabled. Thus, any further advancement of the delay line counter 18 is prevented, thereby locking in the desired matched relationship between Cd and Cs.It will be noted in this regard that the 2 bit counter 117 is advantageous in that it provides for alternating between detecting the phase difference between Cd and C5 and advancing the counter 18, thereby facilitating the locking in of the desired matched relationship between C5 and Cd. FIG. 6 illustrates how error checking may additionally be provided for the implementation ofFIG. 4. Two types of error checking are illustrated inFIG. 6. First, a counter decoder 130 is provided to which the count of the delay line counter 18 in FIG. 2 is applied. The decoder 130 is constructed and arranged in a conventional manner to provide a high output signal 130a via an OR gate 132 to the data input D of an error flip flop 134. If the count of the delay line counter 18 advances beyond a predetermined maximum count indicating that the delay required to be added to Cs in order to match Cd is greater than can be provided by the delay line 12 , the decoder output 130a becomes high to set the error flip flop 134 so as to thereby set the error flip flop output 134a high, indicating an error. A second type of error checking illustrated inFIG. 6 is provided by applying the delayed clock signalCd to the error flip flop 134 via the OR gate 132 to an error check delay circuit 136 which produces an additionally delayed clock signal Cde. Graphs A, B andC in FIG. 7 illustrate typical waveforms for C, Cd and Code, respectively. It will be understood that if, as illustrated by d in FIG. 7, the delay of Cs relative to the main clock C is greater than Cde in which case no proper match can be obtained between Cs and Cd , then the error flip flop 134 will be set since both Cs andCde will be high to set the error flip flop output 134a high to indicate an error. Once set, the error flip flop 134 remains set since the error flip flop output 134a is fed back via OR gate 132 to the data input D of the error flip flop 134. Although the present invention has been described with reference to particular preferred embodiments, it is to be understood that various modifications in construction, arrangement and use are possible without departing from the true scope and spirit of the present invention. For example, the invention disclosed herein is also applicable for deskewing or controlling the delay provided between other types of signals as well as clock signals. Accordingly, the present invention is to be considered as encompassing all possible modifications and variations coming within the scope of the appended claims.