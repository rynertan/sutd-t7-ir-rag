# PERIPHERALLY SYNCHRONIZED DATA TRANSFER SYSTEM

## Claims
In einem Netzwerk, in dem Daten zwischen einem Host Hauptcomputer 10 und einer Magnetbandperipherieeinheit 50

## Description
This invention is related to systems where data transfers are effected between magnetic tape peripheral terminal units and a main host computer wherein an intermediate I O subsystem involving a peripheral controller is used to perform the housekeeping duties of the data transfer. A continuing area of developing technology involves the transfer of data between a main host computer system and one or more peripheral terminal units. To this end, there have been developed I O subsystems which are used to relieve the monitoring and housekeeping problems of the main host computer and to assume the burden of controlling a peripheral terminal unit and to monitor control of data transfer operations which occur between the peripheral terminal unit and the main host computer system. A particular embodiment of such an I O subsystem has been developed which uses peripheral controllers known as data link processors whereby initiating commands from the main host computer are forwarded to a peripheral controller which manages the data transfer operations with one or more peripheral units. In these systems the main host computer also provides a data link word which identifies each task that has been initiated for the peripheral controller. After the completion of a task, the peripheral controller will notify the main host system with a result descriptor word as to the completion, incompletion or problem involved in the particular task. These types of peripheral controllers have been described in a number of patents issued to the assignee of the present disclosure and these patents are included herein by reference as follows U.S. Patent 4,074,352 issued February 14, 1978, entitled Modular Block Unit for Input Output Subsystem , inventors D.J. Cook and D.A. Millers, II. U.S. Patent 4,162,520 issued July 24, 1979, entitled Intelligent Input Output Interface Control Unit for Input Output Subsystem , inventors D.J. Cook and D.A. Millers, II. U.S. Patent 4,189,769 issued February 19, 1980, entitled Input Output Subsystem for digital Data Processing System , inventors D.J. Cook and D.A. Millers, II. U.S. Patent 4,280,193 issued July 21, 1981, entitled Data Link Processor for Magnetic Tape Data Transfer System , inventors K.W. Baun and J.G. Saunders. U.S. Patent 4,313,162 issued January 26, 1982, entitled I O Subsystem Using Data Link Processors , inventors K.W. Baun and D.A. Millers, II. U.S. Patent 4,322,792 issued March 30, 1982, entitled Common Front End Control for a Peripheral Controller Connected to a Computer , inventor K.W. Baun. US Patent 4,293,928 discloses a peripheral dependent circuit for providing the specific functions required for data transfers between a peripheral terminal unit and a peripheral controller made up of a common control circuit card and a peripheral dependent circuit board. The peripheral dependent circuit board provides logic means for executing micro code word operators received from the common control circuit card and provides multiplexor means for selecting a source of data that is to be transmitted in a RAM buffer memory. The peripheral dependent board also provides address logic means for formulating addresses to be used for the reading and writing of data out of and into the RAM buffer memory. The present invention relates to a network wherein data is transferred between a main host computer and a magnetic tape peripheral unit via a peripheral controller, wherein said peripheral controller is initiated by commands from said host computer to execute data transfer operations and said peripheral controller includes a common control circuit unit for sequencing microcode instructions and a peripheral dependent circuit unit for managing said tape peripheral unit, said peripheral dependent circuit unit having its own internal basic clock unit, a system for regulating data transfer operations from a magnetic tape peripheral unit to said peripheral controller, said regulating system comprising buffer memory means in said peripheral controller for temporarily storing blocks of data being transferred, said buffer memory means having channels of connection to said tape peripheral unit and said host computer status means in said peripheral dependent circuit unit for providing information data for indicating the number of blocks of data residing in said buffer memory means signal output means connected to said status means and functioning to provide status signals to said common control circuit unit a tape control unit connecting a plurality of magnetic tape peripheral units to said peripheral dependent circuit unit and wherein said tape control unit provides synchronizing signals to said peripheral dependent circuit unit for the transfer of data to said buffer memory means and latching logic means in said peripheral dependent circuit unit for receiving data from said tape control unit for subsequent transfer to said buffer memory means. The invention is characterised in that said peripheral dependent circuit unit includes flag logic circuitry connected to receive clock signals from synchronization logic means regulated by clock signals from said tape control unit for periodically enabling said latching logic means to transfer data received, by said latching logic means, to said memory buffer means, said flag logic circuitry functioning to develop information signals for said latching logic means so as to permit data transfer to latching registers in said latching logic means when they are cleared of previous data inputs. FIG. 1 is an overall system drawing of the elements involved in data transfer operations between host computer and magnetic tape peripheral terminals. FIG. 2 is a block diagram of the common control circuit of the peripheral controller, also called the common front end. FIG. 3 is a block diagram of the first circuit card of the peripheral dependent circuit of the peripheral controller. FIG. 4 is a block diagram of the second circuit card of the peripheral dependent circuit of the peripheral controller. FIG. 5A is a circuit drawing of the circuit for synchronizing data transfer from the tape control unit to the peripheral controller. FIG. 5B is a logic circuit used for control of automatic Read operations for transferring data from magnetic tape units to the peripheral controller. FIG. 5C is a chart illustrating operation of the automatic Read logic circuit. FIG. 6 is a circuit diagram of the latching logic for the automatic Read circuit. FIG. 7 is a diagram illustrating operation of the latch enable function of FIG. 5A. FIG. 8 is a timing diagram showing use of the automatic Read and latching circuitry. To initiate an operation, the host system 10, FIG. 1, sends the peripheral controller data link processor 20 When the operation is completed, the DLP 20 The data link processor 20 As previously discussed in the referenced patents, the MT DLP utilizes the following status states STC transitions when disconnected from the host The DLP status states can be represented in a shorthand notation such as STC n. Upon completion of an I O operation, the data link processor forms and sends the result descriptor to the host system. This descriptor contains information sent by the tape control unit 50 All communications between the DLP 20 When in STC 3 IDLE , the DLP can accept a new I O descriptor. When in STC 1 DISCONNECT or in STC 5 SEND DESCRIPTOR LINK , then the DLP is busy performing a previously transferred operation. When the DLP receives an I O descriptor and descriptor link that does not require immediate attention, the DLP stores the descriptor in its descriptor queue. The DLP is then able to receive another I O descriptor from the host system. When the host system 10 Disconnects from the DLP 20 The DLP searches its descriptor queue on a rotational basis. The order for search is not disturbed by the receipt of one or more new I O descriptors, nor by the execution of operations. This means that all queued entries are taken in turn regardless of DLP activity and all units have equal priority. When cleared, the DLP halts all operations in progress with the peripherals and invalidates all the queued I O descriptors, and returns to Status STC 3 IDLE . The data buffer 22 FIG. 1 of the DLP provides storage for six blocks of data which are used in a cyclic manner. Each of the six blocks holds a maximum of 512 bytes of data. Data is transferred to or transferred from the host system one block at a time, via the buffer 22, followed by a longitudinal parity word LPW . Data is always transferred in full blocks 512 bytes except for the final block of data for a particular operation. This last block can be less than the 512 bytes, as may be required by the particular operation. As seen in FIG. 3, logic circuitry to be described hereinafter is used to feed information to a block counter 34 During a Write operation, the block counter 34 After the data link processor has transmitted one block of data to the tape control unit, the data link processor attempts to reconnect to the host system by means of a poll request as long as the host 10 has not terminated the operation . Once this reconnection is established, the host transfers additional data to the data link processor. This transfer continues until either the six blocks of RAM buffer memory 22 are again full a buffer which is in the process of being transferred to the tape control unit is considered full during this procedure , or until the host 10 sends a Terminate command. Data transfer operations between the data link processor 20 If the data link processor has not successfully reconnected to the host before the DLP has transmitted, for example, three blocks of data to the tape control unit 50 The last block of data for any given I O operation is transferred to the tape control unit 50 If the host does not respond to the poll request before four blocks of data are present in the DLP RAM buffer 22, the data link processor sets emergency request on the data link interface 20 Once the host system answers a poll request , the data link processor 20 When the data link processor has completed data transfer, the tape control unit 50 Referring to FIG. 1, the overall system diagram is shown whereby a host computer 10 is connected through an I O subsystem to a peripheral unit, here, for illustrative purposes, shown as a tape control unit 50 In this network situation, it is often desired that data from the main host computer be transferred on to a peripheral unit, such as a magnetic tape unit, for recording on tape. This would be done via a peripheral tape control unit TCU such as 50 The key monitoring and control unit is the data link processor 20 The RAM buffer 22 of FIGS. 1, 2 is used for temporary storage of data being transferred between peripherals and the main host computer. In the preferred embodiment this RAM buffer has the capability of storing at least six blocks of data, each block of which consists of 256 words. The Magnetic Tape Data Link Processor MT DLP consists of three standard 96 chip multi layered printed circuit cards that plug into adjacent slots in the backplane of the base module FIG. 1 . The base module for this system has been previously described in U.S. 4,322,792 and the previously referenced patents. The common front end card 10 In addition to the common front end card 10 The PDB 1 card contains The second peripheral dependent board card designated PDB 2 contains the following As discussed in the previously referenced patents, each card in the peripheral controller Data Link Processor has foreplane connectors through which frontplane cables can interconnect these cards. The cards are slide in cards which connect at the backplane connectors into the base module. The top two foreplane connectors of all three cards of the DLP are interconnected by means of three connector, 50 pin foreplane jumper cables. The common front end is connected to the first board, PDB 1, via connector and cable and the board PDB 1 is connected to the second board, PDB 2, via another connector and cable. This is done by means of two connector, 50 pin foreplane jumper cables. From the connector on the second board PDB 2, there is a 50 conductor cable which is connected to an interface card which plugs into an interface panel board. Connections to the tape subsystem TCU 50 In FIG. 2 there is seen a basic block diagram of the common front end card which has previously been described in U.S. Patent 4,322,792 entitled Common Front Control for a Peripheral Controller Connected to a Computer , inventor Kenneth W. Baun. The most significant item of the common front end card designated as 10 PROM 13 consists of 13 PROM chips of 1K X 4 bit chips which are connected in parallel to form the 1K X 52 bit PROM. The contents of these PROMs 13 are called the microcode which controls all of the DLP functions. The microcode address lines, designated A0 A9, are wired in parallel to all 13 chips. The eight megahertz clock PROMCLK latches the next 52 bit microcode word output from the PROM 13 into the microcode register 14. The common front end card 10 Seventeen 1K x 1 bit RAM chips are connected in parallel to make up the random access buffer memory 22 on the common front end card 10 An additional 1K X 17 bit RAM buffer memory 22₂ is provided on the PDB 2 card 80 The high chip select signal selects the extended buffer RAM 22₂ on PDB 2. All the data inputs and data outputs to the RAM buffer memories are sourced, sunk and controlled by the peripheral dependent boards PDB 1 and PDB 2. The common front end 10 The common front end card contains the receivers and control logic which enables connection to a maintenance card in the base module, and which governs test diagnostics for the data link processor. The CFE 10 The maintenance interface line SWH.1 .0 is used to override the microcode PROM address. When the DLP is connected to the maintenance card, and when this line is low , the DSIMxx 0 lines provide the microcode addresses. This permits the verification of the contents of the microcode, and also allows special microcode words to be used to govern DLP action during diagnostics. The primary function of the peripheral dependent boards PDB 1, PDB 2 is to provide the interface to the peripheral tape subsystem which is controlled by tape control unit 50 Two twelve bit address registers P The arithmetic logic unit 32 The ALU 32 receives input data from a 4 X 1 multiplexor 32 The data path on the PDB 1 card of FIG. 3 consists of two latches, 33 The block counter 34 of FIG. 3 keeps track of the number of data blocks available for transfer or for acceptance with the host system and with the tape subsystem, 50 The MT DLP has capabilities of utilizing a burst mode data transfer mode wherein data can be transferred to the host system at the maximum DLI rate of 64 megabits per second depending upon the speed capability of the host system . When in the burst mode, the 8 bit burst counter 36 A converter 32 FIG. 4 shows a block diagram of the second peripheral dependent board designated PDB 2. This card contains an extension RAM 22₂ of the RAM memory 22 which is located on the CFE card 10 The extended RAM memory 22₂ on PDB 2 FIG. 4 is a 1K X 17 bit memory which uses the same address lines and the same write enable as the common front end RAM buffer memory 22. A high chip select signal selects the extended RAM 22₂, as previously discussed. Unique to the magnetic tape data link processor is the logic known as the auto write and auto read logic 50 During a Write operation, the block counter 34 After the data link processor has transmitted one block 256 words of data to the tape control unit, the data link processor attempts to re connect to the host system by means of a poll request . Once this re connection is established, the host transfers additional data to the buffer 22 of the data link processor. This transfer continues until either the six blocks of RAM buffer memory are again full a buffer which is in the process of being transferred to the tape control unit is considered full during this procedure , or until the host sends a terminate command. Data transfer between the data link processor and the tape control unit 50 If the MT data link processor has not successfully reconnected to the host before the DLP has transmitted three blocks of data to the tape control unit, the data link processor sets emergency request on the data link interface 20 The last remaining block of data for any given I O operation is transferred to the tape control unit 50 If the host does not respond to the poll request before four blocks of data are present in the DLP RAM buffer 22, the data link processor sets emergency request on the data link interface DLI . If no connection to the host system is effectuated before all of the six RAM buffers are filled, then the data link processor sets host access error in the result descriptor. Once the host system answers a poll request , the data link processor 20 In the normal situation when there are more than two blocks of data to be transferred to the host system, the DLP sets the burst counter 36 When the data link processor has completed data transfer, the tape control unit enters a Result Phase and sends two words of result status to the data link processor. The DLP then incorporates this information, plus any internal result flags, into the result descriptor which the DLP 20 Referring to FIG. 3, a block counter logic unit 33 The address data outputs from P The block counter 34 Referring to FIG. 3, if there is a Write operation, this determines that data is to be written into the magnetic tape unit. Then, as data is removed from the RAM buffer 22 over to the magnetic tape unit, the block counter 34 The condition known as the host access error causes the setting of a flip flop 34 During Read operations During Read operations, when a 1 appears in the 6th bit position of block counter 34 During Write operations, when the buffer memory 22 has received six blocks of data from the host system, and the 1st bit position 1 BLKFUL becomes 0 , this indicates that the buffer memory has been completely unloaded cleared and then the flip flop 34 Thus, the Data Link Processor 20 Referring to FIG. 3, there is again seen a block diagram of the main elements of the peripheral dependent card PDB 1 which is used in the magnetic tape peripheral controller. In addition to individual word data transfer operations, the system operates to permit automatic transfers of data without need for repeated instruction routines. Thus, the microcode from common control circuit 10 For data transfers between the magnetic tape peripherals via tape control unit 50 The Cycle Steal unit 50 In FIGS. 3, 5A, the TCU clock synchronizer 59 receives signals from the tape control unit TCU clock shown as TCU clock input to synchronizer 59. The synchronizer 59 also receives an eight megahertz clock signal designated CLK8 . The TCU clock synchronizer 59 is used during Read operations whereby data from a selected magnetic tape unit is sent via the tape control unit TCU 50 In FIG. 4 the automatic read logic 50 The purpose of the clock synchronizer 59 is to regulate and clock the sequence of data which is read out from the magnetic tape peripheral unit for transfer over to the RAM buffer 22 of the peripheral controller 20 Thus, the clock signals TCU from the tape control unit 50 In FIG. 4 the bi directional line INFO at the top left of this drawing connects to the peripheral tape control unit while the bus PRIF at the upper right hand side of FIG. 4 connects to the 4 1 multiplexor 32 Referring to FIG. 5A, there is shown the clock synchronizer 59 in greater detail. As seen in FIG. 5A, the TCU clock signal is conveyed from the tape control unit TCU 50 The output of receiver 141 in FIG. 5A is designated TCU clock and is fed to the D flip flop 145 which has a second input CLK8 . The Q output of the D flip flop 145 provides the TCLK signal for Automatic Read . The In FIG. 5B there is shown the use and development of flag signals from the tape control unit 50 The two output lines of counter 151 are designated TCU flag 1 and flag. 2. These lines are conveyed over to D flip flop 153 which also has an 8 megahertz clock input. The outputs of D flip flop 153 are designated CTCU flag 1 and flag 2. These are signals which are delayed one clock time over the signals TCU flag 1 and flag 2. The logic unit 154 receives the two CTCU flag signals flag 1 and flag 2 and provides three output lines, designated TCUFLG, EFEMPTY and EEMPTY. These output signals of the logic unit 154 are tabularly shown in FIG. 5C as reflective of certain conditions that occur with respect to the word latches E and F 51 Referring to FIG. 6, there is shown the latching logic for Automatic Read operations in the magnetic tape peripheral controller. Here in FIG. 6 it will be seen that the signal EFLATEN E latch, F latch enable are derived from the output of NAND gate 144 of FIG. 5A. This signal feeds to both NAND gates 156 The output of 156 The output of NAND gate 156 It will be noted that NAND gate 159 provides the latch enable signal to the F latch 51 Thus, the combination effect of the latch enable signals to the E latch and to the F latch is to permit a word to be latched into the E latch and then transferred and latched into the F latch after which it can be transferred to a location in the buffer 22. Thus, in Automatic Read operations the combination of clock signals from the tape control unit 50 Referring to FIG. 5C, there is seen a tabular scheme chart which indicates the relationships of the logic signals from logic unit 154, the input flag signals to the logic unit 154 and the status of the input latches for the E latch 51 As seen in FIG. 5C, when the E latch and the F latch are both empty , then the output line EFEMPTY is active while the other two output lines of logic unit 154 are inactive. When the E latch is empty and the F latch is full, then the output logic line EFEMPTY is inactive while the other two lines TCU flag A and EEMPTY are both active . When both the E latch and F latch are full that is to say, when each of them has a single word being held within it , then it will be seen that the TCUFLGA line is active while both the other two lines are inactive . If there should be an error because the latches are both full and thus some data may have been lost in transmission , then all three output lines of the logic unit 154 will be inactive in order to indicate the error status. As seen in FIG. 7 and in further clarification of FIG. 5A, the TCU clock is connected to the JK flip flop 142 which provides the output signal INFLAG. This signal is ANDed with the SEND signal to provide the signal EFLATEN. This signal EFLATEN means that the Read operation and the receipt of the data strobe clock from the tape control unit peripheral will put data into the E or F latch. Thus, the peripheral controller 20 The peripheral controller described herein permits data transfers from magnetic tape peripherals to temporary buffer memory storage in the controller in an orderly synchronized fashion regulated by the peripheral.