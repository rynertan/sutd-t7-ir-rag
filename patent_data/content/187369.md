# POWER SUPPLY SYSTEM FOR AN ELECTRONIC APPARATUS HAVING MEMORY

## Claims
Stromkreis zur Versorgung eines elektronischen Ger√§tes mit einem Speicher 4 mit elektrischem Strom, umfassend

## Description
This invention relates to a power supply system for an electronic apparatus incorporating a volatile memory and, particularly, to a power supply system suitable for use with a data processing system. A conventional power supply circuit for a volatile memory is disclosed in Japanese Patent Unexamined Publication No. 57 23123. This prior art circuit arrangement is intended to automatically switch the supply of electric power from the main power supply to the battery in response to the turn off operation of the main power supply. However, this system needs a battery of large capacity depending on the expected turn off duration of the main a.c. power supply, since the battery is used continuously during the power off state regardless of the presence or absence of the a.c. power input. Another prior art technique disclosed in Japanese Patent Unexamined Publication No. 56 168246 is the use of a battery in response to the detection of a.c. power failure. However, this system operates in response to two conditions, i.e., the output voltage of a main power supply has built up or a.c. power failure exists, and there is no description in the publication on the power off operation of the main power supply. Accordingly, when the main power supply is turned off, battery back up is started as in the case of power failure, resulting in over discharging of the battery. Another technique similar to that of the above patent publication 56 168246 is discribed in Japanese Patent Unexamined Publication No. 59 24323. This publication does not describe the power off operation of the main power unit and power failure and power off can not be distinguished, resulting in over discharging of the battery. Still another technique disclosed in Japanese Patent Unexamined Publication No. 56 116134 is intended to operate such that the battery back up for the volatile memory is suspended upon expiration of a certain time length after the state of power failure has been detected so as to prevent over discharging of the battery. Also in this publication, no description is given for the power off operation for the main power supply, and the system treats the power failure in the power off state in the same way as the power failure in the power on state, resulting in over discharging of the battery. Another prior art document is US A 3 980 935. It discloses an assembly of a main power supply which can be switched off by the main power switch, a seconcary power supply which cannot be switched off by the power switch and a battery supply. However, this document gives no teaching concerning the preventing of over discharge of the battery in case of a failure in the secondary power supply. An object of this invention is to prevent over discharging a back up battery during the power off state of the main power supply. Another object of this invention is to prevent over discharging of a back up battery through the setup of different battery back up time lengths for the power failure occuring in the power on state and for the power failure occurring in the power off state. These objects are solved by the features in the main claim, dependent claims are directed to preferred embodiments of the present invention. Generally, a memory device consumes a relatively large power when it is accessed, while it needs little power for holding information. In view of this property of memory devices, the present invention contemplates to supply power to the apparatus from a main power source during the power on state in which power consumption is high due to memory access, from an auxiliary power source during the power off state, i.e., standby mode, and from a battery only in the event of power failure. In consideration of the battery service life which is deteriorated by over discharging, the battery back up time is set longer for the case of occurrence of power failure during power on state at which occurrence no time is available for evacuating important information to a non volatile memory such as a floppy disk, and a shorter battery back up time is set for the case of occurrence of power failure during power off state in which power off state important information has already evacuated, so that the over discharging of the battery is prevented. An embodiment of this invention will now be described with reference to Fig. 1. Only a power supply section and a memory section of a data processing system are illustrated in Fig. 1. In the figure, reference numeral 1 denotes a plug for receiving the external a.c. input power supply voltage Vin, and 2 denotes a power unit incorporating rectifiers for converting the a.c. input voltage into d.c. voltages. The power unit 2 includes a main power source 8 which provides a d.c. output V The main power output V The auxiliary power output V Reference numeral 20 denotes a CMOS logic circuit operating under the battery voltage and it produces an output signal for terminating the battery back up for the DRAM 4 upon expiration of two hours, for example, in the case where the power failure has occurred during the power on state, or for terminating the battery back up upon expiration of 15 minutes, for example, in the case where the power failure has occurred during the power off state. Reference numeral 26 denotes a clock generator which supplies the clock signal to the CL terminal of a clock counter 27. The counter 27 is reset to the initial state by receiving at its R terminal the reset signal which is produced by a driver 28 in response to the detection of the build up of the auxiliary power output voltage V A console 30 provides the P.OFF N signal 25 indicating the power off state, but the signal is not produced when the power unit 2 is deactivated without through the power off operation as in the case of power failure. The P.OFF N signal is fed to one input of a logical AND gate 22, which has another input connected to the C1 output of the clock counter 27. The AND gate 22 has its output connected to the set terminal of a flip flop 23. The console 30 provides another output signal P.ON P indicating the power on state, and it is fed to the reset terminal of the flip flop 23. A logical OR gate 24 has two inputs from the flip flops 29 and 23, and supplies its output to the base of the transistor Q2 so that it is forced to cut off. Reference numeral 6 denotes a static random access memory SRAM operating under the battery voltage V The DRAM is provided with the battery back up for a limited duration in the occurrence of power failure so as to spare much battery power for the SRAM which is battery backed up continuously so that information is retained. Information stored in the DRAM includes program preset data, and information stored in the SRAM includes input data received consecutively in the power on state. Next, the operation of the foregoing circuit arrangement will be described in connection with Fig. 2 showing the timing relationship between the major signals. As initial conditions, it is assumed that the battery V Next, when the power unit 2 is brought to the power off state, the main power output V In the case where power failure occurs in the a.c. power input Vin during the normal power off state, the auxiliary power output V The loss of the auxiliary power output V If power failure occurs abruptly during the normal power on state, the power off indication signal P.OFF N 25 is not produced, causing the AND gate 22 to stay disabled even if the clock, counter 27 provides the output at C1 on expiration of 15 minutes, and the flip flop 23 is not set. In the case of the main a.c. power not recovering on expiration of two hours, the clock counter 27 produces the output signal on its terminal C2, causing the flip flop 29 to set, and the OR gate 24 is enabled. The OR gate output forces the transistor Q2 to cut off, resulting in the cut off of the transistor Q1, and the battery backup is terminated. Accordingly, a 2 hour battery back up takes place for the a.c. power failure during the power on state. Generally, information in the volatile memory is saved in a non volatile memory such as a floppy disc unit or fixed disc unit prior to the power off operation. When the internal memory is powered by the auxiliary power source to retain the contents during the power off state, the time spent for reloading the saved information following the power on operation can effectively be minimized. The auxiliary power source for this purpose is preferably backed up by the battery so as to avoid the risk of power failure during the power off state. However, a greater battery power consumption needs a longer charging time, and based on the fact that important data has been saved in the non volatile memory before power failure occurs in the power off state, the internal memory is battery backed up for a relatively short time 15 minutes in this embodiment so as to minimize the discharging of the battery. Namely, it cannot be distinguished during the power off state as to whether the loss of a.c. power is caused by an accidental power failure, disconnection of the power plug, or turning off of the a.c. power switch, and a shorter time is allowed for the battery back up of these cases so that the battery power is spared for a long term power failure after power is turned on. On the other hand, power failure during the power on state allows no time for saving the memory contents in the non volatile memory, and therefore the internal memory is battery backed up for a longer time two hours in this embodiment in expectation of a.c. power recovery. According to this invention, the internal memory is supplied with power uninterruptedly irrespective of the a.c. power condition, and the battery is operated to discharge only in the event of accidental power failure for different time lengths depending on the operating condition of the apparatus, whereby the battery can be protected from over discharging.