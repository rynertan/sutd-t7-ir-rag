# APPARATUS FOR REPRODUCING A DIGITAL SIGNAL

## Claims
Anordnung zur Wiedergabe eines numerischen Signals, mit einem mit einem wiedergegebenen Signal zu beliefernden Phasenregelschaltkreis PLL Schaltkreis 5 zum Erzeugen eines Taktsignals,

## Description
This invention relates to apparatus for reproducing a digital signal in which a clock signal is generated from the reproduced signal. Transmission systems for transmitting information having a burst shape signal waveform, such as recording and reproducing apparatus, are known in which a plurality of rotary heads are mounted on the periphery of a tape guide drum and have, for example, an equal angular spacing, such as, for example, an angular spacing of 180 between the heads. A magnetic tape is wrapped around the periphery of the tape guide drum over an angular distance which is less than 180 and may, for example, be 90 In this prior recording and reproducing apparatus, a radio frequency RF signal is reproduced by the rotary head during the normal playback mode and has a signal waveform of a burst shape which has a high signal level as shown in Figure 1A of the accompanying drawings. This is because signals recorded on the tape are reproduced only when the rotary head is effectively in contact with the tape. The RF signal reproduced by the rotary head is waveform equalized by a waveform equalization circuit, is waveform shaped by a waveform shaping circuit, and is then fed to a phase locked loop PLL circuit. The PLL circuit is provided so as to generate a clock signal from the reproduced digital signal. When the level of the RF signal is sufficiently large, a voltage controlled oscillator VCO of the PLL circuit is locked and placed in a stable state as shown in Figure 1B of the accompanying drawings. When the level of the RF signal is, on the other hand, very small, which means that substantially no signal exists, the VCO of the PLL circuit is not in the locked condition and is in a free running state as illustrated in Figure 1B, so that the VCO runs freely. Thus, the oscillation frequency of the VCO will vary near the free running frequency, and the unstable state will be maintained until a normal level RF signal arrives again. This is also true for high speed playback modes such as the fast forward FF search mode and the rewind REW search mode. Thus, in the high speed playback mode, the plurality of rotary heads scan a plurality of tracks during one scan, such that at that time each head generates an output when it scans the tracks whose azimuths are coincident with the head, and each head generates no output when it scans the tracks whose azimuths are not coincident with the head, so that an RF signal which has a so called bead shape, shown in Figure 2A of the accompanying drawings, is obtained. Thus, the PLL circuit to which such an RF signal is supplied will be locked and placed in a stable state at a location on the tape where the level of the RF signal is sufficiently large, but it will not be locked, as shown in Figure 2B of the accompanying drawings, and will be in a free running state and become unstable at locations on the tape where no RF signal exists, or at a trough portion of the RF waveform having the bead shape. In prior apparatus in which the level of the RF signal becomes small, the PLL circuit is released from the locked state and the PLL circuit is put into the free running state, and under these conditions there are various defects of the apparatus. First, the capture range oscillation frequency range of the VCO in which the PLL circuit can be locked to the input signal which is being varied from the initial state, so that the PLL circuit is not in a locked state cannot be widened. Even if the capture range could be widened, the pull in time of the PLL circuit that is, the time necessary for locking the PLL circuit becomes long, and the locking range of the PLL circuit oscillation frequency range of the VCO in which the PLL circuit can maintain the locked state to the input signal when the input signal is being varied from the initial state such that the PLL circuit is in the locked state is not substantially widened. At the present time, the lock range is about 2 to 3 under the best conditions. In addition, adjustment of the free running frequency of the VCO is required. Furthermore, even if the recovery time of the PLL circuit that is, the time period from the time when the PLL circuit is unlocked to the time when it is locked again from a drop out of the RF is short, then the PLL circuit will be locked for a long period of time. Also, in the prior waveform equalization circuit, the waveform equalization characteristic for equalizing a waveform of a signal reproduced from the tape is fixed to that which occurs in the normal playback mode. As a result in the case of, for example, a high speed playback mode or a variable speed playback mode, such as when the relative speed between the tape and the head becomes faster or slower than the speed in the normal playback mode, the waveform equalization characteristic which is fixed to the normal playback mode cannot operate properly with the various playback modes, because the frequency of the data is shifted upwardly or downwardly in response to the relative speed. This defect causes the data error rates to be increased. Another prior art timing signal regenerator circuit which exhibits similar problems is disclosed in German patent specification DE A1 2 951 022 US A 4 360 781 . In this circuit a switch is present in the VCO. Control signal path for disconnecting and holding the VCO during a drop out in the reproduced signal. US patent specification US A 4 580 100 published 1 April 1986 discloses a data reproduction circuit for reducing jitter on reproducing an audio signal from an optical disc and including a charge pumping circuit. A part of this same disclosure is also contained in Japanese patent specification JP A 59 111422 published 27 June 1984 . According to the present invention there is provided apparatus for reproducing a digital signal, the apparatus comprising The invention will now be described by way of example with reference to the accompanying drawings, throughout which like parts are referred to by like references, and in which Figure 3 is a block diagram illustrating the overall circuit arrangement of an embodiment of the present invention. A rotary head 1 typifies a plurality of rotary heads which are mounted on the periphery of a tape guide drum at an angular spacing of 180 . The tape guide drum is not shown. These rotary heads are alternately switched by a switching pulse, and outputs are derived from the heads. Although not shown, a magnetic tape, is wrapped around the periphery of the tape guide drum over an angular distance of, for example 90 . As shown in Figure 3, the reproduced signal RF signal which is read out from a recording medium such as, for example, the magnetic tape by the head 1 is amplified by an amplifier 2 and supplied to a variable waveform equalization circuit 3 in which it is waveform equalized. The output from the variable waveform equalization circuit 3 is supplied to a waveform shaping circuit 4 in which it is waveform shaped and then fed to a PLL circuit 5. The PLL circuit 5 comprises a phase comparing data extracting circuit 6 which receives the output of the waveform shaping circuit 4. A charge pump circuit 7 receives the output of the phase comparing data extracting circuit 6 and supplies an output to a low pass filter 8 of a complete integration type. A VCO 9 receives an output of the low pass filter 8, and supplies an input to the phase comparing data extracting circuit 6. The output of the amplifier 2 is also supplied to a high speed envelope detecting circuit 10, in which the envelope of the reproduced signal RF signal is full wave rectified at high speed, and converted to an envelope waveform. The detected output from the envelope detecting circuit 10 is supplied to a tracking comparator 11 in which it is compared with a threshold level that can be automatically varied in response to the envelope waveform, so as substantially to detect a point where the RF signal drops out. The output from the tracking comparator 11 is supplied to a random walk filter 12 in which the unstable portion flapping or oscillatory portion which exists at the side edges of the output waveform of the tracking comparator 11 is removed. In other words, the tracking comparator 11 and the random walk filter 12 serve as a form of wave shaping means for wave shaping the envelope output. The random walk filter 12 is supplied with a clock signal which has a frequency which results from dividing the oscillator frequency of the VCO 9 by a predetermined factor. Thus, in the random walk filter 12, the state transition speed is changed by the phase compared frequency, so that the occurrence of unused time can be reduced as compared with a filter using a normal fixed clock signal. The output from the random walk filter 12 is supplied to the charge pump circuit 7 as a control signal which controls the charge pump operation. Specifically, when the control signal is, for example, at a high level, the charge pump operation will be carried out, or the feedback loop will be closed, and the PLL circuit 5 will be locked. On the other hand, when the control signal is at a low level, the charge pump operation is stopped, and the feedback loop is opened, and the PLL circuit 5 is placed in the holding state. In this case, the envelope detecting circuit 10, the tracking comparator 11 and the random walk filter 12 form a feed forward system. Also, at the output side of the low pass filter 8, another low pass filter 13 is connected. The low pass filter 13 may comprise a low pass filter having a relatively large time constant, such that noise contained in the output from the low pass filter 8 will be removed. The output from the low pass filter 13 is supplied to a control signal generating circuit 14 which generates in response to the output of the low pass filter 13 corresponding to the relative speed between the tape and the head 1, or in other words in response to the control voltage of the VCO 9, a control signal which is supplied to the variable waveform equalization circuit 3 in modes other than the recording mode and the normal playback mode such as, for example, the high speed playback mode and the variable speed playback mode. The variable waveform equalization circuit 3 is constructed so it can change its waveform equalization characteristic in response to the relative speeds in a manner such that, for example, when the relative speed is higher than that of the normal playback, the waveform equalization characteristic is shifted to the upper side in frequency by a predetermined amount as compared to that in the normal playback mode, and when the relative speed is lower than that of the normal playback mode, the waveform equalization characteristic is shifted to the lower side in frequency by a predetermined amount as compared to the normal playback mode. Thus, the waveform equalization characteristic of the variable waveform equalization circuit 3 is always set at the best data error rate. The output from the low pass filter 13 is supplied to one input terminal of a comparing circuit 15. Another input terminal of the comparing circuit 15 receives a reference voltage from a reference voltage source 16. The reference voltage is set at a value equal to the control voltage for the VCO 9, which is generated at the output side of the low pass filter 8 during the normal playback mode. The output from the comparing circuit 15 is supplied to a contact The output from the switching circuit 17 is supplied through a drive circuit 18 to a drum motor 19 which drives a drum on which the rotary head is mounted. The drum motor 19 is controlled such that during the high speed playback mode, the compared error signal from the comparing circuit 15 will become zero, or the control voltage from the VCO 9 during the high speed playback mode will become equal to the control voltage for the VCO 9 during the normal playback mode. In other words, the relative speed between the tape and the head 1 in the high speed playback mode will become equal to the relative speed between the tape and the head 1 in the normal playback mode. Figures 4A to 4F are signal waveform diagrams for explaining the operation of the circuit of Figure 3 in the normal playback mode. When an RF signal S1 illustrated in Figure 4A, which contains noise and a drop out, is supplied to the envelope detecting circuit 10, it is full wave rectified by the envelope detecting circuit 10, and the envelope waveform signal S2 illustrated in Figure 4B is produced at the output of the envelope detecting circuit 10. The envelope waveform signal S2 is supplied to the tracking comparator 11 where it is compared with the threshold level which can automatically be varied in response to the level of the envelope waveform signal S2. The result is that the tracking comparator 11 generates at its output an output signal S3 which is illustrated in Figure 4C. As can be seen in Figure 4C, during a period in which the signal S3 has a low level, the envelope waveform signal S2 corresponding to the RF signal S1 does not reach the threshold level, and the RF signal S1 has a poor waveform. On the other hand, during the period in which the signal S3 has a high level, the envelope waveform S2 corresponding to the RF signal S1 reaches the threshold level and thus the RF signal S1 will have a good waveform. For this condition, since the noise of the envelope waveform as well as the noise of the system are superimposed upon the waveform of the output signal S3 from the tracking comparator 11, a signal having a beard shape occurs near the side edge of the signal. Thus, the waveform of the output signal does not have a desirable form. Therefore, the output signal S3 of the tracking comparator 11 is supplied to the random walk filter 12 to remove the flapping portion. As a result, the random walk filter 12 generates at its output an output signal S4 which has a satisfactory waveform as illustrated in Figure 4D. At the output side of the waveform shaping circuit 4, an output signal S5 is obtained which is shown in Figure 4E, which results from the waveform equalizing of the RF signal S1 shown in Figure 4A and the waveform shaping of the signal. When the output signal S5 is compared with the output signal S4 illustrated in Figure 4D, and which occurs at the output of the random walk filter 12, it is seen that when the output signal S4 from the random walk filter 12 has a high level, good data OK are found in the output signal S5 which is generated by the waveform shaping circuit 4, while when the output signal S4 has a low level, bad data NG occur in the output signal S5. In other words, when the output signal S4 from the random walk filter 12 has a high level, the output signal S5 from the waveform shaping circuit 4 is a good signal, and is a signal suitable to be supplied to the PLL circuit 5. On the other hand, when the output signal S4 from the random walk filter 12 has a low level, the output signal S5 from the waveform shaping circuit 4 is not satisfactory, and this signal is unsuitable to be supplied to the PLL circuit 5. Thus, the output signal S4 from the random walk filter 12 is supplied to the charge pump circuit 7 to control it. The output signal S5 from the waveform shaping circuit 4 is supplied to the phase comparing data extracting circuit 6 where it is phase compared with the signal from the VCO 9. The phase compared error signal from the phase comparing data extracting circuit 6 is supplied to the charge pump circuit 7. During this time, when the output signal S4 from the random walk filter 12 has a high level, the charge pump circuit 7 will be placed in an operable state, so as to allow charging current to flow to the low pass filter 8, so that the feedback loop of the PLL circuit 5 will be substantially closed and the PLL circuit 5 will be put into a locked state. When the output signal S4 is, on the other hand, at a low level, the charge pump circuit 7 will be placed into an inactive state which inhibits the flow of charging current into the low pass filter 8, so that the feedback loop of the PLL circuit 5 is substantially opened so as to place the PLL circuit 5 in a holding state and, thus, the VCO 9 will oscillate in the locked condition. At that time, the VCO 9 will be supplied with an output signal S6, which is shown in Figure 4F, from the low pass filter 8. As a result, the oscillating frequency of the VCO 9 will be stabilized at a substantially constant oscillating frequency and will not return to a predetermined free running frequency. Figures 5A to 5F are signal waveform diagrams showing signal waveforms at various points in the high speed playback mode. Since the operation of the respective circuits are similar to those in the playback mode, the signal waveforms corresponding to those illustrated in Figures 4A to 4F are marked with the same reference numerals S1 to S6. Since in the prior art the unlocking of the PLL circuit by an external disturbance or the like only depends on the feedback system of the PLL circuit itself, the capture range cannot be widened and the pulling time cannot be reduced. In the embodiment described above, since the state of the RF signal is detected by other circuits, such as a feed forward system circuit, so as to control the feedback system circuit, it is possible to have a clock extracting circuit which icnludes the PLL circuit which strongly resists external disturbances, and in which the capture range and the locking range are wide and the pulling time is short, and where substantially no adjustments are required. In operation, the variable waveform equalization circuit 3 will be described with reference to Figures 6 and 7. When the waveform equalization characteristic of the variable waveform equalization circuit is examined, the waveform equalization characteristic during the normal playback mode is represented by, for example, a curve When the reproducing apparatus is placed, for example, in the high speed playback mode and the relative speed between the tape and the head become faster than the normal playback mode, the control voltage S6 to the VCO 9 will be raised up to the position or level illustrated by By way of example, consider data of a continuous pattern of a minimum transition interval Tmin 1T of a signal that is digitally recorded. Although in the normal playback mode, the frequency is placed at a position f₁ on the frequency axis of Figure 6, if the relative speed increases, the frequency is shifted upwardly to a position f₂. thus, if the waveform equalization characteristic is fixed to the characteristic shown by the curves Conversely, when the relative speed becomes slower, the frequency of the 1T pattern data will be lowered to a position f₃. Then if the waveform equalization characteristic is fixed to the curve Referring again to Figure 3, when the PLL circuit 5 is in the locked state, the control voltage to the VCO 9 substantially indicates the relative speed between the tape and the head 1. Thus, in the high speed playback mode where the switching circuit 17 is switched to contact In this manner, by closing the loop in the high speed playback mode, the error voltage of the PLL circuit 5, or the control voltage to the VCO 9 can be approximated to that utilized in the normal playback mode. In other words, this operation is the same as the operation for making the relative speed between the tape and the head 1 constant, so that the relative speed between the tape and the head 1 in the high speed playback mode becomes equal to the relative speed in the normal playback mode. Figure 8 is a circuit diagram illustrating one example of a practical circuit arrangement of the PLL circuit 5. An input terminal 20 is connected to the output of the waveform shaping circuit 4 of Figure 3, and a signal S7 which corresponds to the signal S5 shown in Figures 4E and 5E, and is also shown in Figure 9A, is supplied to the D input terminals of D type flip flop circuits 21 and 22, and is also supplied through an exclusive OR E OR circuit 23 to the clock input terminal of the flip flop circuit 21. The output signal from the VCO 9 is supplied to a D type flip flop circuit 24 which generates at its outputs a signal S8 illustrated in Figure 9B. The signal S8 is supplied through NOR circuits 25 and 26 to a clock output terminal 27 and forms a reproduced clock signal. The signal S8 from the flip flop circuit 24 is supplied to the clock terminal of the flip flop circuit 22, and the inverted outputs from the flip flop circuits 21 and 22 are supplied to an E OR circuit 28 which generates at its output a signal S9 which is the feedback signal. Figure 9C illustrates a signal The output from the flip flop circuit 29 is supplied to the E OR circuit 30 so that the E OR circuit 30 will generate at its output a signal S10 which is a reference signal. Figure 9D shows a signal The signals S9 and S10 are supplied to a NOR circuit 32 and to a NAND circuit 33 which are included in the phase comparing data extracting circuit 6. The NOR circuit 32 generates and produces at its output a signal S11 which is shown in Figure 9E, and the NAND circuit 33 generates and supplies to its output a signal S12 shown in Figure 9F. The signals S11 and S12 are respectively supplied to a NAND circuit 34 and to a NOR circuit 35 of the charge pump circuit 7. At an input terminal 36, which is connected to the output of the random walk filter 12 of Figure 3, the signal S4 shown in Figures 4D and 5D is supplied to the NAND circuit 34 and is supplied through a NAND circuit 37 to the NOR circuit 35. The result is that the NAND circuit 34 generates at its output a signal S13, shown in Figure 9G, and the NOR circuit 35 generates at its output a signal S14, shown in Figure 9H. The charge pump circuit 7 includes diodes 38 and 39 connected in opposite polarity to each other. The cathode of the diode 38 is connected to the output of the NAND circuit 34 and the anode is connected to a connection point P between the diodes 38 and 39. The anode of the diode 39 is connected to the output of the NOR circuit 35 and the cathode is connected to the connection point P. The signal S13 is supplied to the diode 38, and the signal S14 is supplied to the diode 39, with the result that a signal S15, illustrated in Figure 9I, occurs at the connection point P and comprises the phase compared error signal. If there are many time periods in which the signal S15 is at a low level L , the oscillating frequency of the VCO 9 will be increased, and when there are many time periods in which the signal S15 is at high level H the oscillating frequency of the VCO 9 will be decreased. In other words, when the time periods in which the signal S15 is at a low level increases, the charges accumulated in an integration capacitor 40 of the low pass filter 8 are discharged, so that the output the VCO control voltage of an integrating type amplifier 41 is increased so as to increase the oscillating frequency of the VCO 9. On the other hand, when the time periods during which the signal S15 is at a high level increases, then a current flows into the integration capacitor 40 which accumulates the charges so that the output the VCO control voltage of the integrating type amplifier 41 decreases, and the oscillation frequency of the VCO 9 decreases. Also, when the signal S15 is in a high impedance state Z , the feedback loop is opened to place the PLL circuit 5 in the holding state, and the VCO control voltage will be held in the holding state so that the VCO 9 oscillates at a frequency when the PLL circuit 5 is locked. The above described operation explains the normal operation accomplished with the feedback system of the PLL circuit 5. In this embodiment, the feedback system is controlled by the feed forward system. Specifically, when the output signal S4 supplied to the input terminal 36 from the random walk filter 12 has a high level, the operation of the charge pump circuit 7 depends on the signals S11 and S12. When the output signal S4 is alternatively at a low level, then regardless of the levels of the signals S11 and S12, the signal S13 becomes of high level, and the signal S14 becomes of low level, so that the diodes 38 and 39 are both reverse biased. In consequence, the feedback loop is opened, and the PLL circuit 5 is unlocked and then placed in a holding state. Then the VCO voltage is held at the same voltage and the VCO 9 oscillates at the frequency determined by such voltage when the PLL circuit 5 is locked. In other words, when the output signal S4 becomes low in response to a portion of unsatisfactory data of the signal S7, the PLL circuit 5 is placed in a holding state so that even if the PLL circuit 5 is released from being locked, the oscillating frequency of the VCO 9 will not be returned to the predetermined free running frequency, but the VCO 9 will oscillate at the oscillating frequency which existed when the PLL circuit 5 was locked, and the oscillating operation of the VCO 9 will be stable. Figure 10 shows an example of a practical circuit of the high speed envelope detecting circuit 10. A signal is supplied at an input terminal 43 which is connected to the output side of the amplifier 2 of Figure 3, and is converted from an unbalanced signal to a balanced signal by a cascade amplifier which comprises transistors 44, 45, 46, 47, 48 and 49. The balanced signal is then converted in impedance by a differential amplifier formed by transistors 50 and 51, and is then detected by a detector comprising transistors 52 and 53. The result is that there is obtained an output signal whose envelopes have been detected. Output terminals 54 and 55 are connected to the input side of the tracking comparator 11 of Figure 3. Since the outputs from the envelope detecting circuit 10 are emitter follower outputs, high speed envelope detection is possible. Transistors 56 and 57 are connected in a Darlington connection and are used for impedance conversion. Figure 11 shows an example of a practical circuit of the tracking comparator 11. Input terminals 58 and 59 are connected to the output terminals 54 and 55 of the envelope detecting circuit 10. The input terminal 58 forms the signal input, and the input terminal 59 forms the reference signal input. The input signals applied to the input terminals 58 and 59 are supplied to a differential amplifier, formed of transistors 60 and 61, which converts the impedance. Then they are supplied to transistors 62 and 63 where potentials of the signals are increased and supplied to a differential amplifier comprising transistors 64 and 65, and to a differential amplifier comprising transistors 66 and 67 where they are amplified. The signals amplified by the transistors 64, 65, 66 and 67 are converted in impedance by a differential amplifier comprising transistors 68 and 69, and are then fed to a comparator 70. The comparator 70 compares the signal supplied to its non inverting input terminal with the reference level threshold level supplied to its inverting input terminal. This reference level can automatically be varied in response to the level of the envelope waveform. For this purpose, the input terminals of the comparator 70 are connected to integrating capacitors 71 and 72, respectively. An output terminal 73 is connected to the output of the comparator 70. Since the reference level can automatically be varied in response to the level of the envelope waveform, it is possible automatically to match the reference level with the level of the RF signal, and also it is possible to detect accurately when the head 1 crosses the track during high speed playback mode. Transistors 74 and 75 are limiters and transistors 77, 78 and 79 are used to lower the reference level during the normal playback mode. Transistors 80 and 81 are used to set a bias voltage. Figure 12 is an example of a practical circuit of the random walk filter 12. An input terminal 82 is connected to the output terminal 73 shown in Figure 11 of the tracking comparator 11. The input terminal 82 is connected to the D input of a D type flip flop circuit 83. The flip flop circuit 83 is supplied at its clock terminal with a clock signal supplied at a clock terminal 84 which is connected to the output side of the VCO 9 of Figure 3 through an inverter 85. The output from the flip flop circuit 83 is supplied to a D input terminal of a D type flip flop circuit 86, as well as to an E OR circuit 87 and to an up down U The clock signal supplied to the clock terminal 84 is supplied through the inverter 85 and an inverter 89 to the clock terminal of the flip flop circuit 86, and to the up down counter 88. The inverted output from the flip flop circuit 86 is supplied to the E OR circuit 87, and the output of the E OR circuit 87 is supplied to a clear terminal CLR of a D type flip flop circuit 90 and serves as the reset signal. The D input terminal of the flip flop circuit 90 goes to a high level, and the flip flop circuit 90 is supplied at its clock terminal with an inverted output of a D type flip flop circuit 91 provided at the output of the up down counter 88. The output from the flip flop circuit 90 is supplied to an enable terminal A signal from a ripple carry terminal The up down counter 88 assumes sixteen conditions from, for example, 0 to 15 during operation. When the up down counter 88 is supplied with a signal S When, at a time t₆, the input signal S As above described, by passing the output of the tracking comparator 11 through the random walk filter 12, unstable factors such as flapping portions which are produced near the side edges of the pulse of the input signal S As the state of the RF signal that is, the reproduced data is detected by the circuit in the feed forward system, and the feedback system of the PLL circuit is controlled by the detected output, the PLL circuit used resists external disturbances and the capture range of the lock range of the PLL circuit can be extended to be more than 20 and the pull in time of the PLL circuit will be about 20 microseconds in the normal playback mode and 5 microseconds if the RF signal is in good condition and, thus, the pull in operation can be carried out at high speed. Since also the free running frequency does not occur, a frequency adjustment is unnecessary and recovery from drop out can be quickly accomplished. Also, false locking is difficult and unlikely to occur, and if it does occur, such false locking can easily be released. Embodiments of PLL circuit according to the present invention are very suitable for use with recording and reproducing apparatus for producing information of burst shape waveform, data communication and similar applications. Also, since the waveform equalization characteristic can be automatically varied by the VCO control voltage, which corresponds to the relative speed between the tape and the head in response to the relative speed in the high speed playback mode and the variable speed playback mode, it is possible to decrease the error rate of the data. Attention is drawn to our copending European application no. 88119049 divided from the present application and claiming similar subject matter.