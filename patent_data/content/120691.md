# ELECTRICAL COMPASS

## Claims
Elektrischer Digital Kompaß für ein Fahrzeug mit

## Description
The present invention relates to electrical compasses for a vehicle and particularly a compass for use in connection with a display of the vehicle s heading and to a method of correcting the displayed information of such a compass. In recent years, digital electronics technology has been employed in the automotive industry to provide, for example, the display of speed and engine operating parameters to the vehicle user. In a compass for use in a vehicle, it is necessary to compensate the compass to correct for stray magnetic fields and ferromagnetic material in the vicinity of the sensor. For accuracy, a second and different correction for variation in the earth s magnetic field as a function of the geographic location of the vehicle is desirable. Thus, for example, in the United States, the magnetic variation between true north and magnetic north from the east to west coast is approximately 40 Typically, vehicle mounted compasses have been mechanical types with rotating compass cards mounted in a viscous damping media. An electrical compass has been described in a 1980 SAE paper entitled It is one aim of the present invention to provide an electrical digital compass for use in a vehicle which is easy to use and which provides a compensation and correction control which is easily reset by the vehicle operator. It is a further aim to provide a method of correcting the displayed information of such a compass. Document US A 3991361 discloses those features in the pre characterising portions of Claims 1 and 12. According to the present invention an electrical compass is characterised by those features in the characterising portions of Claims 1 and 12. The invention may be carried into practice in various ways but one specific embodiment of the invention will now be described with reference to the accompanying drawings in which Referring initially to Figure 1, there is shown a control and display module 10 which is adapted to be integrally included in a vehicle during manufacturing, although it could be separately added at a later time. The module 10 is positioned in the roof 12 of a vehicle and centred near the top edge of the windshield 4, typically just above the rearview mirror. Module 10 includes a pair of map reading lamps 16 having switches 17 for operating lamp means positioned behind lenses 18 which direct illumination into the lap area of either the vehicle driver or passenger side of the vehicle, depending on which switch is actuated. The centre of the module includes a garage door opening transmitter 20 including a three position switch 22 for actuating any one of three different garage door remote control units by the actuation of a push button switch 24. Module 10 may also include an electrical sunroof control switch 25. The construction of the lamp modules 16 and garage door transmitter module 20 is generally described in US A 4,241,870. Module 10 additionally includes a separate display panel 30 which includes display indicators 31, 32, 33 and 34 for displaying vehicle operating parameters such as engine temperature, oil pressure, generator and fuel warning or the like which can either be displayed in a digital alpha numeric format or as warning lights. The centre of display module 30 includes a digital display 35 providing, in one embodiment of the present invention, an octant display 36 of the vehicle heading in an alpha format and, on the left side of display 35, a temperature display 37 providing fahrenheit or celsius display of the exterior ambient temperature of the air near the vehicle as well as a warning signal when road conditions approach freezing, as will be described hereinafter. The temperature display circuit is actuated by a push button temperature switch 38 while the compass circuit is actuated by a push button switch 39. A pair of apertures 40 and 41 provide limited access to calibrate and compensation switches 42 and 44, respectively Figure 2 , which are only occasionally used and are push switches mounted to a circuit board positioned behind panel 45 and are actuated by a pointed instrument such as a ball point pen. Thus, module 10 incorporates, at a single overhead location conveniently positioned for operator use, a control and information display centre for the vehicle. As shown in Figure 2, the compass and temperature display system includes an oscillator 46 which, in the preferred embodiment, is an R C oscillator having an output frequency of approximately 100 kHz at output terminal 47 thereof. The output signal from oscillator 46 is applied to a counter circuit 48 providing 500 Hz at output terminal 49 which is applied to a driver amplifier 50 which subsequently applies the 500 Hz signals to excitation winding 11 of a flux gate sensor 13. Counter 48 also provides a 1 kHz signal at output terminal 51 which is applied to synchronous phase detector circuits 52 and 54. The output terminal 47 of oscillator 46 is also coupled to clock input terminals of digital bandpass filters 56 and 58. Filters 56 and 58 also include signal input terminals 57 and 59, respectively, coupled to one end of sensing coils 14 and 15 of sensor 13, as shown in Figure 2, with the remaining terminals of coils 14 and 15 commonly coupled to a floating ground. The output of bandpass filters 56 and 56 are coupled to the input terminals of synchronous phase detectors 52 and 54 such that second harmonic frequency signals are applied to each of the synchronous phase detectors which are actuated by an enabling signal from counter 48 via an enabling line 53 to apply positive and negative half cycle sinusoidal signals received from sensing coils 14 and 15 through bandpass filters 56 and 58 to integrating and inverting amplifier circuits 60 and 62. The closed loop gain of the system is controlled through a feedback path including conductors 61 and 63 extending between integrating amplifier 60 and flux gate sense winding 14 and integrator 62 and flux gate sense winding 15, respectively. At the output terminals 65 and 66 of integrators 60 and 62, respectively, there is thus provided DC varying signals e₁ and e₂, respectively, which represent the direction information from sensing coils 14 and 15. The amplitude and polarity of e₁ and e₂ varies with vehicle direction with respect to the earth s magnetic field. These DC varying signals are applied to a suitable interface circuit 70, including, for example, suitable amplifiers and an AD converter for converting the DC signal information to digital signals. Circuit 70, in turn, is coupled to a microprocessor 75 which includes associated RAM and ROM memories with the ROM programmed to mathematically derive an output control signal in the form of the arc tangent of the ratio to provide a digital output control signal applied to a display driver circuit 80 for displays 35 such that octant direction and temperature information can be displayed to the vehicle operator. The processing of signals e₁ and e₂ from integrator circuits 60 and 62 by the microprocessor and program to provide the tan ¹ in a digital format for octant display of vehicle direction is entirely conventional. Microprocessor 75 also receives input signals from switches 38, 39, 42 and 44 through an interface circuit 85 and from temperature sensing means such as a thermistor 90 through interface circuit 92. Thermistor 90 is positioned exterior of the vehicle such as in the front grill area to measure the outside ambient air temperature. The microprocessor includes output terminals 76 and 77 coupled to D A converters 78 and 79, respectively. The outputs of the D A converters are coupled to sensing coils 14 and 15 through resistors 81 and 83, respectively to provide correction signals to the sensor 13, as described below. A detailed description of the operation of the bandpass filters and synchronous phase detectors to provide direction representative signals is presented in our copending application Publication number EP 0 087 890 A2. Having described the overall circuit arrangement by which the microprocessor 75 receives direction indicating signals from the flux gate sensor 13 and provides a compass output display therefrom and provides correction information through D A converters 78 and 79 to the flux gate sensor as well as receives and processes temperature information, a more detailed description of the circuit together with the operation of the system is presented in connection with first Figure 3 and subsequently Figures 4 and 5. In Figure 3, the same reference numerals corresponding to structure shown in Figure 2 are employed. In the Figure, the flux gate sensor 13 has its excitation coil 11 AC coupled by means of a capacitor 100 to the driver amplifier 50 Figure 2 through input terminals 101 and 102. The excitation frequency is, in the preferred embodiment of the invention, approximately 500 Hz. The north south detection winding 14 of sensor 13 has an output terminal 104 coupled to bandpass filter 56 at input terminal 5 thereof while east west sensing winding 15 has its output terminal 106 coupled to input terminal 16 of bandpass filter 58. Filters 56 and 58 are each 1 2 of an integrated circuit chip Model No. MFlOBN available from National Semiconductor Corporation and are coupled to a source of operating voltage V The bandpass filters 56 and 58 and their operation is described in greater detail in the application referred to above and provide at output terminals 2 and 19 thereof second harmonic 1 kHz sinusoidal signals which are coupled by capacitors 114 and 116 to input terminals 4 and 12 of the synchronous phase detection circuits 52 and 54. Circuits 52 and 54 are combined on a single monolithic integrated circuit chip 53 which includes a 4016 National Semiconductor integrated circuit, an oscillator and counter circuits which supply 100 kHz timing signals at output pin 1 to inputs 10 and 11 of circuits 56 and 58, respectively. A 200 kHz R C oscillator including resistors 118, 120 and capacitor 122 provides synchronous clock signals to the clock input of microprocessor 75 through inverter 55 and to the display driver 50 Figure 2 . The sinusoidal second harmonic frequency signals at output terminals 3 and 5 and 11 and 13 alternate 1 2 cycles of 1 kHz information, the amplitude and sign of which is direction indicative, and are applied to the input terminals of the integrating circuits 60 and 62, respectively, including integrating resistive capacitive networks, as shown in Figure 3. The output of integrators 60 and 62 are varying DC level signals e₁ and e₂ which are applied to the negative input terminals of the interface circuit 70 comprising digital comparators 120 and 122, respectively. Signals e₁ and e₂ are representative of the north and south component of the sensed magnetic field as well as the orthogonal east and west component, respectively. The output of integrators 60 and 62 also are coupled via feedback lines 61 and 63 and gain controlling resistors 61 and 63 in a negative feedback control configuration. Each of the operational amplifiers 120 and 122 of circuit 70 have their positive input terminals coupled to output G₂ of microprocessor 75 which is a National Semiconductor COP345L microprocessor. Output terminal G₂ provides a variable duty cycle signal which is time shared between 120 and 122 and is applied to a D to A converter including inverter circuit 124, integrator resistor 126 and capacitor 128 and operational amplifier 130 coupled as a voltage follower and having its output terminal coupled to the positive input terminals of digital comparators 120 and 122 via resistors 131 and 132, respectively. Comparators 120 and 122 also include feedback resistors 121 and 123, respectively, for prevention of oscillation. The output signal at G₂ thus provides a variable duty cycle positive going signal, the average component of which is proportional to the amplitude of e₁ or e₂ or, as described in detail below in connection with the temperature sensing circuit including thermistor 90, the sensed temperature. The operation of the microprocessor, in response to digital input signals applied at the terminals L₀, L₁ and L₂ through comparators 120, 122 and 166 to provide a variable duty cycle output at terminal G₂, is described in the 1982 Cops Microcontroller Data Book published by National Semiconductor. Variable duty cycle output signals are also applied to output terminals G₁ and G₀ of microprocessor 75 with the signal from terminal G₁ which corresponds to output terminal 76 shown in Figure 2 being applied to the D to A converter 78. The signal terminal G₁ provides a variable duty cycle output applied to an inverter 140 and to the D to A converter 78 including integrating resistor 142 and capacitor 144 and to the positive input terminal of an operational amplifier 146 configured as a voltage follower and through current limiting resistor 81 to output terminal A which is commonly coupled to input terminal A of north south winding 14 corresponding also to its output terminal 104. Similarly, the variable duty cycle output at G₀ corresponding to terminal 77, shown also in Figure 2, is coupled to an inverter circuit 150 to D to A converter 79 including integrating resistor 153 and capacitor 154 through a voltage following amplifier 156 and to current limiting resistor 83 to output terminal B coupled to input terminal B of east west coil 15 which also corresponds to terminal 106. These signals are internally monitored by the microprocessor to provide digital signals containing the direction information contained by e₁ and e₂ voltages to provide display output information to display driver 80 through output terminals D₀, SK,S₀ and SI. The temperature sensing thermistor 90 is coupled to input terminal L₂ of microprocessor 75 by the voltage dividing interface circuit 92 including a voltage dividing resistor 160 coupled to the V Operating power for the microprocessor is applied through a voltage reducing network including a resistor 170 coupled to V The described circuit provides automatic calibration for compensation of the compass and variation correction for ease of use by the operator. When the system is first installed or, in the case of original equipment, when the vehicle is delivered, the vehicle operator or the dealer positions the car facing in a magnetic north direction. This can be achieved by utilizing a magnetic compass to determine magnetic north and aligning the car in such direction. At the dealership level, the dealer will typically establish this in a parking area for new vehicles incorporating this system of the present invention by painting or otherwise marking an area of the lot to indicate the direction of magnetic north. The operator then depresses the compass function switch 39 and simultaneously, using a ball point pen or the like, the calibration switch 42. In response to the simultaneous occurrence of these two switch closures, microprocessor 75 outputs at display 35 the display SET N , indicated by block 200 in Figure 5. Also in response to this command, output G₁ is supplied with a 50 duty cycle signal integrated by circuit 78. The output of integrator 60 and comparator 120 applied to input L₁ of the microprocessor 75 is measured to determine its level. These steps are indicated by block 210 of the program flow diagram of Figure 5 for the microprocessor. The voltage e₁ is tested to ascertain whether it is 1 2 of V The vehicle operator, upon seeing the flashing SET W display, aligns the vehicle 90 Thus, by effectively measuring the integrated DC levels e₁ and e₂, provided by sensing coils 14 and 15 of the flux gate sensor 13, through the digitally processed duty cycle technique of the microprocessor, when the vehicle is aligned in magnetic north and subsequently in magnetic west direction, duty cycle information for controlling the output display to read N and W, respectively, is determined and such control information is stored in non volatile memory for use by the compass in providing a compensated output signal correcting for local magnetic fields or ferromagnetic material which interferes with the sensing of magnetic north by the flux gate sensor, once installed, in a particular vehicle. In order to correct for magnetic variation, which is a geographical phenomenon by which true north varies from magnetic north by different amounts at different geographic locations, variation correction is provided. In the United States, for example, the true north direction in which highways are typically aligned and magnetic north may vary significantly. Twenty degrees of variance between the true and magnetic north headings exist on the coastal regions of the United States with an approximate 40 The vehicle operator, once the compass system has been calibrated for compensation of the compass, drives the vehicle on a road whose direction is known to be true north. The variation correction switch 44 is actuated and display 35 displays TN to the operator indicating the proper actuation of the variation correction entry signal, as indicated by block 300 in Figure 5. Next, the microprocessor reads the input signals at input ports L₀ and L₁ and determines the actual display angle reading, as indicated by block 302. If the display angle information provided at input ports L₀ and L₁ are different than known signals to provide an exact 0 During use, after the calibration and variation of the compass system has been achieved, the compass can be selectively used by actuation of switch 39 which upon a first actuation provides a continuous compass output display and is deactivated upon a second actuation of the momentary push button switch. The temperature display provided by the system is activated by the momentary actuation of temperature switch 38 providing an input signal at port L₇ of microprocessor 75 which then reads the input signal at port L₂ comprising digitized temperature representative information from comparator 166 driven by sensor 90 and integrated variable duty cycle signals from output G₂ of microprocessor 75. The ROM memory of microprocessor 75 includes preprogrammed temperature representative signals to correlate the signals provided at port L₂ and provide a display output signal representing the temperature of the sensor 90. In the event a temperature of 38 Thus, the system described provides the vehicle operator with a conveniently used and accurate octant heading compass display which provides N, NE, E, SE, S, SW, W, and NW displays as the vehicle heads in these directions. The microprocessor responds to signals from the flux gate sensor 13 to change to a predetermined octant heading at an approximately 22 1 2