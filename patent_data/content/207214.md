# METHOD OF AND APPARATUS FOR CONTROLLING DATA FLOW THROUGH A SUBSYSTEM OF A DATA COMMUNICATION NETWORK

## Abstract
An apparatus for controlling data flow through a subsystem 12 of a data communication network 10 includes a plurality of network interface devices 20 connected to a networking medium 14 . Each network interface device 20 comprises a data transport controller 32 which includes means for distributing said data traffic through said network interface device 20 , whereby said distributing means are autonomously adaptive to the traffic across each said network interface device 20 , and further means, responsive to said data traffic of said subsystem 12 for invoking data flow control communication protocols within each network interface device 20 .

## Claims
1. Method of controlling data flow through a sub system 12 of a data communications network 10 , said subsystem 12 having a plurality of network interface devices 20 characterized in that it comprises the steps of

## Description
The present invention relates to a method of controlling data flow through a subsystem of a data communication network, said subsystem having a plurality of network interface devices and to a apparatus for carrying out such a method. In the general field of modern communications systems, a data communication network is frequently formed by interconnecting a plurality of subsystems, or nodes. Conventionally, each subsystem, or node, is designed to support a prespecified capacity of data traffic. This capacity is normally dependent upon the subsystem hardware and the number of network connections throughout the network. Consequently, in the early stages of the design of a particular subsystem and or network, one of the more critical issues to be resolved is the data flow capacity requirements of the end users. Without question, subsystems and networks can be designed to handle just about any prespecified data flow capacity. However, a major difficulty lies in the unanticipated increase in data handling requirements of the users after the network is installed. Hence, when the data handling requirements of a network exceeds the anticipated, or design, levels thereof, a user must either commit to an expensive system redesign or suffer with reduced services. Another common difficulty of modern subsystems is that, occasionally, during peak use by a small number of subscribers the remaining subscribers are either denied access to the network completely or are subjected to ergonomically unacceptable delays. Considering the present growth in data transport technology in such fields as computers, microcomputers, electronic mail and so on, the demands upon data communication networks and the subsystems interconnected thereto has escalated far beyond anticipated levels. Such technological growth is anticipated to continue to outstrip the present day communication network designs. In addition, many individual subscribers to such networks are requiring increased services. Further, numerous services are presently available to supply subscribers with such services as electronic mail, data bases of information, for example, in such fields as finance, law, business, chemistry, and numerous others. Consequently, more and more users are facing the difficulties discussed above. An object of the present invention is to provide a method for autonomously adapting the data traffic flow across a subsystem and an apparatus for carryint out such a method. According to the invnetion, this object is attained by the method claimed in claim 1 and the apparatus claimed in claim 6. Developments of the invention are characterized in the subclaims. An embodiment of the invention will now be explained in detail with reference to the accompanying drawings, in which A communication network, generally indicated at 10 in Figure 1 and embodying the principles of the present invention, includes a plurality of substantially identical subsystems 12 interconnected to a networking medium 14 whereby communication is established between and among peripherals 16 interconnected to each subsystem 12. In one embodiment the networking medium 14 is a digital switching network such as the ITT SYSTEM 12 digital exchange In the preferred embodiment, each subsystem 12 includes one or more peripheral interface device 18, one or more network interface device 20, and a one or more gateway interface device 22. In addition, at least one of the subsystems 12 further includes a network control interface device 24 that, as more fully discussed below, interfaces with a system control means 26. The system control means 26 being operative to control a data bank 28 having stored therein, inter alia, all operative communication protocols for the communication network 10. Further, the peripheral interface devices 18, the network interface devices 20, the gateway interface devices 22 and, when present, the network control interface device 24 of each subsystem 12 are all interconnected by a multiple access masterless contention bus 30 having collision detection. The contention bus 30, hereinafter referred to as the intrasubsystem bus 30, thus establishes a communication path between and among all devices, 18, 20, 22 and 24, within each subsystem 12. Thus, the system control means 26 has access, via the network control interface device 24, to every subsystem 12 via the networking medium 14. Each peripheral interface device 18 includes a data transport controller 32 that interfaces with the plurality of peripherals 16 via a plurality of universal synchronous asynchronous receiver transmitter USART devices 34. Each network interface device 20 includes a data transport controller 32 that interfaces with the networking medium 14 via a PCM interface device 36. Further, each gateway interface device 22 and network control interface device 24 also include such data transport controllers 32. Further, each data transport controller 32, for each device 18, 20, 22 or 24, is substantially identical with every other such data transport controller 32 throughout the network 10. The primary difference among the data transport controllers 32, as more fully discussed below, is the traffic control tasks assigned thereto. Thus, each subsystem 12 has a fully distributed multi microcomputer architecture. Referring to Figure 2, a more detailed block diagram of a data transport controller 32 and, as shown, includes a peripheral interface controller 38, a communication bus interface 40, a microcomputer 42 and a storage medium 44. In the preferred embodiment, the peripheral interface controller 38 is adapted to service a plurality of peripherals 16 operating according to the same comunication protocol. Such a peripheral interface controller 38 includes both a general peripheral control program and a device specific subprogram adapted to allow intercommunication to each of various types or peripherals 16 according to the individual operating requirements thereof. In the preferred embodiments, the communication bus interface 40 interfaces with the masterless multiple access contention bus 30 with collision detection having a first bus 46, shown more clearly in Figure 3, for sustaining data transmission therealong and a second bus 48, distinct from the first bus 46, provided solely for collision detection. The microcomputer 42 preferably includes a microprocessor 50, a read only memory ROM 52, a random access memory RAM 54 and a means 56 for providing local services, such as high level protocol conversions that are relatively infrequently required, for example, for providing gateway functions. The microprocessor 50, the ROM 52, the RAM 54 and the means 56 are interconnected via the local bus 58 of the microcomputer 42. Preferably, the microcomputer 42 is directly connected to the peripheral interface controller 38 and the communication bus interface 40 only for the exchange of interrupt and channel attention signalling via lines, 57 and 59, respectively. Preferably, the microcomputer 42 is a high capacity microcomputer, such as the 80186 microprocessor device, manufactured and marketed by INTEL Corporation of Santa Clara, California. Such a microcomputer 42 includes sufficient capacity to execute the requisite single protocol conversion and to regulate the data traffic thereacross. In one preferred implementation, shown in Figure 3, a subsystem 12, includes a printed circuit board mainframe 60, having means 62 for accepting a plurality of printed circuit boards therein. The printed circuit board mainframe 60 preferably includes the intrasubsystem bus 30 etched thereinto. Further, each peripheral interface device 18, each network interface device 20, each gateway interface device 22 and the network control interface device 24 is self contained on separate printed circuit boards, 64, 66, 68 and 70, respectively. Hence, in this embodiment, the subsystem 12 is substantially completely self contained and is, for all intents and purposes, prewired to be modularly expanded. Thus, any peripheral 16 operating under a previously unavailable communication protocol can be accommodated simply by the insertion of a printed circuit board carrying a new peripheral interface device 18 dedicated to only that protocol. Consequently, each subsystem 12 and the entire network 10 are easily expanded without reprogramming or redesigning the entire system. Naturally, depending upon the number of peripherals 16 having the same communication protocol to be connected, more than one peripheral interface device 18 can be provided for executing any specific communication protocol conversion. Thus, each subsystem 12 includes the means 62 for accepting additional peripheral interface devices 18 whereby additional peripheral devices can be added and interconnected to the intrasubsystem bus 30. Further, each subsystem 12, as discussed above, includes means 62 for providing additional network interface devices 20 whereby the total traffic flow capacity through the subsystem 12 can be increased in a modular fashion. The benefits derived from this implementation are graphically illustrated in Figure 4 where the total subsystem throughput, in packets second, is shown as a function of the proportion of processing time per packet between the network interface device 20 and the processing time per packet for the peripheral interface device 18 and the number of network interface devices 20 in that subsystem 12. The various delay characteristics associated with offered packet traffic for intrasubsystem transport, using the intrasubsystem bus 30, and the intersubsystem transport, using the networking medium 14 is depicted in Figure 5. In one preferred embodiment, the network 10 includes a uniform communication protocol for intrasubsystem data communication and for intersubsystem data communication via the network medium 14, the communication protocol being stored in the data bank 28 for downloading into the RAM 54 of the data transport controller 32 of any peripheral interface device 18 or any network interface device 20 introduced into the network 10. In one embodiment, the system control means 26 can be a personal computer, or the functional equivalent thereof, having the data bank 28 stored, for example, on a floppy disk. The system control means 26 is adapted to monitor the status of each device, 18, 20 and 22 in each subsystem 12. The downloading to newly inserted devices is initiated according to a preprogrammed portion of the ROM 52 of every data transport controller 32 that, upon insertion into the means 62, alerts the system control means 26. The system control means 26 then downloads the appropriate software program into the RAM 54. The system control means 26, during the monitoring of the devices 18, 20 and 22, ensures that the newly inserted device 18, 20 or 22 is acknowledged by the remainder of that subsystem 12. Such programming for effecting a program downloading is within the skill of those familiar with the software arts. A functional block diagram of the primary traffic control mechanisms provided is shown in Figure 6. It will be understood that, due to the multi microcomputer distributed nature of each subsystem 12, by the provision of a common data transport controller 32, each such controller 32 is provided with only those functions necessary to the operation thereof. For example, each peripheral interface device 18 includes those functions relating to intrasubsystem data transport and data transport with a peripheral 16 but not functions relating to the data traffic across the networking medium 14. However, because of the commonality and distribution of the data transport controllers 32, a uniform nested layered communication protocol is provided. The provision of such a uniform network wide communication protocol further enhances the autonomous traffic control by each device 18, 20 and 22, and, hence, each subsystem 12. Preferably, the communication protocol is based on the The normal services take advantage of the, effectively, independent access to the storage medium 44 of each data transport controller 32 by the bus interface 40 and the peripheral interface controller 38 to dynamically assign the medium 44 on a demand basis. Thus, each channel transferring information via any storage medium 44 throughout each subsystem 12 is assigned memory according to its instantaneous need rather than on a fixed block basis. Hence, congestion is, in many cases, avoided where it would normally occur due to exceeding an assigned fixed block of memory during times when other preassigned fixed blocks of memory were empty or only partially full. The rate adaptation function 74 is downloaded into every data transport controller 32 at each peripheral interface device 18 throughout the network 10. Preferably, the rate adaptation function 74 is implemented according to the state machine diagram shown in Figure 7A based on the state table, shown in Figure 7B and in accordance with the following definitions The rate adaptation function 74 is provided to equalize the data transfer rate between a fast data rate source and a slow data rate destination. Such a function more efficiently utilizes all communication links throughout the network 10 Preferably, the traffic distribution function 76 is implemented according to the state machine diagram shown in Figure 8A based on the state tables of Figures 8B and 8C and in accordance with the following dictionary The traffic distribution function 76, for example, across the network interface devices 20 on opposite sides of the networking medium 14 relies on status reporting between the data transport controllers 32 interconnected via the intrasubsystem bus 30. This reporting allows identification of the least loaded network interface device 20 in a subsystem 12. To distribute load uniformly among network interface devices 20 in the involved subsystem 12, a new virtual link is established between the least loaded network interface device 20 in each of the subsystems 12. The congestion detection and control function 78 is downloaded into each data transport controller 32 and preferably is implemented according to the state diagram shown in Figure 9A based on the state tables of Figures 9B 9F and in accordance with the following dictionary The following definitions describe the variables and procedures of the congestion detection and control which are used in the state machine transition tables. In the preferred embodiment, the first congestion in the system is defined as the operational point of offered traffic to a data transport controller 32 wherein the available free buffer in the storage medium 44 thereof approaches complete utilization. If this is allowed to continue with increasing offered traffic the performance of that data transport controller 32 would degrade as a result of lost packets due to unavailable memory and also the potential for deadlock would also occur. Therefore, congestion detection consists of monitoring the size of the free buffer in the storage medium 44 with respect to three thresholds. When the size of the buffer is below the first threshold the congestion control mechanism throttles new input traffic. When the buffer size falls below the second threshold then transit traffic is throttled. In the first case though input traffic was throttled transit traffic was not affected for the reason of attempting to provide service to those packets that have already been partially serviced. If the free buffer size falls below a third threshold then virtual circuits are torn down and packets may be discarded. For peripheral interface devices 18, input traffic is from the external peripherals 16 and transit traffic comes from the intrasubsystem bus 30. The network interface devices 16 have input traffic from the intrasubsystem bus 30 and transit traffic from the networking medium 14. The above described subsystem 12 is responsive to the growing need for the inexpensive expansion of subsystems 12 connected to a communications network 10, while avoiding a complete system redesign. Thus, the fact that, in any given subsystem 12, certain paths are more heavily used than others and the fact that it is not predeterminable which paths are to be the heaviest used and, additionally, the fact that the location of the heaviest used paths changes, does not affect the present subsystem 12. That is, the traffic flow across a subsystem 12 having, inter alia, a plurality of network interface devices 20 is both autonomously and automatically distributed by each network interface device 20 therein. The communication system 10 as described herein is applicable to almost any type of network. The present apparatus has been described with reference to a particular exemplary embodiment and is not intended to be limiting as other arrangements and configurations may be made without departing from the spirit and scope of the present invention.