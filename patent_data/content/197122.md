# A CELLULAR FLOATING POINT SERIAL PIPELINED MULTIPLIER

## Claims
Zellularer Multiplizierer mit seriellem Fliessbandbetrieb, ausgebildet zur Annahme eines seriellen Datenstroms für den X Operanden, zur Annahme des Y Operanden und zur Ausgabe eines seriellen Datenstroms, welches das Produkt der Operanden ist, wobei alle Zellen identisch sind, jede Zelle mit Verzögerungsmitteln für den X Operanden versehen ist, die Verzögerungsmittel der Zellen eine Verzögerungsschaltung 1 bilden, jede Zelle mit Additionsmitteln versehen ist, die Additionsmittel der Zellen eine Additionsschaltung 3 mit Fliessbandbetrieb zur Ausgabe des Produkts bilden, dadurch gekennzeichnet, dass er ausgebildet ist zur Annahme von zwei synchronen seriellen Datenströmen von Ziffern im Gleitkomma Format und zur Ausgabe eines einzigen identisch formatierten Stroms, welches das Gleitkomma Produkt ist, und ausserdem dadurch gekennzeichnet, dass jede Zelle Umordnungs Verzögerungsmittel umfasst, wobei diese Umordnungs Verzögerungsmittel in den Zellen eine Umordnungs Verzögerungsschaltung 2 für den Y Operanden bilden, und dass jede Zelle Durchlauf und Erzeugungsmittel 4 umfasst, wobei diese Durchlaufmittel in den Zellen ein MODUS Signal durch eine erste Verzögerungszelle laufen lassen, um ein verzögertes MODUS Signal zu erzeugen, und dieses verzögerte MODUS Signal durch eine weitere Verzögerungszelle zum Zellenausgang laufen lassen, diese Erzeugungsmittel dieses MODUS Signal und dieses verzögerte MODUS Signal verwenden, um Signale zu erzeugen, welche den Betrieb der Additionsschaltung mit Fliessbandbetrieb und der Umordnungs Verzögerungsschaltung steuern, und dass jede Zelle Differenzierungsmittel umfasst, wobei diese Differenzierungsmittel in den Zellen eine Zellen Differenzierungsschaltung 5 bilden, die zur Steuerung jeder der Additionsschaltungen 3 mit Fliessbandbetrieb und der Umordnungs Verzögerungsschaltung 2 und der Verzögerungsschaltung 1 für den X Operanden geschaltet ist, und dadurch gekennzeichnet, dass das MODUS Signal in einem ersten Zustand das Vorhandensein eines Mantissen Bits und eine Multiplikations Operation definiert, wobei alle Zellen zusammenarbeiten, um die Multiplikations Operation zu erlauben, und wobei die Umordnungs Verzögerungsmittel 2 die Umordnung der Y Mantissa erlauben, und dadurch gekennzeichnet, dass das MODUS Signal in einem zweiten Zustand das Vorhandensein eines Exponenten Bits und eine Additions Operation definiert, wobei alle Zellen unabhängig voneinander arbeiten und eine einfache Addition der Operanden in der letzten Zelle erfolgt, und wobei die Verzögerungen der Exponenten zugleich in der Verzögerungsschaltung 1 für den X Operanden und in der Umordnungs Verzögerungsschaltung 2 für den Y Operanden einander gleich sind mit der Folge, dass die Exponenten des X Operanden und des Y Operanden die Anordnung synchron durchlaufen.

## Description
This invention relates to a floating point serial pipelined multiplier. Architectures well matched to the computationally intensive task of real time SONAR signal processing have been proposed by Whitehouse and SPEISER 1981 based on the systolic techniques of KUNG 1979 . These architectures are characterised by arrays of identical, limited capability systolic processing elements SPE s with minimum complexity nearest neighbour interconnections which allow a large number of parallel arithmetic operations to occur. However, direct handling of the large order matrices typical of SONAR applications is difficult. Physically realisable systolic arrays are currently of limited size and partitioning of the matrix computation is mandatory. This partitioning diminishes the benefits of the systolic approach. A design methodology which minimises the partitioning problem is the bit serial approach proposed by LYON 1981 . It is based on minimum area serial data paths and fixed point serial processing elements and allows many more processing elements to be included in a systolic array. For SONAR however, the use of fixed point arithmetic imposes unacceptable constraints. In particular, the large dynamic ranges typical of the application can only be met indirectly by increasing the precision of the representation i.e. the number of bits . This solution slows the achievable processing rate and incurs area overheads of O n where n is the number of bits in the representation. Further, number overflows must be prevented by periodic rescaling which increases quantum noise in intermediate values. The net effect is a degradation of processor throughput. To optimise system performance a floating point format is required. This permits both precision and dynamic range to be independently optimised, and it is shown that it can be implemented with a methodology related to the work of LYON. Bit serial data paths and processing elements are used and an associated mode bit differentiates between mantissa and exponent. Each multiply accumulate SPE as defined by WHITEHOUSE and SPEISER is constructed from several registers and a multiplier and accumulator. The major element is the multiplier. Current work on floating point multipliers for systolic processor applications such as NASH 1984 uses parallel algorithms to implement the multiplication. The problem of implementing minimum complexity units is addressed as an application of this invention. A study of the work on serial fixed point multipliers, originally proposed by JACKSON et al. 1968 , revealed many references to their inherent capability to perform concurrently the operation X x Y Z. This patent demonstrates a use for the addition operator which is applicable to the direct handling of time division multiplexed exponents in a serial floating point data format. A canonic multiplication cell is described which when used in a linear array implements a serial pipelined floating point multiplier. For an m bit mantissa and e bit exponent, the area of the multiplier is O m , independent of the exponent length. Further, the exponent length is arbitrary and allows the dynamic range to be varied during task execution. The implications of this low complexity VLSI implementation optimised for both precision and dynamic range for real time signal processors with computation rates in excess of 1000 million floating point operations per second are significant. The object of the present invention is the implementation of a serial floating point multiplier. Serial pipelined multipliers have attracted continuing attention for digital signal processing applications and reference may be had to a report of JACKSON, L.B., KAISER, J.F. and McDONALD, H.S. An approach to the Implementation of Digital Filters , published in IEEE Trans. on Audio and Electroacoust., Vol. AU 16, pp. 413 21, Sept. 1968. Further examples are LYON, R.F., Two s Complement Pipeline Multipliers , IEEE Trans. on Comm. COM 24, pp. 418 425, 1976, also BALDWIN, G.L., MORRIS, B.L., FRASER, D.B. and TRETOLA, A.R., A Modular, High Speed Serial Pipeline Multiplier for Digital Signal Processing , IEEE J. Solid State Circuits, SC 10, pp. 307 13, October 1975, and PEKMESTZI, K.Z. and PAPADOPOULIS, G.D., Cellular two s Complement Serial Pipeline Multipliers , The Radio and Electronics Engineer, Vol. 49, No. 11, pp. 575 580, November 1979. Number representations have been restricted in these examples to sign magnitude and two s complement fixed point. However, the implementations have varied from the direct addition of partial products to a five level re coded Booth s algorithm. Examination of these implementations indicated that a minimum complexity design which offered most in terms of modularity was that proposed by PEKMESTZI and PAPADOPOULIS above. A brief description of a modification of this multiplier follows. Operands are represented in two s complement notation As the operands are less than one, the product is also less than one and can be written Use of modulo 2 in equation 2.4 indicates that carries are not considered in the analysis. The algorithm of 2.4 is implemented with the basic cell of figure 4. This figure differs somewhat from that presented by PEKMESTZI and PAPADOPOULIS. An additional delay element has been used for the partial product and carry terms to provide a simpler control structure. A further difference is the allowance for both operands to be serial. A complete nxn serial pipelined multiplier is constructed of n basic cells. Three cell types are required, corresponding to the last, second to last and other stages. Cell types are differentiated from each other by two links shown in figure 4. Link positions are given in Table 1. Operands are entered with the least significant bit first. A control signal is entered in parallel with the data such that it is low only during the entry of the most significant bit MSB . This signal performs the following functions The term 2 According to this invention, there is provided a cellular serial pipeline multiplier arranged to accept a serial data stream for the X operand, to accept the Y operand, and to output a serial data stream being the product of the operands, wherein all cells are identical each cell having delay means for the X operand, the delay means of the cells forming a delay circuit, each cell having adding means, the adding means of the cells forming a pipelined addition circuit for outputting the product, characterised in that it is arranged to accept two synchronous digit serial data streams in floating point format and to output one identically formatted stream which is the floating point product, and further characterised in that each cell comprises reordering delay means, said reordering delay means in the cells forming a reordering delay circuit, for the Y operand, and in that each cell comprises propagation and generation means, said propagation means in the cells propagating a MODE signal through a first delay cell to form a delayed MODE signal and propagating the said delayed MODE signal through a further delay cell to the cell output, said generation means using said MODE and said delayed MODE signals to generate signals which control the function of the pipelined addition circuit and the reordering delay circuit, and in that each cell comprises differentiation means, said differentiation means in the cells forming a cell differentiation circuit connected to control each of the pipelined addition circuits and the reordering delay circuit and the X operand delay circuit, and characterised in that the MODE signal in a first state defines the presence of a mantissa bit and a multiplication operation, whereby all cells function together to enable multiplication operation and whereby the reordering delay means enable reordering of the Y mantissa, and characterised in that said mode signal in a second state defines the presence of an exponent bit and an addition operation whereby all cells function independently, and a simple addition of the operands is executed in the last cell, and whereby the exponent delays in both the X operand delay circuit and the Y operand reordering delay circuit are equal, causing the X operand and Y operand exponents to propagate synchronously through the array. For a better understanding of the invention and to show how the same may be carried into effect, reference will now be made, by way of example, to the accompanying drawings, wherein As will be seen from the illustrations, a floating point number F is composed of two parts, a fractional mantissa M and an integral exponent E, and can be represented as The real number representation R of this floating point representation is The product P of two floating point numbers F₁ and F₂ can be expressed. Substituting 3.1 where represents addition Floating point multipliers are typically constructed in a manner detailed in fig. 7. This schematic shows the x and y integral exponents directed to a parallel adder 12 and the fractional X and Y mantissae directed to a parallel multiplier 13. For number representations which are wider than the available data paths additional control circuitry is required to schedule the operands through the arithmetic units. Post normalisation has not been considered. A conventional approach to the implementation of a multiplier for a serial floating point format is shown in schematic form in fig. 8. Multiplexers 14 and 15 direct the integral X and Y exponents through a serial adder 16 and the X and Y fractional mantissae through a serial pipelined multiplier 17 with the serial pipelined multiplier 17 output directed to the serial result multiplexer 18 but with the serial adder 16 output directed to the multiplexer 18 through the delay 19, all under control of the control unit 20 which receives instruction signals from the mode control 9. The spatial separation of the parallel implementation is translated to a time separation in the serial multiplier of fig. 8. The serial adder 16 and serial multiplier 17 of fig. 8 perform the same functional roles as the parallel adder 12 and parallel multiplier 13 of fig. 7. Functional complexity for the serial case is increased by the distribution over both time and space of both exponent and mantissa. This increase in complexity is illustrated by the additional functional elements 14,15,18,19 and 20 of fig. 8 which are required in addition to the serial equivalents of the parallel adder 12 and multiplier 13 of fig. 7. A new approach to the problem of implementing a serial floating point multiplier is detailed in this patent and it demonstrates how using as a basis a serial pipelined multiplier, all of the additional functional elements 14,15,18,19 and 20 of fig. 8 can be integrated into a simple cellular structure. Instead of multiplexers 14 and 15 separating exponent and mantissa for independent processing and subsequent combination of the result by multiplexer 18 as in fig. 8, the multiplier structure 17 is modified to allow both the addition and multiplication operations to be performed in one array of cells. This is possible in a serial floating point format. The multiplier 17 cannot achieve full utilisation for arbitrary exponents as varying delays are introduced between successive mantissae as a function of the exponent lengths as shown in the timing schematic fig. 10. During these delays the multiplier adders become idle in a pipe lined sequence which propagates through the array. Use is made of the adder in the last cell during its idle state to perform exponent addition. To efficiently utilise this adder in a dual role for both multiplication and addition a delay circuit is constructed for one operand to propagate an unchanged exponent through the array in the addition mode and to re order and store the mantissa digits in the multiplication mode. An arbitrary length cascade of cells which directly handle a floating point data format in this way is shown in a functional schematic form in Figure 1. Five functional circuits 1, 2, 3, 4 and 5 are constructed. The X and Y operands are input to the delay circuit 1 and the digit re ordering delay circuit 3 respectively and the outputs from each of these circuits are combined in the pipelined addition circuit 2 to form the floating point product X x Y which is output via the delay cell 6. The cell differentiation circuit 5 controls individual cell function. Signals entering the circuit 5 are SELO and SEL1 and they are both held at a logic high. Interconnection of these signals between cells provides three independent control states to define the three cell types required for correct multiplier operation. The different cell types invert the X operand in the last cell and correctly handle the carry signals for the pipelined adders. The MODE signal, which differentiates at the multiplier input the operand mantissae and exponents, is entered into a control signal propagation and generation circuit 4. When MODE is a logic high it defines the presence of a mantissa bit and a multiplication operation, and when low it defines an exponent and an addition. This use of the MODE bit to differentiate exponent and mantissa also allows the identification of the MSB s and is an extension of the approach adopted by LYON in the fixed point case. The pipelined addition circuit 3 functions in two distributed modes which propagate across the array as a function of the MODE signal. The low to high transition of this signal at a cell boundary initialises the carry inputs to the adders and begins a multiplication. Partial product information is transferred across cell boundaries in this mode. Carry information is transferred from each cell to its successor at the end of the multiplication phase when the MODE signal undergoes a high to low transition. The additional delay stage 6 at the end of the addition circuit 3 is required to re synchronise the product with the MODE signal. The product is subject to 2k 1 delays in a k cell array while the MODE signal is subject to 2k delays. This additional delay matches both delay paths. During the addition phase, when MODE is low, no information is transferred across cell boundaries and all cells function independently. This results in a simple addition of the operands in the last cell as required for the exponents. The bit re ordering delay circuit 2 supports two data handling operations for the Y operand which are necessary to implement multiplication and addition in one iterative array. The operations The delay circuit for the X operand provides two delay stages per cell and under the control of SELO and SEL1 inverts the data used in the last cell. The principle of operation discussed above is illustrated by considering a particular implementation. Fig. 5 shows a floating point multiplier cell. Multiplication of two n bit mantissae is performed by an array of n cells implementing the algorithm described in section 2. As before, three cell types are required in the array, and are constructed from the basic cell by the placement of the two links shown in fig. 5 and whose position is detailed in Table 1 herein. During operation a MODE bit is entered in parallel with the data to identify the data type mantissa or exponent and to select both the operation required and the nature of the delay for the Y operand. A logic high enables a multiplication operation and a logic low an addition. The delay structure of one or two delays per cell for the Y operand allows respectively the re ordering of the Y mantissa during a multiplication, and the synchronous delay of both X and Y exponents during an addition. Exponent addition is performed by the carry save adder in the last cell. Both modes are fully pipelined. In an NMOS implementation the time penalty of this cell compared with the of PEKMESTZI and PAPADOPOULIS is due to one additional pass transistor in the logic preceding the full adder. A further delay present in the cell shown is due to the internal identification of the MSB. Overall cell speed can be increased by the use of independent MODE and MSB control signals. The fully pipelined, alternating exponent and mantissa format is preserved at the output of the multiplier with the qualification that the result is not normalised. The worst case normalisation required is one bit which presents no numeric problems when the multiplier is followed by a floating point adder as in an SPE. A fully modular floating point multiplier cell as illustrated in Fig. 6 has the link structure of figs. 4 and 5 removed and replaced with multiplexers and two control lines. Logic highs are entered from the last cell and propagate a maximum of two cells backwards along the array to perform the differentiation of cell function. The multiplexers incur a minor time penalty, but minimise the system complexity by allowing all cells to be identical. Operation of the array is identical to the multiplier discussed above. Fig. 2 shows the propagation of the MODE signal through a four cell multiplier for the case of an operand with a four bit mantissa and a three bit exponent. There are two delay stages in each cell with the arithmetic operation coinciding with the second delay. At any time instant a row of fig. 2 describes the contents of each cell in terms of an addition or multiply symbol exponent or mantissa respectively . As there is only one arithmetic operation in each cell, an additional diagram, Fig. 3 shows the distribution in time and position of the useful arithmetic operations carried out in the array. The delay stages are denoted by either D or D In the timing schematic shown in Fig. 10 the mantissa length is equal to the number of cells, in this case shown as four, while the exponent length is arbitrarily greater than one and is shown as three for the purpose of illustration. Two phase clocking ₁ and ₂ has been assumed. The MODE input defines exponent and mantissa to the multiplier array, and the MODE output defines the product exponent and mantissa. A single delay stage is required at the result output to properly synchronise result and MODE signals. The unlimited exponent range achieved with the circuit of Figs. 5 and 6 is achieved naturally. This is an advantage of the approach. From the foregoing it will be seen that the invention is concerned with the following Floating point arithmetic units designed for use in VLSI systolic arrays must be numerically robust. This is a consequence of the inability to handle an exception condition in a primitive SPE. For the floating point multiplier as discussed, no difficulties can arise during the processing of normalised mantissae. The only exceptions possible are due to inadequate exponent range. The proposed cell provides a solution to this representation problem by allowing the number of bits in the exponent to be dynamically varied. Guard digits can be carried in the exponents, and the number of digits increased as required to prevent overflow during computation. There is a lower limit of one digit with no upper limit. This dynamic exponent control allows optimisation of both computation time and storage requirements. From the foregoing it will be appreciated that a serial floating point multiplier has been provided. The area time product of the bit serial multiplier approaches the optimum, and the overall complexity is minimised by a fully modular design. An unlimited exponent range is a feature of the implementation which offers an unusual ability to handle a class of numerical problems with large dynamic ranges.