# Digital video delay by sample interpolation.

## Abstract
Delay apparatus for providing convergence and correc tion in a video display system includes a digital signal delay circuit 20 which uses a sample interpolation technique to provide apparent signal delays corresponding to fractional parts of whole sample periods. Adjacent digital samples from 42 are combined 43,44,46 using fractional coeffi cients that sum to unity. The selection 30,40 of the fractional coefficients determines the size of the smallest delay increment. The number of whole sample delay periods as well as the initial fractional coefficients are provided, e.g. for a given horizontal scan line, by information that is stored in a memory device 30 during assembly or alignment of the video display apparatus.

## Claims
CLAIMS 1. Delay apparatus for a digitally encoded video signal, characterized by the combination of means 24 for presenting for processing a first and second one of a plurality of digital input samples from said digitally encoded video signal, said digital input samples each having an encoded amplitude value comprising one of a plurality of possible values, said second digital input sample being displaced from said first sample means 40 for generating first and second fractional sample coefficients and means 42.43,44 for processing said first and second digital input samples in response to said first and second fractional sample coefficients, said first and second fractional sample coefficients forming a unity fractional complement, and means 30,31,32,33 40,41,52 for combining said processed first and second digital input samples to form a third sample having an apparent predetermined displacement from said first and second digital input samples. 2. Apparatus as claimed in claim 1, including means 30,40 for selectively choosing said first and second fractional sample coefficients. 3. Apparatus as claimed in claim 1, wherein said first and second fractional sample coefficients provide amplitude weighting of said first and second digital input samples, respectively. 4. Apparatus as claimed in claim 1, arranged to receive, as said digitally encoded video signal,a horizontal line of video information.

## Description
DIGITAL VIDEO DELAY BY SAMPLE INTERPOLATION This invention relates to digital processing of video signals and, in particular, to the delay of video signals to eliminate raster distortion and convergence errors. A digital color television system may sample an analog video signal at a predetermined rate, for example, 14.32 MHz, which, for NTSC color signals, is four times the color subcarrier frequency. The signal amplitude of each sample is converted to a digital value by an analog to digital converter ADC . The digitized video signal is processed to form red, green and blue drive signals which, after conversion back to the analog domain by a digital to analog converter DAC , are applied to the electron guns of the color cathode ray tube. Both digital and analog television receivers are subject to raster distortion and convergence errors.Horizontal convergence errors and raster distortion, such as side pincushion distortion, may be corrected by selectively delaying one or more of the individual color signals in a given horizontal scan line in order to converge the three colors on the cathode ray tube display screen and correct the distortion. In a digital system, this delay may be accomplished by clocking the digital samples into a storage device, such as a random access memory RAM and clocking the samples out of the RAM after a predetermined number of clock pulses. This technique permits video information and, consequently, entire video lines to be moved in steps equal to the distance between adjacent digital samples, or pixels, on the cathode ray tube display screen. Actual convergence and distortion errors may require that the video information be moved a fraction of a whole sample to provide correction within a specified tolerance. U.S. Patent Application Serial Number 480,907, filed March 31, 1983, in the name of T. V. Bolger and entitled, Digital Video Processing System with Raster distortion Correction , corresponding to UK published .application 2137849A, published 10 October 1984, describes U V w v S U a digital television system having a multiphase clock for reading samples out of a digital sample storage device. The phase of the clock is selected to provide the amount of sample delay necessary to give the desired raster distortion or convergence correction for each of the three colors. The present invention provides a digital television system which utilizes a fixed frequency and single phase clock, yet provides an equivalent of fractional sample delays in order to correct distortions within closely defined tolerances. In accordance with the present invention, a variable delay apparatus for a line of digitally encoded component video signal information comprises means for selecting a first one of a plurality of digital samples from a line of digitally encoded video signal information, the sample having an encoded amplitude value of one of a plurality of possible values, processing the first sample to provide a first processed sample having an amplitude value comprising a first fraction of the first sample amplitude value selecting a second digital sample located adjacent to the first sample processing the second sample to provide a second processed sample having an amplitude value comprising a second fraction of the amplitude value of the second sample, the second fraction being a unity fractional complement of the first fraction and combining the first and second processed samples to form a third sample having an apparent displacement from the first sample. In the accompanying drawing FIGURE 1 is a schematic diagram of a digital signal processing circuit in accordance with an aspect of the present invention and FIGURE 2 illustrates waveforms useful in understaznding the theory of operation of the circuit ofFIGURE 1. Referring to FIGURE 1, an analog composite video signal, from a source of video signals not shown , is applied to an analog to digital converter ADC 10. ADC 10 generates digital signals at a sample rate determined Dy the clock signal frequency from a clock generator 11. The circuit of FIGURE 1 illustratively uses a sampling frequency equal to four times the color subcarrier frequency. For NTSC color signals having a color subcarrier of 3.58 MHz, the sampling frequency is 14.32 MHz. ADC 10 is illustratively shown as providing an 8 bit digital sample, thereby generating samples having 28 256 quantizing steps. The digitized video signal is applied to a synchronizing separator circuit 12, where it is processed to remove the horizontal and vertical synchronizing information, and to a digital comb filter 13 Digital comb filter 13 separates the luminance and chrominance information and applies the luminance information to luminance processing circuitry 14 which provides a luminance signal on a conductor designated Y to a digital matrix 15. Chrominance information from digital comb filter 13 is applied to chrominance processing circuitry 16, which generates the I and Q color signals in response to the properly phased I and Q clock signals, on conductors designated ICK and QCK, from clock generator 11. The I and Q color signals, on conductors I and Q, are also applied to digital matrix 15, which combines the luminance signal and the I and Q color signals to produce the digital red, green and blue color signals on conductors DR, DG and DB, respectively. Each of the digital red, green and blue color signals is applied to a digital delay circuit. FIGURE 1 shows, in detail, a digital delay circuit 20 which acts on the digital blue color signal via conductor DB. Similar delay circuits 21 and 22 for the digital red and green color signals are illustrated in block diagram form, for simplicity. Digital matrix 15 generates digital color signal samples illustratively comprising 8 bits. These samples are applied to a buffer 24 via the digital blue signal conductor DB which produces a 16 bit sample pair comprising two adjacent 8 bit color signal samples. For example, subsequent sample pairs in a given horizontal scan line may comprise digital samples one and two, samples two and three, and samples three and four, such that each subsequent sample pair comprises one new 8 bit sample not included in the previous sample pair. The 16 bit sample pairs are stored in a random access memory RAM 25 in locations determined by a write address generator 26. Write address generator 26 is incremented by a write clock signal provided by clock generator 11 via conductor WRCK.The write clock signal is first applied to a gate circuit 27 which prevents the write clock signal from being applied to the write address generator 26 during the horizontal blanking interval. Gate circuit 27 operates in response to a signal from synchronizing pulse separator circuit 12. Write address generator 26 is reset each horizontal scan line by a horizontal reset pulse that may also be generated by synchronizing pulse separator 12. A delay of the blue video signal is accomplished by writing a predetermined number of sample pairs into RAM 25 before any reading of sample pairs out of RAM 25 is begun. Sample pairs are written into RAM 25 at the write clock rate, i.e., 14.32 MHz, which corresponds to one sample pair being written into RAM 25 approximately every 70 nanoseconds. Each sample pair written into RAM 25 before sample pairs are read out of RAM 25 corresponds therefore to a delay of 70 nanoseconds. RAM 25, configured to accommodate 128 sample pairs, could therefore produce a maximum delay of 128 samples x 70 nanoseconds sample 8.96 pS. In order to provide horizontal movement of the digital red, green and blue color signals in either direction with respect to each other, a nominal delay is provided for each of the digital color signals on each horizontal scan line. The amount of actual delay desired for each of the color signals can then be provided by increasing or decreasing the delay relative to the nominal delay. For delay circuit 20 of FIGURE 1, a nominal delay of 4.48 vS, corresponding to 64 samples x 70 nS sample, gives the maximum amount of relative sample movement that can be produced by RAM 25.For example, if the digital green color signal is processed by delay circuit 22 to have the nominal delay of 4.48 pS, the blue color signal, processed by delay circuit 20, may be delayed with respect to the green signal by a maximum of 4.48 pS, or the blue signal may be advanced with respect to the green signal by a maximum of 4.48 uS. The amount of the delay is determined by the time at which samples are read from RAM 25 relative to the time at which those samples were written into RAM 25. The units of signal delay that have been discussed up to this point have been determined by whole numbers of clock pulses, i.e., 70 nanosecond steps. In actual operation, however, the amount of convergence or raster distortion requiring correction may not correspond to whole numbers of delay steps, but may require a fraction of a delay step in order to bring the convergence or distortion errors within desired tolerances or specifications. Delay circuits 20, 21 and 22 incorporate means providing an equivalent of fractional amounts of whole delay steps in order to accurately correct convergence and raster distortion errors. In accordance with an aspect of the present invention, the fractional delay steps are achieved via sample interpolation circuitry which operates in the following manner. The convergence errors and amounts of raster distortion side pincushion distortion, for example for a given video display apparatus are determined during assembly of the video display apparatus. One technique for determining this error utilizes photodiodes placed at various screen locations to sense actual electron beam landing positions. Knowing the desired beam landing positions in order to produce a raster without mis convergence or distortion errors allows a determination of the amount of shift needed in the beam landing positions in order to accomplish the desired corrections.This shift information is utilized to program a read only memory ROM 30 during assembly or alignment of the video display apparatus. The ROM 30, which illustratively includes misconvergence and distortion information for each digital sample of each horizontal scan line, is individually programmed for a particular cathode ray tube of a particular video display apparatus. For a given horizontal scan line, the amount of blue signal delay needed nominal delay plus or sinus delay shift to effect the desired corrections is provided by ROM 30 to a read delay counter 31 via a conductor identified as PRESET. Read delay counter 31 is incremented by the write clock signal and begins to produce output pulses in response to write clock pulses when the number of preset sample delay steps from ROM 30 is reached. The output pulses from read delay counter 31 are applied to the input of an AND gate 32. Another input of AND gate 32 is coupled to the input of gate circuit 27, which is the write clock pulses. AND gate 32 will therefore produce output pulses representative of write clock pulses whenever the preset delay count has been exceeded.TheAND gate 32 output pulses are applied to a read address generator 33, which is reset each horizontal line by a signal from sync separator 12. Read address generator 33 is coupled to RAM 25 and accesses particular sample locations of RAM 25 at the frequency of the clock pulses from AND gate 32. Samples are read out of RAM 25 from addresses accessed by read address generator 33 in the order they were written into RAM 25 from buffer 24, i.e., first in first out. Read address generator 33 will always lag write address generator 26 so that information is always available to be read out. As previously described, merely delaying the reading out of video samples from RAM 25 by a multiple of clock pulses may not provide accurate enough convergence or raster distortion correction. It may be necessary to have a delay equal to a fraction of the delay provided by one clock pulse delay. This fractional delay may be effected by sample interpolation, which will be explained with reference to FIGURE 2. FIGURE 2 illustrates a portion of an analog video waveform 35.Waveform 35 is illustratively shown as being digitally sampled, by an analog to digital converter, similar toADC 10, for example, at sample points 35a f. Sample interpolation combines a fraction of the digital amplitude values of adjacent samples to from a new sample having a new amplitude value. The fractions selected illustratively comprise a unity fractional complement that is, the sum of the fractions selected for an adjacent sample pair should sum to unity. In FIGURE 2, sample points 35a f occur at timesT1 T6, respectively, and have amplitude values of S1 S6, respectively. As an illustration of sample interpolation, the amplitude values of adjacent samples, such as the amplitude of sample 35a, equal to S1, and the amplitude of sample 35b, equal to 52 are combined, for example, using 1 2 as the fractional coefficient for each sample. The resultant samples will have amplitude values intermediate the original sample amplitudes, as shown by sample 36b, having an amplitude S, between and S2. If the resultant samples are used to replace the original samples, as shown by samples 36b 36f in FIGURE 2, the effect is to generate a new encoded waveform 36 that gives the appearance of being shifted or delayed with respect to waveform 35 by an amount equal to one half a whole sample period. The fractional coefficients selected will determine the amount of apparent delay with respect to time T1. For example, using 7 8 of the amplitude S1 and 1 8 of the amplitude S2 will produce an apparent delay of 1 8 the sample period from T1 to T2 Similarly, if adjacent digital samples of a horizontal line of video information are combined in the previously described manner by using unity fractional complement coefficients, it is possible to shift the video information in as small an increment as desired, merely by selecting the proper fractional coefficients.A greater number of fractional parts of a selected coefficient will result in smaller possible apparent delay steps. In an application such as is shown in FIGURE 1, the number of whole and fractional delay periods for each horizontal scan line is stored in ROM 30 to establish a horizontal starting point for the video signal information of each line. As described previously, the number of whole delay periods is applied to read delay counter 31 via the PRESET conductor, in order to determine when samples will begin to be read from RAM 25. A three bit digital word, representative of the fractional delay coefficient, is applied to a coefficient control and counter circuit 40, which in turn applies the three bit digital word to a sample interpolator circuit 41.Interpolator circuit 41 incorporates a buffer 42, shift and add circuits 43 and 44, inverter 45 and a summer 46.Buffer 42 reforms the 16 bit sample pair from RAM 25 into two 8 bit samples which are respectively applied to shift and add circuits 43 and 44. The three bit word from coefficient control and counter circuit 40 is applied to shift and add circuit 43 and to inverter 45. The digital word value determines the number of digit shifts required by shift and add circuit 43. Inverter 45 forms a digital word representative of the unity fractional complement coefficient, which is applied to shift and add circuit 44 and determines the number of digit shifts. Shift and add circuits 43 and 44 perform the function of multiplying the values of samplers from buffer 42 by their respective fractional coefficients. This is accomplished by shifting the appropriate number of bits of the digital samples based on the coefficient representative 3 bit words.Shifting bits therefore allows 8 bit digital samples to be moved in delay increments equal to 1 8 of the total sample period. Therefore, apparent delay increments of 8.75 nsec are possible. The outputs from shift and add circuits 43 and 44 are combined by summer 46 to form the resultant delay corrected video information sample. The output signal from summer 46 comprising delay corrected digital data occurring at the 14.32 MHz sample rate, is applied to a digital to analo DAC converter 47, which converts the digital data to the analog blue drive signal. The blue drive signal is ten applied to the kinescope or cathode ray tube drive circuits which act to produce the desired blue designated electron beam.Similarly, the outputs of delay circuits 21 and 22 are applied to digital to analog converters 50 and 51, respectively, which produce the red and green drive signals. The previously described interpolation method, utilizing a single fractional coefficient pair, will provide the same amount of delay for each sample of a given horizontal scan line. This is appropriate for certain types of correction, such as raster centering however, other types of misconvergence or distortion errors will require different amounts of correction, or sample delay, for different positions along a given horizontal scan line. For example, misconvergence is usually more severe at the ends of a horizontal line than at the center of the line. Similarly, side pincushion distortion will decrease in severity away from the edges of the cathode ray tube display screen. This requires a variable amount of sample delay for a given horizontal scan line.Since the amount of delay change from sample to sample is relatively small, it is possible to accomplish the desired variable delay by changing the fractional coefficients. The rate of delay change the number of digital samples occurring between coefficient changes , and the delay change direction whether the delay is increased or decreased are also programmed into ROM 30 as a result of the error measurements taken during circuit assembly and alignment. The coefficient change and delay change direction data is applied to coefficient control and counter circuit 40. This delay change data either increments or decrements the coefficient counter, which in turn controls the operation of interpolator 41. When the coefficient counter of coefficient control and counter circuit 40 becomes incremented or decremented to its upper or lower limit, respectively, an output signal is applied to advance hold control circuit 52.When the coefficient counter becomes incremented to its upper limit, advance hold control circuit 52 increments read address generator 33 by one sample address. This is in addition to the normal address increments which occur in response to the clock pulses from AND gate 32. Similarly, when the coefficient counter becomes decremented to its lower limit, advance hold control circuit 52 prevents read address generator from being incremented for a period of one clock pulse. This effectively resets the advance hold control circuit 52. In an analogous manner, the offsets and scan differences of the red, green and blue pickup devices of a color video camera can be compensated by utilizing the prev iously described technique of apparent signal delay by sample interpolation. A ROM may be programmed during assembly of the camera which will provide the appropriate correction amounts for each horizontal scan line. The previously described sample interpolation technique therefore provides apparent delays of digitized video signals of small increments in order to correct misconvergence and raster distortion errors to within very small tolerances, thereby making the arrangement described in accordance with the present invention appropriate for high resolution cathode ray tubes.