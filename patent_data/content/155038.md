# FAST DECODER FOR REED SOLOMON CODES WHICH CAN ALSO BE USED AS AN ENCODER, AND RECORDING PLAYBACK APPARATUS COMPRISING SUCH AN ENCODER DECODER

## Claims
Decoder für Codewörter, die gegen das Auftreten mehrerer Symbolfehler je Codewort mittels eines Reed Solomon Codes über GF q mit einer Länge n, einer Abmessung k und einem Mindestabstand d n k 1, und durch ihre Paritätsprüfmatrix geschützt sind, deren i. Spalte nachstehende Form hat

## Description
The invention relates to a decoding device for code words which are protected against the occurence of several symbol errors per code word by means of a Reed Solomon code over GF q , having length n, dimension k, and minimum distance d n k 1, and its parity check matrix, the ith column of which being of the form wherein α is a primitive element of GF q and b an arbitary integer, said device comprising A flexible procedure is thus obtained. External pointer information of incorrect symbols can be realized, for example by the detection of an analog signal level or by the detection of inadmissible bit patterns. Similarly, pointer information for an incorrect symbol can be internally generated. U.S. 4,124,174 provides a simple and hence fast correction of at the most three incorrect symbols per code word, but the flexibility of this method is not high and, for example already present pointer indications are not used so that the ultimate repair capability is less than that of the present invention. By addition and subtraction the Galois field arithmetic unit can quickly perform operations which correspond to multiplication and division of the symbols. For code words which are systematic at the symbol level, said first arithmetic means preferably comprise a control input EDS for an encoding decoding signal in order to form syndrome symbols from a code word unter the control of the decoding signal and to form subsequently, under the control of erasure indications or not, a set of error locations from the syndrome symbols and an error value for each error location, and to form, under the control of an encoding signal, a series of parity symbols from a series of data symbols of a data word as erasure symbols in the locations of the parity symbols which have been corrected with respect to the already present symbols. This extension is based on the fact that during the encoding operation the same parity symbols are formed as if they were erasure symbols in the decoding situation. It will be apparent that in given circumstances a saving is achieved by the dual use of parts for encoding as well as for decoding. Before encoding, the symbols already present in the parity locations may have the value zero or any other value. Preferably, said buffer device comprises two alternating buffer elements, each of which serves to accommodate a complete code word, with each buffer element there being associated a memory for the erasure locations, each of said memories being addressed by an associated counter which is decremented by a read control signal and which is incremented by a write control signal. The counting of the number of erasure symbols in a code word represents a simple aid for the selection of the mode of operation. When the number of erasure symbols becomes too high, correction will become impossible. When the counter position has decreased to zero, all erasure symbols have been treated this can also be simply detected. Notably when the maximum number of permissible erasure symbols is comparatively small six in the present embodiment , the construction of these memories as a random access memory represents a simple solution. Preferably, said Galois field arithmetic unit comprises a chain which is formed by a converter for converting a symbol into an element of the set exponent, double exponent, inverted exponent, halved exponent , a selectively activatable adder which is provided with a bypass, and a second converter for reconverting an exponent into the associated symbol. This results in a simple device which allows for the flexible execution of a large number of relevant calculations. Preferably, said first arithmetic means comprise a parallel connection of d 1 registers, each of which serves for a provisional syndrome symbol, a series connection of d 2 multiplier elements for multiplying each symbol received by the basic element of the relevant Galois field, each multiplier element being connected between the inputs of two successive registers, per code symbol received the registers being cyclically driven in the sequence of the multiplier elements, an exclusive OR circuit XOR which comprises a code symbol input and a feedback input which is fed by all registers of the parallel connection, the output of the exclusive OR circuit being retrocoupled to the series connection and also constituting an output of the first arithmetic means. This results in a fast operating configuration. In order to obtain an even higher speed, a further symbol register may be arranged between the exclusive OR circuit and the series connection. Preferably, said buffer means comprise a counter LCO which can be loaded by an adjustable register WLE in order to count down the number of symbols received and to form a reception completed signal when a predetermined position is reached. The word length can thus be readily adjusted under software control. Preferably, said second arithmetic means comprise a strategy determining register for prestoring the maximum permissible count of erasure symbols in a code word and for selectively supplying an uncorrectability signal. When the number of erasure symbols in a code word received is larger, or said second arithmetic means comprising a second strategy determining register for storing the maximum permissible count of error symbols in excess of the erasure symbols and for selectively supplying an uncorrectability signal when the number of error symbols found in a code word is larger. The strategy can thus be adjusted in various ways, depending on the requirements imposed as regards safety and correction capability. Preferably, said Galois field arithmetic unit comprises two parallel connected processor memories which are bidirectionally connected to said chain as well as to a connection to further part of the second arithmetic means. The speed is thus further increased because read and write operations can be simultaneously performed. The invention will be described in detail hereinafter with reference to some Figures the environment and philosophy of the invention, the encoding and the decoding will be successively dealt with Various complex formules are separately shown in the form of a table. Figure 1 shows a block diagram of a device for the preparing for use of information which is serially received, for example from a magnetic tape, and which is protected by a Reed Solomon code. Feedback effects which could occur at various higher levels during the treatment have not been taken into account. The information is received on input 20, that is to say bit serially. In block 22 series parallel conversion is performed for the symbol wise further processing of the information. Demodulation takes place in block 24. Superfluous spacing bits between the symbols can thus be removed and the symbols modulated in channel bits can be translated into code symbols because redundancy is removed . Only this symbol information, with or without flag bits, will be further processed. In the present embodiment, all symbols comprise 8 bits, but this is not a fundamental restriction. A flag bit can act as a quality indication reliable unreliable for the associated symbol. For example, when a symbol in the bit stream received does not satisfy the modulation rules, the symbol can be indicated as being unreliable. The flag bits can contain information relating to a level which is higher than the symbol level, but this will not be considered herein. If necessary, de interleaving is performed in block 26 so that the symbols of a code word are arranged to be successive in time thereafter. In block 28 the associated syndrome symbols are formed from the data symbols and redundant symbols of a code word, and corrections are made or not on the basis of flag bits and syndrome symbols. When corrections are necessary but not possible because of an excessively large number of errors, mitigating steps may be taken in block 30 although the correct information cannot be restored in this manner, the annoyance to a user due to incorrect symbols can in many cases be reduced, for example by presenting a code symbol consisting exclusively of 0 bits. The information becomes available to a user via output 32. The procedure to be described hereinafter is particularly suitable for consumer information, for example information representing images and or sound. In special cases also for example, program information or data for a computer environment may be concerned. The relevant use has its consequences for the steps taken in block 30, but the invention does not relate thereto. Correction detection takes place in block 28 on the basis of a Reed Solomon code. The symbols of the code are defined over a Galois field GF q in the present embodiment q 256. The generator polynomial is a continual product g x pi i 0 ... d 2 of factors x a Encoding can be performed by means of the retrocoupled shift register shown in Figure 3. In the present embodiment, however, preference is given to an implementation in which the same device is capable of encoding as well as decoding. Evidently, encoding will be simpler because no branch operations will be required in the program. For the sake of simplicity, various secondary procedures will be described hereinafter with reference to the arithmetic programs in the higher programming language RTL 2. It is to be noted that programming languages are artificial languages, so that any resemblance to languages spoken by humans or other intelligent beings is purely coincidental. The advantage of the representation used herein over flowcharts consists in that the present representation is much more compact. Upon encoding, n d 1 data symbols are converted into n code symbols. For the sake of simplicity, a systematic code will be described, which means that each data symbol corresponds directly to one associated code symbol, so that the d 1 further code symbols are real redundant symbols. This restriction is not fundamental. Each code word must be divisible by the generator polynomial of the code g x . The information words m x have a degree of at the most n d . Therefore, the remainder r x x During the decoding operation, the decoder searches for a word received, the next nearest correct code word, in as far as the Hamming distance, as determined over the symbols which are not erasure symbols, at the most equals d 1 e 2 , in which e d. When this code word cannot be found, an alarm bit is attached to the relevant word. The calculations are performed in the Galois field GF 2⁸ as commonly done for the error correction in the Philips Compact Disc system. Reference is already made to Figure 4 which shows a general block diagram of the decoder in accordance with the invention. The symbols are byte serially received by RES, together with a pointer flag bit EEP which is produced, for example by the demodulation. This information is applied to block 68 which acts as a buffer and correction device. The code symbols are applied to element 50 in which the syndromes are formed, the operation being synchronized by a number of clock signals. The first clock signal is a 16 kHz word clock WOCL which produces a signal transition after each word. The second clock signal is a 32 kHz symbol clock LSCL which is high each time when the last symbol of a word is received consequently, after that all syndrome symbols are known and is otherwise low. The third clock signal is a microprocessor clock MPCL of 4 MHz which serves to synchronize the symbol treatment per period of the signal LSCL, so that after each half period of WOCL a new word can be received more than 256 symbols per word is in principle impossible because the symbol length is restricted to 8 bits . The fourth clock frequency SGCL amounts to 24 MHz and serves to perform the relevant operations during the period in which a symbol is received. Finally, the syndrome generator 50 receives the signal SRD for controlling the reading of the syndromes formed. The code words are processed with a time overlap. During the decoding of a given code word, the directly preceding code word is applied to a user decoded while the next code word can be received, the syndrome symbols being formed coincidentally with the reception. Component 76 is the symbol bus for communicating syndrome symbols and corresponding data bytes between the various components. The syndrome generator 50 acts as the source. Other sources are the elements 66, 52. Destinations are elements 62, 66, 68 as will be described hereinafter. Element 52 localizes the erasure symbols. To this end, it receives first of all the pointer signals EEP. Register 72 contains the information concerning the word length in number of symbols . At the beginning of a new word, the counter 70 is each time loaded with this information, so that the erasure locator 52 and the buffer correction device 68 can use this information. Loading is controlled by the clock LSCL, and resetting by the clock SYCL. Erasure locator 52 also receives a control signal from the control unit 64, an information NOS from the register 54 which indicates the number of syndromes in the code word which can thus be adjusted under external control , an information ANE from the register 56 which indicates the total number of permissible erasure symbols with a maximum of six in the presence of six redundancy symbols , and a switch over bit EDS from a flipflop 57 which indicates whether the circuit is used for encoding or for decoding. Element 62 is the test unit. This unit receives a 7 bit signal from the erasure locator 52, that is to say a 1 bit signal NEE for indicating whether the permissible number of erasure symbols for the relevant word was exceeded, because in that case correction will not be possible. Also received again on bundle 55 are a three bit signal NER which indicates the actual number of erasure symbols, and a three bit signal NES which indicates the number of remaining effective syndrome symbols and wherefrom further incorrect symbols can be detected and or corrected outside the erasure symbols. The test unit 62 also receives a three bit signal ANF from the register 60 which indicates the total number of incorrect, non erasure symbols which is permissible for correction this variable is co determined by the correction strategy followed. Furthermore, the test unit 62 receives a 7 bit control signal from the control unit 64, comprising a 1 bit signal RAT which controls the execution of a test as regards the permissibility of the errors and which is further used for decrementing the counter which enumerates the number of errors yet to be treated. Also received are a four bit signal TST and a two bit signal RST see hereinafter . The test unit 62 supplies a jump control signal JMP and a stop control signal STP to the control unit, and a signal ZSS which indicates a symbol having the value zero hex for for the Galois field arithmetic unit 66. For each symbol received the test unit is synchronized by means of the clock MPCL. The test unit also outputs a 1 bit signal UEP to the unit 68 in order to indicate that the relevant word contains an uncorrectable error pattern. Element 64 is the control unit which outputs a number of successive control signals for each word, synchronized by the clock MPCL. It applies a signal COR to the element 68 in order to indicate when a correction must take place, so that the contents of the element 68 can be further used. The signals JMP, STP, ERD and SRD have already been described. Furthermore, a 22 bit control signal is applied to the Galois field arithmetic unit 66. For the WME memory to be described hereinafter, this concerns a 4 bit address and also a write control signal and a read control signal. The memory HME to be described hereinafter is controlled by a similar series of signals. Finally there are the signals IDS 1 bit for selection between direct and indirect, a 1 bit signal AWR for writing in the A memory, a 1 bit signal BWR for writing in the B memory, a two bit signal LRD for reading a logarithm, a 1 bit signal MUL for controlling a multiplication, a 1 bit signal BAC for controlling an accumulator operation of the B memory, a 1 bit signal ZAC for controlling a zero accumulation, and a two bit signal RRD for reading a root zero point of a polynomial . The arithmetic unit 66 GFA for the Galois field is synchronized by the clock MPCL, communicates bidirectionally with the bus 76, receives a number of control signals already described , and applies an 8 bit signal BME to the unit 68 as generated on the outputs of the B memory. Finally, the symbol buffer and correction unit 68 receives a 1 bit signal UFL from flipflop 74, for example to indicate that an uncorrectable word must be considered to be generally unreliable. The latter means that all symbols of the word themselves are also unreliable. Synchronization is performed by the clock signals SYCL, MPCL and WOCL. Also received are the control signals UEP and COR. On its output COS, this element outputs symbols corrected or not and on its output SFL it outputs each time 1 flag bit for each symbol output. Figure 6 shows the syndrome generator 50 in Figure 4 . Many mnemonics have already been discussed. Via two logic AND gates 90, 92 each time comprising an inverted input which is indicated by a circle and a logic OR gate 94, the four clock pulse series received are decoded. Two operations can be simultaneously performed by the insertion of the register SR multiplication in the elements denoted by a and addition in the exclusive OR element XOR. Furthermore, the resetting of the syndrome registers IS ... IS5 is simplified. Each of the latter registers comprises two clock inputs, one of which is shown at the upper side for controlling the output, and one at the lower side for controlling the loading. As is shown, these clock pulses form part of a six fold cycle 1 ... 6 which is repeated, for each symbol received, by way of the six fold pulses per symbol SGCL. The decoding of this series has been omitted for the sake of simplicity. The Figure also shows the multiplier elements, denoted by a , such as the element 96 therein, each time a multiplication by a is performed. As soon as a word consisting of n symbols has been completely received, the registers SR, IS , ... IS4 have the contents 0 and the register IS5 is reset to zero when the first symbol of the next word arrives register S has a tristate output. If desired, the assembly formed by the registers IS , IS1 and the multiplier elements a connected parallel thereto can be implemented as one module. By repeating this module a number of p times, a number of 2p syndrome symbols can be formed. It will be apparent that a number of syndrome symbols in excess of the number of parity symbols formed during encoding does not make sense. However, encoding can also be performed with an arbitrary number of parity symbols provided that the program allows for the relevant degree of redundancy . Figure 7 shows a more detailed diagram of the unit 68 of Figure 4 for the buffering and correction of the symbols received. Storage takes place in the two memories SME1, 2 of the random access type which have a capacity of 256 symbols of 8 bits plus flag bit thus, the capacity suffices for a code word of any length which is permissible within the scope of the code, input and output de multiplexer also being provided. The successive code words can be applied alternately to the memories SME1 and SME2 at the input. In the memory which is not used for input, the symbols to be corrected are then written over by the other inputs of the multiplexers 100, 102, while a flag bit 0 means reliable is suppleted as indicated. At the output side, the memory filled with corrected information is read on the output line COS simultaneously with the renewed filling of this memory , any flag bits also being presented on the output. Symbols to be corrected can then be applied from the other memory to the bit wise exclusive OR circuit 108, the associated flag bits being reset. Updating is performed by means of said byte BME. During filling vacating, the two memories SME1, 2 are addressed by the information of the symbol counter LCO and during correction by the information of the symbol bus SOS, the procedure being performed by means of multiplexers 100, 112. During reading writing of a complete word, synchronization is provided by the clock SYCL enabled by the word clock WOCL. Synchronizing for correction is performed by the control signal COR in conjunction with the 4 MHz clock MPCL, enabled again by the signal WOCL. There are two attractive ways of storing the symbols 0 ... i ... n 1 of a word in the memories SME1, 2. The first method consists in that the rank number i equals the address, or the address running backwards n 1 i . In that case storage space can be saved if the word length, i.e. the highest permissible value of n, is limited, so in this case it can always be substantially smaller than 256 symbols. The second possibility consists in that the addresses and the rank numbers are logarithmically related, so that the symbol i stored at the address a The flag bits EEP received may be received from an external source, for example from the demodulator. When an uncorrectable word has been received, either all flag bits are output on the output without modification or all flag bits of the relevant word are set to 1. This is because in this case the bit UEP is 1 , while the latter choice is controlled by the value of the bit UFL. Control is performed by means of five AND gates as indicated, two of which comprise an inverting input, and two OR gates which are shown in the same way as in Figure 6. Figures 8a, 8b, 8c show the erasure locator, that is to say successively the subsystem elements, the formation of the internal synchronization signals, and the formation of the internal condition signals. There are two memories EME1, 2, each of which is associated with one of the two memories SME1, 2 of Figure 7. The positions of the address counter act as data. The erasure symbols are counted in the counters ECO1, 2 which also operate as address counters for the local memories. The storage capacity is chosen to be 16 words of 8 bits actually 6 words would already suffice . The counters comprise an incrementation input which is controlled together with a write operation an additional erasure symbol is received and a decrementation input which is controlled together with a read operation the control unit requests the information of a further erasure symbol . Before the reception of a new code word, the associated address counter is set to 1. After reception of the entire word, the counter contains the total number of erasure symbols, the latter information forming the information NER via a three bit multiplexer structure. For Figure 8a, Figure 8b shows the selective formation of write signals WR , read signals RD and erasure control signals for the memories EME1, 2 and the counters ECO1, 2, respectively. The signal WOCL each time selects only one half of the organiziation. Figure 8c shows the central control section of the erasure locator. The encoding decoding bit EDS conducts either the permissible number of erasure symbols ANE in the case of decoding or the permissible number of syndromes NOS for storage in the counter CO1. The erasure symbols EEP received decrement this counter, synchronized by The information NOS 0 deactivates the decoding a borrow carry signal to the counter CO2 is then directly formed, so that the uncorrectable signal NEE is formed. At the correct instant the signal UEP is formed therefrom Figures 7 10 in order to provide all symbols with an unreliability flag. The signal NES indicates how many syndrome symbols of a word stored can still be effectively used for error correction. For these signals see Figure 4, connection 55. When the information ANE has the value zero, only errors will be corrected but not erasure symbols. During encoding the signal EDS 1 in order to render the number of erasure symbols to be pseudo corrected equal to the value of NOS top left corner of Figure 8c . Figure 9 shows the arithmetic unit for the Galois field GF 2⁸ . A GFA unit has already been published in the United States Patent Specification 4,162,480 in the name of E.R. Berlekamp. The external connections SOS, BME, ZSS and the control by the control unit 64 have already been briefly described with reference to Figure 4. The unit described herein is optimized for a limited value of the mininum Hamming distance, that is to say 7. The processor memory of the GFA unit consists of the memories WME 120 and HME 122 , each of which is provided with relevant latch memory 121, 123 which is connected to the data output which can be made transparent by the signals WRD, HRD. Also provided are a symbol register AME 124 for symbols in the logarithmic mode, and a symbol register BME 126 for symbols in the vector notation. The relevant write control signals are WWR, HWR, AWR and BWR. The signal IDS controls the multiplexer 128 for filling the two memories directly or not. The addresses for the two RAM memories 16x8 are the 4 bit signals WAD, HAD. At an elementary scale there are eight feasible source elements for the bus SOS, that is to say Element S contains the next syndrome symbol each of the elements QEQ, TEQ, TRT is formed by a read only memory for 256 memory words of 8 bits, said elements being shown in combined form in block 128. The latter three elements are addressed by the 8 bit address BME. The contents of the three read only memories is as follows for the relevant values of BME The circuit also comprises a further memory bank 130 which comprises four read only memories LOG, LGS, LGQ, LGI, each of which has a capacity of 256 8 bit memory locations. The information on the bus SOS acts as an address the data appears on connection 132. At the address a The element OCA 125 is an adder for numbers in 1 complement notation, modulo 255. To this end, one operand is stored in a latch register 124 under the control of a signal AWR, the second operand being applied directly via the connection 132. The result of the addition is applied to a multiplexer 134 which is controlled by the output signal of an AND gate 136. A multiplication or division is thus realized by the addition of the exponents. The bit value ZSS 0 indicates whether one of the factors has the value . Under the control of the load signal AWR, storage takes place in the latch circuit 138. When one or both factors have the value 0 , the second input of the multiplexer is activated to present HEX on the output. When the signal MUL has the value 1 , multiplexer 140 becomes conductive for the pseudo product. When MUL 0, the output of block 130 is directly connected to the input of block 142. The block 142 is a read only memory having a capacity of 256 8 bit locations. At each address i, this memory ILG contains the value a Figure 10 shows a block diagram of the test unit 62 of Figure 4. Therein a number of assumptions in the decoding process are tested. Depending on the test result, the program stops, a jump is made, or the program continues with the next program step. The table 1 at the conclusion of the present description contains the assumptions, which can be tested. Actually, the third and the fourth line form seven separate tests each. The results of the first 16 tests can be classified as follows. When the signal RAT has the value 1 and the symbol value SOS does not form an element of the set a The signal NEE 1 means that the number of erasure symbols is larger than permissible in accordance with the chosen strategy. In that case the program again stops immediately upon the relevant detection and correction is considered to be impossible. Using the variable ANF, the number of symbols to be corrected in excess of the number of erasure symbols can be specified. When the number of additionally detected error symbols is excessively large, the program stops immediately upon the relevant detection and the code word is considered to be uncorrectable. Immediately before the first symbol of the next code word is received, the bit CNP is stored in the register UEP and the register bits F1, F2 are reset to zero. In this respect the circuit of Figure 10 comprises the following elements The conditions are thus tested, the remainder of the circuit providing, co controlled by the signals RST1 , RST2, NEE and load control signals for the register bit positions F1, F2, the decoding into the signals JMP, STP, CNP and UEP. Element 178 is a further register bit position for the signal UEP. The control unit 64 in Figure 4 is shown in greater detail in Figure 11, Figure 12 showing the associated information structure. The central element is formed by the sequencer memory SEQ having a read only capacity of 256 words of 40 bits. The 8 bit address is present in the address counter SCO. In the reset condition of the address counter SCO, the address is HEX and a void instruction is applied to a program status register PSR. The activation of the elements SCO incrementation , SEQ reading and PSR storage is synchronized by the clock signal MPCL. The counter is started as soon as the first symbol of the new word is received, unless the signal NEE has the value 1 because the blocking signal STP is formed on the basis thereof. Under the control of the jump signal JMP, the counter SCO is loaded with the part NAD of the register PSR. The relevant groups of information bits in the register PSR are identified by their mnemonics. In this respect Figure 11a shows the decoding of the two bits RRD 1, 2 and REN in order to obtain four further control bits evidently, these could also be directly stored in the memory SEQ by making the latter wider . The maximum clock frequency of MPCL is now determined by the maximum value of the following delays The first four bits in Figure 12 denote the address WAD Figure 9 and the second four bits denote the address HAD, so that the relevant memory location is capable of communicating with the bus. The bits 8, 9, 10 are applied to element 128 in Figure 9 and to the circuit of Figure 11a, thus selecting the source element for the bus SOS. The bits 11, 15 and 19 are free. The bits 12, 13, 14 are used as selection bits in Figure 9. if IDS 0, direct access occurs. The bits 16, 17 form a two bit address, LRD2 having the highest significance. The bits 18 and 20 are applied to the elements 124 and 140, respectively. The bits 21, 22, control element 146. The bit 23 controls element 126. The bit 24 is used in Figure 7b. The bits 25 27 are used in Figure 10, the bits 26, 27 forming a 2 bit code if this code is 0 , nothing is done. If this code is 1 , correction is not possible if this code is 2 , the correction is already and if this code is 3 , a jump is made. The bits 28 31 form a four bit value which is decoded as shown. The bits 32 39 form the next address for the unit SEQ. The algorithm for the various operations comprises several operation modules The values QEQ, TEQ, TRT are stored in read only memories as shown. All values X₁... differ from one another and from zero. Moreover, they must be situated within the word lengt, which means that they must form an element of the set a