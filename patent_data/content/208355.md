# Method of enlarging reducing dithered images.

## Abstract
A method of enlarging reducing a dithered image obtained from a rastered gray level image by means of a dither matrix consisting of a unique combination of thresholds, consisting of the following steps In this method the information content of the original image remains substantially unaffected, the occurence of Moiré distortion is avoided and the signal noise ratio of the image is only affected insignificantly.

## Claims
1. A method of enlarging reducing a dithered image obtained from a rastered gray level image by means of a dither matrix consisting of a unique combination of thresholds, characterised by the following steps

## Description
This invention relates to a method of enlarging reducing a dithered image obtained from a rastered gray level image by means of a dither matrix. Methods of dithering analog image information are known per se. In these methods, an image for dithering is scanned dot by dot by suitable means and the gray level of each dot is determined. The resulting raster of gray levels is then sub divided into contiguous sub rasters, the dimensions of which correspond to those of a dither matrix filled by an arbitrarily preselected distribution of all the gray level thresholds possible within a sub raster. In each sub raster the gray level of each raster dot is then compared with the corresponding threshold from the dither matrix. If the gray level is greater that the threshold, the associated raster dot is allocated a logic 1 while if the gray level is lower than the threshold the associated raster dot is allocated a logic 0 . In this way the ana log image information is converted to a raster of two level pixels or picture elements by means of which, for example, it is possible to control a printer to display the image, or by means of which the image information can be transmitted over transmission lines, e.g. in facsimile applications. In many cases it is necessary or desirable to be able to enlarge or reduce the image whose information is present in dithered form. In the case of facsimile transmission, reduction may be desirable in order to reduce the number of bits for transmission and hence the required transmission line bandwidth. In displaying an image using the dither information it may be necessary to adapt the information to the resolution of the printer in such a way that the resulting print has a predetermined size. Enlargement or reduction of the image by a given factor may also be required by a user. A method of reducing enlarging an image is described, for example, in US Patent 4,394,693. To reduce an image, according to this known method a number of rows and columns are simply omitted depending upon the required reduction factor. To attain a reduction having a factor a b, b a lines columns are omitted from each group of b lines columns of the input image in order to give the required out put image. The number of lines columns b a to be omitted is distributed as uniformly as possible over the group b lines columns. Similarly, to enlarge an image, a number of rows and columns are added. To obtain an enlargment having a factor c b, c b lines columns are added to each group of b lines columns of the input image. Here again the number of lines columns c b to be added is distributed as uniformly as possible over the group of b lines columns. Each of the added lines columns has the same pixel pattern as one of the neigh bouring lines columns. This method can give acceptable results in the case of pure black white images, such as drawings, but a number of problems arise if the method is used in connection with dithered images containing several gray levels, e.g. photographs and the like. Moiré distortion occurs due to the more or less uniform struc ture in which the pixels are removed from the pixel raster in the case of reduction or with which lines columns are added to the raster in the case of enlargement. The uniform structure with which the pixels are omitted or added interferes with the uniform structure present in the dithered photographs as a result of the dithering method. Moiré distortion does not occur in the reduction of an image in those cases in which the omission pattern is in synchronism with the dither matrix used. This situation, however, will occur only in a very restricted number of cases, e.g. when an 8 8 dither matrix is used and a reduction from 4 to 3. In that case, however, there is another important disadvantage, because those pixels corresponding to one and the same part of the dither matrix are consistently omitted. These omitted pixels represent a number of specific gray level thresholds and by omitting all the pixels associated with these specific gray level thresholds the number of gray levels in the reduced image is greatly reduced. In the above example of an 8 8 dither matrix and a reduction from 4 to 3 the number of gray levels decreases from 65 to 37 or from 33 to 19 respectively if each threshold occurs twice in the 8 8 matrix . Attempts have been made to counteract the formation of Moiré patterns by omitting adding pixels in accordance with an arbitrary scheme such that the positions where pixels are omitted added are no longer situated in a fixed structure. Although on the one side this gives an improvement in the quality of the resulting reduced image inasmuch as the Moiré distortion is more or less reduced, on the other side, however, the noise in the image increases visibly, so that optimum results are certainly not obtained. More particularly, if the display means is capable of printing or displaying each pixel with high accuracy and high fineness, this image noise becomes very perceptible. Reducing or eliminating Moiré patterns by omitting adding the pixels in accordance with an arbitrary scheme is then replaced by a sharp increase of the noise in the image without there being any real quality improvement. Another disadvantage of the known method is the fact that it is not possible to use excessively large reduction factors because with large reduction factors a relatively large number of pixels have to be omitted, and hence a relatively large part of the information content of the image. The object of the invention is to provide a method by means of which a dithered image can be reduced or enlarged while using a wide range of conversion factors, in such a manner that the information content of the original image remains unaffected or substantially unaffected, the occurrence of Moiré distortion is avoided and the signal noise ratio of the image is affected insignificantly, if at all. In accordance with this objective, the invention provides a method of enlarging reducing a dithered image obtained from a rastered gray level image by means of a dither matrix, characterised by the following steps The invention is based on the realization that conversion algorithms should not act directly on individual pixels, but must act on the pattern of the pixels or on the gray level of an area itself without affecting the pattern of the area. To this end, according to the invention, the entire image is divided up into a number of contiguous relatively small input areas and it is assumed that locally the intensity variation will be small within these input areas. On the basis of this hypothesis, according to the inven tion, the pattern in each area is divided into a pattern corresponding to an average gray level and a number of pixels deviating therefrom, which together form the high frequency component of the area. Since, in the case of enlargement or reduction of an image, the gray level of each of the input areas will not change, this gray level can be transferred directly to the output area. The high frequency pixels are then imaged on the associated output area by a linear co ordinate transformation. Although it has been assumed hereinbefore that the intensity variations in each input area will be small, it has been found in practice that the method according to the invention also gives good results if a considerable variation can be signalled in a number of areas. In order to reduce the number of operations to be carried out during the enlargement reduction processing, preferably the number of gray levels of the second dither matrix used in step d is selected to be equal to the number of gray levels of the first dither matrix. A further reduction of the number of processing steps can be achieved if in step c each of the deviating pixels is allocated an amplitude level equal to the difference between the threshold asso ciated with the pixel from the first dither matrix and the average gray level, and only those deviating pixels whose amplitude is greater than a predetermined threshold are imaged on the corresponding output area. By the introduction of a threshold, only those deviating pixels of the input area which differ adequately from the average gray level of the associated input area are imaged on the corresponding output area. It has been found in practice that a correct choice of this threshold makes the signal noise ratio of the reduced enlarged image substantially equal to that of the original image. To be able to determine the average gray level of each input area faultlessly it is preferable that the dimensions of each input area are equal to the dimensions of the first dither matrix or a whole multiple thereof. The effect of this is that in determining the average gray level of an input area each threshold in the dither matrix is involved an equal number of times in the determination. The dimensions of the first dither matrix will not in all cases correspond to the dimensions of the input areas. If there is no con formity, it is preferable to take steps to maintain the dither struc ture in the input areas. In this connection, an embodiment of the method according to the invention is characterised in that if the dimensions of the first dither matrix are not equal to the dimen sions of the input areas in step b , use is made each time of an auxiliary matrix, which is to be determined separately for each input area, and which is found by placing a contiguous array of first dither matrices on the contiguous array of input areas, the thresholds of the dither matrices which fall within each area together forming the auxiliary matrix for that area. Generally, the dimensions of each output area will not be equal to a whole multiple of the dimensions of the dither matrix used, cer tainly not if the first dither matrix is also used for the output areas. To ensure that the required dither structure of the output image is not affected, it is preferable if to generate the standard patterns associated with the gray levels of the output areas in step d , use is made in each case of an auxiliary matrix, which is to be determined separately for each area, and which is found by placing a contiguous array of second dither matrices on the contiguous array of output areas, the thresholds of the dither matrices which fall within each area together forming the auxiliary matrix for that area. The effect of this is that a shift in the dither matrix is brought about for each area separately both in the direction of the row and in the direction of the column. This shift is such that if all these auxiliary matrices are placed next to one another on the output areas the required continuous dither structure is obtained. Preferred embodiments for performing the various steps of the method according to the invention and devices to enable the various steps to be performed will be discussed in detail hereinafter with reference to the accompanying drawings. The disadvantages of the prior art will first be discussed and explained briefly by reference to Figs. 1 and 2. Fig. 1 represents an 8 8 dither matrix in which each gray level threshold 1 32 occurs twice in the total. If a gray level image converted to a raster of two level pixels with this dither matrix is to be reduced, for example, by a factor 3 4, this means that in the known method one line column has to be omitted each time after each three lines columns. The lines columns to be omitted are shown framed in the Figure. It will be apparent from the Figure that with this conversion factor 3 4 all the pixels associated with the gray level thresholds 31, 28 ... fourth column , 2, 6 ... eighth column , 29, 24, ... fourth row and 3, 9, ... eighth row disappear from the complete picture. This means that the number of gray levels in the reduced image has been reduced from 32 1 to 18 1. Although Moiré distortion does not occur in this case, the picture quality is considerably impaired by the considerable reduction of the number of gray levels. With other less pleasant conversion factors, e.g. 2 3, this loss of pixels all associated with one or more specific gray level thresholds will not occur, but Moiré patterns do occur in that case due to interference. The periodicity arising in the reduced image due to the omission of columns, e.g. with the 8 8 dither matrix of Fig. 1 and a conversion factor of 2 3, is represented in Fig. 2. In this Figure, a number of dither matrices according to Fig. 1 are placed side by side in the way in which this also occurs during dithering of an image. It will be clear from this Figure that a repeating pattern occurs of gray level columns which are absent in each case, thus causing the Moiré distortion. In practice this distortion leads to a considerable impairment of the image quality. Fig. 3 diagrammatically represents the method used according to the invention. In block 2 the dithered image information 1 is split, by means of the same dither matrix 3 as was used for dithering the original image, into a series of average gray levels and an asso ciated series of high frequency components. Each of the elements from the two series is then subjected to an enlargement reduction pro cessing in the respective blocks 4 and 5 and then again dithered in the respective blocks 6 and 7. It should be noted that the blocks 4 and 6, or 5 and 7 respectively, can also be combined as shown in dotted lines in the Figure, depending on the operations applied, which will be discussed in detail hereinafter. The associated com ponents of the two series are then re combined at junction point 8 to give the reduced enlarged dithered image. Each of the various opera tions of Fig. 3 will be described in greater detail hereinafter. According to the invention, it is assumed that the intensity variation in a photograph or similar image is generally not excessive locally. If, therefore, a total image is divided up into a raster of contiguous small sub areas, each sub area will have a specific average gray level and there will also occur in each sub area deviations from this average gray level, hereinafter referred to as the high frequency component, which deviations, however, will not be excessive in accordance with the above assumption. In the enlargement or reduction of an image divided up into input areas of b b pixels, each input area is imaged on an output area of a a pixels, the enlargement reduction ratio being equal to a b. If the information from each input area is now divided up in the above manner into an average gray level and a high frequency com ponent deviating from this gray level, it will be apparent that the gray level does not change when an input area is imaged on an output area. For imaging this average gray level on the output area, there fore, the output area must be filled with a pattern of pixels corresponding to this same average gray level. To simplify the explanation, it will be assumed hereinafter that the second dither matrix is equal to the first dither matrix. The average gray level of an input area can be determined in block 2 in Fig. 3 by comparing the pixel pattern of the input area originating from block 1 in Fig. 3 with a series of standard patterns. These standard patterns arise by dithering, with the dither matrix originating from block 3 in Fig. 3 , a number of image areas each filled with a unique gray level from the series of possible different gray levels. Fig. 4 represents two of such standard patterns dithered with the matrix represented in Fig. 1. Fig. 4a represents the standard pattern obtained when dithering a uniform area with a gray level above the threshold 7 but below the threshold 8 and Fig. 4b represents a standard pattern obtained when dithering a uniform area with a gray level above the threshold 23 but below the threshold 24. It will be apparent that a series of 32 standard patterns is associated with the dither matrix represented in Fig. 1. Generally, however, a series of n² standard patterns is associated with an n n dither matrix in which each threshold occurs only once. By comparing the pixel pattern of an input area with the series of standard patterns, it is possible to find that standard pattern which, on comparison, gives the smallest number of deviating pixels. This standard pattern then represents the average gray level of the pixels pattern in the input area. The pixels in the pixel pattern of the input area which deviate from this selected standard pattern form the high frequency component of the input area. These pixels are found by comparing the selected standard pattern with the pixel pattern of the input area. Fig. 5 represents a circuit provided with a memory 11 of the EPROM type. All possible standard patterns are beforehand stored in this memory in an ascending gray level sequence. These standard patterns need only be determined once for the dither matrix used. The circuit of Fig. 5 is also provided with two shift registers 12 and 13. The pixel pattern of an input area is fed to the shift register 13 at the beginning of a comparison procedure via the 64 bit line 22. The shift register 13 is in a feedback circuit. A next standard pattern is fed from the memory 11 to the shift register 12 after every 64 shift pulses. The outputs of the last stages of the shift registers 12 and 13 are connected to the inputs of an exclusive OR gate 14, the output of which is connected on the one hand to the 5 bit counter 16 and, on the other hand, to the 64 bit shift register 15. By the synchronous feed of shift pulses to both shift registers 12 and 13 the pixel pattern of an input area in register 13 is compared each time with a standard pattern in the register 12. A 1 is delivered at the output of gate 14 if no equality is found between the two pat terns for a specific picture point. In that case the 5 bit counter is raised one step. The shift clock pulses Ø are also fed to the 64 bit shift register 15, in which, therefore, the deviating pixels are stored for each standard pattern. At the end of the standard pattern the 5 bit comparator 17 determines whether the value accumulated in the counter 16 is less than the value in a 5 bit register 18 which at the start of the com parison procedure was filled with all l s. If the contents of the counter 16 are less than those of the register 18, gate 19 is opened and the contents of the counter 16 are written in the register 18 instead of the value previously present therein. Comparison with the next standard pattern then starts. Since the standard patterns in the EPROM 11 are stored in sequence, the comparison procedure can be stopped as soon as the value accummulated at any time in the counter 16 starts to rise again, in other words as soon as the comparator 17 determines that the value in the counter 16 is greater than the value in the register 18. At that moment the standard pattern corresponding to the average gray level of the input area is situated in the shift register 12 and the high frequency component, i.e. the pattern of those pixels which deviate from the average gray level, is situated in the register 15. It will be apparent that the entire comparison procedure can also be performed by means of a suitably programmed processor. In many cases, however, the speed at which the comparison operation is to be performed will be subject to stringent requirements. It has been found that the hardware solution of which Fig. 5 represents an example generally operates condiserably faster than the software solution. No details are given of the software solution because it is considered that it is within the knowledge of a person skilled in the art to devise a corresponding program on the basis of the information given above. It is possible for the entire comparison procedure to be per formed faster if both the average gray level component and the high frequency component and also the pixel pattern of each input area are regarded as a vector and the special characteristics of these vectors are taken into account. The following vectors are defined In comparing the pixel pattern of an input area with the various standard patterns, the Hamming distance is in actual fact determined between Each of the possible vectors Fig. 6 represents, in the form of a flow diagram this time, how this modified comparison procedure can be performed. As will be apparent from Fig. 6, the pixel pattern of the input area or the vec tor If block 34 gives a negative result, the comparison procedure is completed. The values allocated at that moment to c and d are the final requested values for the uniform gray level from which the associated vector b By means of the procedure represented diagrammatically in Fig. 6, the average number of comparisons to be performed is reduced to 3 4, while with the procedure explained with reference to Fig. 5 an average of 16 comparisons were required starting with a dither matrix with 32 thresholds , which means a significant reduction of the time required to complete the procedure. A further reduction can be obtained if better use is made of the above mentioned weight that can be allocated to each vector Fig. 7b represents as an example the standard pattern for the threshold 5, i.e. a 1 is allocated to all the thresholds 5 and an 0 is allocated to all the thresholds 5. If this pattern is written as a series of ones and zeroes in ascending threshold sequence, the result is a series with a number of ones at the beginning until the threshold associated with this standard pattern is reached and then the series is continued with a number of zeroes as indicated below. If a standard pattern is now offered without being known to which gray level threshold this pattern is associated with we have to find that value of i for which the Hamming distance d As will be apparent from the foregoing table, the sum d₁ i d It is apparent from this diagram that here too the minimal value of the sum d₁ i d In order to determine the two series d A still further reduction is possible if, starting from a suf ficiently high level, a series of numbers is produced in which each number is always one lower than a previous number if there is a 0 in the pattern at the position in question and each number is always 1 larger than the preceding number if there is a 1 in the pattern at the position in question. In that case too this series will have to have a minimum which, irrespective of the presence of a high frequency component, is at the threshold corresponding to the average gray level pattern. An example of this is represented below with reference to the pattern of Fig. 7c. It is apparent from the foregoing that the generated number series which started with a value 16, which value is sufficiently high to avoid the occurrence of negative numbers in the series even if the pattern consists completely of zeroes, has a minimum at the value 14 corresponding to the threshold 5 and this threshold therefore corresponds to the average gray level pattern of the vector Embodiments of this both in hardware and in software are con sidered to be within the knowledge of a person skilled in the art on the basis of the above data and will therefore not be discussed in detail. If the average gray level component has been found by means of one of the methods described in the foregoing, it is a simple matter, using an exclusive OR processing, to trace all those pixels which deviate from the standard pattern corresponding to this average gray level. For the example of Fig. 7 this would mean that the high frequency component contains only a 1 at the positions of the thresholds 2 and 11 and otherwise contains only zeroes. Both the average gray level found and the high frequency com ponent then have to be subjected to an enlargement reduction operation in the respective blocks 4 and 5 of Fig. 3, if desired at the same time as a second dither processing in the respective blocks 6 and 7 of Fig. 3. If, for example, an image has to be reduced by a factor a b, that means that each input area of b b pixels must be imaged on an output area of a a pixels. If a dither matrix b b gray levels is used for dithering the input image and a dither matrix of a a gray levels is used for dithering each output area, then once the average gray level of the input area is known it is possible to determine, for the associated output area, that standard pattern of a a pixels which most closely approximates the same average gray level on the basis of the output dither matrix concerned. It will, however, be clear that in these conditions the number of gray levels in the output image is also reduced by a b, and this is undesirable. It is therefore preferable to select the second dither matrix in the blocks 6 and 7 of Fig. 3 equal at least insofar as concerns the numbr of gray levels to the first dither matrix in block 3 of Fig. 3 . In that case, however, the dither matrix will generally no longer fit correctly on each output area. To be able to convert uni form gray areas faultlessly care must be taken to ensure that both the input areas and the output areas are well synchronized with the dither matrix to be used. Fig. 8 indicates how this synchronization can be obtained. The solid lines in Fig. 8 indicate an array of input areas A11, A12, ... A21, A22, ... etc. Each of these input areas has the same dimensions as the dither matrix used, in this example the dither matrix represented in Fig. 7a. This dither matrix is filled in in each of the areas A11 ... The Figure also represents in dotted lines the output areas B11, B12, ... B21, B22, ... etc, on which the input areas with the same indices must be respectively projected. It will be clear from this Figure that with the dimensions selected a reduc tion by a factor of 3 4 is aimed at. Input areas of 4 4 pixels are imaged on output areas of 3 3 pixels. The synchronization between the dither matrix used and the output areas B is maintained if a sub matrix used for dithering each individual output area B This technique can otherwise also be used if the dimensions of the input areas do not correspond to the dimensions of the first dither matrix. In that case too the gray level structure in the input areas is maintained by determining an auxiliary matrix for each input area in the manner described above. It will be clear that auxiliary matrices can be similarly used in the enlargement of images, such auxiliary matrices also being found by placing a contiguous array of dither matrices on the con tiguous array of output areas and each time forming an auxiliary matrix for a specific output area from the thresholds of the array of dither matrices which fall within the area in question. Enlargement reduction of the average gray level and dithering of the enlarged reduced gray level is thus complete. All that remains is to enlarge reduce the high frequency component and its dithering respectively in blocks 5 and 7 of Fig. 3. The high frequency component of the input area can be imaged on the output area by linear co ordinate transformation. The co ordinates x₀, y₀ of an input area A These transformed high frequency pixels are now written in in the output area instead of the pixels associated with the average gray level pattern originally written in there as the result of the processing in block 6 of Fig. 3. The high frequency pixels have a special information content and hence a higher priority and are all transferred to the output area in a one to one transformation from the input area so that practically nothing, if anything, is lost from the information content of the original image. In the case of enlargement it is meaningful, depending on the enlargement factor, to image a high frequency pixel from an input area on a number of pixels in the output area. In the case of enlargement by a factor of 2, in accordance with this, a high frequency pixel from the input area is for example imaged on a group of four contiguous high frequency pixels in the corresponding output area. Before a high frequency pixel is transformed to a corresponding pixel in the output area or a plurality of pixels in the case of enlargement , a threshold is preferably introduced to include in the high frequency component only those pixels which deviate from the average gray pattern in a predetermined manner. It has been found that if a correctly selected threshold difference is introduced the signal noise ratio of the processed image enlarged or reduced is approximately equal to that of the original image. If, for example, the average gray level lies between the thresholds 6 and 7, and hence the standard pattern selected in block 4 of Fig. 3 has a 1 for all thresholds 7 and a 0 for thresholds 7, and if a minimum threshold difference of 2 is determined, then if the pixel associated with the threshold 8 is not equal to 1 but is equal to 0, this high frequency pixel will not be included because the difference between the gray level of this pixel and the average gray level is too small. After both the average gray level component and the high frequency component are again available in dithered form in suitable manner in accordance with the foregoing, at the outputs of the blocks 6 and 7 in Fig. 3, both components are superimposed in block 8 by the fact that at those positions where a high frequency pixel is present this pixel occurs instead of the corresponding pixel in the average gray level component. As a result, the enlarged or reduced image is delivered in dithered form at the output of the junction point 8.