# Process and apparatus for sorting samples.

## Abstract
In a process and an apparatus for sorting samples of a material in which a pulse signal from each sample reaches a detector, where the signal than is electronically processed to avtivate a sorting device if the signal has predetermined properties, the gain is automatically controlled. This is achieved by measuring peak values of the pulses, by counting the pulses with pulse heights within a certain predetermined range, and by readjusting the gain if the ratio of number of pulses within the predetermined range to the number of total pulses deviates from a predetermined ratio.

## Claims
Claims 1. Process for sorting samples of a material, in which a pulse signal from each sample reaches a detector, where the signal then is electronically processed to activate a sorting device if the signal has predetermined properties, characterized in that the gain of the device for processing the signal is automatically controlled by measuring peak values of the pulses, by counting the pulses with pulse heights within a certain predetermined range, and by readjusting the gain if the ratio of number of pulses within the predetermined range to the number of total pulses deviates from a predetermined ratio. 2. Process according to claim 1, characterized in that all pulse with heights above a predetermined magnitude are counted and compared with the total number of pulses. 3. Process according to claim 1 or 2, characterized in that the pulse height is determined by successively samplirg the pulse a plitude, where the pulse height is determined by the maximum measured amplitude value. 4. Process according to claim 1 or 2, characterized in that the pulse height is determined by measuring the pulse height at the moment when the derivative of the pulse signal goes through zero. 5. Process according to claim 4, characterized in that the derivative is amplified into a square wave function. 6. Process according to any of the claims 1 to 5, characterized in that also additional peaks of the pulses are recorded. 7. Process according to claim 5 or 6, characterized in that the number of pulses is determined only from the number of main peaks of the pulses, and that also the negative portion of the derivative of the pulse signal is amplified into a square wave and evaluated. 8. Process according to any of the claims 1 to 7, characterized in that the DC level of the pulse signal is restored to its original valve before an input capacitor 58 of the circuit. 9. Process according to any of the claims 1 to ti, characterized in that 2 detectors or sets of detectors are used, which are arranged in a distance with respect to each other in the direction of movement of the samples, that the time wise distance of the peaks of the corresponding pulses is measured and used for determining the delay with which the sorting device is activated after the sample has passed the detectors. 10. Apparatus for performing the process according to any of the claims 1 to 9, characterized in that it comprises a device for determining the pulse height of every signal, a counting means for counting pulses with pulse heights within a predetermined range, a counting means for counting the total number of pulses, means for comparing these numbers and means for adjusting the gain as a result of these numbers.

## Description
DescriptionThe invention relates to a process for sorting samples of a material, in which a pulse signal from each sample reaches a detector, where the signal then is electronicallY processed to activate a sorting device if the signal has predetermined properties. The invention also relates to an apparatus for performing the process.In a large numberof cases samples of material which move past a detector have to be sorted or athexwise investigated. For this reason some signal of the samples is taken up in the detector and further processed. signals of this Kina can be signals of visible light, ultraviolet light, infrared light, other electromagnetic radiation as e.g, X rays, microwaves etc. Also ultrasonic signals could be used for these purposes. An example of such a sorting machine is described inUS A 4 057 146 of the applicant.This apparatus serves for sorting beans or grains. In this apparatus the beans or grains are moved one by one past a ring of detectors in which their colour is sampled. The signals of several detectors are combined in a photocell the signals of the photocell are then electronically processed.If one of the beans or grains has not the desired properties is e.g. too small or has an unwanted colour , with a given delay a sorting device is activated, when the corresponding bean reaches this sorting device. This sorting device can be e.g. a stream of air which is produced by activating a soleonid.One important problem with such a process or an apparatus is the fact, that the gain of the devices for electronically processing the signals has to be adjusted. This is particularly the case, if the conditions change with which the radiation signals or other signals reach the detector, e.g. due to a changing amount of dust on the detectors.Normally this gain has to be adjusted by hand which requires that a person is constantly watching the apparatus.In addition to that, there is always the chance of an error which will result in bad sorting results.The object of the invention is to provide a process and an apparatus of the above mentioned kind which requires no manual adjustment of the gain.This object is solved by a process in which the gain of the device for processing the signal is automatically controlled by measuring peak values of the pulses, by counting the pulses with pulse heights within a certain predetermined range, and by readjusting the gain if the ratio of number of pulses within the predetermined range to the number of total pulses deviates from a predetermined ratio.Automatic gain control AGC is known per se, e.g. in radio and television receivers. This automatic gain, however, is operative only in connection with more or less continuous signals, e.g. more or less continuous steady oscillations. The amplified signals in such devices are averaged by integrating if necessary after rectification the corresponding DC signal is used for adjusting the gain.Such a conventional automatic gain control cannot be used here. The total average signal will not be only a function of the single pulses or signals of single beans. It will also be a function of the total number of pulses of beans passing the apparatus within a given time. If the conventional system of automatic gain control would be used, the gain would be reduced if the number of beans or other objects to be sorted increases. This effect of course is not at all desired.According to the inventive process and apparatus, the peak values of the pulses are measured. The pulses with pulse heights within a certain predetermined range are counted. Also the total number of pulses is counted.If the ratio of numbers of total pulses and pulses within the predetermined height range deviates from a predetermined value, the gain is adjusted. Because it is easier to determine whether pulses exceed a pretermined level than to deside whether they fall into a predetermined range with two given bounderies, in an advantageous embodiment all pulses with heights above a predetermined magnitude are counted and compared with the total number of pulses.If the pulses should fall in a range between 5 V and 10 V, it would be possible to count 256 pulses. If less than 128 pulses have a pulse height exeeding 5 V, the gain is increased if more than 128 pulses have this height, the gain is decreased. After 256 pulses have been counted, the whole procedure starts again.This process can be controlled by a microprocessor. In this case e.g. after switching on the gain can be doubled in the first step, then reduced by a factor of 1,5 in the next step, if the increase was to large, thus asymptotically reaching the ideal value. If conditions e.g. dust on the sensors change, of course the gain will change correspondingly.In an advantageous embodiment the pulse height is determined by successivly sampling the pulse amplitude, where the pulse height is determined by the maximum measured amplitude value. For this purpose only the present amplitude value has to be compared with the previous one.If the previous one is smaller, obviously the peak of the pulse has not been reached. When the successivevalue is equal to the previous one or even smaller, the peak has been reached or passed. This value then is further processed as the pulse height. Corresponding electronical equipment with adequate speeds for such a process is available.A much simpler way of measuring the pulse height which does not require high speed electronic of such a high quality consists in that the pulse height is determined by measuring the pulse height at the moment when the derivative of the pulse signal goes through zero.As is well known, the derivative of a pulse signal is zero at the position of the pulse peak. To obtain the derivative of the pulse signal does not present any difficulties at all, such that the pulse height can be determined easily.In order to determine the position of the zero derivative and thus the pulse peak more accurately the derivative in an advantageous embodiment is amplified into a square wave function. Sometimes the pulses will not contain only one peak, but also additional peaks. This will be the case e.g. if spots on the beans are present which are much darker or much brighter than the remaining surface of the bean. If also such additional peaks are recorded and processed, further results about the quality of the beans can be obtained.If this information is also used for sorting the beans, a product of higher quality can be obtained.Advantageously the number of pulses is determined only from the number of main peaks of the pulses. By amplifying and evaluating also the negative portion of the derivative of the pulse signal as a square wave further information can be obtained, e.g. about secondary peaks and thus defects spots of the samples. in this portion. Thus the derivative here is hidden within the noise. If, however, also the negative portion of the derivative is used, also this secondary peak can be detected.Because the signals normally are fed to the circuit via at least one input capacitor, the DC zero level is shifted by the pulse signals. In order to remove the ambiguities of an uncertain DC level, advantageously the DC level of the pulse signal is restored to its original value before an input capacitor of the circuit.As mentioned above, the sorting device has to be activated with a delay which corresponds to the flight time of the samples, e.g. the beans, from the detectors to the sorting device. This time of flight can be different for different beans, depending on the shape of the beans, whether they just have touched the wall, etc. Therefore, a certain danger exists that much faster or much slower samples are not sorted out properly. In order to avoid these problems which can be achieved with means anyhow provided for the inventive process or in the inventive apparatus, detectors or sets of detectors can be used, which are arranged in a distance with respect to each other in the direction of movement of the samples.The time wise distance of the peaks of the corresponding pulses is measured and used for determining the delay with which the sorting device is activated after the sample has passed the dectors.An apparatus for performing the process is characterized in that it comprizes a device for determining the pulse height of every signal, a counting means for counting pulse with pulse heights within a predetermined range, a counting means for counting the total number of pulses, means for comparing these numbers and means for adjusting the gain as a result of these numbers.The invention in the following in the following is further explained with reference to the accompanying drawings in which Fig. la shows a typical wave form of pulses occuring when performing the inventive process Fig. 1b shows the derivative of the signals of Fig. la Fig. 1c shows the square wave signal obtained from the derivative of Fig. lb Fig. 2a to 2c in a similar way as in Fig. 1 show the signal, the derivative signal and the square signal obtained from the derivative Fig. 3a shows schematically two spaced sets of detectors Fig. 3b shows the pulse signal originating from the detector arrangement of Fig. 3a Fig. 4 shclws the wave form of a pulse for showing the effect of the inventive measures in order to restore the DC level and Fig. 5 shows a simple circuit for obtaining the result indicated in Fig. 4In Fig. 1a a sequence of pulses is shown, in which the peak values of the pulses are indicated by straight lines.These peak values are determined by measuring the pulse amplitude at the moment when the derivative dU dt ofFig. 1b goes through zero. This point where the derivative goes through zero is determined more accurately with the wave form dU dt S of Fig. 1c, which was obtained from the derivative of Fig. 1b by amplification up to seturation.The usefullness of this squared wave form dU dt S is more clearly shown in Fig. 2a,where the pulse 10 has two peaks, i.e. a main peak 11 and a secondary peak 12 which might be due to the fact that the bean corresponding to the pulse 10 has a spot on its surface.As can be seen in Fig. 2b the very flat secondary peak results only to a very small positive portion 13 of the derivative signal dU dt. This small positive portion can be completely hidden in the noise which is indicated at 14.If, however, also the negative portion of the square wave form is amplified and used, the position of peak 12 can nevertheless be detected with aid of part 15 of the square wave form, where the signal quickly drops from zero to the maximum negative value.In the embodiment of Fig. 3a two sets of detectors 31 and 32 are shown which are spaced with respect to each other in the direction 33 of movements of the samples. As can be seen in Fig. 3b detectors 31 produce a pulse 41 whereas detectors 32 produce a pulse 42. The time wise difference of these pulses, which is indicated at 43, is a measure for the speed of the sample. This time wise difference 43 can be accurately determined by again determining the point when the respective derivatives of the pulses go through zero.In Fig. 4 a pulse signal is shown in which the DC zero level is shifted to the level indicated by broken line 51 due to the effects of at least one capacitor which normally is present in the signal path. By adding the absolute value of the negative part of the signal to same a signal is obtained, the DC zero voltage level of which is restored to the original one the solid line indicated at 52 . Thus, the pulse height can be determined without the ambiguities of an uncertain DC level. A simple circuit for obtaining this result is shown inFig. 5. The signal enters at terminal 55 and leaves the circuit after passing through a buffer amplifier 56 at terminal 57. Due to the input capacitor 58 of this circuit the DC zero level is shifted as indicated at 51 in Fig. 4. A point 59 of the signal path between capacitor 58 and buffer amplifier 56 is connected to the minus input of an amplifier 60 via a resistor 61. The plus input of amplifier 60 is grounded or connected to a referenceDC voltage. The output of amplifier 60 is connected to the anode of diode 61, the cathode of which is connected to point 59.