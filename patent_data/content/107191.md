# METHOD AND APPARATUS FOR COORDINATION AMONG DISTRIBUTED SUBSYSTEMS

## Claims
Verfahren zum Koordinieren der Ausführung von Funktionen in einem System, das mehrere über ein Übertragungsmedium 30 miteinander verbundene verteilte Untersysteme umfaßt, wobei jedes Untersystem einen Koordinator 11, 12...1n aufweist und das Verfahren folgende Schritte enthält

## Description
This invention relates to a method and apparatus for use in a system including a plurality of distributed subsystems carrying out the same or different functions, the apparatus being connected to the individual subsystems so that the subsystems can execute a series of processing while keeping coordination among them. In a system including a plurality of distributed subsystems, those which should participate in the processing and the order of works to be processed by each individual subsystem have been determined by a central specific subsystem. Such a centralized system has been defective in that operational failure of the central subsystem leads necessarily to shutdown of the whole system. The prior art centralized system has also been defective in that a vast amount of information must be collected or stored in a single unit in order to readily grasp the status of each individual subsystem. The prior art centralized system has further been defective in that a modification of the central subsystem is required to deal with additional provision of a subsystem or subsystems and alteration of the function of the existing subsystem or subsystems, and, for that purpose, the operation of the whole system must be stopped. It is therefore a primary object of the present invention to provide a method and apparatus for coordination among a plurality of distributed subsystems, in which each individual subsystem selects an executable one from among a series of works, associated ones of the subsystems cooperate with each other to select the one deemed to be most suitable for processing depending on the situation, and the order of works to be executed by each individual subsystem is determined upon consideration of the relation between it and the other subsystems. A method and a system by which the present invention attains the above object are set forth in claims 1 and 2, respectively. The present invention will be apparent from the following detailed description taken in conjunction with the accompanying drawings, in which Fig. 1 shows the structure of a preferred embodiment of the system according to the present invention. Referring to Fig. 1, the system includes a plurality of subsystems 1 to n not shown such as machine tools and or robots. A workpiece is conveyed by a carrier running along a guide line extending from a warehouse, which is also a subsystem, to each of these subsystems. The workpiece is received and processed by one of the subsystems, and the processed workpiece is then loaded on the carrier again and conveyed to another subsystem to be further processed. Upon completion of a series of scheduled processing, the workpiece is finally delivered from the system. Suppose that a plurality of workpieces are conveyed to these subsystems, and some of these subsystems carry out the same function. Then, which one of the subsystems 1 to n should process one of the workpieces according to what order becomes a problem. In order to solve this problem, coordinators 11 to 1n are provided according to the present invention. As shown in Fig. 1, these coordinators 11 to 1n are interconnected through associated information transmission controllers 21 to 2n and an information transmission loop 30 for exchange of information therebetween. These coordinators 11 to 1n are also connected to associated subsystem controllers 41 to 4n respectively. Fig. 2 shows the internal structure of a preferred form of the coordinator 11. Referring to Fig. 2, the coordinator 11 includes an interface 52 connected to the information transmission controller 21, an interface 53 connected to the subsystem controller 41, a processor 51, an input output buffer 54, file memories 55 to 58, and three kinds of timers 59 to 61. Figs. 3a to 3g are flow charts of the steps of processing by the processor 51 shown in Fig. 2, and Figs. 4 to 7 illustrate the operation of the coordinator 11 shown in Fig. 2. The operation of the coordinator 11 shown in Fig. 2 will be described in detail with reference to Figs. 3a to 3g and Figs. 4 to 7. The subsystems which are the machine tools and or robots are designated by the reference numerals 1 to 5, and the subsystem which is the warehouse is designated by the reference numeral 6 herein. When now the power sources for the individual subsystems 1 to 6 are turned on, the subsystem controllers 41 to 4n shown in Fig. 1 transmit data indicative of executable functions of the machine tools and or robots of respective subsystems Suppose now that workpieces P₁ and P₂ are conveyed into the production system from the subsystem 6 which is the warehouse. Then, as shown in Fig. 5, the process flow data for processing the workpieces P₁ and P₂ is broadcast on the transmission loop 30 through the information transmission controller 26 shown in Fig. 1. The process flow shown in Fig. 5 indicates the procedure for working. For example, after execution of the function F₁ on the workpiece P₁, the function F₂ or F₃ can be executed, and, after execution of the function F₂ or F₃, the function F₄ can be executed on the workpiece P₁. On the other hand, the functions F₆, F₇ and F₈ can be executed on the workpiece P₂ in a relation entirely independent of execution of the functions F₁, F₂, F₃, F₄ and F₅ on the workpiece P₁. After execution of the functions F₅ and F₈ in the manner above described, the function F₉ is executed on both of the workpieces P₁ and P₂ to complete all the works on the workpieces P₁ and P₂. In the manner above described, the process flow data for processing the workpieces P₁ and P₂ is applied to the coordinator 11 through the information transmission loop 30 and information transmission controller 21 shown in Fig. 1. In the coordinator 11, the received data is stored once in the input output buffer 54 shown in Fig. 2 block 73 in Fig. 3b . The processor 51 decomposes the process flow data stored in the input output buffer 54 into the individual processing functions and adds the processing functions of the processes forward and backward of each individual process thereto thereby making up subflows 201 to 209 as shown in Fig. 6 block 74 in Fig. 3b . When any one or more of the subflows 201 to 209 indicating the flows of the individual processing functions coincide with those registered in the executable function register file 55 in the coordinator 11 block 75 in Fig. 3b , those subflows are stored in the processing procedure store file 56 in Fig. 2 block 76 in Fig. 3b . For example, the processing procedure store files 56 for the subsystems 1 to 5 are as shown in Fig. 7. Each of the processing procedure store files stores the data of a workpiece or workpieces to be processed by the corresponding subsystem, the processing functions of that subsystem the function executed in each of its own processes , and the functions executed in the processes forward and backward thereof. When charging of a new workpiece into the production system or completion of a forward process is broadcast through the information transmission loop 30 block 77 in Fig. 3c , each of the coordinators 11 to 16 searches its processing procedure store file 56 for finding whether or not the assocaited subsystem can process the workpiece and its own functions can be executed block 78 in Fig. 3c . For example, when the coordinator 11 having made the above effort finds that the associated subsystem 1 can execute the function F₁ on the workpiece P₁, the timer 59 is started block 79 in Fig. 3c , and the performance indices J₁ The performance index J₁ Also, the performance index J₁ As a result, the performance indices J₁ Similarly, when each of the remaining coordinators finds that the associated subsystem can execute its function on the workpiece, the individual performance indices are calculated to be broadcast on the information transmission loop 30. Thus, when a new workpiece is charged into the production system or processing in a forward process is completed, the processing request data D After reception of the data informing of charging of the new workpiece or completion of the work in the forward process, the coordinator After a plurality of such processing request data D Suppose that the coordinators 11 and 12 broadcast the processing request data for execution of the same function F₁ on the same workpiece P₁. Then, these data are respectively as follows Suppose that the subsystems 3 and 4 can execute plural functions in parallel relation on the same workpiece P₁. Then, the data broadcast from the coordinators 13 and 14 after completion of the function F₁ on the workpiece P₁ are respectively as follows As in the first case a suitable one of the coordinators 13 and 14 is only selected, and any other different ones are not selected in this second case too. Suppose that the subsystem 5 can now execute the functions F₅ and F₆ on the different workpieces P₁ and P₂ respectively. Then, the coordinator 15 broadcasts the following data after execution of the function F₄ on the workpiece P₁ and after charging of the workpiece P₂ into the production system respectively As in the first and second cases, only one of the workpieces P₁ and P₂ is selected according to the algorithm in this third case too. The coordinator associated with the subsystem determined to execute processing on the workpiece as a result of the steps described above broadcasts execution of the required processing on the workpiece blocks 89 and 90 in Fig. 3d . On the basis of this broadcast, each of the coordinators is informed of the fact that the specific subsystem executes the specific processing on the workpiece, and a flag indicating determination of the participating subsystem is attached to the processing request data stored in the coordination process record file 58 blocks 91 and 92 in Fig. 3d . After the specific subsystem has completed the required processing blocks 101 and 102 in Fig. 3e , the coordinator of that subsystem erases the data of the corresponding contents in the files 56 and 58 and, at the same time, broadcasts completion of the processing block 103 in Fig. 3e . As a result, each of the coordinators erases the specific processing request data recorded in the coordination process record file 58 block 104 in Fig. 3e . The coordinator i On the other hand, when a subsystem i₁ which should participate in processing is determined, the coordinator i As described already in the second and third cases, a workpiece P is determined to be processed later than another as a result of coordination, and a function F is executed on this workpiece P after execution of another function. In such a case, the processing request data requesting execution of the function F on the workpiece are broadcast from the individual coordinators after another function has been executed on this workpiece P . Coordination processes executed thereafter are the same as those described hereinbefore. The timers 61 and 60 are included in the coordinator 11 so as to monitor whether or not the coordinator 11 can communicate with the associated information transmission controller 21 and subsystem controller 41 respectively. The coordinator 11 decides that the communication is impossible when the controllers 21 and 41 do not respond to the transmitted data within predetermined periods of time T₆₁ and T₆₀ respectively. If the coordinator 11 is unable to communicate with these controllers 21 and 41, the files 54, 55, 56 and 58 are cleared. It will be understood from the foregoing detailed description of the present invention that, in a system including a plurality of distributed subsystems carrying out the same or different functions, the subsystems can individually judge the contents of a work and their own status so that a subsystem which should process the work can be readily identified. Therefore, a suitable processing procedure matching the situation can be readily found without the necessity for previously scheduling such a work processing procedure. Thus, the system can operate without being shut down and its reliability, expansibility and maintainability can be improved regardless of operational failure of whichever subsystem at whatever time, maintainance or expansion of any one of the subsystems, and charging of a new workpiece into the production system.