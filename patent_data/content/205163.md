# WATCHDOG TIMER CIRCUIT SUITED FOR USE IN MICROCOMPUTER

## Claims
Zeitüberwachungsschaltung für einen Mikrocomputer mit einem Programmzähler 3 zur Bezeichnung einer Adresse eines Programmspeichers 4 , in der ein auszuführender Befehl gespeichert wird, und einem Befehlsdecoder 5 zum Dekodieren eines Befehls aus dem Programmspeicher 4 , wobei die Zeitschaltung einen Kondensator C1, C2, , einen ersten Transistor Q1 , der mit dem Kondensator gekoppelt ist, um, im leitenden Zustand, den Kondensator zu laden, einem zweiten Transistor Q2 , der mit dem Kondensator gekoppelt ist, um, wenn leitend, den Kondensator zu entladen, und eine Einrichtung 1, 2, 13 21, 22 30 35 aufweist, die mit dem Kondensator gekoppelt ist, zum detektieren einer Spannung relativ zu elektrischen Ladungen, die im Kondensator gespeichert sind, und zum Erzeugen eines Rückstellsignals Rs AS , um den Programmzähler 3 in einen Anfangszustand zu bringen, wenn der Kondensator über eine vorgegebene Zeitspanne hinaus weiterentladen wird,

## Description
The present invention relates to a timer circuit, and more particularly to a watchdog timer circuit suited for use in a microcomputer to detect abnormal program execution such as abnormal termination of the program and infinite loop operation. In an information processing equipment such as a microcomputer, there sometimes occurs a program abnormal termination or an operation within an infinite loop. In order to detect such abnormal program execution, a watchdog time circuit is employed. A prior art watchdog timer circuit is constituted by a counter having a reset funtion and counting a clock signal. This counter is reset cyclically by a program. The reset operation of the counter by the program is carried out within a time when the count value of the counter does not overflow. Accordingly, so long as the program is executed normally, the overflow signal is not obtained from the counter. On the other hand, when the program is abnormally executed, the counter is not reset, so that the counter produces the overflow signal. The overflow signal brings a program counter into an initial condition. The information processing equipment is thereby returned to a normal operation state. However, the counter requires a large number of bits construction even in a microcomputer. For this reason, a semiconductor chip is made large in area and a large power is consumed in a one chip microcomputer equipped with the prior art watchdog timer. A watchdog timer circuit according to the preamble of claim 1 is disclosed in JP A 60 84 644. In this circuit a capacitor is utilized which is charged by a first transistor controlled by a clock signal and is charged by a second transistor controlled by a clear signal. In this construction the first transistor is switched in a cycle determined by the clock signal irrespective of the state of the second transistor. This means that temporary both transistors are in conductive state or the transistors are temporarily in non conductive state. In the first case a DC current flows through the transistors resulting in an increase in power consumption. In the second case the capacitor is brought into a floating state resulting in that electrical charges stored in the capacitor may produce a reset signal erroneously. It is therefore an object of the invention to provide a watchdog timer circuit which has a simple construction and which is suitable for being incorporated into a microcomputer as a single semiconductor chip and which has a reduced power consumption. This object is achieved by a watchdog timer circuit as defined in claim 1 claim 2 is related to a further development of the invention. In a microcomputer, the discharging capacitor is charged periodically by a program before the voltage thereacross reaches the detecting level of the detecting means. Accordingly, when the program is executed normally, the control signal is not generated. On the other hand, if there occurs the abnormal program execution such as the program abnormal termination and the operation in the infinite loop, the capacitor continues discharging without being charged. As a result, the voltage is reduced below a predetermined level and the control signal is generated, so that a program counter is reset into an initial condition, for example. The microcomputer is thereby returned to a normal operation state to execute the program normally. The time constant of the discharging means is selected such that the voltage across the capacitor does not take a value below the predetermined level within the interval between the charging periodes upon the normal operation, so that the generation of the control signal represents the abnormal operation. The above and other objects, advantages and features of the present invention will be more apparent from the following description taken in conjunction with the accompanying drawings, in which Fig. 1 shows a microcomputer equipped with a watchdog timer circuit according to one embodiment of the present invention. A read only memory called hereinafter as an ROM 1 stores a plurality of instructions for controlling an operation sequence according to a program, the addresses thereof being designated in order by a program counter 3. The instructions read out of the ROM 4 are supplied to an instruction decoder 5 through an internal bus 12. The decoder 5 decodes the instructions and supplies the decoded result to a timing generator 6. The generator 6 generates predetermined timing signals to attain the instruction processing. A random access memory called hereinafter as an RAM 8 stores data to be processed or the processed data, and its addresses are supplied by an address decoder 7 in response to a set of address signals supplied via the internal bus 12. An arithmetic logic unit called hereinafter as an ALU 9 performs a logical operation and supplies its result to an accumulator 10. The data in the accumulator 10 is supplied to the RAM 8 or the ALU 9 through the internal bus 12. An input output port 11 is coupled bidirectionally to the internal bus 12, so that the data of an instrument to be controlled not shown is transferred to the internal bus 12 or the data on the internal bus 12 is transferred to the instrument to be controlled. The above described circuit block is same as that of a prior art microcomputer, but the microcomputer shown in Fig. 1 includes a new watchdog timer circuit 100. This timer circuit 100 has a capacitor C₁, P channel and N channel MOS Metal Oxide Semiconductor transistors Q₁ and Q₂, a comparator 1, a reference voltage source 2, and a one shot pulse generator 10. The transistor Q₁ is connected between a node N and a power potential V In Fig. 2, the timing chart representative of the signal IDD, the voltage V On the other hand, if the program abnormal terminal or the operation in the infinite loop occurs, the charging operation of the capacitor C₁ is not carried out as shown by dotted lines in Fig. 2. The capacitor C₁ continues to be discharge, so that the voltage V As described above, by charging the capacitor C₁ periodically this cycle period is not fixed, but changed more or less in accordance with the program as shown in Fig. 2 by a predetermined instruction NOOP or NOP instruction in this embodiment and by detecting the voltage thereacross, the program abnormal termination and the infinite loop operation are detected and the system is returned to a normal condition. Moreover, the number of the circuit elements is decreased more remarkably than the prior art circuit, so that the area occupied on a semiconductor chip is reduced and the power consumption becomes very small. Incidently, the capacitor C₁ requires a relatively large capacitance, and therefore it is connected to one chip microcomputer as an externally provided component. Many microcomputers further include a power on clear function using a capacitor, this function resetting internal circuits into the initial conditions in response to the fact that the voltage across the capacitor is zero just when the power is ON. According to the present invention, the capacitor used for the power on clear function can be also used for the watchdog timer circuit. Such a watchdog timer circuit 200 is shown in Fig. 3 as another embodiment of the present invention. In Fig. 3, the same constituents as those shown in Fig. 1 are denoted by the same references. The microcomputer shown in Fig. 3 includes a power on clear terminal 20, and a capacitor C₂ is connected between the terminal 20 and the ground point. The transistors Q₁ and Q₂ respond to the signal IDD and control the charging and discharging of the capacitor C₂ as also mentioned in Fig. 1. A P channel MOS transistor Q₃ is connected in parallel to the transistor Q₁ and supplied at its gate with a signal CC which is an inverted signal of an output V Upon the power switching on, the voltage V₂₀ across the capacitor C₂ is zero as shown in Fig, 4, and therefore the Schmitt trigger circuit 21 produces the high level output V When the NOOP instruction in the program is executed, the transistor Q₁ is turned ON to charge the capacitor C₂ to the V When the program abnormal termination or the infinite loop operation occurs, the charging to the capacitor C₁ represented by dotted lines in Fig. 4 is not carried out, so that the transistor Q₂ discharges the capacitor C₂ to the level that is smaller than the low threshold voltage V In this embodiment, the capacitor C₂ which is provided previously for the power on clear function is also used for the watchdog time circuit 200. The initial charging of the capacitor C₂ can be carried out by the transistor Q₁ in place of the transistor Q₃, and another circuit may be employed in place of the Schmitt trigger circuit 21 to detect the voltage across the capacitor C₂. Such a watchdog timer circuit 300 is shown in Fig. 5 as still another embodiment of the present invention. It is noted that only the watchdog timer circuit 300 and the all clear circuit 32 are shown in Fig. 5 and other circuit blocks shown in Fig. 3 are omitted. In Fig. 5, the signal IDD is supplied to the gate of the transistor Q₂ and one input terminal of an NAND circuit 37. The output of the NAND circuit 37 is supplied via an inverter 38 to the gate of the transistor Q₁. The terminal 20 is connected via two inverters 30 and 31 to the reset terminals Fig. 6 shows a timing chart of the circuit shown in Fig. 5. Upon the power switching on, the charge in the capacitor C₂ is zero, and therefore the output V When the program abnormal termination or the infinite loop operation occurs, the charging of the capacitor C₂ is stopped, so that the voltage V₂₀ across the capacitor C₂ becomes smaller than the threshold level V Also in this embodiment, the program abnormal termination and the infinite loop operation are detected by using the capacitor for the power on clear function, and the returning to the normal operation from the abnormal conditions is carried out by utilizing the all clear circuit. As described above, the present invention provides a watchdog timer circuit having a simplified circuit construction and a reduced power consumption. Moreover, the design of the time constant in the watchdog timer circuit facilitates the program composition, and the capacitor used for a power on clear function is also used for the watchdog timer circuit.