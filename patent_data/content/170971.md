# METHOD FOR DISTRIBUTING WIRE LOAD IN A MULTILAYER ELECTRICAL CIRCUIT BOARD OR INTERCONNECTION PACKAGE

## Claims
Verfahren zur Herstellung einer mehrlagigen Leiterplatine oder eines Pakets mit Verbindungsleitungen, das eine Vielzahl elektrischer Verbindungen aufweist, deren Anschlüsse innerhalb der Lagen der Platine oder des Pakets verteilt sind, wobei diese Herstellung die Implementierung eines Verfahrens zur Verteilung von Anschlüssen umfaßt und die Stufen aufweist

## Description
The invention relates to a method of assigning electrical connections to the several layers of a multilayer interconnection package to effect a distribution of the electrical connections. More particularly, the invention relates to a method for distributing electrical connections among the layers of a multilayer interconnection package, in such a manner that the number of connections passing through each region of the package is evenly balanced among all the layers, and such that each connection or each net, comprising one or more connections, is assigned to a single layer. In order to facilitate the understanding of the present invention and the prior art the following background information is provided. The electrical connection of individual components on large or very large scale integrated circuits and interconnection packages is achieved using metallic paths between the endpoints or pins which are to be connected. A path between two pins is referred to as a connection. A net is a specified set of one or more connections. Generally, the connections of a net are all electrically in common that is, there is a path joining any two pins of the net, either directly or by means of other pins of the net. The method of the present invention does not, however, require this property of electrical commonality. The present invention is concerned with packages that contain more than one wiring layer and that are designed so that each connection is required to be routed completely within one of the layers. That is, the path for a connection passes from one pin, down to a wiring layer, then to a point beneath the other pin, still within the same wiring layer, then to the other pin. A layer typically, but not necessarily, comprises a pair of wiring planes, often referred to as x and y planes when the predominant direction of wiring within each plane of the layer is disposed along orthogonal x and y axes respectively. In designing a multilayer interconnection package, it is necessary to specify the layer in which each connection is to be routed. The present invention provides a method that assigns each connection to a layer in such a way that wire load in each region number and length of connections passing through the region is evenly balanced among the layers of the package. Region means a portion of the package that comprises all layers, but is limited in areal extent in the x y plane. It may also be necessary or desirable to assign complete nets to layers that is, to assign connections to layers in such a way that, for every net, all connections of the same net are assigned to the same layer. The present invention also provides a method for making such an assignment while providing evenly balanced wire load in each region of the package. There are several reasons why assignment of complete nets to layers may be necessary or desirable. First, certain package technologies require or benefit from this constrained assignment for electrical or fabrication reasons. Second, such assignment can allow the subsequent wire routing to be done independently for each layer, even though the routing process for a connection may depend upon knowledge of the positions or routings of other connections of the same net. For example, the electrical properties of the package may have to be controlled for each net, and the routed lengths of other connections of a net may need to be known before a given connection can be routed. Third, rework or repair of the package can be facilitated if all connections of a net are wired within the same layer. Now with respect to the prior art, several methods exist for assigning connections to layers in a multilayer package. One method is to use a sequential routing procedure. In such a method, one attempts to route a connection in a first layer without violating package design rules. If this fails, one attempts to route the connection in a second layer, etc. until a valid routing is found or the connection fails to be routed. One then proceeds to the next required connection. This can result in an imbalance between the number and total length of connection paths on the several layers, which can lead to a requirement for more wiring layers than would be the case according to the method of the present invention. A second method is to randomly assign each connection to some layer, so that each connection has an equal probability of being assigned to any of the layers. This method results in regional imbalances of wire load among the layers, due to statistical fluctuations. To understand this, suppose that a total of N wires traverse a region, and that there are L layers. The average number of wires traversing the region in each layer is N L, but the actual number of wires in each layer will deviate from N L by a number on the order of the square root of N L , because of statistical fluctuations. The same result applies if we denote by N the number of wires connecting pins that lie in two specified regions. In contrast, as will be seen, the present invention distributes connections among layers in such a way that the number of connections between pins that lie in two specified regions is evenly balanced among the layers, without such statistical fluctuations. Another method for assigning connections to layers is disclosed in European Patent Application, Publication No. 145925. The aspect of that invention that relates to assignment of connections to layers, comprises a method of initially randomly assigning to each connection a layer and an initial approximate wire routing referred to as a global routing , then iteratively removing and rerouting each connection in turn so as to determine a new routing and layer assignment that minimizes certain undesirable routing characteristics at each iterative step. Another wiring method is described by S. Kirkpatrick, C. D. Gelatt, Jr. and M. P. Vecchi, in a paper entitled Optimization by Simulated Annealing, Science, Vol. 220, pages 671 680, May 13, 1983 and in a paper by M. P. Vecchi and S. Kirkpatrick entitled Global Wiring by Simulated Annealing, IEEE Transactions on Computer Aided Design, Vol. CAD 2, No. 4, pages 215 222, October 1983. The method described therein is limited to routing using L and Z wire path shapes. It considers at each step of the routing procedure only one possible alternative wire path for a connection, and evaluates a specific penalty function equal to the sum of the squares of the numbers of wires crossing each edge of the global cell. In contrast to the methods described above, the method of the present invention does not require that a wire routing be performed in order to determine layer assignments. Furthermore, the present invention can be used to assign connections to layers with resulting balanced wire load in each region of the package, even when all connections of each net are required to be assigned to the same layer. European Patent Application publication number 78388 describes a methof of optimizing a required organization of many discrete elements and in the method of that application, elements are initially assigned to locations, then a sequence of possible moves are considered in turn. For each move, a score is computed, and the move is made if the score for that move is negative. If the score is positive, the move is made with probability equal to the exponential of minus the ratio of the score to a number T. The value of T is first increased, then decreased gradually as the process continues. An aspect of the present invention relates to the making of a decision on a probabilistic basis, for the case in which all connections of each net must be assigned to the same layer. While this decision can be made using a random number and a T value that decreases gradually during the process, this is not required. Even when the decision is made in this way, a plurality of possible moves are considered simultaneously, and the decision to make or not to make any of the moves is made on a different basis than in the prior art method. Furthermore, the present invention relates to connection or net assignment, and teaches the use of connection type classes as a means for balancing wire load among layers the prior art method does not relate to these issues. According to the present invention, the wiring load in each region of a multilayer interconnection package is balanced among all layers. Each net or other desired subset of two pin connections is assigned to a single layer. The first of the above mentioned features improves package wire ability, while the second is useful or necessary for a satisfying certain package technology constraints, b improving design efficiency, and c improving electrical performance. To accomplish the balancing of wiring load, the method according to the invention uses connection types. A connection type is defined in such a way that two connections are of the same connection type if, and only if, the pins of one connection are located within the same regions of the package as are the pins of the other connection. The utility of this definition stems from the observation that if the number of connections that join each pair of regions on the package is essentially equally distributed among the layers, then the wire load, i.e. the number of wires passing through each region of the package once the interconnection routing has been completed , will be well balanced among the layers. Defining connection types in this way provides a means for balancing wire load effectively, in advance of any actual approximate or exact wire routing. It is an object of the present invention to provide a balancing of wire load among the layers of the package, by distributing the connections among the various layers so that for every connection type, the disparity in the number of connections of that connection type assigned to any of the layers is zero or one, rather than a number on the order of the square root of the average number of connections of that type. It is another object of the invention to distribute connections among the various layers so that the disparity in the number of connections of the same connection type assigned to any of the layers is minimized subject to the constraint that, for every net, all connections of the net must be assigned to the same layer. The method according to the invention is set out in claim 1. The invention will now be more particularly described by reference to specific examples and to the accompanying drawings, in which In order to better understand the present invention, it is useful to consider how connection types and net types may be defined. Figure 1a shows a four by four global grid defined on an interconnection package. The global grid has 16 cells in it, numbered 1 through 16. At the outset, it should be understood that the global grid with the sixteen uniform cells is used for the purpose of illustration only. It is only necessary to think of the cells as being regions of the interconnection package which contain one or more pins. A first connection AB connects a pin A in cell 5 with a pin B in cell 11. By convention, connections will be defined by referring to the lower number or earlier in sequence letter first. Assuming in this example that the connection types are referred to by cell number, the lower cell number is listed first according to the convention. Thus, connection AB may be referred to as a connection type 5, 11 . For purposes of this invention, it makes no difference whether one goes from pin A to pin B or vice versa. Thus, connection 5, 11 is the same as connection type 11, 5 but both are referred to as connection type 5, 11 . Another connection CD is shown within cell 4. This will be referred to as a connection type 4, 4 . In contrast to the 5, 11 connection type made between two differently numbered cells, this connection is made within a single cell. For a global grid comprising n regions, the number of connection types is equal to 1 2 n n 1 . For the present illustration, n 16, so there are 136 connection types. Means for achieving balanced wire load by distributing connections among the layers such that the connections of each connection type are assigned in equal numbers to the various layers or with a disparity of one, when the number of connections of that connection type is not evenly divisible by the number of layers , will be discussed later in connection with Figure 2. It might be thought that when all connections of the same net are required to be assigned to the same layer, a balancing of wire load among the layers could be achieved by defining for each net a net type, and distributing the nets among the layers. That is, one could consider proceeding by direct analogy with the connection assignment case, replacing connection by net as the basic unit being assigned. This would not generally be satisfactory for the following reason. Consider Figure 1b, in which two different four pin nets A, B, C, D and A , B , C , and D are shown. For the purposes of this discussion, the net type of a net is defined by the global cells containing the pins of the net. Then, the net type of each of these two nets is 3, 5, 11, 13 . With n global cells, there are n n 1 n 2 n 3 24 types of 4 pin nets i.e. 1820 types for n 16 , not counting net types in which two or more pins share the same global cell, and not counting nets with different connection ordering as distinct. Accordingly, any net joining the four cells 3,5,11 and 13 in order would be counted as being of the same type, by this definition. Any further refinement of the net type definition would introduce more distinct types. Consider a large interconnection package with approximately 4000 connections. If all connection types were represented approximately equally, there would be about 4000 136 or 29 connections of each type. In contrast, there are more than 1800 types of 4 pin nets. Even if the entire connection list consisted of 4 pin or three connection nets, there would be a total of 4000 3 or 1333 connections in the package. Since there are more than 1800 connection types, the average number of nets of each net type would be less than one. Accordingly, it would generally be meaningless to think in terms of balancing net types among the several layers for such a case. Therefore, instead of attempting to balance the wire load by defining net types, the problem is regarded as one of balancing connection types among the layers, subject to the constraint that all connections of a net must be assigned to the same layer. Rather than defining connection type in terms of the global cells in which the pins of the connection are located, it may be more convenient to define connection type in terms of other regions, arbitrarily disposed on the package, in which the pins are located. One useful choice is to define the connection type in terms of the components mounted on the package with which the pins of the connection are associated. Table I illustrates the determination of connection type, given a connection list each connection of which is labeled by a NETNAME and by a pair of connection pins. For this illustration, it is assumed that each pin has a letter number designation, the letter specifying the name of the component with which the pin is associated, and the number labeling a particular pin associated with that component. There are three nets comprising six connections in Table I. With reference to the left or input side of Table I, the left column labeled CONNECTION INDEX simply represents a cardinal number associated with the connections in the list. The column labeled CONNECTION PINS simply lists the two pins making up each connection. NETNAME is a designation given to a net. Thus, NET1 is a three connection net from pins A3 to D5, D5 to B1 and B1 to C2. NET2 is a two connection net from pin A6 to pin D2 and from pin A6 to pin B1. Finally, NET3 is a one connection net from pin A1 to pin D2. Referring to the right or calculation side of Table I, it is now possible to analyze the nets to determine how many connection types there are based upon the prefix letters. On connection index line 1, it is seen that the connection extends between components A and D. The first connection type or CONNTYPE then is A, D . On connection index line 2, the connection extends between components D and B. A second CONNTYPE B, D is established. Similar to using the lower number first as was the case with the global cell examples, the convention of using the earlier in sequence letter is used. On connection index line 3, CONNTYPE B, C is established. That constitutes the entire set of CONNTYPES for NET1. Looking now at connection index line 4, which relates to NET2, it is seen that the connection extending between pins A6 and D2 have the same prefixes as the connection pins listed for NET1 on connection line index 1. The fact that the pin numbers are different is of no consequence at this point. As was the case with the global grid construction above for connection types, the concern here is with a more general area, i.e., the area beneath a component on the interconnection package rather than the particular pin within that area. Accordingly, the connection A6, D2 of NET2 has a CONNTYPE A, D . Moving on to connection index line 5, the second connection of NET2 extends from pin A6 to pin B1. This is a CONNTYPE A, B . Lastly, NET3 shown on connection index line 6 is a single connection net extending from pin A1 to pin D2 making a CONNTYPE A, D . Figure 2 is a flow diagram which illustrates how the method according to the present invention maximizes balancing among the layers of an interconnection package. To start, it is necessary to read or input the information shown in the left side of Table I. This is depicted in block 5. Next, block 10 depicts the calculation of the CONNTYPE shown on the right side of Table I. The first inquiry, stated in block 15, asks whether the connections of the same net are constrained to lie in the same layer. Taking the simpler case first, i.e., where there is no layer constraint for the nets, the several different CONNTYPES are dealt randomly among all layers. This step is set forth in block 20. Referring to Table I again, all CONNTYPES A, D would be dealt out first. Assuming that there are three layers in the interconnection package, one CONNTYPE A, D connection would be assigned to each layer. Similarly, all CONNTYPES are considered in turn. Since there is only one each of CONNTYPES A, B , B, C , and B, D , each in turn would simply be assigned randomly to some layer. Considering each CONNTYPE, it is seen that CONNTYPE A, D is perfectly balanced among all three layers, whereas the other CONNTYPES have an imbalance of 1. In other words, the number of connections of CONNTYPE A, B is one for one of the layers and zero for the other layers. The same rationale applies to CONNTYPES B, C and B, D . Another example wherein the balancing of five connections of a given CONNTYPE are divided among three layers now will be considered. The connections would be balanced such that two layers are dealt two connections each and their remaining layer will be dealt only one connection. Again, the maximum imbalance between the layers is 1. The first two layers are in perfect balance with respect to each other and the remaining layer has one connection less than either of the first two layers. As a variation of the step set forth in block 20, the assignment of the connections of each CONNTYPE for which the number of connections is not exactly divisible by the number of layers, can be made in such a way that the total number of connections of all CONNTYPES is the same for all layers, or differs by at most one for the various layers. This is an alternative to dealing the excess connection s of each CONNTYPE to layers at random. When the entire list has been passed through, the layer assignments are written. These asssignments will typically be utilized as input to a wire routing process, which may be used to generate art work or control a wiring machine. Upon completion of the steps shown in block 25, the process according to this aspect of the invention is completed. Turning to the more complex case where the inquiry in block 15 results in an affirmative response, the case in which nets are constrained to lie wholly within the same layer is considered. The problem is solved by balancing connection types in a manner discussed hereinafter. In block 60, each net is initially randomly assigned to one of N layers of the interconnection package. The following table illustrates a possible initial random assignment of the nets in three layers. The column labeled NET INDEX is similar to the connection index and is simply the row number of the table used for reference purposes. The column labeled NETNAME refers to the particular net under consideration each of which is here labeled NET followed by a number. Finally, the column labeled LAYER simply identifies the layer to which each net has been assigned. In the example shown, NET1 has been assigned to layer 3 while NET2 and NET3 have been assigned to layer 1. No nets have been assigned to layer 2. In block 80, a quantitative measure or SCORE is associated with the assignment of the nets to the several layers. SCORE is a measure of the degree of imbalance of a particular assignment and can be compared to other SCORES. The lower the SCORE value, the more balanced the interconnection package is. With reference to Figure 3 where the CALCSCORE subroutine is illustrated, SCORE is calculated in the following manner. For each CONNTYPE and for each layer from 1 through the last layer, NLAYER, where NLAYER represents the total number of layers, the population of that CONNTYPE in a layer is represented as POP CONNTYPE, LAYER . The population of each CONNTYPE in each layer is counted in block 82. Then an average population of the CONNTYPE per layer, POPAVG CONNTYPE , is determined by summing the population of each CONNTYPE in all layers and dividing the number of the total number of layers i.e., NLAYER. This may be expressed mathematically as This step is shown in block 84. Finally, in block 86 the SCORE is calculated by summing the square of the quantity equal to the difference between the population of each CONNTYPE in each layer and the average population of that CONNTYPE for all layers. The sum is taken over all CONNTYPES and all layers. This is expressed mathematically as With reference to Table I and Table II, the contribution of CONNTYPE A,D to the score will be calculated for purposes of illustration It can readily be seen that if the connections had been distributed evenly among the three layers the SCORE would be equal to zero, indicating perfect balancing of the connections of that CONNTYPE. When the subroutine depicted in block 80 is done, the next step, shown in block 100, is to reassign nets from the present layer to any other layers to which they may be permissibly assigned. For reasons specific to a particular design, assigning certain nets to one or more of the other layers may sometimes not be permissible. In cases where some nets are not permitted to be moved, they should be omitted from the NET loop in Figures 4a and 4b. When a net is not permitted to be moved to a particular NEWLAYER, the WEIGHT for that net and that NEWLAYER should be set equal to zero at block 108. Otherwise, the flow diagrams apply without change. Figures 4a and 4b show the details of the REASSIGN subroutine. In block 102, the user specifies some real number for the value T. Practice has shown that is useful to start with a value for T which is at least several times larger than the largest value encountered for DELTA, as will be discussed hereinbelow. By running through the REASSIGN subroutine several times the value of T may be decreased with each loop. If one starts with a value for T that is too low or if one starts high and decreases it too rapidly with each loop, an undesirably large SCORE i.e., large measure of imbalance may result. In block 104 the value of NET is simply set equal to 1 so that on subsequent passes through the loop all movable nets will be considered. In block 106, the DELTA value is calculated as will be described hereinbelow in detail in connection with Figure 5. The DELTA value is a measure of whether reassigning a net to another layer results in a more balanced interconnection package. The expression for DELTA is so chosen that DELTA plus the value of SCORE prior to a reassignment of a net to a new layer, equals the value of SCORE following such reassignment. This is expressed mathematically as The value of DELTA for keeping the net in the same layer, i.e., not reassigning it, is 0. In the embodiment described here, the lower the algebraic value of DELTA is i.e., the less positive or more negative it is , the greater will be the probability of moving the net to the new layer corresponding to that value of DELTA. The net is not simply assigned to the new layer having the most negative value of DELTA at every step, since by so doing it is found to lead to a final assignment that can be far from optimal. Thus, there may be several alternative layer reassignments for a given net and it is necessary to make a decision between the alternative layers. As mentioned above there exists some probability associated with each alternative reassignment that the net will be moved to a given alternative layer. In block 108, a probablility factor or weight is calculated for each DELTA value. The weight is mathematically expressed as follows In other words, the weight represents a number associated with the probability of reassigning a net from one layer, LAYERNET, to a different layer, NEWLAYER, which is an exponential function based on the values of a calculated DELTA and a user specified value of T. In block 110, a random real number, R, is chosen lying between zero and the sum of the weights over all values of NEWLAYER. In block 112, the value of NEWLAYER is set equal to 1 at the start of the loop so that all potential reassignments of the net to other layers are considered. Also, the value of SUM is set equal to 0. Intervals are established as follows, the length of each interval being equal to the value of WEIGHT for each NEWLAYER 1 through NLAYER. In block 114, the sum of the previous sum value and the weight is added. If R is not less than or equal to the sum as determined in block 116, the next step is to add 1 to the value of NEWLAYER as shown in block 118. Then, it is necessary to loop back to block 114 to recalculate the sum for the next layer to which the net may be reassigned. Eventually, the value of the sum will be equal to or greater than R. The net is reassigned to the current value within the loop of NEWLAYER, and a change of SCORE is calculated in block 120 to determine the SCORE for the net in its reassigned layer. NEWLAYER may of course happen to equal LAYER NET . In that case, no layer reassignment occurs. The value of LAYER NET will be set equal to NEWLAYER in block 122 and the NET index will be increased by 1 in block 124. In block 126, it is determined if NET is greater than the number of nets, i.e., NNET. If so, then all the nets have been considered. If NET is not greater than NNET then it is necessary to look at the next net and consider the layers, to which it may be reassigned. With reference to Figure 5, the derivation of the DELTA value now will be discussed. The subroutine of Figure 5 is called once for each net and each value of NEWLAYER. The value of DELTA is set to zero in block 202. At block 204 it is determined whether the new layer, NEWLAYER, to which the net is to be assigned is the same as the layer it presently is in, i.e., LAYER NET . If it is, then the DELTA value remains unchanged and is equal to zero. If, however, the NEWLAYER value does not equal LAYER NET , it will be necessary to begin a loop to recalculate DELTA by setting the value of K to 1 which is done in block 206. K indexes the rows of a table that is maintained for each net, and is illustrated in Table III for the case of NET1, a net defined in Table I. The contribution to the value of DELTA resulting from the Kth entry of this table is calculated in block 208. The contribution is MULTIPLICITY refers to the number of connections of a given CONNTYPE in a given net. Referring to Table I, the MULTIPLICITY of the connections in NET1 is depicted in the following table The K is simply an index value for convenience of reference to the values in the table. It is seen that the MULTIPLICITY for all CONDTYPES in NET1 is one. In principle, one can have multiple connections of the same CONNTYPE for a given net. MULTIPLICITY simply takes account of that possibility. The firs entry into block 208 calculates the contribution of the K 1 row of the MULTIPLICITY table to the value of DELTA. The K value is increased by one at block 210. If all K values have been considered, K LAST and the subroutine is complete. If not, block 208 is re entered and the contribution of the next row indexed by K is added to DELTA. The calculation of DELTA is illustrated for the case in which moves of NET1, from the layer 3 to which it was originally assigned, are being evaluated. If NEWLAYER equals 3, it is known that DELTA is equal to zero. Now, DELTA is calculated for moving NET1 from layer 3, LAYER NET , to NEWLAYER, for the case in which NEWLAYER 2. The top three lines of the right hand expression are the contributions from the three passes through block 208, for K 1, 2, and 3 respectively. This result can be compared to that for moving NET1 from layer 3 to NEWLAYER 1. The difference in DELTA between the two layer assignments can be understood with reference to Table I and Table II. NET1 consists of connections of CONNTYPES A,D , B,D , and B,C . Moving NET1 from layer 3 to layer 2 does not affect the SCORE, since all connections of those CONNTYPES that were formerly in layer 3 are simply shifted to layer 2. However, moving NET1 from layer 3 to layer 1 does increase the SCORE, since an additional connection of CONNTYPE A,D is thereby placed in layer 1, which already has two such connections. The change in SCORE is equal to DELTA, which 4. It is understood that the loop shown in Figures 4a and 4b should be performed a number of times to optimize the SCORE. T should be selected such that it is initially at least three or four times the largest value of DELTA. On successive passes through this loop, T should be reduced, e.g., to 80 or 90 of its value on the preceding pass, and layer reassignment performed for each net. After T has been reduced substantially, and the SCORE appears to be converging to a low number, a final pass may be performed in which T is set equal to an essentially zero value e.g., 0.001 . This may drive down the value of SCORE even more. The value of MAXIMBALANCE provides a direct indication of how imbalanced is the layer assignment of the most imbalanced CONNTYPE. MAXIMBALANCE is defined mathematically as The method according to the invention examines each CONNTYPE, in sequence. For each CONNTYPE that is examined, it determines the population of that CONNTYPE in each layer. IMBALANCE is defined as the number of connections of that CONNTYPE in the layer containing the largest number of such connections minus the number of connections of that CONNTYPE in the layer containing the smallest number of such connections. MAXIMBALANCE is the maximum value of IMBALANCE taken over all CONNTYPES. If MAXIMBALANCE is 0 or 1, the layer assignment is as balanced as is possible for the given net list. Further reassignment cannot possibly reduce a MAXIMBALANCE of 1 to zero. Referring to Figure 2, after the REASSIGN loop is completed, the SCORE and any other diagnostics such as MAXIMBALANCE are written as shown in block 140. At that point, the user either manually or by coded instruction must determine if the SCORE and or MAXIMBALANCE values are satisfactory. This is illustrated in block 160. If these values are not satisfactory, it will be necessary to return to block 80 and begin to perform another reassignment pass perhaps with a different value for T, as mentioned above. If the SCORE and or MAXIMBALANCE values are satisfactory, then the layer assignments are written for all nets is shown in block 180. This data typically may be utilized for subsequent wire routing, which will yield detailed path information used to gene rate artwork or to control physical wiring equipment. The Appendix hereto presents a programming implementation of the method of Figure 2. This implementation is written in FORTRAN for use with an IBM 370 computer. Implementation of the method of Figure 2 in the program presented in the Appendix will be readily apparent to one having ordinary skill in the art, and is therefore not described further.