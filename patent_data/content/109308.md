# Block counter system to monitor data transfer.

## Abstract
A system is disclosed which is usable to monitor data being transferred in terms of blocks 512 bytes or 256 words wherein the data being transferred is temporarily stored in a RAM buffer memory. Thus, data blocks being transferred from a main host computer to a peripheral terminal unit as a magnet ic tape unit via a Tape Control Unit TCU can be monitored to indicate, at certain intervals, the balance of data residing in the buffer memory during moments between cycles where data has been shifted into and or shifted out of the buffer memory.

## Claims
1. A system for monitoring the status of data in transit between a peripheral unit and a main host system, said system comprising a memory means for temporary data storage, said memory means connected to receive data from and to transmit data to, both said main host system and said peripheral unit b counter means for maintaining a current status signal which indicates the amount of data residing in temporary storage in said memory means c logic circuit means for providing signal data to said counter means, said circuit means indicating the number of data blocks received by said memory means and the number of data blocks transmitted from said memory means. 2. The system of claim 1 wherein said logic circuit means provides said signal data during two conditions of data transfer operations, said conditions including 2a read operations wherein data is transferred from a peripheral unit to said memory means for subsequent transfer to said main host computer system 2b write operations wherein data is transferred from said main host system to said memory means for subsequent transfer to said peripheral unit. 3. The system of claim 1 wherein said logic circuit means includes 3a address register means for receiving address data to be used in accessing locations in said memory means and for providing numerical data signals to a block counter logic unit wherein said numerical data signals indicate the amount of data transferred into, and the amount of data transferred out of, said memory means 3b a block counter logic unit connected to receive said numerical data signals from said address register means and to provide first and second logic output signals to a gating means 3c gating means for permitting output signals to said counter means, said output signals operating to shift up or shift down the count in said counter means at selected clock times. 4. The system of claim 3 wherein said address register means includes 4a peripheral address register means connected to receive address data when data is transferred either from the said memory means to said peripheral unit or when data is transferred from said peripheral unit to said memory means 4b system address register means connected to receive address data when data is transferred either from said memory means to said main host system, or from said main host system to said memory means. 5. The system of claim 3 wherein said logic circuit means includes 5a means for signalling said block counter logic unit to indicate the condition of a Read operation from the said peripheral unit or a Write operation from the said main host computer to the said peripheral unit. 6. The system of claim 3 wherein said gating means includes 6a input connection means from the output of said block counter logic unit to carry logic information indicating an upcount or down count or no change for each Read operation or for each Write operation 6b microcode input signals for diagnostic and control operations for said counter means 6c first and second output signals, connected to said counter means, for causing said counter means to shift up or to shift down. 7. A system for monitoring the status of data in transit between a peripheral unit and a main host system, wherein a peripheral controller is initiated by instructions from said main host system to manage data transfer operations, and said peripheral controller includes a common control circuit unit for sequencing microcode instructions and a peripheral dependent circuit unit for interfacing said peripheral unit, the status monitoring system comprising 7a buffer memory means for temporarily storing data in transit between said main host system and said peripheral unit 7b counter means for carrying a current status signal which indicates the number of blocks of data residing in said buffer memory means during any given clock cycle 7c logic circuit means for raising or lowering the said status signal in said counter means according to address data signals which insert or remove data into or out of said buffer memory means 8. The status monitoring system of claim 7 which includes 8a address data signals, from said common control circuit unit, and connected for transmittal to said logic circuit means, for logical operations which determine the amount of data removed from or inserted into said buffer memory means. 9. The system of claim 8 which includes 9a output flip flop means receiving signals from said counter means, said flip flop means providing output information signals to said common control circuit unit upon the occurrence of specified numerical conditions occurring in said counter means. 10. The system of claim 9 wherein said output flip flop means provides an output information signal when lOa the count in said counter means is equal to X indicating that the said buffer memory means is full, where X represents the number of data blocks filling the maximum data capacity of said buffer memory means. 11. The system of claim 9 wherein said output flip flop means provides an output information signal when lla the count in said counter means is equal to O denoting that the said buffer memory means is empty.

## Description
BLOCK COUNTER SYSTEM TO MONITOR DATA TRANSFERSFIELD OF THE INVENTION This invention is related to systems where data transfers are effectuated between a peripheral terminal unit and a main host computer wherein an intermediate I O subsystem is used to perform the housekeeping duties of the data transfer.BACKGROUND OF THE INVENTION A continuing area of developing technology involves the transfer of data between a main host computer system and one or more peripheral terminal units. To this end, there has been developed I O subsystems which are used to relieve the monitoring and housekeeping problems of the main host computer and to assume the burden of controlling a peripheral terminal unit and to monitor control of data transfer operations which occur between the peripheral terminal unit and the main host computer system. A particular embodiment of such an I O subsystem has been developed which uses peripheral controllers known as data link processors whereby initiating commands from the main host computer are forwarded to a peripheral controller which manages the data transfer operations with one or more peripheral units. In these systems the main host computer also provides a data link word which identifies each task that has been initiated for the peripheral controller. After the completion of a task, the peripheral controller will notify the main host system with a result descriptor word as to the completion, incompletion or problem involved in the particular task. These typessof peripheral controllers have been described in a number of patents issued to the assignee of the present disclosure and these patents are included herein by reference as follows U.S. Patent 4,106,092 issued August 8, 1978, entitled Interface System Providing Interfaces to Central ProcessingUnit and Modular Processor Controllers for an Input OutputSubsystem , inventor D.A. Millers, II. U.S. Patent 4,074,352 issued February 14, 1978, entitled Modular Block Unit for Input Output Subsystem , inventors D.J. Cook and D.A. Millers, II. U.S. Patent 4,162,520 issued July 24, 1979, entitled Intelligent Input Output Interface Control Unit forInput Output Subsystem , inventors D.J. Cook andD.A. Millers, II. U.S. Patent 4,189,769 issued February 19, 1980, entitled Input Output Subsystem For Digital Data ProcessingSystem , inventors D.J. Cook and D.A. Millers, II. U.S. Patent 4,280,193 issued July 21, 1981, entitled Data Link Processor for Magnetic Tape Data Transfer System , inventors K.W. Baun and J.G. Saunders. U.S. Patent 4,313,162 issued January 26, 1982, entitled I O Subsystem Using Data Link Processors inventors K.W. Baun and D.A. Millers, II. U.S. Patent 4,322,792 issued March 30, 1982, entitled Common Front End Control for a Peripheral ControllerConnected to a Computer , inventor K.W. Baun. The above patents, which are included herein by reference, provide a background understanding of the use of the type of peripheral controllers known as data link processors , DLP, used in a data transfer network between a main host computer and peripheral terminal unit. In the above mentioned Baun patent, there was described a peripheral controller which was built of modular components consisting of a common front end control circuit which was of a universal nature for all types of peripheral controllers and which was connected with a peripheral dependent board circuit. The peripheral dependent circuit was particularized to handle the idiosyncrasies of specific peripheral terminal units. The present disclosure likewise uses a peripheral controller data link processor which follows the general pattern of the above described system, in that the peripheral controller uses a common control circuit or common front end which works in coordination with a peripheral dependent circuit which is particularly suited to handle a specific type of peripheral terminal unit, such as a TapeControl Unit TCU which connects to one or more magnetic tape units.SUMMARY OF THE INVENTION The present invention involves a data transfer network wherein a peripheral controller known as a data link processor is used to manage and control data transfer operations between a peripheral such as a magnetic tape unit or a tape control unit and the main host computer system, whereby data is transferred rapidly in large blocks, such as a block of 256 words. The data link processor provides a RAM buffer memory means for temporary storage of data being transferred between peripheral and host system. In this case, the RAM buffer is capable of holding at least six blocks or units of data, each of which consists of 256 words, each word being of 16 bits. In order to facilitate and control those activities in which a data is sometimes being shifted into the RAM buffer memory means from either the peripheral unit or from the main host computer and b the data in the RAM buffer memory is being shifted out either to the magnetic tape unit peripherals, for example, or to the main host computer, it is necessary that the peripheral controller and the system have data which informs it of the condition of the RAM buffer memory means with regard to the amount of data residing therein at any given period of time. Thus, the present disclosure describes a block counter monitoring system which will inform the peripheral controller and the main host system of the numerical block status of data in the RAM buffer memory means. In particular, the present invention discloses a system whereby the common front end common control circuit uses routines providing microcode instructions to address registers which access locations in the RAM buffer memory for the insertion of data or the withdrawal of data. There are two address registers, one for addresses of data taken from to the peripheral unit and one for addresses of data which are to be forwarded from to the main host computer. A block counter logic circuit receives input from the peripheral address register and the system address register.In addition, a flip flop output to the block counter logic circuit indicates the direction of data flow as being a Write host to peripheral or a Read peripheral to Host . The block counter logic circuit provides two output logic signals which control a block counter. This enables the block counter to be shifted up or shifted down so that the internal signal data indicates the number of blocks of data residing in the RAM buffer memory.Certain parameters may be set to trigger signal output conditions when the amount of data in the RAM buffer memory falls below a certain figure.BRIEF DESCRIPTION OF THE DRAWINGS FIG. 1 illustrates the block counter system of the present disclosure which is used to inform the data transfer system of the status of a buffer memory means. FIG. 2 is a system diagram showing the host computer cooperating with a peripheral controller in order to control data transfer to and from a peripheral unit. FIG. 3 is a drawing showing an eight bit shift register which can be shifted up or down according to conditions which occur between certain logic signals and clock signals. FIG. 4 is a diagram showing how the block counter logic unit of FIG. 1 is organized to operate during Read orWrite operations and the effect of either shifting up or shifting down the shift register. FIG. 5A is a schematic drawing illustrating the significance of each bit position in the block counter. FIG. 5B is a chart indicating various shift relationships of the block counter with regard to Read and Write operations. A Read operation takes data from a peripheral magnetic tape unit and temporarily stores it in a RAM memory buffer for later transfer to the host system. A Write operation takes data from the main host system for temporary storage in the RAM buffer memory for subsequent transfer to a selected magnetic tape unit via aTCU or Tape Control Unit.DESCRIPTION OF PREFERRED EMBODIMENTS Referring to FIG. 2, the overall system diagram is shown whereby a host computer 10 is connected through an I O subsystem to a peripheral unit, here for illustrative purposes shown as a tape control unit 50tC. As per previous descriptions in the above cited patents which were included by reference, the I O subsystem may consist of a base module which supports one or more peripheral controllers, in addition to other connection and distribution circuitry such as the distribution control circuit 20old and the data link interface 20i.The peripheral controller 20t is shown in modular form as being composed of a common front end circuit 10c and a peripheral dependent circuit shown, in this case, as being composed of two peripheral dependent boards designated 80pl and 80p2. In this network situation, it is often desired that data from the main host computer be transferred on to a peripheral unit, such as a magnetic tape unit, for recording on tape. This would be done by a peripheral tape control unit TCU such as 50to. Likewise, at times it is desired that data from the magnetic tape unit be passed through the tape control unit to be read out by the host computer. Thus, data is transferred in a bidirectional sense, that is, in two directions at various times in the activities of the network. The key monitoring and control unit is the data link processor 20t which when initiated by specific commands of the host computer will arrange for the transfer of the desired data in the desired direction. As seen in FIG. 1, the RAM buffer 22 is used for temporary storage of data being transferred between peripherals and the main host computer. In the preferred embodiment this RAM buffer has the capability of storing at least six blocks of data, each block of which consists of 256 words. Again referring to FIG. 1, a block counter logic unit 33c is used to receive input from two address registers designated as the peripheral address register, Pat and the system address register, Sa. The peripheral address register, Pat handles addresses required when data is retrieved from the peripheral tape unit or when data is being sent to the peripheral tape unit. The system address register, sa, is used when data is being received from the host system into the buffer 22 when data is being sent to the host system from the buffer 22. These two address registers in FIG. 1 are seen to receive their address data via microcode signals from the common front end circuit 10c ofFIG. 1. The address data outputs from Pa and Sa are fed to theRAM buffer 22 in order to address the desired location in the buffer memory. Further, the block counter logic unit 33c receives one input designated P Carry from the peripheral address register and another input S Carry from the system address register, in addition to a Read Write control signal from read write flip flop 33f.The flip flop 33f is controlled by microcode signals from the peripheral controller common front end unit 10C. The block counter logic unit 33c provides a first logic signal LS1 and a second logic signal LSo which are fed to OR gates G1 and Go. These gates also have additional inputs from the microcode of the common front end card 10C which inputs can be used to simulate the LS1 and LSo signals for diagnostic or other control purposes.The OR gates provide two output signals designated S1 and SO which are fed to the block counter 34c As will be seen in FIG. 3, the output signalsS1 and So are combined at certain times on occurrence of rising clock signals in order to provide conditions which will make the block counter either shift up or shift down or no shift . Referring to FIG. 3, there is seen a schematic drawing which illustrates the use of the block counter 34c of FIG. 1. Referring to FIG. 3, there is seen, schematically, an eight bit shift register which will be affected at selected points in time where the clock signal is in its rising state as illustrated by the arrows shown in FIG. 3.Referring to the leftmost schematic of the shift register, it will be seen that there are two ones which illustrate that the RAM buffer 22 has been loaded with two full blocks of data. At time T1 it will be seen that conditions are such that no shift has occurred and the two ones remain in the shift register. At time T2 there is a shift up and the shift register now has three bits with the 1 signal. At time T3 there is a shift down signal and the shift register is back where two bit positions include a 1 . At time T4 there is a shift up and the shift register now has three bit positions manifesting the 1 signal, which indicates three full blocks of data residing in buffer 22 at that moment. Referring to FIG. 4, there is seen a chart whereby the block counter logic unit 33c is organized to show overall operating conditions. Thus, as seen in the FIG. 4 chart, the conditions of the S Carry and P Carry during the Read condition show that there is a no shift or no change when SCarry and P Carry are the same, that is to say they are both 0 or they are both 1. However, when S Carry is 0 and the P Carry is equal to 1 , then there is an up shift, while if the S Carry is 1 and the P Carry is 0 , there is a down shift during Read operations. Referring to FIG. 4, it is seen that during Write operations, again when the S Carry and the P Carry are equal both 0 or both 1 to each other, then there is no change or shift in the shift register. However, when the S Carry equals 0 and the P Carry equals 1 there is a down shift in this situation, and when the S Carry is equal to 1 and the P Carry is equal to 0 there is an up shift. The block counter 34c will reflect the situation that when data is being taken out of the magnetic tape unit in order to be fed to RAM buffer 22 Read operation , the block counter will shift up unless at the same time there is data being removed from buffer 22 for transfer to the main host computer system in which case the block counter will shift down. Thus, the condition of the block counter s numerical status will indicate the balance between what data has gone out of and what data has come into the buffer 22. Referring to FIG. 4, if there is a Write operation, this determines that data is to be written into the magnetic tape unit. Then, as data is removed from the RAM buffer over to the magnetic tape unit, the block counter will shift down but if more data is transferred from the main host computer into the RAM buffer 22, the block counter will be shifted up.Thus, again the placement of ones in various bit positions provides a running balance of the data blocks taken out as against the data blocks taken in at any given period. Referring to FIG. 4 there are certain logic equations which indicate the logic used in the block counter logic unit 33c In the following logic equations it should be indicated that the asterisk refers to AND logic operation while the plus sign refers to OR logic operation. a If signal counter S1 equals 1 and signal S0 equals 0 , there occurs what may be called a condition of Up enable which is equal to Read S Carry P Carry Write S Carry P Carry . b Under the conditions where the signal S1 equals 0 and the signal S0 equals 1 , this could be considered as a Down enable wh ich is equal to Read S Carry P Carry Carry Write S Carry P Carry . c In the condition where the signal S1 equals 0 and the signal So equals 0 , there is the condition called no change . This is equal to Read S Carry P Carry Write S Carry P Carry . d The condition known as the host access error ,He, causes the setting of a flip flop 34eft FIG. 1. This is also called a block counter error . Thus, the host access error signal or block counter error signal is a result of He Read 6 BLKFUL Write 1 BLKFUL . Thus, on a Read operation, a full RAM buffer six blocks of data will signal an error condition. Likewise, on a Write operation, a single one remaining block of data will trigger an error condition. Referring to FIG. 5A, a schematic drawing of the block counter 34c is shown to indicate that when a 1 resides in a series of bit positions, it is an indication of how many blocks of data reside in the RAM buffer 22 FIG. 1 . For example, if a 1 resides in each of bit positions 1, 2, 3, 4, this indicates that 4 blocks of data reside inRAM 22. Each block consists of 256 words 512 bytes of eight bits each . In FIG. 5B the chart illustrates that during Read operations a As the P Carry increases data being transferred from peripheral tape to buffer memory 22 , the block counter 34c will shift up indicating the buffer is being loaded . b As the S Carry increases data from buffer memory being transferred to main host system , the block counter 34c will shift down indicating the buffer memory is being emptied . In FIG. 5B the chart illustrates that during Write operations c As S Carry increases data being loaded in buffer memory from main host system , the block counter 34c will shift up to indicate the number of blocks of data in the buffer. d As P Carry increases data in buffer being unloaded for transfer to peripheral tape unit , the block counter 34c will shift down and show how much data is left remaining in buffer 22. In FIG. 5B, during Read operations, when a 1 appears in the 6th bit position of block counter 34cx then a flip flop circuit 34e FIG. 1 is set and provides a signal to the common front end circuit 10C which will inform the main system of an access error condition. This signifies that the buffer memory 22 was overfilled in that the main host system did not accept data quickly enough. During Write operations, when the buffer memory 22 has received six blocks of data from the host system, and the 1st bit position 1 BLKFUL becomes 0 , this indicates that the buffer memory has been completely unloaded cleared and then the flip flop 34e is set to signal the common front end circuit 10C that more data is required from the host. This indicates the host did not supply data quickly enough to theRAM buffer 22. There has been thus described a system by which it is possible to monitor blocks of data being transferred between peripheral units and a main host computer when there are simultaneous flows of data being put into or taken out of aRAM buffer means. While the disclosure herein illustrates one embodiment of the described system, the described system is not to be deemed limited to but rather to embrace those systems as defined in the following claims.