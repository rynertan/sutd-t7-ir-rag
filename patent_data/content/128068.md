# Charge balance voltage to frequency converter utilizing CMOS circuitry.

## Abstract
A charge balance voltage to frequency converter utilizes CMOS circuitry to provide a digital pulse ouptut proportional to an analog input signal. The converter approaches a desired charge balance by cycling between a charging and discharg ing state. A clock signal provided by a stable oscillator 118 is applied to a clock input of a CMOS D type flip flop 116 . The analog input signal Vin effectively is fed to a non inverting input 103 of an integrating amplifier 104 . The output 114 of the integrating amplifier 104 is fed to the D input of the flip flop 116 , which input has a threshold level. The Q output of the flip flop 116 is connected via a voltage divider 119 to an inverting input 112 of the integrating amplifier 104 . This configuration eliminates the need for a dual polarity power supply. When the output 114 of the integrating amplifier 104 rises above the threshold level of the D input, on the next rising edge of the clock signal, the flip flop 116 sends feed back pulses to the inverting input 112 , thus beginning the discharge state. Each feedback pulse causes the integrating amplifier 104 to discharge a predetermined amount. When the output of the integrating amplifier 104 falls below the D input threshold level, feedback pulses are inhibited, and the charging state begins again. The output pulses from the flip flop 116 when accumulated over a period of time, represent the charge required to balance the charge provided by the input signas Vin . The feedback pulses are summed by an accumulator 130 to provide an indication of the converter input.

## Claims
CLAIMS 1. A converter, characterized by a integrator means, having a first input for receiving an input signal and a second input for receiving a freedback signal having a high state and a low state, for producing a first output signal as a function of the integral of the difference between the input signal and the feedback signal b reference oscillator means for generating a clock signal having a high state and a low state c CMOS flip flop means having an input responsive to said first output signal and having a clock input responsive to said clock signal for producing said feedback signal and d logic means, having a first input responsive to said clock signal and a second input responsive to said feedback signal, for producing an output pulse ecch time said clock signal and said feedback signal are in the same high state. 2. The converter of claim l characterized in that said CMOS flip flop means, also produces an Inverted feedback signal and in that said second input of said logic means is responsive to said inverted feedback signal. 3. The converter of claim 1 or 2 characterized in that said integrator means comprises a operational amplifier means having a first input for receiving said input signal, and a second input for receiving said feedback signal, and an output for producing said first output signal and b a capacitor connected between said output and said second input of said operational anplifier means and responsive to said first output signal and said feedback signal whereby the amount of charge present on said capacitor is continuously balanced. 4. The converter of claim l, 2 or 3 characterized in that said reference oscillator means comprises a crystal oscillator. 5. The converter of any one of claims 1 4 characterized in that said CMOS flip flop means comprises a D type flip flop having zl input means responsive to said first output signal for producing a second output signal in a low state when said first output signal exceeds a threshold level. 6. The converter of claim 5 characterized in that said CPIICXS flip flop means further includes electronic switch means for providing said feedback signal in said high state when said second output signal is in said low state and said clock signal is changing state. 7. The converter of claim l characterized in that said logic means comprises AND gate means having a first input responsive to said clock signal, a second input responsive to said feedback signal, and an output for producing said output pulse. 8. The converter of claim 7 characterized in that said logic means further comprises inverter means having an input responsive to said clock signal and an output connected to said first input of said AND gate for inverting said clock signal. 9. The converter of claim 2 characterized in that said logic means comprises OR gate means having a first input responsive to said clock signal, a second input responsive to said inverted feedback signal, and an output for producing said output pulse. 10. The converter of any previous claim characterized by accumulator means for accumulating a preselected proportion of the output pulses produced by said logic means, whereby the number of such output pulses so accumulated is indicative of a parameter of said input signal.

## Description
BALANCE VOLTAGE TO FREQUENCY CONVERTER UTILIZING CMOS CIRCUTTRYBackground of the Invention 1. Field of the Invention The present invention relates generally to voltage to fre guency converters. Mxre particularly, the present invention is directed towards a novel charge balance voltage to frequency converter utilizing CMOS circuitry to provide a digital pulse output proportional to an analog voltage input signal.2. Description of Related Art Voltage to frequency converters are well known. Broadly, a voltage to frequency converter produces an output frequency proportional to the level of an input signal. voltage to frequency converters have been implemented using a variety of technologies, including transistor to transistor logic TTL and complementary metal oxide structure CMOS . Charge balancing in such converters is desirable because the integrating capacitor 5 tolerance does not affect the accuracy of the conversion. One example of a conventional voltage to frequency converter is the integrating section of a device produced ty ScientificColumbus, of Columbus, Chio, designated SC 60 Watt WattbourStandard, which produces an output pulse train whose frequency is proportional to the power level of an input signal. The voltage level and the current level of the input signal are modulated to produce a signal whose pulse width and pulse amplitude are varied in proportion to the average power level of the input signal.This modulated signal is applied to the input of an integrator.Also applied to this input is a gated negative current source signal whose duration is controlled by the output signal from a quartz crystal referenced monostable multivibrator. The gated signal from tire current source is added to the modulated signal at the input of the integrator. The output from the integrator is applied to a first input of a comparator whose second input is connected to a voltage reference source. This circuit requires the use of a dual polarity power supply.The output of the comparator, which is a high repetition rate pulse train whose rate is accurately proportional to the power level of the input signal, is provided to the input of a divider and to the input of the quartz crystal referenced monostable multivibrator. The divider provides driving pulses at a desired rate to isolated open collector output stages. Another conventional voltage to frequency converter is a device designated 8700 CMOS A D Converter, produced by TeledyneCorporation, of Hawthorne, California. This monolithic integrated circuit chip parforms A D conversion utilizing CMOS circuitry to provide a charge belancing of the output of an integrating amplifier. The input signal to the circuit is fed to the inverting terminal of an integrating amplifier. The output of the integrating amplifier is compared by a comparator to a threshold voltage generated by zn internal clock and control logic.The output of the comperator, in combination with an internal clock, generated by the internal clock and control logic, controls a switch used to gate a reference voltage, VREF Which is applied b the innerting input of the integrating amplifier to provide the charge balancing of the amplifier output. The application of the reference voltage to the inserting input necessitates the use of a aual polarity power supply.The output of the internal clock and control logic is applied to data counters, whose output is supplied, via a bus, to output latches. These stages accumulate the number of VREF pulses rewired to charge balance the output of the integrating amplifier over a predetermined time interval. While the Teledyne circuit is superior in some respects to the charge balancing techniques previously discussed, it has its own deficiencies. Pbr example, it requires separate comparator, switch, internal clock and control logic, data counter and output lath stages. Its output is limited b 2 binary word based on a given conversion period. Therefore, the output of the circuit is only applicable to a limited number of applications Where the conversion period of the circuit corresponds to the sample period desired. It also requires a dual polarity power supply.Additionally, since the clock controlling the feedback pulses and the data acquisition are internal, the conversion period cannot be varied to Optionally suit a given application.Summary of the Invention The present invention is a charge balance voltage to frequency converter Which utilizes CMOS circuitry to provide a digital pulse output proportional to an analog input signal. Broadly, the present invention provides an output pulse train whose frequency is proportional to the level of an input signal V. The VIN N signal is fed to the non inverting input of an integrating amplifier comprising an operational amplifier with a capacitor connected between its output and its inverting input.The output of the integrating amplifier is fed to the input of aCMOS flip flop, such as a D type flip flop. The input of the flipflcp labeled convention as the D input has a threshold value which when exceeded causes the flip flop to produce a logic bign output on the rising edge of the next clock pulse received at its clock input. The flip flop receives the clock signal at its clock input frcm a stable oscillator. When the integrating amplifier output rises above the threshold level of the flip flop input, the flip flop produces a pulse at its output labeled by convention as the Q output on the next rising edge of the clock signal. This pulse is fed back to the inverting terminal of the integrating amplifier, and acts to charge balances the amplifier output. Only a single polarity power supply is required since the feedback pulses are applied to the inverting input of the integrating amplifier. In a first embodiment, the signal at the Q output of the flip flcp is combined with the clock signal in a CMOS AND gate to produce an output pulse train indicative of the charge necessary to balance the input signal. In a second embodiment, the signal at the output of the flip flop is wined with the clock signal in a CMOS QR gate to produce the output pulse train indicative of the charge necessary to balance the first signal. The CMOS flip flop of the present invention performs four functions it acts as a comparator of the output signal fraa the integrating amplifier it acts as a switch in prrviding feedback pulses to the inverting input of the integrating amplifier it provides a flip flop function, in that it produces an output signal of the same state as the signal present at its input on the rising edge of the next clock pulse and it serves as an A D converter by producing a digital pulse output from an analog voltage input.Certain of these functions are described below in greater detail Specifically, the D input stage of the CMOS flip flop eliminates the requirement for a separate comparator in the circuit of tire present invention. The D input stage of the flip flop comprises a pair of P devices neted across the supply voltage and ground. The i T devices function as a very consistent ccoarator because their winge in conductive state always cccurs at the exact same voltage level over the lifetime of the e devices.When the level of the signal present at the D input crosses the particular threshold of the FET devices in the cS flip flop device, the output of the FET devices change state. As discussed above, the threshold level of the input stage of a givenCMOS flip flop is quite precise and is accurately repeatable.Hence, the CMOS input stage of the CMOS flip flop functions as an excellent comparator. Additionally, the Q output stage of the CMOS flip flop advantageously eliminates the need for a separate switch in the charge balance circuit of the present invention. The voltage level at the Q output of the CMOS flip flop is determined by the state of the r devices of the D input stage of the flip flop.Since the output stage of the CMOS device ,is connected directly between the source voltage and grcund, there is very little voltage drcp between, the flip flop Q output and the source voltage when the flip flop Q output is high or between the flip flop output and ground when the flip flop Q output is low . Hence, the Q output voltage level of the flip flop Q is essentially equal to the source voltage when the flip flop Q output is high , and is essentially equal to the ground when the flip flop Q output is low . The use of CMOS circuitry in the present invention also advantageously requires only 2 single polarity power supply and can function with a supply voltage which may vary over a broad range. The lack of criticality in the supply voltage level is due to the ability of CMOS to operate effectively over a broad voltage supply range. This is to be contrasted to TTL circuitry, which requires a supply voltage in a very narrow range for effective operation. Furthermore, CMOS circuitry consumes much less power than Tit circuitry to perform a given function. The output of the present invention is a pulse train which may be utilized in a broad range of applications with a variety of data acquisition circuits.Brief Descrirtion of the Drawing Figures These and other features and advantages of the present invention will be readily understood from the following description of the present invention, when considerea in connection with the accompanying drawings, wherein Figure 1 is a schematic diagram of an embodiment of the voltage to freauency circuit of the present invention Figure 2 is a schematic diagram of the pcwr supply circuit for the present invention Figure 3 is a simplified representation of the input and output stages of the CMOS D type flip flop employed in the present invention Figures 4A 4E are timing diagrams for the embodiment of the voltage to frequency converter of the present invention shown inFigure 1 Figure S is a schematic diagram of an alternative edbodisent of the present invention and Figures 6A 6E are timing diagrams for the alternative embodiment of the present invention shown in Figure 5.Detailed Description of the Preferred Embodiment With reference to Figure 1, an input signal VIN is plied at input 102 to the circuit of the present invention, designated generally by the reference number 100. Input signal VIN is coupled to the non inverting input 103 of an amplifier 104 through a low pass filter 105, which comprises a resistor 106 and a capacitor 108. Low pass filter 105 eliminates AC ripple on the input signal v so that amplifier 104 sees only the slowlyvarying DC ca ceent of input signal yg low pass filter 105 can be eliminated if there is no significant Ac ripple. Amplifier 104 is configured as an integrator. Specifically, it has a capacitor 110 connected in a feedback path between its inverting input 112 and its output 114. Amplifier 104 is preferably a lsw offset amplifier, such as a chopper stabilized amplifier Part No. ICL7650, produced by the Intersil Cbrporation of Cupertino, California. Note, however, that any suitable lowoffset amplifier may be employed in the present invention. The output of amplifier 104 is connected to the D input of aCMOS D type flip flop 116. A D type flip flop is characterized by duplicating at its 0 output an input signal which is present at its D input upon the application of either the e rising or falling edge of a clock signal depending on the flip flop design at the clock input of the flip flop. Flip flop 116 may consist of, for example, a CD4013 D type flip flop produced by RCA Corporation ofSomerville, N.J. It should be understood that any suitable type of CMOS flip flop could be used to implement the D type flip flop function. Fbr example, a CMOS JK type flip flop could be used with h the K input inverted and the 3 and inverted K leads tied together. Flip flop 116 receives timing signals at its clock input from a stable oscillator 118. Bor correct operation of the present invention, stable oscillator 118 must produce an accurately timed clock signal. Preferrably, stable oscillator 118 is crystal controlled in the preferred embodiment of the invention, a commercial watch crystal is employed in stable oscillator 116 and has a frequency of 32.768 KHz. Referring now to Figure 3, CMOS flip flop 116 is shown in a very simplified fo as having an input stage 302 and an output stage 304. Input stage 3G2 comprises a pair of FET transistors 306 and 308 connected across supply voltage VDD and groundVSS. Note that VREF is applied as VDD as the supply voltage in the embodiment shown in Figure 1.Input stage 302 includes an input 310 and an output 312. when the level of the signal present at input 310 crosses the threshold level , VTH of FET transistors 306 and 308, transistors 306, 308 change their respective states of conductivity. his results in a change of voltage level at output 312. The threshold level of the particular FET devices 306, 308 in a given CMOS D type flip flop is very precise. For this reason,CMOS input stage 302 functions as an excellent comparator. In contrast, TTL circuitry is unsatisfactory in this regard, since the threshold level present at a TIG input tends to vary over a relatively broad range each time the device changes state. Output stage 304 of flip flop 116 comprises a pair of electronic switches connected directly between source voltage VDD and ground VSS. Output stage 304 includes an input 314 and an output 316. The voltage level at output 316 may be either high or low , and is determined by the state of output 312 of input stage 302 and the rising edge of the clock pulse rot shown in Figure 3 . Since output stage 304 is connected directly between source voltage VDD and ground VSS, the voltage level at output 316 is either essentially VSS when output 316 is high or VDD when output 316 is low . Thus, CMOS output stage 304 functions as an excellent switch.In contrast, the output voltage of TTL circuitry is generally varies over a relatively broad range each time the device changes state. Flip flop 116 of the present invention acts as an converter, since it converts zn analog input. signal to a digital output sigrnl. It also acts as a generator of specific amounts of feedback charge to integrating amplifier 104. Thus, D type flip flop 116 must have a precise voltage threshold level at its D input, and an accurate output voltage level at its 0 output. P r these reasons, the application of a TTL D type flip flop in the circuit of the present invention would not provide proper operation of the circuit.Conversely, the application of a CMOS D type flip flop in the circuit of the present invention provides all the necessary functions discussed above it also eliminates the need for a separate comparator and a switch. The 0 output of flip flop 116 is used to provide feedback pulses to charge balance the output of integrating amplifier 104. The Q output of flip flop 116 is cc nected to to the inverting input 112 of integrating amplifier 104 through a voltage divider 119 comprised of resistors 120 and 122. Resistcr 122 is variable and may be used to adjust the charge balance point of the circuit in order to set the maximum input to correspond to full scale output. In the first preferred embodiment of the present invention, the 0 output of flip flop 116 is also coupled to one input of a CMCS AND gate 124. AND gate 124 comprises a CMCS AND gate, such as a model CD4081 AND gate, produced by RCA Corporation ofSomerville, N.J. The other input of AND gate 124 is coupled to stable oscillator 118 through an inverter 126. The output of AND gate 124 is coupled to a divide by N counter 128 which, in turn, is connected to an accumulator 130. Accumulator 130 may comprise, for example, a microprocessor. Amplifier 104, flip flop 116, and AND gate 124 are advantageously all powered by a single source voltage VREF.Source voltage VREF is produced, for example, by the circuit shown in Figure 2. A positive voltage V is applied to one side of a current limiting resistor 202. The other side of resistor 202 is coupled to a voltage regulator 204. In the preferred embodiment, regulator 204 consists of an IM326 5 voltage regulator manufactured by National Semiconductor of Santa Clara, California.However, any suitable voltage regulator 204 could be employed in the present invention. A capacitor 206 is applied across regulator 204 to stabilize the regulator and to filter noise from the power supply VREF. Referring to Figure 4, the signal applied ed to the non inverting input 103 of operational amplifier 104 causes capacitor 110 b charge and raises the level of output 114 above VTH as stated previously, VTH is the threshold voltage at Which the comparator at the D input of flip flop 116 will change state . The charging of capacitor 110 is shown in the initial segment designated A in the timing diagram of Figure 4B. In response, as shcwn in. Figure 4C at falling edge B , output 312 of input stage 3C2 at the D input of flip flop 116 gces low. Upon receiving the rising eoge G Figure 4A of the next clock pulse at its clock input, flip flop 116 produces a logic high ce its output see Figure 43, rising edge C . The high signal at the Q output of flip flop 116 is now transferred as a feelback signal through voltage divider 119 to the inverting terminal 112 of amplifier 104. Referring again to Figure AS, at the segment desigrated by D , thiS feedback signal or pulse causes capacitor 110 to discharge a predetermined amount. Flip flop 116 can only change states at the leading edge of each clock pulse from stable oscillator 118.The Q output of flip flop 116 remains high for an integral number of clock cycles one or more , causing a charge balancing of capacitor 110 in known increments. The clocking of flip flop 116 by stable oscillator 118 assures that the feedback pulses coupled frcm stable oscillator 118 to amplifier 104 are precise in width. As a result, each feedback pulse balances out a precise amount of charge input to non inverting input 103 of amplifier 104. In other words, each feedback pulse represents a precise amount of charge required to belance a corresponding amount of charge at input terminal 102. When a sufficient number of pulses have been received by amplifier 104 at its non inverting input 103 to drive output 114 below VTH output 312 of input stage 302 at the D input of CMOS flip flop 116 changes state to a logic high see Figure 4Ct rising edge E . Upon receiving rising edge H Figure 4A of the next clock pulse at its D input, flip flop 116 the delivers a logic low signal on its Q output see Figure 4D, falling edge F , thus terminating feedback pulses to amplifier 104. Thereafter, the signal put V on terminal 102 applied to the non inverting terminal 103 of amplifier 104 will charge the amPlifier output to a point above the threshold voltage VTH and the cycle will continue.This cycling of charging and discharging causes output 114 of amplifier 104 to oscillate slightly above and below V. As mentioned previously, the amount of feedback pulses applied to inverting input 103 of amplifier 104 required to maintain output 114 of amplifier 104 at this relatively constant level is indicative of the voltage applied at non inverting input 103, since the feedback pulses exactly balance the input at this quiescent point. In the first preferred embodiment, AND gate 124 is used for producing an output pulse train in which the pulses appear at a rate proportional to the input voltage. AND gate 124 combines signals fran stable oscillator 118 and the c output of flip flop 116 to produce this pulse train. As shown in Figure 4E, whenever the flip flop 0 output is high and the stable oscillator 118 is lcw, AND gate 124 produces a logic high. Hence, in operation, AND gate 124 will produce pulses at its output whenever flip flop 116 is providing feedback pulses. As a result, the output of AND gate 124 will be pulse a train which has a rate proportional to the signal at input terminal 102 of circuit 100 of the circuit. In the example illustrated in Figure 4E, two output pulses are produced for every three clock pulses Fig. 4A , indicating thet input VIN is two thirds of full scale as set by resistor 122 . In the first preferred embodiment, inverter 126 prevents an anomolous pulse from appearing at the output of AND gate 124 on the edge of the clock pulse which clocks flip flop 116. Flip flop 116 is clocked on the leading edge of the clock pulse from oscillator 118, whereas AND gate 124 is satisfied if at all following the trailing edge of the clock pulse. It is apparent that AND gate 124 could be replaced by an OR gate 125 with one input directly connected to stable oscillator 118 and another input connected to the Q output of flip flop 116. Figure 5 is a schematic diagram of such an alternative embodiment.Figures 6k 6E are timing diagrams for the embodiment of Figure 5. Divide by N counter 128 is connected to the output of AND gate 124 in the first embodiment, and to the output of OR gate 125 in the second embodiment, in order to reduce the pulse rate to the desired data rate. The resultant lower frequency pulse train is then passed to an accumulator 130, which processes the pulses. While the present invention has been described in considerable detail, it is understood that numerous modifications and variations fall within the scope of the appended clains.