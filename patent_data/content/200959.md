# STEPPING MOTOR CONTROL SYSTEM

## Abstract
It takes a comparatively long time T

## Claims
1. In a positioning mechanism using a stepping motor 100 as a drive source, a stepping motor control system comprising means 10 for determining that the phase excitation step of said stepping motor has reached a phase excitation step preceding the phase excitation step at a target stop position by a predetermined number of steps and control means 20 for transferring the excitation state from one phase excitation step n 1 to another phase excitation step n by successively decreasing said one phase excitation current and successively increasing said another phase excitation current, said control means being activated upon arrival of the phase excitation step of said stepping motor at a phase excitation step preceding the phase excitation step at the target step position by a predetermined number of steps.

## Description
The present invention relates to drive position ing using a stepping motor and in particular to a stepping motor control system having reduced positioning and stopping time. In head positioning the drive of a small sized disk unit, for example, stepping motors have been widely used. An example of the conventional stepping motor control system for head positioning and driving used in such a disk unit will now be described. In Fig. 1, a controller 1 supplies a rotation direction signal When the signal As a result, the pulse motor 4 is rotated in a predetermined direction by as many steps as supplied from the controller 1. Thus the head of the disk unit is driven to be positioned at a predetermined position. The head drive and positioning operation at this case is referred to as seek . Fig. 2 shows the above described pulse rate pattern. In the starting acceleration region, the pulse rate is so raised that the acceleration may be constant from a low velocity up to a predetermined velocity to prevent the stepping motor 4 from getting out of step. Subsequently, the pulse motor 4 stays in the fixed velocity region until the total number of seak steps minus the number of steps required for deceleration is reached. In the fixed velocity region, the pulse rate is held at a predetermined constant value to seek the head at the uniform velocity. In the deceleration region, the pulse rate is lowered at a predetermined rate to seek the head with the uniform deceleration. And the head is stopped at the target position to be positioned. Increase or decrease in the number of seek steps, i.e., increase or decrease in the distance the head moves is dealt with by changing the number of steps included in the fixed velocity region so as not to change the curves of acceleration and deceleration. When the number of seek steps has become smaller than the sum of the number of steps included in the acceleration region and the number of step included in the deceleration region, however, the acceleration region is immediately succeeded by the deceleration region as represented by broken lines 1 to 4 in Fig. 3. That is to say, control is effected by the so called triangular seek. Therefore, the control procedure of the micro computer 2 at this time is represented by Fig. 4. In the deceleration region, the rotation angle of the stepping motor 4 changes as shown in Fig. 6. As well known, the stepping motor is configured to successively rotate while taking discrete stationary stabilized angles each time the phase excitation is changed over, i.e., for each step. In the prior art, therefore, the step commands are so supplied as to form stairs as represented by A of Fig. 5. The rotation of the stepping motor follows it as represented by B of Fig. 5. In this control system of the prior art, therefore, the rotation angle of the stepping motor becomes oscillatory as represented by a period C of the rotation angle characteristics B after the stepping motor 4 reaches the target rotation angle position and the stepping operation is stopped, i.e., the phase excitation state is fixed. It thus takes long time for the motor to converge to the target angle position and stop, the so called settling time being elongated. In disk units or the like, the settling time at the completion of the head seek is desired to be short as far as possible. In a widely used method heretofore, therefore, a mechanical damper is added to the drive section. However, the use of the mechanical damper results in large sized units. Therefore, it is desirable to remove the mechanical damper to attain the small sized system. If the mechanical damper is removed, however, the settling becomes very long, resulting in long access time. Therefore, a small sized disk unit using a stepp ing motor of the prior art has a problem that it is difficult to shorten the access time. Such a disk unit is disclosed in Japanese Patent Unexamined Publication No. 122270 80, for example. An object of the present invention is to shorten the so called settling time measured from time when the rotor of the stepping motor begins to move at an arbitrary angular position to the time when the rotor stops at the next target angular position. Another object of the present invention is to realize shortened settling time by control means to avoid the large size of the unit attendant upon the use of mechanical means. In accordance with the present invention, there fore, rotation of the rotor of the stepping motor beyond the target angular position and the succeeding vibration of the rotor around the target angular position are lightened. To be concrete, the amount or angle of rotation of the rotor beyond the target angular position is reduced. In accordance with the present invention, therefore, fixed control means is taken before the rotation of the rotor gets beyond the target angular position. In a preferred embodiment of the present invention, the transition of phase excitation for each winding of the stepping motor, i.e., the transition from one phase excitation to the next step phase excitation is gradually carried out. In another embodiment of the present invention, the voltage applied to each winding of the stepping motor is changed over to a lower needed value with needed timing. A stepping motor control system according to the present invention will now be described in detail by referring to illustrated embodiments. In an embodiment of the present invention which will now be described, the hardware configuration is the same as that of Fig. 1 of the prior art excepting that a part of changeover control between steps of phase excitation for the stepping motor 4 is effected alternately and repeatedly by using the PWM Pulse Width Modulation system as illustrated in Fig. 6 when the motor 4 has entered the deceleration region. In this embodiment, therefore, the control procedure of the microcomputer 2 is modified as shown in Fig. 7. Processing steps 10 and 20 of Fig. 7 are the modified added part for this embodiment. At processing step 10, it is judged whether the stepping motor 4 has reached a step preceding the target rotation angle position by a predetermined number of step, say, 3 steps. At the next step 20, alternate changeover of phase excita tion using the so called PWM is conducted. When the stepping motor 4 must be transferred from a particular step, say, step n 1 to the next step or step n, the excitation state at phase m 1 corresponding to step n 1 is not changed over directly to the excitation state at phase m corresponding to the next step n. Instead, changeover between the excitation at phase m 1 and the excitation at phase m is conducted during the pulse rate alternately and repeatedly with a period 10τ sufficiently shorter than the pulse rate as shown in Fig. 8. At this time, the ratio of excitation duration of phase m to that of phase m 1 is successively increased. Finally, transfer of the excitation state from phase m 1 to phase m is completed when the pulse rate duration has elapsed. Any method may be used for judgment at processing step 10. In an example, the number of steps of the stepping motor 4 is counted, and it is judged whether the counted value has reached the number of steps up to the target value minus a predetermined value 3, for example or not. In this embodiment, therefore, the stepping motor 4 is driven as illustrated in Fig. 2. When the state preceding the target value by 3 steps is reached, the answer at processing step 10 of Fig. 7 becomes YES and the processing step 20 is carried out. As represented by A of Fig. 6, therefore, the phase excita tion state between steps takes the form of PWM as illustrated in Fig. 8 during the period D. On the basis of the time constant of the circuit including the coil of the stepping motor 4, the average value of excita tion current at phase n 1 successively decreases as represented by broken lines E of Fig. 8. On the contrary, the average value of excitation current at phase n is successively increased with the same rate as the above described decrease. When the pulse rate period is over, the excitation state of phase n is assumed. In this embodiment, therefore, the rotation of the rotor of the stepping motor 4 between steps becomes sufficiently smooth when the rotation angle approaches the target value. When the target value is reached, the stepping motor 4 can be stopped in an extremely short period C causing little vibration. In case the embodiment is applied to the head seek of a disk unit, it is possible to sufficiently shorten the access time. In the above described embodiment, the period D of Fig. 3 is composed of the last three steps of the deceleration region. So far as the last step at the stop side of the deceleration region is included, the period D may be composed of an arbitrary number of steps. It is a matter of course that the period D may be composed of all steps in the deceleration region, for example. In this embodiment described heretofore, it is possible to sufficiently suppress the vibration of the stepping motor caused when the motor is stopped and positioned, by using only electrical control to the stepping motor. It is thus possible to eliminate the drawbacks of the prior art and sufficiently shorten the settling time without using a mechanical damper. As a result, a small sized disk unit having sufficiently high performance is realized. Further, this embodiment needs mainly software arrangements and need little change in hardware, resulting in cost saving. Further, this embodiment can be applied not only to the above described disk unit but also to any unit using a stepping motor controlled by a microcomputer. Since only the software modification is needed, this embodiment can also be applied to a system in operation easily, resulting in high universality. Another embodiment shown in Figs. 9 to 18 will now be described. In this embodiment as well, a stepping motor 100 is used for positioning the read write head in a small sized magnetic disk unit. By controlling the rotation angle of the motor 100, the head is positioned on a predetermined track of the disk through a capstan, a steel belt and a carriage which are not illustrated in Fig. 9. The motor 100 is two phase bipolar type, for example, and has a pair of windings ₁ and ₂. Numeral 300 denotes a control section of the disk unit. The control section 300 has a microprocessor unit and program memory means for operating a driver 200. The program is shown in Figs. 14 and 15. Truth tables relating to Fig. 9 are shown in Figs. 10 and 11. Under the state of phase excitation A wherein both signal lines S₁ and S₂ are H High , feeders P₁, P₂, P₃ and P₄ respectively assume H , L , H and L levels as shown in the truth table. When the feeder p₁ is H and feeder P₂ is L , the polarity of the input voltage to the winding ₁ becomes as P₁ P₂. That is to say, the feeder P₁ becomes the positive pole and the feeder P₂ becomes the negative pole. The magnitude of the input voltage is either 12 V or 5V, for example. The changeover of the voltage level is effected by a signal line S₃. When the signal line S₃ is H , the voltage level becomes 12 V. When the signal line S₃ is L , the voltage level becomes 5 V. If the phase excitation of the windings ₁ and ₂ proceeds in the order of A, B, C and D, the motor 100 rotates in the regular direction. If the phase excitation proceeds in the order of D, C, B and A, the motor 100 rotates in the reverse direction. Fig. 12 shows an example of internal configuration of the driver 200. A portion of the driver 200 correspond ing to the winding ₁ is illustrated in Fig. 12, and a portion corresponding to the winding ₂ is omitted. In the circuit of Fig. 12, switching transistors such as Q₁ the and Q₂, NOT gates, and AND gates are used. Fig. 13 shows a truth table relating to Fig. 12. When a signal line G By referring to flow charts of Figs. 14 and 15 as well as Figs. 16 and 17, the control system will now be described. The program for the control system is previously stored in the control section of Fig. 9. Figs. 14 and 15 show a series of processing steps conducted from the time when the next target rotation angle for the stepping motor 100 is specified until the time when the positioning at the rotation angle is completed and the input of the next target rotation angle is waited. The command of the next target rotation angle is waited at step 1011 of Fig. 14. The contents of this command are the rotation direction and the number of steps. At step 1002, the slewing curve as illustrated in Fig. 16 is derived. This curve is a kind of speed pattern for acceleration and deceleration control. The curve is divided into the acceleration region t₁ to t₂ , fixed velocity region t₂ to t₃ , and deceleration region t₃ to t₄ . The pattern used in the acceleration region t₁ to t₂ has been predetermined to rapidly accelerate the stepping motor so far as the motor is prevented from being out of step out of synchronism . This pattern is stored in an acceleration data table. The maximum velocity in the fixed velocity region t₂ to t₃ is also predetermin ed. The pattern of the deceleration region t₃ to t₄ is also predetermined and its data are stored in a decelera tion data table. The timing at the end of the deceleration region t₃ to t₄ of Fig. 16 is so determined that the number of steps corresponding thereto may coincide with that specified by the rotation command. If the number of steps is small, the fixed velocity region t₂ to t₃ becomes short or zero. If the number of steps is further small, a higher velocity area in the deceleration region t₃ to t₄ and the acceleration region t₁ to t₂ is elminated. On the way of acceleration, therefore, deceleration is started. At step 1003, the output of the signal line S₃ is changed to L Low . As a result, the input voltage of the motor 100 is held at a high value 12 V. At step 1004, one step is taken. This aims at changing the phase excitation shown in Figs. 10 and 11 from C to B , for example. To be concrete, the signal lines S₁S₂ are changed from L L to H L . As a result, the rotation phase of the stepping motor 100 advances by the unit step. At step 1005, a necessary delay is taken. This delay is a time interval between one step and the next step supplied from the acceleration data table. Since the unit step angle is constant, the delay becomes the recipro cal of the speed. Fig. 17 is rewritten from Fig. 16. The ordinate of Fig. 17 represents the rotation angle. The intersection resulting from dividing the rotation angle by the unit step angle width indicates the timing of each step command processing in step 1004 . Fig. 17 also shows states L and H of the feeder P₁ relating to the winding ₁ and the feeder P₃ relating to the winding ₃. At step 1006, it is judged whether the accelera tion has been completed. That is to say, it is checked whether the time t₂ or the corresponding number of steps is over or not. If the acceleration region is still effective, step 1003 is resumed. Otherwise step 1007 is taken. At step 1007, the signal line S₃ is made L . That is to say, the input voltage is made 12 V, and one step is taken at step 1008. The delay in step 1009 is constant. At step 1010, it is judged whether the timing t₃ of the deceleration region is reached or not. This judgment is conducted by comparing the number of remaining steps the number of projected steps with the number of deceleration steps reference value . Unless the decelera tion region t₃ to t₄ is not reached, processing is repeated from step 1007. If the deceleration region is reached, processing is advanced to step 1011 of Fig. 15. At step 1011 as well, the input voltage is set to 12 V. At step 1201, another step is taken. At step 1202, a necessary delay is taken. And processing is advanced to step 1203. Processing flow from step 1203 on will now be described by referring to Fig. 18. Fig. 18 is an enlarged view of a portion K shown in Fig. 18. The actual rotation phase of the stepping motor 100 is shown as a waveform 10. States of the signal line S₃ is also shown. At step 1203, it is judged whether the target value command value is reached or not by checking whether the timing t₄ previously computed at step 1002 or the number of steps corresponding thereto is reached or not. Since the feedback control is not conducted here, this is a problem on the computation level. Unless the target value is not reached, it is judged at step 1204 whether predetermined timing t₅ has been reached or not. In any case, step 1201 is resumed thereafter. If the timing t₅ is reached, however, the signal line S₃ is changed over to H before step 1201 is resumed. As a result, the input voltage to the motor 100 is set to the lower value of 5 V. The timing t₅ is defined by taking the timing t₄ computed to step 1002 as reference and previously holding the value of t₄ t₅ as a constant. This constant Δt ranges from zero to 2Δt . As illustrated in Fig. 17, 2Δt is the length of 2 steps in the fixed velocity region. After the target value has been reached, the input voltage is changed to 5 V at step 2001. By consider ing this together with step 1205, it is understood that the signal line S₃ turns H to change the input voltage to 5 V when the target position or the timing t₅ is reached. A delay of t₆ t₄ seconds is taken at step 2002 and the signal line S₃ is changed to L to select 12 V at step 3001. And a delay of t₇ t₆ seconds is taken at step 3002, and the signal line S₃ is changed to H to select 5V. Thus the processing is completed. By the processing from step 2002 on, the input voltage is changed from 12 V to 5 V at time t₅, changed to 12 V at time t₆, and changed to 5 V at time t₇ as shown in Fig. 18. In this way, 12 V is maintained until the time t₅. This 12 V is the higher value and the rated value of the stepping motor 100. In order to arrive at the target value quickly, 12 V is maintained until the time t₅. In order to shorten the settling time or T The waveform 10 of Fig. 18 is oscillatory and a settling time T In case the input voltage is not changed over as represented by the waveform 10 , it takes a comparatively long time T The time t₅ when the input voltage is lowered is so preset as to shorten the settling time T The aforementioned offset means a difference from the target value command value . This is to say, the rotation phase is settled on a value displaced from the target value. Since this offset is caused in case of an insufficient torque, the input voltage is changed over to 12 V again in the period of t₆ to t₇ as described before. It is desirable to define the changeover time t₆ so that the latter 50 to 20 of the period of the settling time t If the changeover time t₆ is too early, the effect of reducing the settling time is weakened. If the changeover time t₆ is too late, the stepping motor is not settled on the target value, causing an offset. As described above, the input voltage is main tained at a high value in a first process included in a series of processes. The first process means a process until the vicinity of the command value commanded rotation angle is approached. The first process corresponds to the processing in steps 1003 and 1011 of Figs. 14 and 15. In a second process wherein the rotation phase is close to the commanded value, the input voltage is maintained at a low value. The second process corresponds to process ing in steps 2001 and 2002. The processing in steps 1201 to 1205 is overlapped with the first and second processes. In the above described embodiments, a stepping motor of two phase bipolar type is used and the input voltage is changed over from 12 V to 5 V. However, this is only an example. Different forms may be used.