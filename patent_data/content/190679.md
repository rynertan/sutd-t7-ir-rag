# Centralized image responsive telephone time slot interchange system

## Claims
Verfahren zum Ermitteln und Berichten des Auftretenseines zuf√§lligen Ereignisses in Peripherieeinheiten, diemit jeweiligen Ports verbunden sind, die durch einZeitmultiplex Abtastschema adressiert werden,

## Description
This invention relates to time division multiplexed communication systems. Time division multiplexed TDM telephone systems typically have a Central Processing Unit CPU controlling the TDM connections between port peripherals. This is accomplished typically by directlyaddressing an addressed or receiving peripheral in response to a transmitting or Source peripheral androuting the TDM pulse code modulation PCM words between the connected peripherals. That type ofconnection is on a random addressing basis and with the timing controlled by the immediate needs of theperipherals. A TDM telephone system of thus type is disclosed in GB A 2 022 366. The disadvantage of that arrangement is the distributed processing required to control the addressingand the decoding and the status within each peripheral unit. Additionally, such devices require a sequentialaddressing either involving more addressing machinery or faster addressing machinery In accordance with the principles of the invention, as defined in independent claims 1 and 10, a pluralityof ports, connected to various peripheral devices, are arranged for port to port communication through aTelephone Time Slot Interchange System TTIS . The TTIS is able to connect ports in any combination.According to the principles of the invention, a reduction in the size of the TTIS switching network isachieved by a real time scanning schedule of modules, representing groups of ports, rather than dependingon separately addressing each port on a request or need basis According to the principles of the invention, the ports are addressed through a time dependent scanningschedule, thereby avoiding the need for random addressing mechanisms, within the peripheral units.Instead, according to the inventive principles, information, such as data information and signaling information,is stored within a centralized store. The centralized store serves as an image of the peripherals, i.e.data and signaling information, produced at each port and the status or condition of each port. The timescheduled addressing assures that the store always contains the port s most current information, whethersignaling information used for operations or data passed to a designated addressed port from a SourcePort. The image is contained in a centrally located image RAM for use in the interconnection of all the TTISPorts. The TTIS Ports have two functions with regard to data 1 to serve as a transmitter or as a source ofthat data Source Port and 2 to be the receiver of that data or the address location of that data AddressPort . In the preferred embodiment, Source and Address Ports are grouped and designated as separateSource and Address Modules. Each of the separate groups of Address Ports within each Address Modulehave concurrent access to all of the Source Ports during a scanning cycle. This is accomplished, accordingto the preferred embodiment, by providing a Source Store for a complete set of Source Modules, with thecapability of storing all the data acquired during one scan frame for each of the designated AddressModules. In accordance with Address Port modularity, as stated above, the Source Port groups areseparated into respective Source Modules and a complete set of Source Store Modules, representing allSource Modules, are provided for access by any Address Module. The connection of the Source Portsthrough the Source Stores to the Address Ports is done responsive to a real time scanning schedule ratherthan by random addressing. As such, the real time scanning results in an Image Store represented in partby the aforesaid Source Store and in part by a store representing the signaling information, as will beexplained below. The number of Source Store locations for each module of Address Ports is equal to the total number ofports, or in the preferred embodiment, 2,048. The connective capability for each module of Address Ports ismade redundant by providing a complete Source Store representing all Source Ports, for each module ofAddress Ports. For example, in the preferred embodiment, for 2,048 peripheral devices representing 4Source Modules of 512 ports each, a Source Store of 4 Store Modules, serving 512 ports each, or a total of2,047 ports, is provided for each Address Module of 512 Address Ports. The Source modularity in thepreferred embodiment then, is arranged to provide 4 Store Modules representing a Source Store for allSource Ports in the system, to each Address Module, representing 512 Address Ports each. Access of eachSource Store data for any Address Port within each Address Module is accomplished by a pointer value inthe Address Store which is indicative of a location within that Address Module s Source Store, containingthat data. In this way, data from a specified Source Port may be connected to a particular Address Portassociated with that Address Store pointer location. This is accomplished by dedicating pointer locations inthe Address Store to respective Address Ports. In the preferred embodiment, as the degree of modularitydivides the total number of 2,048 ports into groups of 512 ports each, each of the Source Stores for each respective Address Store, contains the identical message from any one Source Port. However, only anAddress Store pointer value location, having a pointer value set to access the Source Store locationcontaining that message, can access that message and connect the data within that Source Store locationto the dedicated Address Port for the respective pointer value location and Address Store. As described above, the Address Stores are arranged with respect to Address Modules. In the preferredembodiment, the modules are in groups of 512 ports each. Within the real time scanning sequence, each ofthese separate modules, representing separate Address Ports, access the stores containing data for all ofthe 2,048 Source Ports. Further, the Source Ports are divided into Source Modules and a Store Module foreach Source Module is provided for access, separately by each separate Address Module. In this way, inthe preferred embodiment, the same Address Port is capable of receiving a data message from any SourcePort within any of the four separate modules and within one real time scanning frame. Finally, the separateAddress Modules may be made concurrently responsive to the scanning schedule so all data may beconcurrently transferred to the separate Address Modules, reducing scanning time. In the preferred embodiment, the TTIS system is organized into three components the Call ProcessorSystem CPU the Telephone Controller System TCU and the ports, connected to peripherals. Allline trunk telephony and data units are connected to the TCU by a telephony bus which also providesmultiplexing of modular groups of telephony devices, as will be explained below. The Call Processing System CPU consists of the service unit providing clocks and a priority resolver,a state register and interrupts for the active and stand by states and switchover control not shown to aredundant system in case of failure. In this connection, in the preferred embodiment, a redundant TTIS isprovided which performs in parallel with the active TTIS except for the active TTIS function of connectingthe Source and the Address Ports. In case of failure, the redundant TTIS is made active, so no loss ofcommunication occurs. Additionally provided is the interface to the TCU. The CPU provides the controlinstructions for the TCU. The TTU provides timing to the TCU resulting in repetitive scans in real time andcausing the conveyance of a message from a Source Port, the storage of that message at a first time slot,and then the exchange of that message with an Address Port at a second different time slot, with respect tothe afaresaid first time slot. The Telephony Controller System TCU , including the Time Switch Unit TSU and the Scanner SignalUnit SSU , mediates all communications between the CPU and the ports, scans the ports for servicerequests, provides the switch voice data connections between ports, provides tone generator and conferencefunctions and provides timing for the pulse code modulation of the telephony signals and the data.In the preferred embodiment, the TCU appears to the CPU as an image memory of 32K bytes of RAM,divided into 2,048 blocks of 16 bytes each, with one block for each port. All of the functions associated withany one of the 2,048 ports appear in the 16 byte block as an image of each respective port and in alocation assigned to that particular port. The 16 byte block is described below as the Port InterfaceStructure. The Telephony Bus is a composite of buses forming a multiplexing tree and in the preferredembodiment affects a maximum of 32 ports for each multiplexing level. It being understood, however, thatthe multiplexing modularity can be changed without affecting the inventive principles herein. This modularityis further reduced by multiplexing each unique pair of ports representing 32 separate scan intervals on to asingle bus. The multiplexing stages in the preferred embodiment are a first level multiplexing 32 ports eachinto a single multiplex channel. There are then 16 of those single multiplex channels. Each of those 16multiplexed channels are separated into two groups of 8 each. These two groups of 8 multiplex channelseach, totalling 256 ports, are then processed through a serial to parallel converter, which changes ortransforms bytes in serial form, with each consecutive byte being serially presented, into parallel bytes withconsecutive bytes presented in serial form. Each converter, in a separate timeslot, with respect to ascanning frame, provides a parallel byte for a separate respective port. In the final multiplex level, theoutput of each converter, representing 256 ports, is then combined into one time divided multiplex channelrepresenting the separate time slots for respective ones of the 512 ports within a Source Module. As explained below, each of the ports provides data at a 64K bit rate and signaling information at a 64Kbit rate. The multiplexing for the signaling information is the same as for the data and in the preferredembodiment, within one Source Module, the signaling information is combined from each of the two groupsof 256 ports to provide one time divided multiplex output of signaling information for a Source Module of512 ports and one time divided multiplex output for the data information with respect to that see module of512 ports. In accordance with the principles of the invention, the time slots are arranged according to the scanningschedule, rather than being assigned to ports as identified by conversations. The data and signalinginformation is not sent or received upon random demand of the CPU, but is continuously received,accessed and processed according to a real time scanning schedule, which in the preferred embodiment,comprises two milliseconds. The data at the 64Kb rate and the signaling information of the 64Kb rate fromall Source Ports are multiplexed into the TCU, in a fixed multiplexing tree, as described above, and theinformation flowing out of the TCU to the Addressed Ports is demultiplexed in a symmetrical manner. Theconverter performs serial byte to parallel byte conversion in the multiplexing tree and in a symmetricalmanner, in the demultiplexing tree. The 16 byte status and control registers with the TCU are dedicated toeach port, are not located at the ports, but in accordance with the principles of the invention, are imagesmaintained at a centralized location represented by RAM at the TCU. The data and control information foreach port is maintained in the TCU in separate stores and represents an image of each port within eachscanning cycle. That image is represented by the information in the TCU and refreshed each real time scancycle. All ports are scanned within each cycle and the programmed functions performed during the cycleby the Signal Scanning Unit SSU is performed once for every port. The signal information provided by theport peripherals includes one byte of device identification, a one bit service request indicator monitoredby the event scanner within the SSU and seven bits of additional status as further explained below. Twobytes that are sent to the ports are divided into a busy free indicator bit, an outpulsing or ringing bit asapplicable and fourteen bits of other control. Each port supplies type identification and any other functionsas needed by the particular service. According to the principles of the invention, the status byte last received on the last scan cycle, fromeach respective port is continuously monitored by an event scanner within the TCU. This bit is arranged tochange when any significant condition changes at the port, the meaning of this bit varies from device todevice and with the state of the event scanner. For simple units, it is the only status bit used and will mean off hook . The scanner, responsive to a change of status bit, relays the port number to the CPU whichholds the port number in a first in, first out FIFO register. A logic state machine which is multiplexed to therespective scan registers in respective ports is responsive to a 16 bit pattern written into the scan registerby the CPU, for each respective port, to initialize and enable the state register to perform a particulardesired function for each port. The state machine is controlled by the code pattern written into the scanregister for each respective port, and directs the state machine to recognize a change in the status bit. In the preferred embodiment, the scan register has three different modes 1 an edge detectorproviding an adjustable debounce filter, that when enabled, reports the occurrence in the change of aperipheral devices status 2 a dial pulse collector and 3 a hook discriminator. A full set of signaling registers is provided for every port, including those assigned to tone andconference functions. As stated above, rather than forming connections between a Source Port and an Address Port on an as requiredbasis, the status of each of the ports are monitored continuously over repetitive, consecutivescanframes. All necessary information to conduct the time multiplexed connection between any pair orgroup of ports is performed within the TCU through the aforesaid image RAM within the TCU and within theSSU. It should be understood that the term Source Ports and Address Ports are used in the explanationof the invention and are equally applicable to each of the 2,048 ports in the preferred embodiment. Theword Source Port is used to designate any one of the 2,048 peripherals when it is performing a functionof transmitting information. The word Address Port is used to designate any one of the 2,048 ports at thetime it is receiving information as the Addressee of the respective Source Port. According to the centralized scheme of the invention, an attenuation control is provided for the datapath at a single location within the Source Pointer Register for each port, as explained below. Attenuation isselected from a set of 16 independent attenuation codes, responsive to the Source Pointer Register,established, as stated above, for each port. The attenuation is implemented by a table of output characters.as a function of input characters contained in a bipolar PROM. In this way, a central location is provided forattenuation of each of the peripheral devices attached to respective ports. In accordance with the principles of the operation, the 2,048 port switch is implemented within a set of 4Image Store Modules, operating in parallel, each serving 512 ports. In this way, full service can be providedto each port from a central location and modularity affords concurrent scanning of Address Store Modulesand a reduction in processing time. Each Source Store is 32 bits wide so that four samples of 8 bits eachmay be written into it at once and one sample from each of the 2,048 possible sources can be written in512 cycles. The Source Store is organized with a redundancy related to the number modularity chosen. Although the modular redundancy adds to the cost of the unit, that cost is offset by the simplicity, directcentralized control and the advantage of modularity offered by this organization. Tone patterns are generated through 64 independent PCM sequences, each with its own peripheralnumber. Any number of telephony peripherals can be connected to any tone by writing the tones peripheralnumber to the addressed peripheral. Each tone is produced by reading a selected sequence of PCMsamples from an EPROM and then selecting its sequence indefinitely. Each tone has a starting addresspointer that is set by software to select one of the sequences in the PROM. The starting pointers may alsobe changed and it is possible to generate tone patterns at the tone ports by changing the starting pointervalues in an appropriately timed sequence. The Call Action Processing subsystem within the CPU CAP interprets and records actions by callers and tracks parties on hold. It collects and interprets signalinginformation, including key depressions and hook flashes and determines what to do when action has notbeen taken within a predetermined time. The invention is explained in detail with reference to a preferred embodiment and the drawings, inwhich Figure 1 shows in block form the TTIS including the telephone controller which includes the TelephoneTiming Unit TTU , Conference and Tone Unit CTU , Time Switch Units TSU , and Scan and Signal Unit SSU , and the Call Processing Unit CPU providing control functions over the TCU. Figure 2 shows in block and schematic form, the division of the ports into Source and Address Modulesand the redundant Source Store arrangement for each Address Module, according to the principles ofthe invention. Figure 3 shows the manner in which the data lines at 64 kilobits and signaling lines at 64 kilobits areseparated from their respective signaling or data pairs respectively and combined with like data andsignaling pairs. Figure 4 shows in schematic form and representative form, an image RAM comprising the TCU Sourceand Port Memory Stores, responsive to scan logic, for storing an image of status and data informationgenerated by the peripheral units. The principles of the invention are best explained with reference to the preferred embodiment shownand described herein. Figure 1 shows in block diagram the TTIS and in particular, the CPU and the TCU.The ports are connected to the TCU through the Telephony Bus. The Telephony Bus provides severallevels of multiplexing of the time divided multiplexed outputs of each of the ports connected to theTelephony Bus, as further described below. The TTIS central switch function, causing the connection of Source Port to Address Port, occurs withinthe Telephony Controller and in particular within the Time Switch Unit TSU of the Telephony Controller.The TSU provides non blocking access for up to 2,048 peripherals, in the preferred embodiment. However,it should be understood that modular nature of the TSU permits the expansion of the maximum number ofperipherals without any change to the inventive principles. As shown in Figure 1, the TTIS comprises theTelephone Timing Unit TTU , the Conference and Tones Unit CTU , the Time Switch Unit TSU and theScanning and Signal Unit SSU . The Telephony Bus as explained below provides a multiplexed input fromthe peripherals to the Telephony Controller and a demultiplexed output from the Telephony Controller backto the peripherals. In the preferred embodiment, complete redundancy is provided not shown in case offailure of any part of the system. The above stated multiplexing is accomplished by a multiplexing tree producing a Time DividedMultiplexed TDM output of consecutive bytes for each Source Port Module. In the preferred embodiment,are 4 modules which comprise 512 ports each. Within a module of 512 ports, multiplexing is simultaneouslyarranged to produce 16 groups of 32 ports. Within each group of 32 ports, each port has a fixed timeassignment. The 16 groups of 32 ports are multiplexed to produce 16 output channels, each channelproviding in serial form the time division multiplexed output for respective 32 ports. These 16 outputchannels are then multiplexed into two groups of 8 channels each, which are then processed through aserial to parallel converter to produce 8 consecutive parallel bytes of data from the serial data andproducing, on the output of each converter, consecutive bytes from 256 ports. These 256 bytes ofinformation are then combined as shown in Figure 3 to produce a single multiplexed output of 512consecutive bytes of information. The demultiplexing out of the TTIS is accomplished in a symmetricalmanner. In the preferred embodiment, the multiplexing and demultiplexing substantially occurs on theTelephony Bus. The elements of the TTIS are redundant to reduce the possibility of a single failure causing inoperationof the entire system. The TTIS is designed as two independent control halves, each half of which is capableof controlling system. Only one half of the TTIS is active at any given time the other half may perform allfunctions except the transmission of data and signaling information to the ports. In this way, the redundant half is always ready to assume active control of the system at any time. Any common control subsystem failure in the elements of the TTIS will cause a transfer of control fromthe active to the inactive control half. During the transfer of control, all interconnections already in a stablestate are retained in that state. The redundant half of the TTIS is connected by three cross coupled data busses, an IBUS, a STATUSBUS, and TIMING BUS. The IBUS provides a path by which pertinent data may be passed. The STATUSBUS provides a means of switchover control and current information pertaining to the functional state ofeither redundant half of the system and the TIMING BUS provides synchronization control between theredundant halves so that in the case of switchover timing of other critical functions would be maintained. A schematic representation of the data connection paths in the TTIS and in particular within the TCU isshown in Figure 2. As shown therein, Module Multiplexers shown as M As shown in Figure 2, the X Bus directs the data from any Source Module M The output of the Source Stores SS As stated above, the Address Modules A According to the principles of the invention, addressing is structured such that each message unit fromany one Source Port will be stored in a manner that is accessible to any Address Port in the system,including itself. As shown and described above, this is done on a modular basis by selecting modulargroups of distinct and separate ports, and redundantly storing that data within redundant modular memoryareas in redundant Source Stores. Additionally, the ports are further modularized by dedicating selectedports to respective address pointer value locations in each Address Store, with the result that any messagecan be routed to its designated Address Port by selecting the Address Store corresponding to that AddressPort and storing a pointer value within that Address Store location for the respective Store Module startingthe Source Port data for transmission to that Address Port. Under the control of the CPU and with timing provided by the TTU, bytes of information are located inStore Modules SM Each Address Store pointer contains two bits which locate the Store Module SM In further explanation of the inventive principles, Figure 4 shows in block representation, the connections,of the CPU and the TCU within the TTIS, through the Telephony Bus to the port connected peripheralunits. As shown, the TTIS comprises the CPU with all CPU functions as shown in Figure 1 and the TCUcomprising all functions shown within Figure 1. The image RAM shown within the TTIS is further explainedbelow and includes the Source Stores S The image RAM, as shown in Figure 4, is a representation of the Source Store SS Further details of the Scan and Signal Unit SSU the Time Switch Unit TSU , the Telephony TimingUnit TTU and the Conference and Tone Unit CTU is provided below. The Telephony Timing Unit TTU presents a microprocessor type asynchronous interface the RBUS to the call processing computer system CPU through which the CPU may read or write all the registersthat control and or monitor telephony functions the Telephony Controller system is a peripheral for theCPU. The TTU implements initialization controls for the telephony subsystem and a First In First Out queue FIFO for event reports from signal scanners. The TTU contains the master oscillator that clocks all telephony units and means for synchronizing thisoscillator to an external reference or to a redundant controller the Telephony Controller system providestiming for the PCM Codes and date devices and is itself a synchronous machine. The TCU s registers are presented via the RBUS to the Common Control Services Unit CSU seeFigure 1 as a contiguous block of 16,384 words of 16 bits 32K bytes . The address of the TelephonyController sent by the CPU is determined by logic in the CSU. All the TCU s registers are either read write or read only there are no write only registers. The dataread from any register that is not specified to be read only, will be the data most recently written to it.Writing to the read only registers is permitted but the data written will be discarded. In the following descriptions all addresses are given in hexadecimal notation base 16, indicated by a prefix and are relative to the block origin implemented by the CSU the bits in a cord are number F 15 for the most significant through 0 for the least and the logic values are described from the point of view ofthe CPU, not the bus nor the internal logic. The Telephony Controller register addressing was designed to correspond as far as possible to an arrayof structures indexed by Port Number, the various register functions for each port are arranged as a groupof sixteen consecutive bytes, as shown below. The registers for Port N are bytes 10 N 00 thru 10 N OF for example, the registers for The various bytes in the port structure register array are implemented by the several units of the TCUsystem the correspondence of the various parts of the array to the units that implement the various parts ofthe array to the units that implement the respective functions is shown by the Telephony System Mapshown below. The least significant four bits of the RBUS address are shown decoded as Byte of port structure across the top of the chart the most significant eleven bits of the RBUS address are shown decoded as Port of 2048 along the sides the card slot in the shelf for each unit is shown as nn . Bytes 0 thru 7 of the port structure are implemented by the Signal Scanner Units SSU and aredescribed below. Bytes 8 thru B of the port structure are implemented by the Time Switch Units TSU and aredescribed below. Each Time Switch or Signal Scanner Unit implements the registers and corresponding functions for onlyone module of 512 consecutive ports one, two, three, or four pairs of these units may be installed. Bytes C thru F of the port structure for Ports 0 thru 1023 are implemented by the Conference andTone Unit CTU and are described below. These registers are used only by Ports 0 thru 127 bytes C thru F for ports 128 thru 1023 are spare. The conference and tone registers do not form part of this invention and are not otherwise described. Bytes C thru F of the port structure for Ports 1024 through 2047 are implemented by the TelephonyTiming Unit TTU these 4096 bytes comprise These registers are not functionally related to the ports they have been placed arbitrarily within the portstructure to avoid expanding the address space and further complicating the address decoders. The FIFO s buffer is normally read only bytes C thru F for Ports 1792 thru 1919 cannot be used bysoftware except for hardware diagnostics in an off line system. The operation of the FIFO is describedbelow. The TTIS system functions are controlled by four bytes and four words of registers that have beendistributed over the last four bytes of each of the last four ports shown below. The four bytes for port 2044 7FCC 7FCF are reserved for future use in this model they are read only with all bits 1 because they were decoded for discrete control registers that were not implemented. All of the port registers are multiplexed between processor access and their internal function by thetelephony system clock since the call processor is asynchronous to this clock, the interface will add arandomly varying synchronizing delay to each access. In the preferred embodiment, the first 128 port numbers have been assigned to the alarm and auxiliaryvoice functions and the remaining 1920 ports serve the peripherals installed in the telephony shelves. One hundred and ninety two ports are assigned to each 24 card telephony shelf, as follows The system control provides default initial conditions for the telephony functions, diagnostic capabilities,and access to the system s configuration, status, and serial number. The initialization function is describedonly in regard to the FIFO, all other functions being known and not forming part of the invention. The initialization functions are controlled by bits in byte 7FFF byte F for port 2047 This register is read write but all bits will be reset to zero by the Power Up Reset signal from the CSU. Bit 9 EFQ controls the event report FIFO queue described in regard to the Event Report FIFO.The EFQ bit will be cleared to 0 by power up reset and must be set to 1 after the Q Size register hasbeen initialized, for normal operation. When this bit is reset to 0 the FIFO will be disabled, the Q Size and Q Wptr registers and the queuebuffer may be written, the FIFO not empty interrupt will not occur, and the SSU scan registers will hold theirreports. When this bit is set to 1 the FIFO and its interrupt will function normally and the Q Size and Q Wptrregisters and the queue buffer will be read only. This bit has no effect on the operation of the FIFO Data register except in the RAM Test diagnosticmode see 2.2.2.4 . This is a single hardware first in first out queue that collects the reports that are generated by thesignal scanner units on behalf of the peripherals connected to the ports when a scan register detects anevent its port number will be entered into this queue when the FIFO Data register is read the entry read willbe removed from the queue. The FIFO is implemented as a circular buffer, using 256 words of RAM and two 8 bit counters, and willhold up to 255 entries. An event that occurs when the queue is full or not enabled will not be discarded but will be held by thescan register in its WF bit until space in the queue is available, as described below all service requestswill appear in the queue eventually but they may be in random order if the FIFO is allowed to fill. The TTU provides a signal called QMPTY on the RBUS that is used by the CSU to generate a CBUSinterrupt this signal will be driven HI to cause an interrupt when the FIFO is enabled and not empty andwill be driven LO otherwise. The FIFO entries may be read from word 7FEC bytes C and D for port 2046 The twelve most significant bits of this register are the number of a port and the four least significantbits are qualifying flags. This register is read only data written will be lost. Reading either the whole word or the odd address byte will remove the entry read from the queue andadvance the FIFO. When the FIFO becomes empty the entire word will be zero, which is the flags for emptyand the port number for silence. This bit is a copy of the WF bit of the scan register that made the report, as it was when this entry wasrequested the scan register will clear its WF bit when the report is accepted by the FIFO. Bits E thru 4 of the FIFO data are the port number of a peripheral device requiring service when V 1and are all zero when V 0. Bits 2 and 3 are reserved for future use and are both 0 in the current model. Bit F will also be 0because there are at most 2047 7FF ports in the system. The number of entries currently in the FIFO may be read from byte 7FEE byte E for port 2046 This register must be cleared to zero before the FIFO is enabled the power up reset does not initializethe FIFO. When the FIFO is disabled EFQ 0 this register is read write the FIFO may be set empty by clearingthis register, data previously read from the FIFO may be recovered by incrementing this register, and datamay be discarded from the FIFO by decrementing this register. When the FIFO is enabled EFQ 1 this register is read only and data written will be ignored. The cell number of the next free word in the FIFO buffer may be read from byte 7FEF byte F forport 2046 . This register has been provided for hardware diagnostic purposes and is read write only when the FIFOis disabled when the FIFO is enabled this register is read only and data written will be ignored. The 256 words of RAM that are used for the FIFO queue appear in the last four bytes C F of thenext to last group of 128 ports ports 1792 700 thru 1919 77F . The correspondence between the Q WPTR and Q SIZE registers and the cell address is When the FIFO is enabled the RAM that is used for the queue is read only and data written will beignored the FIFO should be disabled by setting EFQ 0 when a read write RAM test diagnostic is to beperformed. When a report is entered into the queue the port number and flags are written into the cell specified by Q WPTR and then the pointer and size registers are both incremented when the FIFO data register isread the data is obtained from the cell specified by Q WPTR minus SIZE modulo 256 and then onlythe size register is decremented. When the FIFO is full or disabled SIZE 255 FF or EFQ 0 no entries are written to the buffer when the FIFO is empty SIZE 0 data is not read from the buffer in both these cases the write pointerand size do not change. All sixteen bits of FIFO data, including the V always 1 and unused always 0 bits, are always writtento and read from the buffer cells except when the FIFO is empty. The output of the TTU crystal oscillator is 49,152 kiloHertz. This oscillator drives an ECL flip flop dividerwhose outputs are directly connected to the system backplane to provide clean and precise 24,576kiloHertz tick and 2.048 MHz. PCM bit rate clocks all of the units of the Telephony Controller, includingthe TTU itself, derive all their timing from these signals. The TTU master cycle counter provides TTL outputs to the backplane at the 8000 Hertz PCM samplerate and the 500 Hz. signaling multiplex rate for system synchronization and at 409,600 Hz. for the 10 ms.scan register timers. The Time Switch Unit TSU implements the TTIS, which is a simple pure time switch that gives fullaccess and is non blocking. The matrix may be configured for 512, 1024, 1536, or 2048 ports in themaximum configuration it contains the equivalent of 4,194,304 crosspoints. The CPU controls the switch by writing port numbers into the Source Pointer registers. There is onesource pointer value register for each port, as explained above, with regard to Figure 2. These registers are part of the port interface structure described above bytes SB and A are spareRAM. Each source pointer is 12 bits long and shares a word with the Pad attenuator control. The contents ofthe source pointer register specify the port number of the source of the voice or data that will be receivedby the device at the port that owns the register. Bit F of the source pointer is ignored because thehighest port number is 2047 7FF . The source for any port may be any port, itself included, independently for each port. The destinationfor a port is specified only indirectly, by setting some port s to have it as source each port may transmit toany number of ports or none. Most voice connections will be conventional two way conversations, in which the source for each partyis the other party, but certain other configurations are also useful for example, when a party is receivingdial tone or silence and sending to a Touch Tone T.M., AT T decoder we have a chain, and when manyparties are listening to busy tone we have a broadcast. A configuration in which each port in some setlistens to its predecessor in the set the first port listens to the last is a ring and might be used by a packetdata network. An attenuator is included in the voice path from the switch to each telephony device. The attenuator isselected from a set of sixteen independently for each port by the four bits of the Pad Select registeradjacent to the source pointer. A value of zero will select zero loss for voice and transparency for data the other fifteen attenuators areavailable for the management of loss plans and tone levels. The attenuators do not affect the polarity bit ofthe PCM but only the seven magnitude bits and are not intended to be used for anything but PCM voice. The attenuators in the prototype TSU are for mu Law and have the following losses Each attenuator is equivalent to a combination of ideal decoder, linear attenuator, and ideal encoder butis implemented by a table of output character as function of input character contained in a bipolar read onlymemory, the PAD PROM. The tables in the pad prom can be programmed independently, for any value ofattenuation or gain, if necessary , and for either mu or A law PCM or for conversion between laws by theprocedures described in appendix D. TCU is a simple timeslot interchanger the PCM and data characters from all ports are multiplexedtogether, stored in the Source Store SS The present 2048 port switch was implemented as a set of four 512 port modules for convenience inthe construction and so that the full expense of the large switch need not be borne by smaller systems. The Source Store in a simple T switch must both write and read 8000 characters per second for everyport, so that the Source Store in a 2048 port switch must run 2 2048 8000 or 32,768,000 byte cycles persecond. Rather than attempt to run a single RAM at this blinding speed, we chose to have four SourceStores operating in parallel, each serving 512 ports, and to make each Source Store 32 bits wide, so thatfour samples may be written to it at once. Each Source Store has its own Address Store the pointer readfrom the Address Store addresses one of the 512 words in the Source Store and selects one sample fromthe four in the word by a multiplexer. Both the Source Stores and Address Stores are built from 2149 RAM chips and 74LS374 pipelineregisters and run 1024 cycles per frame with comfortable margin at 8.192 MHz. with 122 nanosecondcycles . In each frame each Source Store has 512 four sample write cycles and 512 one sample readcycles and each Address Store has 512 address read cycles and 512 cycles dedicated to CPU access thatare controlled by the processor interface and may be read or write but will be mostly do nothing. Each ofthe four Address Stores has 1024 words of 16 bits the whole RAM is available to the CPU interface butonly 512 words are used to address the Source Store. Each address word has one spare bit, 11 bits ofsource pointer, and 4 bits of pad control that are passed to the PAD ROM with the sample from the SourceStore. This switch has four times as many RAM chips as might be found in a switch organized in some otherway but the cost of the RAM is not large and is well offset by the simplicity, direct control, and modularity of this organization. The X Bus, as shown in Figure 3, is further explained below. The PCM is passed between the switchmodules on a 32 bit wide bus that operates a 4.096 MHz, the rate of the Source Store write cycles. Thisbus is connected to all the cards in the Telephony Controller except the telephony timing unit and is splitinto four bytes in order that the four TSU may be identical, the four bytes are not wired straight across butare swapped around between the pairs. Each line in the chart below represents one byte eight wires the open numbers are the TSU SSU pairthat drives the wires and the numbers in parentheses are the bank for the Source Store in which the bytesare stored. The control of the Selector at the output of the Source Store is modified by two exclusive or gates tocorrect for the crosswiring The Signal Scanner Unit SSU provides the identification, status, control, and serial signaling functionsfor all peripheral devices connected to the ports and a mechanism that will collect rotary dial pulses ordetect service requests from the peripherals. The SSU Store appears to the call processing system CPU as eight bytes of the Port InterfaceStructure described above. All of the SSU registers are maintained in the TCU and in a store that is immediately accessible by theCPU and separate and dedicated for each port. Bytes 0 thru 5 Status, IN, OUT, Control, Type, and Extend represent registers of the peripheraldevices except for the service request bit, the SSU does not interpret, modify, or otherwise process any ofthis data. Bit 0 of byte 0 from each telephony device, the LSB of Status, is called Service Request SRQ theSRQ bit, and only this bit, is monitored by the scanner function described below. The port peripherals is arranged so that this bit will change whenever any significant change of theperipheral s state occurs and such that 0 means idle, on hook, out of service, or discontent and 1 meansactive, off hook, in service, or happy. Byte 4 Type has been reserved for device identification and must be supplied by every telephonyperipheral the pattern of the bits in this byte are expected to be unique to each kind of peripheral. The value of Type will normally be constant for a given unit but may include bits that indicate optionalconfigurations where appropriate. The all zero OO and all one FF values of Type are reserved by convention for empty slots and shorted buses, respectively. The meaning of all the other bits in these bytes may be determined by the particular device that isinstalled at the corresponding port and is given in the specification document for the port peripheral.Analog telephony peripherals are permitted to omit any definition of the IN, OUT, and Extend bytes anyunit that does not specify otherwise will ignore the OUT and Extend bytes and reproduce the Typeinformation in the IN byte. A full set of signaling registers is provided for every device address, including those assigned to theconference and tone unit which has no signaling functions. For all ports for which no device is connected to the signaling. it may be assumed that Status. IN, andType are all zero that Control, OUT, and Extend have no effect and that the scan functions work asdescribed but can generate only timeout and spurious edge reports because SRQ will always be 0. In TTIS, the signaling for device addresses 0 31 tones are used by the system alarm functions Power and Alarm Board and the signaling for device addresses 32 63 tones and 64 127 conference are not connected to anything. All of the parts of the entire TTIS signaling system operate continuously at 500 cycles per second every function is performed once for each port in each two millisecond cycle except IN OUT, which aredone twice per cycle . The signaling cycle is also called a superframe and coincides with a set of sixteen consecutive PCMframes. The various functions for the several ports may be performed at different times in the cycle, withscheduling of such functions not forming part of the corrective concept and is not described herein. Bytes 2, 3, and 5 are read from the RAM by the SSU and sent to the port peripherals in everysuperframe. The SSU does not ever write into these bytes but the CPU may read from them the data readwill be the data last written by the CPU. Bytes 0, 1 and 4 are received from the port peripherals and written to the RAM by the SSU in everysuperframe. The CPU may write into these bytes but the SSU does not ever read from them and will rewriteall bytes in every two millisecond cycle. The OUT byte is read and sent twice and the IN byte is received and written twice by the SSU in eachtwo millisecond cycle. The OUT byte may be written and the IN byte may be read by the Common ControlServices Unit. Bytes 6 and 7 control and monitor various functions that process the SRQ bit received from theperipheral and are called the Scan Register. As explained in the foregoing, the Scan Register controls astate machine and responsive to the port, stores a value indicative of port status. The scan register is both read and written by the SSU and is intended to be both written and read bythe CPU. The normal use of this register will be that Data written to the status byte by the CPU does not affect the scan register functions in any way. The logic that implements the functions of the scan register is shared among modules of 512 devicesby multiplexing the previous state is read from the RAM, the appropriate next state is determined by thestate machine logic, the port address is written to the FIFO if required, the next state is written back into theRAM, and this process is repeated for all ports once in each signaling cycle. The SSU takes 2.7 microseconds to read, update, report, and rewrite each scan register this processcannot by interrupted by the CPU and will appear to be completely indivisible and very nearly instantaneous.The probability of catching a scan register in the middle of its update is only 1 in 819.2 .0012 . If the CPU happens to write to the scan register during its processing after the read and before therewrite the calculated next state will not overwrite the data written by the CPU the CPU s data willeffectively overwrite the update. Normal use will be to write the whole word with a single access but a writeto either byte will suppress the rewrite of both bytes when it occurs during an update. The five most significant bits of the scan register control all of the scanner functions. Bit F EN may be reset to 0 to disable the scan register functions and must be set to 1 to enable thescanner to make reports to the FIFO when the scanner detects the selected condition it will enter theaddress of the port in the FIFO and will reset EN to 0, to prevent further reports. Bit E WF is used internally for management of the FIFO and should be reset to 0 when any functionis initialized WF will be set to 1 by the SSU when a report is to be made to the FIFO and the FIFO is eitherfull or not enabled. When WF 1 the SSU will attempt to report to the FIFO on every cycle on the first cycle that finds theFIFO both enabled and not full, the SSU will report the port address to the FIFO with the delayed reportindicator set FIFO bit W 1 and will reset WF to 0. The operation of WF is not affected by an other bit in the scan register. Bits D and C F1 and F0 select the mode of operation, and the configuration and meaning of bits A through 0, of the scan register. Four modes can be selected but only three of them have any use, on the preferred embodiment. Bit B SS is the debounced version of SRQ this bit has the same polarity and meaning as that givenby the installed peripheral to bit 0 of its Status. Changes in the peripheral s status are delayed and may even be ignored by the debouncingmechanism, whose operation depends on the mode selected. When F1,F0 00 the scan register controls a variable debouncer that will report the occurrence of achange in SRQ when enabled. The edge detector can report either an edge or a pulse , that is, either the first change of SRQ orthe corresponding second, complementary change. In this mode the meaning of bits A through 0 is Bits A thru 6 14 10 are a 5 bit binary up down counter that filters SRQ the result of the debouncingis recorded in SS. Integrator counts down when SRQ 0 and up when SRQ 1, will be updated every 2 ms,will run as long as mode 00 is selected, and is independent of EN. The range of Integrator is controlled by Limit the minimum count is zero and the maximum count isequal to the value set in Limit which may also be zero . if SRQ 0 and Integrator is 0, then SS will be resetto 0 and Integrator will remain 0. Symmetrically, if SRQ 1 and Integrator equals Limit then SS will be set to1 and Integrator will remain equal to Limit. When Integrator is set greater than Limit, it will count up and down until it either overflows from 31 to 0or counts down to equal Limit, and will then resume normal operation. When Limit is set to 5, Integrator will operate as described under mode 01 below but the bits are indifferent positions in the register. Bits 5 thru 1 L4 L0 are a static 5 bit register that sets the speed of Integrator by controlling the rangeof its count the number of consecutive samples that will be counted All values in the range of 0 to 31, inclusive, are valid the delay from a bounce free change of SRQ tothe change of SS may be set to any value between 0 and 31 samples 0 to 62 ms , in one sample 2 ms increments. If Limit is set to zero than SS will equal SRQ and changes will be recognized with only the 0 2ms random delay inherent in the scanning. Bit 0 E P selects reporting at the first E P 1 or second E P 0 change of SS. When SS is changed by integrator, either 1 0 or 0 1, then if EN E P 1 the port address will bereported to the FIFO and EN will be reset to 0 or if E P 0 then E P will be set to 1. When F1 0 and F0 0 is selected SS should be set equal to SRQ and Integrator should be set to zeroif SS 0 or equal to Limit if SS 1 otherwise a spurious or premature edge will be detected. If mode 00 has been running with an appropriate limit then it may be re enabled by setting EN to 1,optionally clearing E P to 0, and disturbing no other bits. Timer will be cleared to 0 by any change of SS, even when EN 0, so that the occurrence of a pulseafter digit collection has terminated an error condition may be determined from the contents of Timer. When F1,F0 01 the scan register will collect dial pulse from a standard rotary telephone or equivalentdevice. The dial pulse collector will report a completed digit, when a hookflash or hang up is detected, or ondigit overrun, and will optionally report the beginning of dialing. The performance of this mechanism in relation to the RS 464 specification is shown by the graph inAppendix E. In this mode the meaning of bits A through 0 is Bits A thru 8 12 10 are a 3 bit binary up down counter that debounces SRQ the result of theintegration is recorded in SS and is used to control the digit and timeout counters. Integrator counts down when SRQ 0 and up when SRQ 1, follows a six state sequence with aminimum count of 0 and a maximum count of 5, and runs continuously as long as mode 01 is selected,independent of EN. When Integrator is set to 6 or 7 it will continue to count up and down until it either overflows from 7 to 0or counts down to 5 and will then resume normal operation. Except for the fixed limit and the differentposition of the bits, Integrator operates as described for mode 00. Since SRQ is sampled at 500 Hz and SS may change on the sixth count, a noise free change will berecognized with a delay of 10 to 12 milliseconds. A change of noisy input will be recognized with a greaterdelay, depending on the amount of noise each false sample must be corrected by a true sample andwill therefore add 4 ms to the recognition delay. Bits 7 thru 4 T3 T0 are a 4 bit binary timer that terminates digit collection when no pulses arereceived within a preset interval. Timer will be reset to zero whenever SS is changed by Integrator and will then count 100 Hz for theduration of the following break or make interval. except when EN 0 or Digit 0 Timer will recognize aninterdigit pause or a hookflash when it counts up to 15 all ones, F , which will take 150 6 millisecond, andthen the device address will be reported to the FIFO. EN will be reset to 0, and if SS 0 on hook, break then also Digit will be cleared to zero to indicate hookflash or hang up. The pulses counted by Timer are not synchronized to SRQ or SS so there is some ambiguity in itstiming an interval less than 144 ms will be counted as a dial pulse, an interval longer than 156 ms will berecognized as an interdigit pause or a hookflash, and an interval between 144 and 156 ms may beinterpreted either way. Timer does not count when EN 0 nor when Digit 0 when EN 0 the digit collector has finished itsfunction and may be waiting for service when Digit 0 the digit collector is waiting for the first pulse, forwhich no timeout is provided, and the 1 s bit of Timer T0 has a different function. Bit 4 T0 enables generation of an extra report to the FIFO at the beginning of dialing this reportindicates that dial tone may be removed, is for information only, and does not terminate digit collection. T0 means dial tone trip only when EN 1 and Digit and will be reset to 0 along with T1 thru T3 wheneveran edge is detected. If Integrator changes SS when T0 1, EN 1, and Digit 0, then the address of the port will be enteredinto the FIFO and Timer T0 thru T3 will be reset to 0 but EN will remain set to 1 and digit collection willcontinue. if the digit collector is initialized in the on hook state the extra report will be generated when theperipheral goes off hook but Timer will not begin to count until Digit is incremented, at the next on hookedge. Bits 3 thru 0 D3 D0 are a 4 bit binary counter that counts the dial pulses when EN 1, Digit will beincremented when Integrator changes SS from 1 to 0, i.e., at the leading edge of every break pulse. Digit must be initialized to zero, will not be incremented when EN 0, and will bed reset by the SSUonly when Timer recognizes hook flash or hang up. Digit will count at most 15 pulses if a sixteenth pulse is detected Digit will remain equal 15, the deviceaddress will be reported to the FIFO, EN will be reset to 0 to terminate digit collection, and Timer will bezero to indicate overrun. When F1 0 and F0 1 is selected SS should be set equal to SRQ Integrator should be set to 0 ifSS 0 or to 4 if SS 1 Timer should be set to 1 if the dial tone trip report is desired and reset to 0otherwise and Digit must be reset to 0. The standard initialization for the digit collector is The loop state at termination may be determined from the contents of Digit Bits 3 0 The digit collector does not distinguish between hookflash and hangup the hook discriminator has beenprovided for that purpose. The occurrence of an extra pulse after the dialed digit may be determined from the contents of Timer Bits 7 4 Timer will be either 0 or 15 F at termination other values occur only during operation or when writtenby the CPU. When F1,F0 10 the scan register controls a simple timer that will report after a preset interval orwhen an edge is detected, whichever occurs first. In this mode the meaning of bits A through 0 is Bits A thru 8 12 10 are a 3 bit binary up down counter that debounces SRQ and records the result inSS Integrator operates ad described in section 4.2.5.1 for mode 01, and runs continuously as long as mode10 is selected, independent of EN. If Integrator changes SS either 1 0 or 0 1 when EN 1 then the device address will be reportedto the FIFO and EN will be reset to 0. Bits 7 thru 0 T7 T0 are an 8 bit counter that will count 100 Hz when EN 1. When Timer overflowsfrom FF to 00 the device address will be reported to the FIFO and EN will be reset to 0. If Timer is preset to 255 FF a report will occur within 10 ms if Timer is preset to 1 the timeout reportwill not occur before 2.540 to 2.550 seconds. Timer should not be initially zero. as this would give anambiguous result if an edge were detected immediately. Timer is not reset by the SSU and will not count at the same time that SS changes or when EN 0. When F1 1 and F0 0 is selected SS should be set equal to SRQ Integrator should be set to 0 ifSS 0 or to 5 if SS 1 and Timer should be set to the two s complement of the integer nearest the productof 100 Hertz and the desired time limit. Hookflash hangup discrimination telephone off hook, timer set to 750 milliseconds Except when Timer is initially zero and an edge is detected immediately, the cause of termination maybe determined from the contents of Timer Bits 7 0 The elapsed time may be obtained by subtracting the initial value of Timer from its final value and thetime remaining may be obtained as the two s complement of Timer s final value. When F1,F0 11 the scan register has no useful function this mode has been reserved for futurerequirements. In the present implementation if EN 1 the device address will be reported to the FIFO and EN will bereset to 0, Integrator operates as in modes 01 and 10, and bits 7 through 0 have no meaning but may beread and written as RAM. In this mode the meaning of bits A through 0 is The inventive principle disclosed herein may be practiced with any suitable data systems, currentlyavailable or available in the future. The data system concepts described herein for implementing theseinventive principles should not be viewed as limiting such inventive principles. Further, details of the systemimplementation have been omitted as they will be well known to those skilled in the art.