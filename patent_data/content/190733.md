# Data processing system and method and pocket size hermetically sealed electronic device.

## Abstract
A system in accordance with the present invention is arranged to carry out data processings by selecting and combining basic functions provided in a pocket size hermeti cally sealed electronic device by operating from an external equipment. The pocket size hermetically sealed electronic device includes a mask ROM 36 which is memorizing programs for realizing a plurality of kinds of basic functions, a RAM 38 which memorizes various kinds of data that accompany the basic functions, a connnnection section 40 which receives a command that includes at least function codes for selecting programs of the plurality of kinds of basic functions based on a command from the connection section, and carries out the functions in accordance with the prog rams selected.

## Claims
CLAIMS 1. A system which carries out data processing, comprising a a pocket size hermetically sealed electronic device, comprising a first memory section which has memorized programs for accomplishing a plurality kinds of basic functions, a second memory section for memorizing various kinds of data used for the basic functions, a connection section for supplying a command which includes at least function codes for selecting programs of the plurality kinds of basic functions, and a control section for selecting the programs of basic functions by the command from the connection section to execute the basic functions in accordance with the program selected and b an external equipment for supplying to the connection section the command with function codes that select the programs of the plurality kinds of basic functions through contact with the connection section, and for receiving from the connection section a response signal for the basic function executed. 2. A system as claimed in claim 1, wle ein the plurality of kinds of the basic functions include a read writer function of the data from the second memory section, a encryption decryption function for preventing leakage and falsification of the communication data, and a password setting password collation function. 3. A system as claimed in Claim 1, l7l rain the pocket size hermetically sealed electronic device comprises an IC card formed in the card like structure. 4. A system as claimed in Claim 1, wherein the first memory section comprises a mask ROM. 5. A system as claimed in Claim 1, .sl erern the second memory section comprises a PROM, and in which the control section comprises a CPU. 6. A system as claimed in Claim 3, wherein said external equipment comprises a keyboard, a memory unit, an IC card reader writer, and a CPU which reads the data processing programs memorized in the memory unit, in response to the command which is inputted via the keyboard, to select and combine the function codes to supply the result to the IC card reader writer, and also executes prescribed processings by receiving a response signal of the IC card from the IC card reader writer. 7. A system as claimed in Claim 6, wherein the IC card reader writer comprises a transportation mechanism for transporting theIC card inserted to a insertion port to a prescribed position, anIC card contact section which is to be brought to an electrical connection with the connection section of the IC card that is set at the prescribed position, an I O interface for carrying out transfer of command from to the CPU of said external equipment, and a control circuit for controlling the transportation mechanism, and the I O interface. 8. A system as claimed in Claim 1, wherein the command supplied by said external equipment comprises a function code and a data. 9. A system as claimed in Claim 1, wherein said second memory section of the pocket size hermetically sealed electronic device is divided into a plurality of zones assigned separately with different access conditions. 10. A system as claimed in Claim 2, wherein said second memory section of the pocket size hermetically sealed electronic device is divided into a zone from which read alone is possible, a zone for which write alone is possible, a zone for which both of read and write are possible, a zone for which both of read and write are not possible, and a zone for which read and writer are possible only after completion of the password collation, with respect to the external equipment. 11. In a system which carries out data processing by means of a pocket size hermetically sealed electronic device in which an electronic device with data processing function is sealed a data processing method, comprising the steps of a storing programs for accomplishing a plurality of kinds of basic functions in the pocket size hermetically sealed electronic device b supplying a command, which includes at least function codes that select programs the plurality of kinds of basic functions, to the pocket size hermetically sealed electronic device c selecting programs for basic functions based on the command from the connecting section and executing the basic functions in accordance with the programs selected. 12. A data processing method as claimed in Claim 11, wherein the plurality kinds of basic functions includes a read writer function of data from the secon memory section, an encryption decryption function for preventing leakage and falsification of communication data, and password setting password collation function. 13. In a system which carries out data processing a pocket size hermetically sealed electronic device, comprising a a first memory section which has memorized programs for accomplising a plurality kinds of basic functions b a second memory section for memorizing various kinds of data used for the basic functions c a connection section for receiving a command, which includes at least function codes for selecting programs of the plurality kinds of basic functions, from an external equipment in the system and d a control section for selecting the programs for basic functions by a command from the connection section to accomplish the basic functions in accordance with the programs selected. 14. A pocket size hermetically sealed electronic device as claimed in Claim 13, herein the plurality kinds of basic functions include a read write function of data from the second memory section, an encryption decryption function for preventing leakage and falsification. of communication data, and a password setting password collation function. 15. A pocket size hermetically sealed electronic device as claimed in Claim 13, wherein said pocket size hermetically sealed electronic device comprises an IC card. 16. A pocket size hermetically sealed electronic device as claimed in Claim 13, wherein the first memory section comprises a mask ROM. 17. A pocket size hermetically sealed electronic device as claimed in Claim 13, wherein the second memory section comprises a PROM and said control section comprises a CPU. 18. A pocket size hermetically sealed electronic device as claimed in Claim 13, wherein the external equipment comprises a keyboard, a memory unit, an IC card reader writer, and a CPU which reads the data processing programs memorized in the memory unit in response to the command which is sent via the keyboard, to select and combine the function codes to supply the result to the IC card reader writer, and also executes prescribed processings by receiving a response signal of the IC card from the IC card reader writer. 19. A pocket size hermetically sealed electronic device as claimed in Claim 18, wnotein the IC card reader writer comprises a transportation mechanism for transporting the IC card inserted to a insertion port to a prescribed position, an IC card contact section which is to be electrical connected with the connection section of the IC card that is set at the prescribed position, anI O interface for carrying out transfer of command from to theCPU of said external equipment, and a control circuit for controlling the transportation mechanism and the I O interface. 20. A pocket size hermetically sealed electronic device as claimed in Claim 13, wherein the command supplied by the external equipment comprises a function code and a data. 21. A pocket size hermetically sealed electronic device as claimed in Claim 13, wherein said second memory section is divided into a plurality of zones assigned separately with different access conditions. 22. A pocket size hermetically sealed electronic device as claimed in Claim 14, wherein said second memory section is divided into a zone from which read alone is possible, a zone for which write alone is possible, a zone for which both of read and write are possible, a zone for which both of read and write are not possible, and a zone for which read and write are possible only after completion of the password collation, with respect to the external equipment.

## Description
DATA PROCESSING SYSTEM AND METHOD ANDPOCKET SIZE HERMETICALLY SEALED ELECTRONIC DEVICEBACKGROUND OF THE INVENTIONField of the Invention The present invention relates to a system which carries out data processing by means of a pocket size hermetically sealed electronic device that has an electronic device sealed in its inside, and more particularly to a pocket size hermetically sealed electronic device which can be adapted for a wide variety of services with a single unit of the device.Description of the Prior Art In recent years, development has been under way for systems such as home banking system, farm banking system, and home shopping system that can make use of the communication systems to the most advantageous degree. Along with it, development of the so called IC card has also been advanced. An IC card is a pocket size hermetically sealed electronic device which has an electronic device with data processing capability sealed inside of the card in such a way as to make it impossible to read out those data that require privacy protection. The IC card is being utilized in the above systems for such purposes as security assurance and memory of necessary information of the data on the network, and its application to a wide variety of uses is being anticipated. Further, it is conceivable to use it in the field of financial services for storage of financial transaction information and encryption descryption. further, its use as a key to scrambling and for storage of viewing listening information for the pay television has been proposed by CII Honeywell Bull, Inc. Moreover, it may be possible to be applied to the medical field for storage of medical information for the patients. As described in the above, the IC card is anticipated to be utilized in the future for all sorts of services that require data storage and data processing. Now, in using IC card for various kinds of services, the form of the data to be stored and the type of data processing required are different for each service, so that service provider has to provide the user with an IC card which is different for different service. For this reason, it is conceivable to seal to the inside of the card different electronic device that is suitable for seprate purposes, and manufacture and provide an IC card corresponding to each purpose of use. However, such an arrangement is undesirable since it leads to a rise in the cost of IC card. Then, one may wish to give a common structure to the hardware and cope with the variety of services buy varying the software for the electronic device that is sealed in the inside of the card. In this case, it becomes necessary to provide a program memory in the inside of the card. However, when a programmable ROM PROM is to be used as the program memory, writing of the program takes a long time such that for one like IC card which is to be provided to a large number of users there was a problem that a rise in the production cost was inevitable due to low mass productivity. further, for a fixed single program, it is possible to provide a card at low cost through mass production by using mask ROM for the program memory. However, in such a case it becomes impossible to provide a variety of softwares as mentioned in the above. In the above maqnewr, in spite of the anticipation that the existing pocket size hermetically sealed electronic device will be utilized for a variety of purposes, there was a problem that it was difficult to provide at low cost a pocket size hermietically sealed electronic device that is applicable to a variety of services. SUMMARY OF THE INVENTION An object of the present invention is. to provide a pocket size hermetically sealed electronic device which enables one to receive a wide variety of services at low cost. Anoth et object of the Nresent invention is to provide a pocket size hermetically sealed electronic device which is adapted for a wide variety of services by selecting and combining via an external equipment the basic functions provided to carry out data processing. One of the features due to the present invention is that the pocket size hermatically sealed electronic device includes a first memory section which memorizes the program for realizing a plurality of kinds of basic functions, a second memory section which memorizes various kinds of data that accompany the basic functions, a connection section which receives a command that contains at least a function command for selecting, by means of an external equipment, the plurality of kinds of basic function programs, and a control section which selects the basic function programs by the command from the connection section and executes the basic functions in accordance with the programs selected. these and other objects, features and advantages of the present invention will be more apparent from the following description of the preferred embodiments, taken in conjunction with the accompanying drawings.BRIEF DESCRIPTION OF THE DRAWINGS Figure 1 is a block diagram for illustrating the function of an IC card embodying the present invention Fig.2 is a block diagram which shows the concrete construction of the IC card shown in Fig. 1 Fig.3 is a perspective view of the IC card shown in Figs. 1 and 2 Fig.4 is a perspective view of a data processing system which uses the IC card shown in Figs.l to 3 Fig.5 is a compositional block diagram for the system shown in Fig.4 Fig.6 is a compositional block diagram for the card reader writer in Fig.5 Fig.7 is a flow chart for illustrating the operation of the terminal of the system shown in Fig.4 Fig.8 is a flow chart for illustrating the operation of the card reader writer of the system shown in Fig.4 Fig.9 illustrates simplified diagrams that show the data format for the data to be sent from the card reader writer to theIC card shown in Fig.4 Fig.10 is a flow chart for illustrating the operation of theIC card of the system shown in Fig.4 Fig.ll is a flow chart for illustrating the sequence when the system shown in Fig.4 is applied to the credit card system and Fig 12 is a flow chart for illustrating the sequence when the system shown in Fig.4 is applied to the transfer system through bank. DESCRIPTION OF THE PREFERRED EMBODIMENTS Referring to Figs.4 and 5, there is shown an IC card system 10 embodying the present invention in which the system 10 is constructed so as to have an IC card 12 connectable to a terminal 16 via a card reader writer 14, and a keyboard 18, a CRT display 20, a printer 22, and a floppy disk 24 connected to the terminal 16. The IC card 12 which is kept by the user is for carrying out such operations as the referencing of the key data that is known to the user alone and the storing of necessary data in, for instance, purchasing a merchandise. As the diagram for its functions shown in Fig.l indicates, the card 12 is composed of the parts for executing basic functions, such as an R W section 26, an encryption decryption section 28, and a password setting password collation section 30, and a supervisor 32 which supervises these basic functions. The R W section 26 has a function for reading the data from the data memory in the IC card 12 or for writing a data in the data memory.The encryption decryption section 28 is for carrying out the encryption for the data to be communicated in order to prevent leakage or falsification in such a case as Pransmitting a data from the terminal 16 to another terminal, or for carrying out the decryption of the encrypted data. The data processing there, is carried out in accordance with an encryption algorithm which has a sufficiently high encryption capability such as the data encryption standard DES . The password setting password collation section 30 is the section for memorizing the passnumber key data set up by the user, and gives a permission for the subsequent processing by carrying out the collation of the key data that is input after setting of the password.Further, the supervisor 32 interprets the function code or the function code supplemented by a code that is sent from the card reader writer, and causes the selection and execution of the required functions from among the basic functions. In order to accomplish these functions, the IC card is composed of, as shown by Fig.2, a CPU 34, a program memory 36, a data memory 38, an I O interface 40, and a contact section 42.The program memory 36 which consists of a mask ROM is for memorizing the programs of the CPU 34 that are equipped with subroutines in order to realize the various basic functions. The data memory 38 comprises a PROM and is divided into a plurality of zones A1, A2, ..., An with various kinds of access conditions assigned to separate zones, such as a zone from which read alone of the data is possible using an external equipment, a zone for which write alone is possible, a zone for which both of read and write are possible, a zone for which both of read and write are not possible, and a zone for which read and write are possible only after collating of the password is completed. These circuits are integrated in the form of an LSI 41 which is sealed hermetically in the card 12. It is arranged to be connectable to an external equipment only through the contact section 42.The contact section 42 has a total of eight terminals 46 such as those for power source, for inputting clock signals, for reset, and for inputting and outputting of data. The card reader writerl14 transfer function code data between the IC card 12 and the terminal 16. It possesses a function to decompose a macro instruction received from the terminal 16 into commands for IC card, and supplies the commands to the IC card 12 in succession. More specifically, the card reader writer 14 includes, as shown by Figs. 5 and 6, a transportation mechanism 48 which transports the IC card 12 that is inserted to the card insertion port 14a to a prescribed position, an IC card contact section 50 which makes an electrical contact with the contact section42 of the IC card 12 that is set at the prescribed position, a control circuit 52 which controls the device as a whole, and an I O interface 54 which transfers function code or data between the terminal 16. The terminal 16 is composed of a CPU 16a and a memory 16b as shown in Fig. 5, and in response to the user s demand which is input via the keyboard 18 determines selection and combination of function codes to be given to the card reader writer 14 by reading the required data processing programs that are memorized Dn the memory 16b or the floppy disk unit 24. The user receives the message from the terminal 16 via the CRT display 20 or the printer 22. Next, the operation of the system in accordance with the embodiment constructed as in the above will be described. As shown by Fig. 7, in a stationary state as represented by step 100 the terminal 16 is in the state which is waiting for a command from the user. As a command from the user is input, the terminal 16 analyzes the command step 102 and determines the selection of necessary functions and their sequence step 104 .When the sequence is determined the terminal 16 outputs necessary command function code to the card reader writer 14 step 106 . Then, the terminal 16 will remain in the state of waiting until it receives from the card reader writer 14 a response that indicates the completion of the processing required by the command step 108 . Upon receipt of a response, it judges whether it is a final response. If it is not a final response, it sends out again รก command to the card reader writer 14 in accordance with the sequence, and if it is a final response, it returns to the state of waiting for a command from the user step 110 . In step 120, when the card reader writer 14 is in a stationary state, it is in the state of waiting for a command from the terminal as shown by Fig. 8. When a command is input, it judges whether the IC card is in execution step 122 , and if it is found to be executing, it goes back again to the state of waiting for a command after outputting a response which indicates that it is a multiple command error to the terminal 16 step 124 . If the IC card is found to be not in execution, it judges the command from the terminal 16 to determine a set of command sequence to be given to the IC card 12 step 126 . Following that, it outputs the first command to the IC card 12 step 128 . Then, it goes to the state of. waiting for a response from the IC card 12 step 130 . When a response from the IC card 12 is received, it judges whether there still remains some commands to be given to the IC card step 132 , and if it is found that there are some, it returns to step 128 to repeat outputting of the command. Otherwise, it outputs a response to the terminal 16 step 134 . The command to be output from the card reader writer 14 to the IC card 12 has the format with prescribed bit length as indicated in Fig. 9, with a form which contains a function code alone as shown by Fig. 9a or a form which contains a function code augmented by a data as shown by Fig. 9b. In its stationary state, the IC card 12 is in the state of waiting for a command from the card reader writer 14 as shown byFig. 10 step 140 . When a command is input, it executes the basic functions in accordance with the command 142 and outputs the response to the card reader writer 14 step 144 . Then, it goes back to its original state of waiting. The response in this case is supplemented by the command that was input originally, to provide for a protective measure for the case where the sequence between the card reader writer 14 is disturbed. It should be noted as shown in the above embodiment that it is convenient to render the command system to be successively more macro as one goes upstream along IC card 12 card reader writer 14 terminal 16. With such an arrangement the preparation of application programs in the upstream will become very easy. Next, a concrete examples of operation of the system will be described. Figure 11 shows an example of credit card system. It is assumed here that the sequence for the credit card system for the terminal 16 has already been determined. The user first inserts his IC card 12 into the card reader writer 14. The card reader writer 14 outputs a signal that informs that an IC card 12 is inserted, to the terminal 16. Based on this, the terminal 16 urges the user to input his passnumber. When the user inputs the pass.lmber the terminal 16 outputs the passnumber and the password collation instruction to the card reader writer 14. The card reader writer 14 outputs the passnumber and the password collation instruction to the IC card 12. The IC card 12 executes the password setting password collation function to compare and refer the input passnumber with the passnumber memorized in its inside.When the result of the collation is affirmative, the IC card 12 outputs the response to the card reader writer 14. The card reader writer gives a permission to input, to the terminal 16. Based on this, the terminal urges the user to input the sum of purchase of merchandises. When the user inputs the sum of the purchase, the terminal 16 requests a list of past purchases from the card reader writer 14. This request command is given in the form of a macro instruction, and the card reader writer 14 outputs a read command to the IC card based on it. In response to this command the IC card 12 executes the R W function to outputs the data on the previous purchases that is memorized in its inside.The read command will remain in effect until the final response is received from the IC card 12, and the purchase list read during that time is held in the card reader writer 14.In this case, in order to avoid inputting of a plurality of commands in the inside of the IC card 12, care is to be taken that a next command is output after a response is returned. When the final response from the IC card 12 is received, the card reader writer 14 outputs the entirety of the purchase list to the terminal 16. The terminal 16 computes the balance to be applicable to the purchase for the IC card from the list, and outputs a write command for purchase sum to the card reader writer 14 only when the purchase sum is less than the balance. This command, too, is given as a macro instruction, and the card reader writer 14 outputs repeatedly the write command of data, to the IC card 12. The reason for repeating the writing of data is that a single write is not sufficient to write the entirety of the data.The IC card 12 executes the R W function in accordance with the command, and makes entry of the new purchase sum in the purchase list of merchandises. When the card reader writer 14 received the final response, the completion of inputting is informed to the terminal 16. The terminal 16 displays the balance on the CRT display 20, and outputs a message that indicates the end of the processing, completing the purchase of a merchandise by means of the credit card system. Next, an example of application of the IC card to the transfer system through bank will be described by referring toFig. 12. It will be assumed that the terminal 16 has already determined the sequence for the transfer system through bank.Form insertion of the credit card 12, through password collation, and up to input permission by the card reader writer 14 are carried out based on the procedure similar to the credit card system described in the above. Then, the terminal 16 urges the user to input necessary transfer data such as the bank account number of the payee, the bank account number of the payer, and the sum of transfer. When the user inputs the transfer data, the terminal 16 outputs an instruction for encrypting the transfer data to the card reader writer 14. This instruction is given in the form of a macro instruction, and based on this, the card reader writer 14 outputs to the IC card 12 an encrypted command supplemented by the transfer data. The IC card 12 executes the encryption decryption function, and outputs an encrypted data to the card reader writer 14.The card reader writer 14 stores the encrypted data in its inside until complition of the encryption of the transfer data. After the encryption of the transfer data, the card reader writer 14 outputs the encrypted data to the terminal 16 upon receipt of the final encrypted data. The terminal 16 transmits the encrypted data to the terminal for the other party bank via a circuit. In response to this, the terminal of the other party transmits a signal which acknowledges the receipt of the data, where the signal transmitted is an encrypted data too. When this data is received the terminal 16 outputs a decryption instruction along with the received data to the card reader writer 14. This instruction is also a macro instruction so that the card reader writer 14 outputs continuously the decryption instruction, to the IC card 12. Based on the instruction the IC card 12 executes the encryption decryption function in its inside, and outputs the decrypted data obtained to the card reader writer 14. Upon receipt of the final decrypted data, the card reader writer 14 outputs the entirety of the decrypted data to the terminal 16.Then, in order to keep a documentary evidence in the inside of the IC card 12, the terminal 16 outputs the transfer data and the received data along with a write command, to the card reader writer 14. The command is also a macro command, and the card reader writer 14 outputs continuously the write command to the IC card 12. The IC card 12 executes the R W function in its inside and stores the above data in its inside. Upon receipt of the final response from the IC card 12, the card reader writer 14 outputs a signal that indicates the completion of inputting to the terminal 16. The terminal 16 outputs the message that indicates the completion of transfer on the CRT display 20. With this, the transfer operation by means of the transfer system through bank is completed. In this manner, according to the present embodiment the software that determines the function selection and the processing sequence in the inside of the IC card 12, through the operation on the terminal 16, can be constructed at will by the provider of the service so that it is possible to meet a wide variety of data processing requirements. This becomes possible due to the circumstance that a plurality of basic functions are given to the IC card 12 and that an arrangement is made to permit a selective execution of these basic functions. These basic functions are not limited to those described in the foregoing so that the utility of the present invention can be increased greatly by arranging the functions to be applicable to all sorts of services and be of general use and basic character. It is to be noted that although the IC card is described in conjunction with the pocket size hermetically sealed electronic device, the present invention is not limited to a card like structure and may be applied to structures of block like or pencil like. Moreover, the hardware construction of the electronic device will also permit various modifications within the scope which does not deviate from the main contents of the invention.