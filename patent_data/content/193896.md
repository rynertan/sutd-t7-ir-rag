# IGNITION TIMING CONTROL METHOD AND APPARATUS FOR AN INTERNAL COMBUSTION ENGINE HAVING A PLURALITY OF CYLINDERS

## Claims
Steuerungsvorrichtung für den Zündzeitpunkt für eine Brennkraftmaschine mit einem oder mehreren Zylindern mit einem Klopfsensor 401 zum Erfassen einer Klopfbedingung im Motor Sensoren 40, 50, 60 zum Erfassen anderer Betriebszustände des Motors und Steuerungseinrichtungen mit Berechnungseinrichtungen 12 und Speichereinrichtungen 14, 16 zum Empfangen von Signalen von den Sensoren 40, 50, 60 , um einen Grundzündzeitpunkt des Motors zu bestimmen und um ein Zündzeitpunktsteuerungssignal zu erzeugen, wobei gemäß dem Zündzeitpunktsteuerungssignal der Steuerungseinrichtung der Primärstrom einer Zündspule an und ausgeschaltet wird, um ein Hochspannungszündsignal zu erzeugen, wobei die Steuerungseinrichtung eine Steuerungsfunktion aufweist, gemäß der der Grundzündzeitpunkt um einen vorbestimmten Betrag verzögert wird in Übereinstimmung mit einem durch erste Vergleichseinrichtungen erfaßten Klopfen, wenn ein Klopfsignal mit einem ersten Entscheidungspegel während des Zündvorganges zum Grundzündzeitpunkt verglichen wird, sowie eine andere Steuerungsfunktion, gemäß der der verzögerte Zündzeitpunkt schrittweise auf den Grundzündzeitpunkt zurückgestellt wird in Übereinstimmung mit einem Klopfen, das während eines Zündvorgangs zu einem Zündzeitpunkt, der in bezug auf den Grundzündzeitpunkt verzögert ist, erfaßt wurde,

## Description
The present invention relates to an ignition timing control apparatus for gasoline engines as referred to in the main claim of the present invention. Such an apparatus is known from FR A25 50 825. It discloses an ignition timing control apparatus for an internal combustion engine having one or more cylinders comprising a knock sensor for detecting a knocking condition in an engine sensors for detecting other operating conditions of said engine and control means including computing means and memory means for receiving signals from said sensors to determine a basic ignition timing of said engine and generate an ignition timing control signal whereby in accordance with said ignition timing control signal from said control means a primary current in an ignition coil is switched on and off to enerate a high voltage ignition signal, said control means having a control function of retarding said basic ignition timing a predetermined amount in accordance with a knock detected during an ignition operation at said basic ignition timing and another control function of gradually restoring said retarded ignition timing to said basic ignition timing in accordance with a knock detected during an ignition operation at an ignition timing retarded from said basic ignition timing. These types of knock control devices are disadvantageous in that the variations in knocking characteristics among the cylinders are not accomodated and the desired engine performance is not ensured fully. EP A 47 394 discloses an ignition timing control apparatus for an internal combustion engine comprising a knock sensor for detecting a knocking condition in an engine sensors for detecting other operating conditions of said engine and control means including computing means and memory means for receiving signals from said sensors to determine a basic ignition timing of said engine and generate an ignition timing control signal whereby in accordance with said ignition timing control signal from said control means a primary current in an ignition coil is switched on and off to generate a high voltage ignition signal, said control means having a control function of retarding said basic ignition timing a predetermined amount in accordance with a knock detected during an ignition operation at said basic ignition timing and another control function of gradually restoring said retarded ignition timing to said basic ignition timing in accordance with a knock detected during an ignition operation at an ignition timing retarded from said basic ignition timing. It is an object of the present invention to provide an ignition timing control apparatus for an internal combustion engine which overcomes the foregoing deficiencies in the prior art and is capable of always ensuring satisfactory engine performance and satisfactorily preventing the occurrence of knocking even if there are variations in knocking characteristics among the cylinders of an engine, so that the occurrence of knocking positively is always detected and the occurrence of knocking is satisfactorily prevented irrespective of the variations in knocking characteristics among the engine cylinders and the aging of the sensor. To accomplish the first object, in accordance with the invention the basic ignition timing of each cylinder is controlled in response to the knocking conditions in each cylinder. To accomplish the second object, in accordance with the invention the level of a detection signal corresponding to the detection of knock with no ignition timing retard is compared with the level of a detection signal generated at the retarded ignition timing so that when the level of the later is higher than the former, the knock detection level is corrected. Fig. 1 is a block diagram showing an embodiment of an ignition timing control apparatus according to the invention. Fig. 2 is a block diagram showing an embodiment of the input output interface according to the invention. Fig. 3 is a time chart for explaining the operation of the invention. Fig. 4 is a block diagram showing an embodiment of the knock detecting device. Fig. 5 illustrates a plurality of signal waveforms useful for explaining the operation of the knock detecting device. Fig. 6 is a general flow chart for the embodiment of the invention. Fig. 7 is a diagram showing an ignition timing control routine. Fig. 8 is a diagram showing a rotation synchronization routine. Fig. 9 is a timing chart for explaining the operation of the first embodiment of the invention. Fig. 10 is a diagram for explaining the operating regions according to the first embodiment of the engine. An ignition timing control apparatus for an internal combustion engine according to the invention will now be described in detail with reference to the illustrated embodiments. Referring to Fig. 1 illustrating an embodiment of the invention, a central processing unit or CPU 12 performs digital computations of various data such as the ignition timing of the engine. An ROM 14 stores an ignition timing control program and fixed data. An RAM 16 is a read write memory device. A back up RAM 17 is an RAM for holding the data even when the engine is stopped. The CPU 12 receives a signal from each of various sensors this embodiment uses a knock detecting device 30, a crank angle sensor 40, a load sensor 50, a water temperature sensor 60 and a load switch 80 through an input output interface circuit 20, so that in accordance with the program stored in the ROM 14 an ignition timing is computed on the basis of these signals and an ignition signal IGN is generated through the input output interface circuit 20. The ignition signal IGN is applied to a base 70 of a power transistor 74 through an amplifier 72 and the power transistor 74 is turned on. When the power transistor 74 is turned off, an ignition current is produced in the secondary winding of an ignition coil 76. Fig. 2 shows a detailed construction of a portion of the input output interface circuit 20 operatively associated with the ignition timing control. The crank angle sensor 40 applies position pulse signals POS to AND circuits 216 and 220. The crank angle sensor 40 also applies a reference crank angle signal REF to the reset terminal of a first counter register 210 and the set terminal of an R S flip flop 218. The first counter register 210 is responsive to the leading edge of the signal REF to start counting the signals POS through the AND circuit 216 and the R S flip flop 218 and the resulting count is applied to a comparator 206. The comparator 206 compares the count of the first counter register 210 and the ignition timing data ϑ The timing of starting current supply to the ignition coil 76 will now be described. In response to the set pulse generated from the comparator 206 to set an R S flip flop 222, a second counter register 212 starts the counting of position pulses POS through the AND circuit 220 and the resulting count is applied to a comparator 208. The comparator 208 compares this count and the value computed by the CPU 12 and stored in a dwell register 204 so that when the two are equal, a reset pulse is applied to the R S flip flop 214 and the R S flip flop 222 is reset. In response to the reset pulse, the R S flip flop 214 generates an output at its Next, the introduction of a knock signal KNCKP into the CPU 12 will be described. The knock signal KNCKP generated from the knock detecting device 30 is applied to a counter register 234 and a number of knock pulses proportional to the intensity of the knock produced are counted. The CPU 12 receives the count of the counter register 234 through a bus 18. The pulse count NP thus applied to the CPU 12 is the data corresponding to the knock intensity and it is used for the computation of an ignition timing correction amount. Fig. 3 is a timing chart showing the operation of the above mentioned circuits of Fig. 2. In Fig. 3, A shows a reference crank angle signal, B a position pulse signal, C the count of the first counter register 210, and C₁ the preset value in the advance register 202. D shows the output signal of the comparator 206 showing that the output signal is generated when the count of the first counter register 210 attains the preset value in the advance register 202. E shows the count of the second counter register 212, and E₁ the preset value in the dwell register 204. F shows the output of the comparator 208 which is the same in operation with the comparator 206, and G the Referring now to Fig. 4, there is illustrated a block diagram of the knock detecting device 30 which is responsive to the occurrence of knocking to generate a number of pulses corresponding to the intensity of the knock. In the Figure, a knock sensor 401 comprises a piezoelectric element to convert the knocking vibrations of the engine cylinder to an electric signal. The output signal V The knock signal passed through the band pass filter 403 is first half wave rectified by a half wave rectifier circuit 404 and then it is branched into two paths. Thus, one is amplified as a knock representative signal by a dc amplifier circuit 405 and the other is amplified as a discrimination level for knock detection by a dc amplifier circuit 407 after it has been smoothed by a smoothing circuit 406. A comparator 409 compares the two signals so that a knock detection signal is generated and applied to an I O circuit 410. Fig. 5 shows the signal waveforms generated at various points in the block diagram shown in Fig. 4. 1 shows the output waveform of the knock sensor 401, 2 the output waveform of the input processing circuit 402, 3 the output waveform of the band pass filter 403, 4 the output waveform of the half wave rectifier circuit 404, 5 the output waveform of the amplifier circuit 405, 6 the output waveform of the smoothing circuit 406, 7 the output waveform of the amplifier circuit 407, and 8 the knock detection signal KNCKP or the output waveform of the comparator 409. Fig. 6 shows a general flow chart of the ignition timing control apparatus according to the present embodiment. In the Figure, when an interrupt request 600 is generated, whether it is a reference REF or timer interrupt is determined by the interrupt request analytic processing of the next step 602. If it is the timer interrupt TIMER , tasks including an input signal A D conversion and engine speed inputting task 606 , a basic ignition timing and dwell time computing task 608 a digital input signal processing task 610 and a correction task 612 are performed. Fig. 7 shows an ignition timing and dwell time control routine corresponding to the task 608 in Fig. 6 and this routine computes a basic ignition timing ϑ First a basic ignition timing processing is performed at steps 701 and 702. At a step 703, the counter data for advancing after the ignition retard is determined. If the counter content is zero, it is determined that a given period of time e.g., a second has elapsed and a transfer is made to a step 706. Thus, an advancing data Δϑ On the contrary, if the counter data is not zero at the step 703, it is an indication that the given time has not elapsed and the advance data Δϑ Fig. 8 shows a rotation synchronization processing routine corresponding to a task 606 of Fig. 6. At a step 801, the counter data the number of pulses NP is inputted. After the inputting, the counter is cleared. At a step 802, the corresponding cylinder is discriminated and the knock discrimination level the number of pulses corresponding to the current cylinder is searched. This discrimination level is a function of the engine speed and load. At a step 803, the counter data NP and the searched knock discrimination level N At a step 805, in accordance with the current engine speed N and load L, corresponding one of the regions shown in Fig. 10 while the four regions are provided in accordance with the engine speeds N and loads L, they may be provided in accordance with only the speeds or the loads and alternatively a greater number of regions may be provided is discriminated and a maximum advance angle determining data α₁ is searched. At a step 806, the value NP of the counter is compared with a discrimination level N On the other hand, if the step 803 determines that NP N At a step 811, the basic ignition timing ϑ At a step 812, the current operating region Fig. 10 is searched and the maximum advance angle correction amount α₁ t corresponding to the region is obtained. At a step 813, the maximum advance angle ϑ At a step 814, the maximum advance angle ϑ As described hereinabove, the above basic ignition timing is corrected for each cylinder and this prevents the frequent occurrence of middle knock. Referring to Fig. 9 showing a timing chart for explaining the operation of this embodiment, if middle knock occurs at A in one cylinder operating at the basic ignition timing ϑ If middle knock occurs at B in the same cylinder in the same operating region, the advance angle is controlled at If middle knock occurs at C , the maximum advance angle is controlled at the following This control is performed in all the same manner on the ignition timing of the remaining cylinders. Thus, in accordance with this embodiment, the desired retard control of the basic ignition timing is provided for each cylinder in accordance with the occurrence of knocking in the cylinder thus enhancing the engine performance to the utmost extent while satisfactorily reducing the ill effects of knocking. As described hereinabove, in accordance with the invention, by virtue of the fact that the desired corrective control of the basic ignition timing is provided for each cylinder in accordance with the occurrence of knocking in the cylinder, there is easily provided an ignition timing control apparatus which overcomes the deficiencies in the prior art and is capable of always accurately providing the desired retard control of the ignition timing in accordance with the occurrence of knocking in each cylinder and ensuring full play of the engine performance.