# CHARGE PUMP CIRCUIT FOR A PHASE LOCKED LOOP

## Claims
Ladungspumpen Vorrichtung zum Erzeugen eines eine Differenz zwischen einem ersten Signal und einem zweiten Signal angebenden Ausgangssignals, mit einer über einen ersten Schaltungspunkt 12 und einen zweiten Schaltungspunkt 13 angeschlossenen Ladungsspeichereinrichtung 11 , einer Stromquelleneinrichtung 14 zum zuführen von Strom an einem dritten Schaltungspunkt 15 , und Schalteinrichtungen SW1,SW2, SW3,SW4 , die auf Steuersignale S1,S2,S3,S4 zum Steuern der Stromzufuhr von dem dritten Schaltungspunkt 15 zu dem ersten Schaltungspunkt 12 und dem zweiten Schaltungspunkt 13 reagieren,

## Description
The present invention relates to charge pump filters for converting timed logic events into an analog signal for use in control circuitry, such as phase locked loops. In the processing of information generally, it is often necessary to compare two different signals to accomplish a variety of purposes. The comparison may result in the generation of an error signal representing the difference between the two signals. Circuitry may then respond to the error signal to minimize this difference between the two signals or perform some other function based on this difference. For example, a phase detector is conventionally used to detect the difference in phase between two signals. The phase detector may be used in a phase locked loop that, among other components, includes a voltage controlled oscillator VCO whose output is a reference frequency signal having a frequency determined by an input control signal. The phase detector receives a stream of data pulse signals, together with the reference frequency signal, which is fed back from the VCO. Any difference in phase between a data pulse signal and the reference frequency signal results in the generation of a phase error signal that is filtered and then used to control the VCO in order to lock the reference frequency signal in phase with the stream of data pulse signals. Phase locked loops often incorporate digital or sequential logic phase detectors that generate digital signals corresponding to the difference in phase between the reference frequency signal and the data pulse signal. The digital output from the digital phase detectors typically must be converted to an analog signal for controlling the VCO. Thus, a charge pump may accompany the digital phase detector to convert the logic states of the phase detector into analog signals suitable for controlling the VCO. A theoretical discussion of prior art charge pumps can be found in Floyd M. Gardner, Charge pump Phase lock Loops , IEEE TRANSACTIONS ON COMMUNICATIONS, Volume COM 28, Number 11, Nov. 1980. Gardner discusses the operation of charge pump filters in the phase locked loop environment. One problem with prior art charge pump filters resides in the necessity to include at least two current sources, one to charge up the capacitor in the charge pump, and one to pull down the charge in the capacitor. Both of the current sources are required to match identically in order to avoid drift in the charge pump and the introduction of other errors because of unbalanced charge up and charge down. This problem is particularly acute in the implementation of a low order filter for a phase locked loop. The very low integration rates involved in low order charge pumps can be interfered with by mis matched current sources. In addition, prior art filters have been designed with a set bandwidth. However, for many applications, a variable bandwidth charge pump filter is desirable. When used as a phase detector, a difficulty arises in the prior art for many types of data pulse streams, such as MFM disk data, in which for a given period of the reference frequency signal from the VCO, no data pulse signals will occur. These missing data pulse signals can cause the phase detector to malfunction. A prior approach to preventing malfunction due to missing data pulse signals is to arm the phase detector only if a data pulse signal occurs and to disarm the phase detector if a data pulse signal does not occur during the bit time. This technique uses a time delay device which receives in real time the stream of data pulse signals and outputs to the phase detector delayed data pulse signals which are to be compared to the reference frequency signal of the VCO. The phase detector also receives in real time the stream of data pulse signals for arming purposes. Thus, in operation, the data pulse stream is fed to the input of the time delay device as well as to the phase detector. If a data pulse signal occurs, the phase detector is armed and then, a short time later, receives the same, but delayed, data pulse signal which had been delayed by the time delay device. This delayed data pulse signal is then compared with the reference frequency signal to produce the phase error signal. However, if no data pulse signal occurs during the bit time, the phase detector is not armed, so that it does not operate for phase detection purposes. One problem with the prior solution is the requirement of a time delay device. In addition to requiring a time delay device which may be expensive, the delay must be precise, so as to have the phase detector properly compare its two input signals. The realization of such a precision time delay is not always easily accomplished. Also, the delay should be equal to one half the cycle of the nominal frequency of the VCO. Therefore, if the nominal frequency of the VCO is to be changed, which may require using a different VCO in the phase locked loop, then a new time delay device may be needed in view of the requirement that the delay be equal to one half the cycle of the nominal frequency. Still furthermore, the arming and disarming of the phase detector has the disadvantage of causing the phase detector to change state between an operative or armed condition and a non operative or disarmed condition. A phase comparator including an integrator and threshold detector is disclosed in GB A 1523879. The integrator or charge pump circuit has a capacitor connected across a first node and a second node in a bridge circuit, and pairs of switches responsive to control signals for controlling the supply of current to the first node and the second node from a third node. The capacitor is charged to a predetermined threshold level, and then discharged using a separate dedicated switch. Attention is also directed to DE A 2706224 a circuit for scaling the current supplied by a constant current source , FR A 2503487 a differential amplifier producing an output signal in response to the voltage across a capacitor , Patent Abstracts of Japan Vol. 8 No. 8 E 221 1445 13th January 1984 an oscillator bridge circuit having a voltage controlled current source and a ground reference , and EP A 054322 a phase sensitive detector with a variable phase relationship between the data pulses and the clock pulses. The circuit described in the present application provides a low order charge pump filter having a single current source, an electronically variable bandwidth, and is operative whether or not a data pulse signal occurs during a given period. According to the present invention there is provided a charge pump apparatus comprising charge storage means connected across a first node and a second node, current source means for supplying current at a third node, and switching means responsive to control signals for controlling the supply of current to the first node and the second node from the third node characterised in that the same current source charges and discharges the charge storage means and the magnitude of the current supplied by the current source is substantially independent of the charge stored in the charge storage means. An amplifier means is coupled to the charge storage means for outputting an error signal proportional to the charge on the charge storage means. In a preferred embodiment, the switching means includes a first switch, a second switch, a third switch and a fourth switch. The first switch is connected from the first node to a reference voltage, such as V The low order charge pump is controllable to operate as a phase detector which is operable whether or not a data pulse signal occurs during a bit period. Furthermore, in one embodiment, a dynamically variable current source is included so that the bandwidth of the low order charge pump filter can be varied dynamically. In the accompanying drawings, by way of example only Figure 1 shows a charge pump apparatus 10 including a charge storage device C, such as a capacitor 11 connected between a first node 12 and a second node 13. Also included is a current source means 14 for supplying a current I Also included is a switching means 16, that includes four switches, SW₁, SW₂, SW₃ and SW₄ for controlling the supply of current at the first node 12 and the second node 13. The first switch SW₁ is connected from the reference V The differential voltage generated across the capacitor 11 is a bipolar analog signal on lines 17, the value of which is controllable by the switching means 16. The bipolar analog signal 17 can be supplied to a means 18, such as amplifier 19, for generating an output error signal S The charge pump apparatus 10 is controlled by control means 30 to function in three states. The control means 30 generates control signals 31 to set the state of the switching means 16. In the first state, switch one SW₁ and switch three SW₃ are closed, or alternatively switch two SW₂ and switch four SW₄ are closed. In this first state, the error signal S The second state, involves switch two SW₂ and switch three SW₃ being closed, while switch one SW₁ and switch four SW₄ are open. In this second state, the error signal S The third state involves switch one SW₁ and switch four SW₄ being closed while switch two SW₂ and switch three SW₃ are open. In this third state, the error signal S This three state charge pump apparatus 10 is suitable for use in a phase locked loop 100 as shown in Fig. 2. The phase locked loop 100 includes a digital phase detector 20 as the control means 30, which generates control signals on line 21, for controlling the charge pump apparatus 10. The charge pump apparatus 10 receives the digital control signals across line 21 to generate the error signal S The phase detector 20 generates control signals on line 21 in response to the difference in phase of the reference frequency signal f Fig. 3 is used to illustrate the switching sequence of the charge pump apparatus 10 for use with a phase locked loop apparatus 100. The reference frequency signal f The data stream f The second condition 102 involves a period of the frequency pulse signal f The third condition 103 involves a data pulse signal 40 which is received during the second half cycle of the frequency pulse signal f The bandwidth of the charge pump apparatus 10 can be varied by varying I Fig. 4 shows a detailed circuit diagram of a charge pump apparatus 10 which is operable over a wide range of frequencies. The particular implementation, shown in Fig. 4, is suitable for manufacture as an integrated circuit. The charge pump apparatus 10 in Fig. 4 operates as a low order charge pump filter in a phase locked loop that is controllable to receive data streams f The apparatus 10, shown in Fig. 4 includes the capacitor 11 connected across the first node 12 and the second node 13. First switch SW₁ is implemented with transistor 50, having its emitter connected to the first node 12, and its collector connected to the reference voltage V The second switch SW₂ is implemented with transistor 51, having its emitter connected to the second node 13 and its collector connected to the reference voltage V The third switch SW₃ is implemented with transistor 52 having its emitter connected to the third node 50 and its collector connected to the second node 12. The base of the transistor 52 is connected to the logic signal S3 for controlling the state of switch three SW₃. The logic signal S3 is a voltage that varies the level of the base of transistor 52. The fourth switch SW₄ is implemented with transistor 53, having its emitter connected to the third node 15, and its collector connected to the second node 13. The base of transistor 53 is connected to the logic signal S4 for controlling the state of switch four SW₄. The logic signal S4 is a voltage for controlling the level of the base of transistor 53. The current source means 14, in the embodiment shown in Fig. 4, includes a first variable current source 54 and a second variable current source 55. The first variable current source 54 and the second variable current source 55 supply current to the third node 15. The sum of the currents from the first variable current source 54 and the second variable current source 55 is equal to I A first variable current source 54 and a second variable current source 55 are used in the implementation in Fig. 4 in order to accomplish a frequency response which is suitable for both floppy disks and hard disks. When operating in the floppy disk mode, the second variable current source 55 is enabled, while the first variable current source 54 is disabled by floppy hard clamp 56. Floppy hard clamp receives control signals FL and HD indicating the desired state of operation of the apparatus 10. When in the floppy mode FL, the floppy hard clamp 56 disables the first variable current source 54. However, while in the hard disk mode HD, a higher I A current scaling means 57 operates to scale I The emitter follower transistors 60 and 61 operate to provide base current for transistors 59, 62, and 63 while minimizing drain from the current ICO. Transistors 62 15X and 63 1X are current mirrors of transistor 59. The emitter resistors of each transistor 59, 62 and 63 are 9.3k 32, 9.3k 15 and 9.3k, respectively. Thus the current flowing through the collector of transistor 62 will be 15 32 ICO and the current flowing through the collector of transistor 63 will be 1 32 ICO. Accordingly, 15 32 ICO is flowing on line 64 and 1 32 ICO is flowing on line 65. The first variable current source 54 thus receives 15 32 ICO through the collector of transistor 66 20X . This causes 1 20 of the current on line 64 1 20 15 32 ICO to flow through the collector of transistor 67 1X connected in current mirror relationship with transistor 66, which supplies current to the third node 15. In a similar manner, the current flowing through line 65 is caused to flow through the collector of transistor 68 20X . This causes, through the current mirror effect, 1 20 of the current on line 65 1 20 1 32 ICO to flow through the collector of transistor 69 1X , which feeds the third node 15. Thus in the hard disk mode, with both the first variable current source 54 and the second variable current source 55 enabled, the current flowing at the third node 15 is equal to the sum of 1 20 15 32 ICO plus 1 20 1 32 ICO . In the floppy disk mode, the floppy hard clamp 56 clamps the current from line 64 to disable the first variable current source 54. Thus in the floppy disk mode, the current supplied to the third node 15 is equal to the current supplied to the second variable current source 55, or 1 20 1 32 ICO . In sum, the current scaling means 57, allows the charge pump apparatus 10, shown in Fig. 4, to operate in a low frequency, or floppy disk, range and a high frequency, or hard disk, range. Furthermore, in both the floppy disk range and the hard disk range, by varying the value of ICO, precise dynamic control of the bandwidth of the charge pump apparatus 10 is attained. In the embodiment shown in Fig. 4, the output is supplied as a differential signal across lines 17 and 17 . The differential signal across lines 17 , 17 is supplied by a differential amplifier means 70, which includes a two stage differential amplifier circuit. The first differential amplifier stage includes transistor 71 and transistor 72 having their emitters coupled across a resistor 73. Transistor 71 receives the voltage from the first node 12 through emitter follower transistor 74. Likewise the transistor 72 receives the voltage from the second node 13 through emitter follower transistor 75. The difference in voltage in the first node 12 and the second node 13 is translated into a differential current through the collector resistors 76, 77 and the collectors of transistor 71 and transistor 72, respectively. A higher voltage at the first node 12, than at the second node 13 will result in a higher current through the collector resistor 76 than through the collector resistor 77, and visa versa. The voltage at the collector of transistor 71 from the first differential amplifier stage is supplied through an emitter follower transistor 78 to the transistor 79 of the second differential amplifier stage. Similarly, the voltage at the collector of the transistor 72 from the first differential amplifier stage is supplied through an emitter follower transistor 80 to the transistor 81 of the second differential amplifier stage. The emitters of transistor 79 and 81 of the second differential amplifier stage are coupled across resistor 82. The emitters of the transistor 71 and 72 of the first differential amplifier stage are connected to identical current source transistors 83 and 84, which are biased to provide a small driving current to the first differential amplifier stage. The emitters of transistors 79 and 81 of the second differential amplifier stage are connected through current source transistors 85 and 86, respectively, and current source resistors 87 and 88 respectively to ground. The current source transistors 85 and 86 are referenced to V The charge pump apparatus 10, shown in Fig. 4, also includes biasing means 89, for maintaining the base of the transistors 50 and 51 at an acceptable bias point. This enables the apparatus to switch over small switching voltages, less than an ECL voltage swing, thus minimizing feed through to the capacitor 11. Thus a third differential amplifier stage, made up of transistors 90 and 91 having their emitters coupled across resistor 92 and being driven by current source transistors 93 and 94 respectively, is included. The third differential amplifier stage receives voltage from the emitter follower transistors 78 and 80 and is effective to generate currents through the collectors of transistors 90 and 91 that is proportional to the difference in voltage at the emitters of transistors 78 and 80. The higher the voltage at the node 12, the lower the current drawn through the collector transistor 90. Likewise, the lower the voltage at the node 13, the higher the current drawn through the collector of transistor 91. The current from the collector of transistor 90 is supplied to draw current through the resistor 95. Likewise, the current from the collector of transistor 91 is supplied to draw current through resistor 96. A smaller current through transistor 95 will result in a higher bias level for the base of transistor 50, corresponding to the higher level of the node 12. A larger current through resistor 96 results in a lower bias level for the base of transistor 51, corresponding to the lower bias level of the node 13. In this manner the first switch SW₁ and the second switch SW₂ are maintained in proper bias for switching by a logic current signal S1, S2. In sum, the apparatus 10 shown in Fig. 4 is an integrated circuit comprising a low order charge pump phase detector suitable for use in phase locked loop apparatus. In the preferred implementation, the differential current supplied across line 17 , 17 is summed with the output of a high order charge pump phase detector to provide a preferred response for the phase locked loop. One suitable high order phase detector and filter is described in the related U.S. patent application entitled IMPROVED PHASE DETECTOR AND PHASE LOCKED LOOP APPARATUS, filed in conjunction herewith, invented by Neil R. Adams, and owned by an assignee in common with the present application. Fig. 5 shows a logic circuit 100 used as control means 30 for generating the control signals S1, S2, S3, and S4 for controlling the charge pump apparatus shown in Fig. 4. The control signals S1, S2, S3, and S4 are generated in response to the difference in phase between a reference frequency signal f The control means 30 includes a first AND gate 101 which supplies an output A on line 102. Also, the first AND gate 101 supplies the complement of A, designated B, on line 103. The first AND gate 101 receives as input the reference frequency signal f Also included is a second AND gate 102 receiving the data stream f A third AND gate 105 receives the complement of the reference frequency A fourth AND gate 109 receives as input across line 110 the output G of a flip flop 111 described below and across line 112 the negative output I from the flip flop 106. The fourth AND gate 109 generates the signal E across line 115. A fifth AND gate 113 receives the signal G across line 110 output by the flip flop 111 and the reference frequency signal f The flip flop 111 is clocked by the signal D from the third AND gate 105 across line 108. The flip flop 111 is reset by the signal E from the fourth AND gate 109 across line 115. The D input to the flip flop 111 is set at a constant high value so that each time the signal D goes from low to high, the output signal G on line 110 is set to a high value. The flip flop 106 receives as its D input the signal A across line 102. The flip flop 106 is clocked by the signal C across line 104. The flip flop 106 is reset by the signal F across line 114. The flip flop 106 generates the signal H across line 107 and its complement I across line 112. The logic circuit 100 includes a delay means 116 which receives the signal A across line 102 and generates a signal J on line 117 which is equal to A but delayed slightly so that the signal is synchronized with the output of the flip flops 111, 106 and, as next described, 118. The flip flop 118 receives as its D input the signal B over line 103, is clocked by the signal C over line 104, and is reset by the signal A over line 102. The flip flop 118 generates the signal K over line 121. The signals H and J across lines 107 and 117, respectively, are received by a first exclusive OR gate 119 which generates an output signal L across line 120. Likewise, the signals J and K across lines 117 and 121, respectively, are received by a second exclusive OR gate 122 which generates an output signal M across line 123. The output signal L across line 120 is received by an output signal driving circuit 124 which comprises a current switch which supplies a current S1 on line 125 and S2 on line 126. When the logic signal L swings high, the current S1 on line 125 swings low, which causes the first switch SW₁ to turn on, as can be seen with reference to Fig. 4. Likewise, the signal S2 is provided as the complement of S1, causing the switch SW₂ to turn off. The signal M across line 123 is supplied to an output voltage driving circuit 127 which generates a voltage signal S3 across line 128 and a voltage signal S4 across line 129. When the level of the signal M swings high, the signal S3 swings high causing the switch SW₃ to turn on. Conversely, the signal S4 is the complement of S3, so the switch SW₄ turns off. The operation of the logic circuit 100 of Fig. 5 is explained with reference to the timing diagram of Fig. 6. In the timing diagram of Fig. 6, the short delays occasioned by the components of the logic circuit 100 are ignored for the purpose of simplicity. Fig. 6 shows the reference frequency signal f The signal A on line 102 is high during the positive half cycle of the reference frequency signal f The signal B is a complement of the signal A as shown at line 206. The signal C as shown at line 207 is high only during a data pulse and low for the rest of the time. The signal D shown at line 208 goes high only during the second half cycle of the reference frequency signal f When the signal D goes high, the flip flop 111 is clocked across line 108 causing the output signal G on line 110 shown at 210 to go high. The signal E goes high only when the signal G on line 110 and the signal I on line 112 are high. The signal I shown at 211 is a complement of the signal H and thus remains low until the flip flop 106 is reset. When the signal E goes high as shown at 212, the flip flop 111 is reset causing the signal G to go low. Signal F resets the flip flop 106 when the signal G is high during the first half cycle of the reference frequency signal f As explained above, the signal J on line 117 equals the signal A across line 102 except delayed by the delay means 116 so that it is in time with the output of the flip flops. Signal J is shown at 214 in Fig. 6. The signal K is operable to be high only after a data pulse signal is received during the negative half cycle of a reference frequency signal until the end of the second half cycle. Signal K is shown at 215 in Fig. 6. The D input on line 103 of the flip flop 118 is the B signal that is high only during the second half cycle of the reference frequency signal f The signal L is high only when the signals H and J are different and low when they are the same. Thus the signal L for the first condition 202, in which the data pulse signal is received during the first half cycle of the reference frequency signal f In the third condition 204, a data pulse signal is received during the second half cycle of a given period of the reference frequency signal f The signal M shown at 217 in Fig. 6 is high only when the signals J and K are different and low only when the signals J and K are the same. Thus the signal M, during condition 202 in which a data pulse signal is received during the first half cycle of the reference frequency signal f Thus the signals L and M on lines 120 and 123 define the state of the switches SW₁, SW₂, SW₃ and SW₄ so that the switching means 16 is controlled to be in the first state, the second state, or the third state as shown in Fig. 3. As mentioned above, it is desirable in some embodiments that while in the first state, the switching means alternates between the condition of having SW₁ and SW₃ closed while SW₂ and SW₄ are open to a condition of having SW₂ and SW₄ closed while SW₁ and SW₃ are open. The logic circuit 100 shown in Fig. 5 accomplishes this. Thus the first state occurs when both L and M are high or when both L and M are low. When both L and M are high, SW₁ and SW₃ are closed or turned on while SW₂ and SW₄ are turned off. When both L and M are low, SW₂ and SW₄ are turned on while SW₁ and SW₃ are turned off. The second state occurs when L is high and M is low. This causes SW₂ and SW₃ to turn on while switches SW₁ and SW₄ turn off. The third state occurs when L is low and M is high. This causes switches SW₁ and SW₄ to turn on while switches SW₂ and SW₃ turn off. Thus it can be seen that the signals L and M shown in Fig. 6 will generate the state sequence shown in Fig. 3. The above circuits provide a low order charge pump filter which operates with a current source means supplying current at a single node, thereby eliminating the need for current source matching of the prior art. Furthermore, the charge pump filter 10 is operable over a wide mange of frequencies by varying the reference current I The foregoing description of a preferred embodiment of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed, and obviously many modifications and variations are possible in light of the above teaching. The phase locked loop embodiment was chosen and described in order to best explain the principles of the invention and its practical application to thereby enable others skilled in the art to best utilized the invention in various embodiments and with various modifications, as are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the claims appended hereto.