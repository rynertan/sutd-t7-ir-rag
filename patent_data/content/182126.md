# DIRECTING STORAGE REQUESTS DURING MASTER MODE OPERATION

## Claims
Speichersteuereinheit 11 bei einem Datenverarbeitungssystem, enthaltend einen Datenspeicher einschließlich eines ROS Speichers 12 und eines RAM Speichers 13 , einen Prozessor 14 der Anforderungen, welche entweder Lade oder Speichervorgänge erfordern, durch die Steuereinheit und ein Adressiermittel in der Steuereinheit an den Datenspeicher sendet, um jede dieser Anforderungen an eine Stelle in dem ROS Speicher oder in dem RAM Speicher zu leiten, die durch eine jeder der Anforderungen entsprechenden Adresse identifiziert ist

## Description
The present invention relates to data processing systems and more particularly to data processing systems having a central processing unit with a plurality of storage units and or I O devices sharing a common system bus. It is a common practice in state of the art data processing systems, including those using microprocessor technology, to employ a common data bus for enabling communication between a central processor and a plurality of storage and or I O devices. Such I O devices include disks, displays, and printers. A plurality of controllers enables communication between the central processing unit and the I O devices or storage units using the common bus. The plurality of controllers are connected to such bus with each controller interfacing between one central processor and at least one storage or I O device. An address containing an identifier is sent from the central processing unit to the address indicated by the identifier. Such identification is required because all of the plurality of controllers access the same bus. Each of the plurality of controllers contains an address comparator, for comparing the identifier in the address sent, to a controller identifier contained within the controller. When the two identifiers match, then the address containing the identifier sent from the central processing unit is accepted by that particular controller. In order to enable such identification in present day controllers, the address comparators are usually hard wired with a particular identifier so that the identifier associated with a particular controller is fixed and cannot be modified. This fixed identification enables the address comparator within a given controller to readily identify and accept the address sent to it from the central processing unit. A system having programmable address comparators may provide the user with considerable flexibility. However, such a system presents significant problems in the initialization phase of the system during which the system is brought on line after the power has been turned on. In conventional systems, such initialization involved having the central processing unit CPU access an initialization program, usually a read only program stored in a storage unit. Usually such an initialization program was stored in one of the storage units, and subsequent to powering on, the central processing unit would access the appropriate storage unit through its controller by sending an address containing the identifier segment which matched the appropriate controller identifier which had already been hard wired into the controller. The CPU would then carry out the accessed program. however, in a system having programmable address comparators, there could be no hard wired identifier associated with any controller since the identifiers had to be loaded during the initialization of the system. During the initialization phase, there can be a problem when the initialization program IPL is stored in a read only storage. such a problem has been solved in the article Read only storage random access memory mode change published in the IBM Technical Disclosure Bulletin, vol 21, n This initialization problem has been solved in accordance with the European patent document EP A 0 182 044 Inventor Wright Charles G. entitled Initialization apparatus for a data processing system with a plurality of input output and storage controller connected to a common bus . In this latter application, initialization apparatus is provided for accessing a stored initialization program through a selected controller. Such selected controller interfaces with a read only initialization program stored in a storage unit with the one selected controller operating as a master controller. Means are contained in such master controller which are selectively activated during initialization so as to enable such master controller to accept all addresses sent from the CPU regardless of the identifier associated therewith. Further, means are provided in each of the other controllers which are also selectively activated during initialization for disabling the programmable comparison means in each of said other controllers so that no addresses are accepted by these other controllers during initialization. A related problem not addressed by the previously referenced document relates to where the storage controller directs storage requests, at system initialization, from the CPU while operating in the mode described in said document EP A 0 182 044. In the processing system previously described, there is usually a processor, a storage controller with a read only storage ROS and a random access memory RAM attached thereto. The system may also include a channel converter with an I O device such as a hard file, soft file, or local area network attached thereto. Some processing systems may have the initialization program code in ROS from which the processor starts fetching instructions after the system is powered on. Other systems may have initialization code that needs to be loaded from an I O device known as an IPL device into RAM before the processor begins fetching instructions. Before the address comparators are initialized, the storage controller must have the capability to direct the instruction fetches to ROS or direct the initial program load to RAM. After the address comparators have been initialized, they will direct all storage requests to ROS or RAM, as is appropriate. An example of initializing a digital computer is shown in U.S. Patent 4,030,073. However, this patent does not provide any guidance on how to initialize one or more storage controllers that have programmable address comparators and an IPL device. Accordingly, it is an object of this invention to provide an improved data processing system having a central processing unit sharing a common bus with at least one storage and or I O device whose access on such bus is controlled by a storage controller. In accordance with the objects of the invention, there is disclosed a data processing system wherein a processor sends requests requiring either load or store operations to a data memory ROS or RAM, through a storage controller including addressing means for directing each request to a location of the memory identified by an address corresponding to each request. The addressing means is a programmable address comparator becoming operative upon being initialized by being provided with a reference address range used by the processor to send the requests to the data memory. The controller comprises first means for directing the first one of the requests to a location in the ROS storage if this first request requires a load operation, and to a location in the RAM storage if this request requires a store operation, while the programmable address comparator is not operative, and second means for directing the remainder of the requests to the location in the ROS or RAM storage to which the first one of the requests was directed, until the programmable address comparator is operative. Fig. 1 is a block diagram of a data processing system having a storage controller and a channel converter according to the present invention. Fig. 2 is a state machine diagram detailing the direction of storage requests to either ROS or RAM. Fig. 3 is a flow diagram of the operation of a data processing system according to the present invention. Referring now to Fig. 1, there is shown a data processing system including a storage controller 11 with a read only storage ROS 12 and a random access memory RAM 13 attached thereto. Processor 14 communicates with storage controller 11 over processor bus 15. The system further includes a channel converter 19 for interfacing I O channel 22, including initial program load IPL device 23, with processor bus 15 using line 20. An IPL READY signal is sent over lines 16 and 17 to storage controller 11 and channel converter 19, respectively. An IPL COMPLETE signal is sent from channel converter 19 over line 21 to processor 14. Processor 14 activates the IPL READY signal when it is ready to start fetching instructions after powering on and waits until the IPL COMPLETE signal is sent by channel converter 19 before instruction fetching begins. Storage controller 11 contains programmable address comparators not shown for directing storage requests from processor 14 sent thereto. After these programmable address comparators have been initialized, any storage requests from processor 14 are sent to the appropriate storage location, indicated by the address associated with the request, which interfaces with storage controller 11. Such location may be either in ROS 12 or RAM 13. However, prior to initialization of the programmable address comparators, storage controller 11 must direct these storage requests from processor 14 to the appropriate one of either ROS 12 or RAM 13, depending on the first request received after the system has been powered on. The operation of storage controller 11 with respect to this latter function will be explained in more detail hereinafter. Channel converter 19 enables the interfacing of I O devices, such as IPL device 23, on I O bus 22 with processor bus 15. IPL device 23 may contain an initialization program which is loaded into RAM 13 at the time the system is powered on. The initialization program may also be permanently stored in ROS 12. Such initialization program contains, among other data, the information needed to program the address comparators contained within storage controller 11. IPL device 23 can be, for example, a hard file, a soft file, or a local area network. The initial program load at the time of system initialization can also occur from a serial port on storage controller 11 as is indicated in Fig. 1. The state of the data processing system shown in Fig. 1 at any given time is detailed in Fig. 2. State 24 indicates that the system is awaiting the first storage request from processor 14. The system will remain in this state, as indicated by arrow 30, until the first storage request is made. If the first request made is a store, as indicated by signal 27, then the next state that the machine takes is RAM IPL 28 which indicates that RAM 13 is to be loaded with the IPL code in IPL device 23. Arrow 31 indicates that the system stays in RAM IPL state 28 until something occurs which forces the system out of this particular state. Likewise, if the first storage request is a load, as indicated by signal 25, then the system enters ROS IPL state 26 which indicates that the IPL code is read from ROS 12. The system stays in this latter state, as shown by arrow 29, until something happens which forces the system out of this state. Signal 32 indicates that the address comparators in storage controller 11 have been initialized with addresses located in ROS 12. As a result, the system enters the hold ROS state 33 whereby instructions are fetched from ROS 12 to Processor 14 according to the address contained within the storage request from processor 14. Arrow 35 indicates that the system remains in hold ROS state 33 until IPL READY signal 34 is issued causing the system to move to ROS IPL state 26. In operation, processor 14 dispatches IPL READY signal 34, on lines 16 and 17, to storage controller 11 and channel converter 17. This IPL READY signal 34 is sent after the system is powered on and also after processor 14 is restarted after a stoppage. Such a stoppage may be caused for system debugging purposes. The issuance of IPL READY signal 34 over lines 16 and 17 indicates that processor 14 is ready to begin fetching instructions. However, the instruction fetching does not begin until an IPL COMPLETE signal is sent over line 21 from channel converter 19 to processor 14. The IPL COMPLETE signal indicates to processor 14 that IPL device 23 has completed loading of the initialization program into RAM 13. Returning now to Fig. 2, hold RAM state 37 is attained after signal 36 indicates that the address comparators within storage controller 11 have been written with the addresses contained within RAM 13. As shown by arrow 38, the system remains in the hold RAM state 37 until IPL READY signal 39 is sent over lines 16 and 17 to storage controller 11 and channel converter 19, respectively. As previously indicated, after issuing an IPL READY signal, processor 14 does not begin fetching instructions until an IPL COMPLETE signal is sent from channel converter 19 over line 21 to processor 14. After RAM 13 has been successfully loaded with the initialization program from IPL device 23, channel converter 19 sends IPL COMPLETE signal over line 21 to processor 14. Processor 14 can then begin instruction fetching from RAM 13. If the system has no IPL device and instruction fetching is to occur from ROS 12, then line 21, which indicates IPL COMPLETE, can be held active so that processor 14 will start instruction fetching immediately after it activates IPL READY signal 34 on lines 16 and 17. The flow diagram shown in Fig. 3 details the operation of the system shown in Fig. 1. When a storage request is sent from processor 14, a decision must be made, as shown in decision block 41, as to whether or not this request is the initial storage request. If the request is the first request, then as indicated in block 44, a decision must be made as to whether or not this is a load or a store request. If the first request is a store, then the IPL code must be loaded into RAM 13 as indicated in block 45. However, if the first request is a load, thus indicating that the IPL code is in ROS 12, then as shown in block 46, storage controller 11 may begin directing the storage request to its appropriate location in ROS 12. At the completion of the loading of the IPL code into RAM 13, storage controller 11 directs the storage request to RAM 13. This is also shown by block 46. At this time, processor 14 may begin fetching instructions as indicated in block 47. If the storage request were not the initial one, then a subsequent decision must be made as to whether or not the address comparators within storage controller 11 have been initialized. If the address comparators have not been initialized, then the no branch of decision block 14 directs operation to block 46, which directs the storage request to the appropriate one of either ROS 12 or RAM 13 depending on whether or not the initial storage request was a load or a store. As indicated previously until the address comparators are initialized, all subsequent storage requests will be sent to the same one of either ROS 12 or RAM 13 that the first storage request was sent to. If the yes branch of decision block 42 is reached, then as shown in block 43, the address comparators within storage controller 11 direct the fetching of instructions from their appropriate location in either ROS 12 or RAM 13. The address comparators within storage controller 11 direct the storage request to its appropriate address location. It will be recognized that the present invention may be embodied in a system, in either hardware or software, having a storage controller with programmable address comparators that power on or reset to uninitialized values.