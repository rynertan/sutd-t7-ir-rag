# MULTIPLE FREQUENCY DIGITAL PHASE LOCKED LOOP

## Claims
Digitale Mehrfrequenz Phasenverriegelungsschleife DPLL zum Verarbeiten eines erhaltenen Signals und zum Erzeugen eines Ausgangssignals, das mit dem empfangenen Signal phasenverriegelt ist, mit

## Description
This invention relates to the field of digital phase locked loops and specifically to an improved digital phase locked loop in which the operating center frequency of the circuit can be programmably altered without altering the frequency divider ratio within the feedback portion of the digital phase locked loop. The conventional digital phase locked loop is coupled to a clock signal which provides a reference operating frequency and is typically divided to the exact operating frequency of the loop. In addition to a frequency divider, the conventional digital phase locked loop circuit comprises a phase comparator and a phase compensation network. In operation, the divided operating frequency is coupled to the phase comparator, which compares the phase of the divided operating frequency with the phase of a received data signal. The phase comparator instructs the phase compensation circuit to adjust the phase of the divided clock by advancing or delaying the phase of the divided clock signal. A digital phase locked loop of this type is shown and described in U.S. Patent 3,983,498 by Malek entitled, Digital Phase Locked Loop and assigned to the assignees of the present invention. J.P. Gouyet in A High Precision Phase Lock Loop , Conference on Frequency Generation and Control for Radio Systems, London, 22 24 May 1966, pp. 129 133, discusses the use of bidirectional counters to accumulate signed phase locked loop phase error and convey phase correction information to the remainder of the loop. Digital phase locked loops of this type are satisfactory for single frequency phase locked loop operation, however, implementing a loop capable of multiple frequency operation usually requires complex circuitry. Some conventional phase locked loops implement multiple frequency operation by coupling a programmable divider between the reference frequency source and the clock input of the loop. This technique severely limits the operating range of the phase locked loop and for small frequency shifts, divider ratios become impractical if not impossible. Furthermore, digital phase locked loops of this type are of limited utility as tone detectors because of prohibitive divider ratios required for fine frequency shifts. Accordingly, the present invention seeks to provide a multiple frequency digital phase locked loop which can be implemented without disturbing the phase locked loop feedback divide ratio. According to one aspect of the present invention there is provided a multiple frequency digital phase locked loop DPLL for processing a received data signal and producing an output signal which is phase locked to the received data signal, comprising A corresponding method of effecting phase and frequency adjustments is set out in Claim 4. Figure 1 is a block diagram of the multiple frequency digital phase locked loop of the present invention. Figure 2a is an electrical schematic of the programmable divider, the phase comparator, and the phase and frequency adjust network of the multiple frequency digital phase locked loop of Figure 1. Figure 2b is an electrical schematic of the digital phase locked loop frequency divider and lock detector circuit of Figure 1. Figure 3a is a timing diagram detailing the operation of the frequency adjustment portion of Figure 2a. Figure 3b is a timing diagram detailing the operation of the phase adjustment portion of Figure 2a. Figure 3c is a timing diagram detailing the operation of the lock detect circuit of Figure 2b. Figure 1 shows a block diagram of the multiple frequency digital phase locked loop DPLL 10, constructed in accordance with the present invention. The digital phase locked loop comprises a phase and frequency adjust network 12 which is coupled to a digital divider 16, a bandwidth control 20, an AND gate 30 and an input clock terminal 14. The bandwidth control 20 is also coupled to a phase comparator 18. The phase comparator 18 accepts inputs from the output of the digital divider 16 as well as the received data signal. In operation, a reference clock signal from a signal source is coupled to the phase and frequency adjust network 12 through terminal 14. The reference clock signal is additionally coupled to digital divider 26 and the programmable digital divider 28. The phase and frequency adjust network 12 generates a shifted clock signal from the reference clock signal, and generates frequency shifts by selectively adding or subtracting the reference clock signal and the shifted clock signal at a rate determined by the programmable clock from signal AND gate 30, which is controlled by programmable signals Y, and Z. The phase and frequency adjust network also effects frequency shifts as directed by a programmable control signal X, as well as the signals generated by the bandwidth control 20. The phase and frequency adjust network 12 provides a composite clock signal E which is coupled to digital divider 16. The digital divider 16, frequency divides the composite clock signal E and provides the output signal of the digital phase locked loop. The output of digital divider 16 is coupled to one input of the phase comparator 18. A second input of phase comparator 18 is coupled to a received data signal. The phase comparator provides a signal which is related to the relative phase of the output of the DPLL and the received data signal. If the DPLL output signal and the input data signal are not exactly in phase, an output is indicated. The operation of the phase comparator will be discussed in more detail later. The multiple frequency digital phase locked loop is additionally provided with two frequency dividers 26 and 28 which are coupled between the clock input 14 and an AND gate 30. The digital divider 28 accepts programmable inputs Y, Z which cause divider 28 to effect a variety of divide ratios. The programmable controls Y, Z, as well as a control X cooperate with a bandwidth control 20 and cause the bandwidth control to vary the loop correction bandwidth in accordance with loop operating frequencies. The programmable control X also cooperates with the phase and frequency adjust network 12 and controls the direction of frequency corrections by the digital phase locked loop. The inputs to phase comparator are also coupled to an EXCLUSIVE OR gate 24 which is further coupled to a lock detector 22. As mentioned earlier, the multiple frequency DPLL cooperates with three programmable control inputs X, Y, Z. The programmable control signals cooperate with the bandwidth control 20, the phase and frequency adjust 12 and the programmable digital divider 28 and direct the center frequency and bandwidth of the multiple frequency DPLL. In the preferred practice of the present invention, it is desirable to provide a first operating frequency with a wide band capability and several other operating frequencies with a narrow band capability. This feature allows the testing a number of operating frequencies while having the multiple frequency DPLL programmed to a known single frequency. The bandwidth control 20 effects a loop bandwidth variation by altering the number of digital pulses which are added or subtracted from the composite clock, while effecting loop phase adjustments. The programmable control signals Y, Z also control the loop operating frequency in the following manner. The composite reference clock signal is coupled, through the phase and frequency adjust network 12, to divider 16. In the preferred embodiment, a clock reference signal of 1.92 MHz is provided, and with no other manipulation, divider 16 would provide a loop operating frequency of 6000 Hz. Therefore, the multiple frequency DPLL is capable of making approximately 6000 corrections per second. In addition, dividers 26 and 28 are coupled to the 1.92 MHz reference clock and to AND gate 30 to provide an output signal which can be several possible frequencies, based on the programmable control signals Y, Z. The output frequency of AND gate 30 is equivalent to where N is provided by programmable controls Y, Z as shown in Figure 1. Therefore, for example, for N 1, this output is the programmable clock signal is coupled to the phase and frequency adjust network 12 which either adds, subtracts, or possibly neither, shifted reference clock pulses from the 1.92 mHz reference clock signal at a rate determined by the programmable clock signal. Therefore for N 1 the loop operating frequency would calculated as follows As mentioned earlier, for the frequencies described, the multifrequency DPLL can make approximately 6000 corrections second. If the phase and frequency adjust network adds or subtracts 6000 pulses second from the reference clock signal, the digital phase locked loop can compensate for phase disparities according to the following relationship Therefore, if the bandwidth control 20 adds or subtracts 1 pulse per correction, the loop bandwidth can be defined as The phase comparator 18 can be programmed to make phase comparisons on the positive edges of f‚ÇÅ or on both positive and negative edge of f The programmable control signals X, Y, Z instruct the bandwidth control 20 to add subtract 1,2, or 4 pulses per correction, therefore, according to the preferred practice of the present invention, and the relationships above, the multifrequency DPLL can exhibit loop bandwidths of 18.75 Hz, 75 Hz or 150 Hz under the control of the bandwidth control circuit 20. The relationship between the programmable control signals X, Y, Z and loop operating frequency and bandwidth is shown below in Table 1. Figure 2a shows an electrical schematic of the phase and frequency adjust network 12, the phase comparator 18, the bandwidth control 20, and the digital dividers 26, 28 of Figure 1. The associated timing diagrams for Figure 2a are shown in Figure 3a and Figure 3b. According to Figure 2a, a reference clock signal is coupled to terminal 14 and provides the operating reference frequency for the multiple frequency DPLL. The reference clock signal is processed by flip flop 101 which is further coupled to NOR gates 103, 105. The flip flop 101 and NOR gates 103,105 provide a reference clock, signal B, and a shifted reference clock signal, signal A, which are shown in Figure 3a. The output terminal of NOR gate 105, or signal A, is coupled to a flip flop 107 which forms an input to the bandwidth control 20. Signal A is also provided to a multiplexer 109 which is also associated with the bandwidth control 20. Signal A is additionally coupled to a flip flop 111 and an AND gate 113 which form a portion of the phase and frequency adjust network 12. The output of NOR gate 103, signal B, is coupled to flip flops 115, 117, 119, 121, 123 which form a portion of frequency divider 26 of Figure 1. In addition, signal B is coupled to flip flops 125, 127 and 129 which form a portion of the programmable divider 28. Signal B is additionally coupled to flip flop 131 and multiplexer 133 in the bandwidth control circuit 20. Signal B is further coupled to AND gate 135 in the phase and frequency adjust network 12. Referring still to Figure 2a, the phase comparator 18 comprises flip flops 137, 139, 141, 143, 145, 147 and 149, OR gates 151 and 153, AND gate 155, and NOR gate 157 which are coupled as shown in Figure 2a. Specifically, flip flop 137 is coupled to flip flops 141 and 143 which form a portion of the phase advance circuitry of the phase comparator 18. Likewise, flip flop 147 is coupled to flip flops 145 and 149 and form a portion of the phase retard circuitry of the phase comparator 18. Flip Flop 139 is coupled to flip flops 143 and 145 and provides signals to both the phase advance and phase retard portions of comparator 18. OR gate 151 is coupled to flip flops 141 and 149 and provides a first output signal for the phase comparator 18. OR gate 153 is coupled to flip flops 143 and 145 and provides a second output signal for the phase comparator circuit. AND gate 155 is coupled to flip flops 145 and 149 and cooperates with NOR gate 157 which is coupled to flip flops 141 and 143 to provide a reset function to the phase comparator 18. It should be noted that flip flops 137, 139, 141, 143, 145, 147 and 149 are D type flip flops which are well known. The operation of the phase comparator 18 will be explained in conjunction with Figure 3b. Referring now to Figure 3b, there is shown two timing signals f Referring now to Figures 2a and 3b, signal G of Figure 3b corresponds to the Q output signal of flip flop 137 of Figure 2a. Signal H of Figure 3b corresponds to the Q output terminal of flip flop 147 of Figure 2a. Signal I of Figure 3b corresponds to the Q output terminal of flip flop 141 of Figure 2a. Signal G of Figure 3b corresponds to the Q output terminal of flip flop 137 of Figure 2a. As mentioned earlier, the purpose of phase comparator 18 is to provide output signals which indicate the relative phase of the reference clock signal and the received data signal. The phase locked loop output signal f For the phase condition shown in Figure 3b and described above, a positive transition in signal G followed by a positive transition in L will cause the output of flip flop 141 to be set high signal I . A high value in signal I indicates that f Flip flops 145, 147 and 149 operate in an analogous fashion, however flip flop 147 is clocked on the negative edge of f Referring now to Figure 2a, the DPLL digital divider 28 is shown. Digital divider 28 is clocked by system clock B and provides a variable divide ratio based on programmable system controls Y, Z. Digital divider 28 comprises flip flops 125, 127 and 129 as well as multiplexer 159 and AND gates 161, 163 and 173, NAND gates 167, 169 and 171, inverter 165, and EXCLUSIVE OR gates 177 and 175, coupled as shown in Figure 2a. Digital divider 26 comprises flip flops 115, 117, 119, 121, 123 and NAND gates 181, 183, 185, 187 and 189 coupled as shown in Figure 2a. Divider 26 provides a fixed divide ratio of 25. Divider 28 provides a variable divide ratio from 1 to 8. The outputs of dividers 26, 28 are combined by AND gate 30 in a dual modulus fashion to provide a composite divide ratio of 200 N wherein N is controlled by programmable controls Y, Z. It should be noted that digital dividers of this type are well known and several divider configurations would function satisfactorily. Therefore dividers 26, 28 may be any suitable conventional 200 N digital divider and is not limited to the specific configuration shown in Figure 2a. Referring still to Figure 2a, there is shown the phase and frequency adjust network 12 of Figure 1. The phase and frequency adjust network 12 cooperates with programmable control signal X, the derived programmable clock signal, the reference clock signal B, the shifted reference clock signal A, and the bandwidth control 20 output signal, and adds or subtracts pulses to the DPLL reference signal B to compensate for phase disparities or frequency changes. The phase and frequency adjust network 12 comprises flip flops 111 and 197 which effect frequency adjustments and flip flops 209 and 211 which effect phase adjustments. The phase and frequency network additionally includes inverters 191, 195, 205, NAND gates 193, 203, 113, 135, and 217, AND gates 201 and 207, NOR gates 215 and 157 and OR gate 213 coupled as shown in Figure 2a. As mentioned earlier, OR gates 151 and 153 in the phase comparator 18 provide an output signal wherein an active signal appearing at the output of OR gate 151 indicates pulses should be added to the composite clock, signal E, to compensate for phase and an active output appearing at the output of OR gate 153 similarly indicates pulses should be subtracted to compensate for phase. The phase and frequency adjust network 12 also cooperates with programmable signals X, Y, Z, to effect frequency shifts in the operating frequency of the digital phase locked loop. The phase and frequency adjust network 12 provides phase and frequency adjustments by combining or subtracting a reference clock, signal B, and a shifted reference clock, signal A, to provide a composite clock signal E which operates the digital phase locked loop divider 16 of Figure 2b. In addition, the phase and frequency adjust network 12 is coupled to the output of AND gate 30 which produces a programmable clock signal and establishes the adjustment rate of the phase and frequency adjust network 12. The phase and frequency adjust network 12 further cooperates with programmable input signal X which indicates positive or negative frequency shifts from the center loop operating frequency. In operation, the phase and frequency adjust network 12 is continuously provided with clock signal A through flip flop 111 and NAND gate 113, clock signal B through flip flop 197 and NAND gate 135, and clock signal C through NAND gates 193 and 203. Programmable input signal X is coupled to inverter 191 which selectively activates either flip flop 197 frequency add or flip flop 111 frequency subtract , depending on the state of signal X. If programmable control signal X is low, then the derived programmable clock signal C will be coupled to flip flop 197 through NAND gate 193 and inverter 195. In a similar fashion, if programmable input signal X is high, then the derived clock signal C is coupled to flip flop 111 through NAND gate 203 and inverter 205. If the programmable derived clock signal C appears at the delay input of flip flop 197, clock signal B will allow signal C to clock through flip flop 197 to OR gate 213. The next B clock pulse will reset flip flop 197, thus gating a single pulse through flip flop 197. The output of OR gate 213 is normally low, except when pulses are to be added to the main system clock B, therefore, when the output of flip flop 197 is high, clock A will be summed with clock signal B through NAND gates 113, 135 and 217. Pulses are subtracted from the clock B in a similar fashion. If programmable input signal X is low, the programmable derived clock signal C will be coupled to flip flop 111 through NAND gate 203 and inverter 205. Programmable derived clock signal C is clocked through flip flop 111 with each positive transition of clock signal A, allowing the output to go high, thus forcing the output of NOR gate 215 low. When the output of NOR gate 215 goes low, NAND gate 135 will be disabled and the main system clock B will be isolated from the composite clock signal E. Phase compensations are also effected utilizing OR gate 213, NOR gate 215 and NAND gates 113, 135 and 217. As mentioned earlier, the output of OR gates 151 and 153 comprise phase adjust indication signals. That is, if the output of OR gate 151 is active, a positive phase adjustment is required. If the output of OR gate 153 is active, a negative phase shift is required. Referring now to Figure 2a, the phase comparator 18 cooperates with the phase and frequency adjust network 12 through AND gates 201 and 207. AND gates 201 and 207 also cooperate with NAND gates 193 and 203 and provide arbitration between phase and frequency adjustments. If a frequency adjustment is presently in process, AND gates 201 and 207 will prevent the phase adjustment from being effected until the frequency adjustment has been completed. This feature will be discussed in more detail later. Assuming that a frequency adjustment is not currently in process, the phase comparison signals I, The bandwidth control circuit effects variable pulse control by providing a variable clock signal to flip flop 209 and 211. If the delay input of flip flop 209 is active, every positive transition of the signal appearing at the clock terminal will cause signal K to go high, activating the output of OR gate 213 which enables NAND gate 113. As mentioned above if NAND gate 113 is enabled, pulses will be added to composite system clock E, wherein the actual number of phase pulses added is controlled by the clock terminal of flip flop 209. If a negative phase shift is required, pulses must be subtracted from the composite clock signal E. If the output of OR gate 153 is active, a negative phase adjustment is currently being effected, the output of NAND gate 203 is high, enabling AND gate 207, which couples the output of NOR gate 153 to flip flop 211. Flip flop 211 cooperates with the bandwidth control 20 through the clock terminal of flip flop 211. With every positive transition of the bandwidth control clock generated in the bandwidth control circuit, the output of flip flop 211 will go high if a negative phase shift is required. If the output of flip flop 211 is high, the output of NOR gate 215 will go low disabling NAND gate 135, thus preventing the main clock signal B pulses from being combined with the composite system clock signal E. As mentioned earlier, phase adjustments will be delayed if a frequency adjustment is currently being effected. Referring now to the phase comparator 18 of Figure 2a, the outputs of flip flops 141, 143, 145 and 149 comprise signals indicating phase adjustments. Once a phase adjustment signal appears, the signal will be maintained until the appropriate flip flop is reset. The reset signal indicates that a phase adjustment has been completed. The phase adjust reset signal is derived from the phase and frequency adjust network 12 by NOR 157. The outputs of phase adjust flip flops 209 and 211 are coupled to the inputs of NOR gate 157 such that whenever a phase adjustment has been completed, on the next subsequent bandwidth control clock, the output of NOR gate 157 will go low, resetting flip flops 141 and 143. Referring still to Figure 2a, the bandwidth control 20 of Figure 1 is shown in detail. The bandwidth control 20 is controlled by programmable control signals X, Y, and Z and programmable switches 223 and 225. The bandwidth control 20 provides a variable control determining the number of pulses to be added or subtracted during phase adjustments. Specifically the bandwidth control 20 can effect phase adjustments of one, two or four pulses based on programmable input signals. As mentioned earlier, the bandwidth control 20 provides a variable clock signal to flip flops 209 and 211 of the phase and frequency adjust network 12. The bandwidth control 20 comprises flip flops 131 and 221 coupled as a frequency divider, flip flops 107 and 219 also coupled as a frequency divider, NOR gate 227 programmable switches 223 and 225 and multiplexers 133 and 109. In operation, flip flops 131 and 221 are coupled to clock B and provide signals at one half and one forth the rate of reference clock signal B. Flip flops 107 and 219 are coupled to clock signal A and provide signals at one half and one forth the rate of clock signal A. The divided B and A clock signals are coupled to multiplexer 133 and 109 through programmable switches 223 and 225 respectively. The programmable switches 223 and 225 control which divided clock signal is coupled to multiplexer 133 and 109. If the mode one position is selected, a higher rate divided clock signal will be coupled to the phase adjust flip flops 209 and 211, causing the Q outputs of flip flops 209 and 211 to be set and cleared more quickly thereby reducing the number of pulses to be added or subtracted from the composite system clock, signal E. If a relatively larger number of pulses are added or subtracted from the composite system clock, larger phase shifts will be effected, thus a wider bandwidth capability is provided to the loop. NOR gate 227 is coupled to the programmable loop control signals X, Y, Z and has an output coupled to the clock terminals of multiplexers 133 and 109. A high output signal at the output of NOR gate 227 indicates that the digital phase locked loop has been set for wide band operation. This output signal causes multiplexers 133 and 109 to select the programmable switches 223 and 225 which have been previously set for a required system configuration, causing flip flops 209 and 211 to effect multiple pulse corrections. If the output of NOR gate 227 is low, the multiple frequency digital phase locked loop will be set for narrow band operation and multiplexers 109, 133 will select signals A and B causing single pulse corrections. Referring now to Figure 2c, there is shown a detailed electrical schematic of the digital divider 16 and the lock detector 22 of Figure 1. The various timing signals of Figure 2b are shown in Figure 3b and Figures 2a and 3c and will be referred to interchangeably. The frequency divider 16 of Figure 1 is coupled to the composite clock signal E of Figures 2a and 3a. The frequency divider 16 divides the composite clock signal E to provide the operating clock signal f Referring still to Figure 2b, the lock detect circuit 16 is shown in detail. The lock detector 16 compares the output clock signal of the digital phase lock loop, f The lock detect circuit inputs are provided by EXCLUSIVE OR gate 329 which is coupled to the incoming data signal, f Flip flops 335, 337, and 339 are coupled in a conventional divider configuration 334 and provide an overflow output pulse every time eight E 4 gated clock pulses are accumulated. Flip flops 321, and 323 are coupled in a well known divider configuration. Flip flops 321 and 323 are coupled to the digital phase locked loop output signal, f The overflow pulses of divider 334 are used to clock divider 341. Divider 341 provides an output pulse whenever divider 334 produces 8 overflow pulses. If signals f Signals P and R are generated by divider 343 and a dual edge detector formed by flip flop 345, 347 and 349 and EXCLUSIVE NOR gate 354 and EXCLUSIVE OR gate 352. Frequency divider 343 is coupled to the output of EXCLUSIVE NOR 333 which is a pulsed signal having a frequency of f Referring now to the lack detect latching circuit 350 of Figure 2b, flip flop 351 provides the first stage of the lock detect latching circuit. If a pulse occurs in signals, flip flop 351 will be latched and signal T will be set high. Signal T will remain high until flip flop 351 is reset by signal R. If no signal S overflow pulses have latched flip flop 351, signal T will remain low. Flip flop 351 is reset with delayed signal R, therefore if no overflow pulses are received, signal T will remain inactive. If signal T is inactive, the following C clock pulse will clock flip flop 353 and cause signal U to go high. The high signal U pulse will be clocked into flip flop 357 by the C clock causing signal W to go high. A logical high state in signal W indicates that the digital phase locked loop is in a locked state. Once signal W has been set high, signal V will be forced low. Signal V clocks flip flop 357, therefore, if signal V is latched low, flip flop 357 will be disabled. Whenever signal W is latched high, signal In summary, an improved multi frequency digital phase locked looped circuit has been described. The multi frequency digital phase locked loop utilizes common circuitry to effect both frequency and phase adjustments in the digital phase locked loop. The preferred practice of the present invention contemplates the use of a phase and frequency adjustment network to selectively combine a reference clock signal and a shifted reference clock signal or to selectively delete pulses from the reference clock signal to generate a composite digital phase locked clock signal. The operating center frequency of the digital phase locked loop is programmably controlled by periodically adding shifted reference clock pulses to the reference clock signal at a rate determined by the programmably clock signal. The multi frequency digital phase locked loop can be utilized as a tone detector by the addition of a lock detect circuit. The multi frequency digital phase locked loop can be programmed for a known operating frequency. If the lock detect circuit indicates a locked state in the digital phase locked loop, a known frequency, within the bandwidth of the loop has necessarily been detected. The multi frequency digital phase locked loop could also be used as a multi tone detector by programmably shifting the multi frequency digital phase locked loop operating frequency sequentially between required frequencies.