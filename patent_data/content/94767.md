# Devices for generating three phase PWM waveforms for control of induction motors.

## Abstract
Programmed digital equipment is utilized in a device 10 to generate three phase pulse width modulated PWM waveforms that are used in controlling an induction motor. A microprocessor 12 is programmed to initialize conditions in the system 10 , to perform a main task including the storage of a converted analog signal, the checking of limits of motor motion and information fed back from the motor concerning its position, and the ramping of frequencies to change the position of the motor. A memory is provided for the programming, which memory also contains tables that correspond to 90 of each desired waveform. A simple 90 segment of each waveform is needed to generate all parts of each of the three phases. An analog to digital converter 44 is utilized to convert analog information concerning gain, set point, deadband and feedback signal into digital signals which are stored and processed by the microprocessor 12 . Programmable timers 16, 18 are connected to the micro rocessor 12 for generating the waveforms and for sup plying master timing and interrupt signals indicative of an undesirable condition in the motor control.

## Claims
CLAIM A device for generating three phase pulse width modulated waveforms for constant torque variable speed control of an induction motor, the device 10 being characterised by a microprocessor 12 which is programmed for initialization, a main task, interrupt processing, and waveform generation, the main task comprising storing a converted analog signal, checking 70 limits of motor position and, when such limits are reached, setting a desired frequency of the motor to zero, checking 72 a feedback signal which is indicative of the motor position, ramping frequency to meet the desired motor frequency, and selection of mode of control according to at least one algorithm a memory connected to the microprocessor 12 for containing the programming thereof and for containing a plurality of tables each corresponding to a desired motor waveform an analog to digital converter 44 connected to the microprocessor 12 for receiving a gain control signal, a deadband control signal, a set point control signal and a feedback control signal, the converter 44 being operable to convert at least one of said control signals at a time into said converted analog signal three waveform timers 18 connected to the microprocessor 12 for receiving information from one of said tables in the memory to generate three phase pulse modulated waveforms for the motor and at least one additional timer 16 connected to the microprocessor 12 for generating, upon the occurrence of an undesirable condition for the motor, an interrupt signal to be applied to the microprocessor.

## Description
DEVICES FOR GENERATING THREE PHASE PWM WAVEFORMS FOR CONTROL OF INDUCTION MOTORS This invention relates to devices or apparatus for generating digital three phase pulse width modulated PWM waveforms which can be used for constant torque variable speed control of induction motors, for example for closed loop position control. Previous methods utilize analog cicuitry comprising sinusoidal and triangular waveform generators to produce the pulse width modulated waveforms necessary to control a three phase induction motor for constant torque variable speed control. The analog technique is usually complex, requiring numerous factory and field adjustments. Also, the analog system is difficult to reconfigure to different applications after final design. Limited use of digital techniques including microprocessors have been attempted for open loop induction motor speed control. US Patent No. 4 099 109 to Abbondanti discloses a digital apparatus for synthesizing pulse width modulated waveforms. According to that reference, however, the waveforms are selected by hardware. The versatility of Abbondanti for adapting the induction motor control to various applications is thus limited. In addition, the provision of the logic required for induction motor control using hardware limits the flexibility of such control and the adaptability thereof to various different conditions and requirements. The use of three phase AC induction motors to replace DC motors for various control functions, such as the movement of butterfly valves and the like, has become increasingly popular with the introduction of controllers which can vary the three phase waveforms applied to the induction motors. This is due to the reduced size and complexity of AC induction motors, particularly in the range of ratings below 7.5 kW 10 HP . According to the present invention there is provided a device for generating three phase pulse width modulated waveforms for constant torque variable speed control of an induction motor, the device being characterised by a microprocessor which is programmed for initialization, a main task, interrupt processing, and waveform generation, the main task comprising storing a converted analog signal, checking limits of motor position and, when such limits are reached, setting a desired frequency of the motor to zero, checking a feedback signal which is indicative of the motor position, ramping frequency to meet the desired motor frequency, and selection of mode of control according to at least one algorithm a memory connected to the microprocessor for containing the programming thereof and for containing a plurality of tables each corresponding to a desired motor waveform an analog to digital converter connected to the microprocessor for receiving a gain control signal, a deadband control signal, a set point control signal and a feedback control signal, the converter being operable to convert at least one of said control signals at a time into said converted analog signal three waveform timers connected to the microprocessor for receiving information from one of said tables in the memory to generate three phase pulse modulated waveforms for the motor and at least one additional timer connected to the microprocessor for generating, upon the occurrence of an undesirable condition for the motor, an interrupt signal to be applied to the microprocessor. Additional information which is useful in understanding the present application can be found in our co pending European Patent Application No. 83302076.1 Publication No. EP 0092937 , which is to be deemed incorporated herein by this reference. In a preferred device embodying the present invention and described in detail hereinbelow, real time software is utilized in the microprocessor to control the pulse width modulated waveform PWM shape and also to control logic involving interrupt and control signals. The use of real time software increases the flexibility of the system to adapt to different conditions and applications. Digital techniques are used in the preferred device to generate the PWM waveforms. The close interrelationship between the hardware microprocessor and related peripherals and the real time software allow efficient generation and control of the PWM waveforms for both open loop and closed loop systems. The preferred device is such as to allow the easy alteration of the control techniques and PWM generation for closed or open loop control with no hardware redesign involved.Necessary changes required for different applications can be implemented in the real time software, the microprocessor being programmable so as to adapt to different control requirements and conditions. No factory calibration is required after the real time software is configured for the intended application. The preferred device alleviates or overcomes the drawbacks of an analog modulation device and generates waveforms for any assigned output level. The invention will now be further described, by way of illustrative and non limiting example, with reference to the accompanying drawings, in which Figure 1 is a block diagram of a position control module comprising a device embodying the invention for generating three phase pulse width modulated waveforms Figure 2 is a flow chart showing initializing and main tasks of the programming of a microprocessor of the device of Figure 1 Figure 3 is a flow chart of wave pulse and overcurrent processing tasks of the microprocessor programming Figure 4 is a block diagram illustrating analog and digital interfaces to the microprocessor Figure 5 is a diagram showing the three phase pulse modulated waveforms and Figure 6 is a schematic representation of the position control module or device in a three phase drive controller for an induction motor. The drawings show a device embodying the invention for generating three phase pulse width modulated PWM waveforms allowing variable speed control of an induction motor. The waveform generation is implemented by hardware and real time software, which is completely contained on a circuit card designated as a position control module PCM 10 in Figure 1. The PCM 10 is an integral part of another system designated a three phase drive controller and shown in Figure 6. The three phase drive controller controls the motion of a motor to set the position of dampers, air registers, butterfly valves, or other process control elements which require a motor or servo positioner to control their position from a remote location. The PCM 10 provides intelligence for the three phase drive controller. The PCM 10 is a self contained microcomputer which accepts control system inputs and, based on those inputs, develops logic level PWM waveforms which are applied to three power switching modules which are external to the PCM. The PCM uses a MC6802 microprocessor 12 with up to 4K bytes of program storage. The processor 12 is an interrupt driven machine with priority given to updating the real time three phase 3 PWM waveform outputs to the induction motor. The remaining processor time is used to check control system inputs, perform calculations, and display controller status. A functional diagram of the hardware of the PCM 10 is shown inFigure 1. A schematic of the PCM is shown in Figure 6, in the three phase drive controller. A microprocessor based system for three phase motor control is more versatile than a dedicated analog or digital logic design. The ease of software modification allows the functional performance of the controller to be easily changed to a new application. The microprocessor 12 used in the PCM as a central control unit is aMotorola 6802. The 6802 processor 12 includes 128 bytes of RAM and an onboard system clock. The control software requires approximately 3K bytes of memory.The software is stored in a 4K ultra violet erasable read only memory ROM 14 such as a 25L32 or 27L32 device. These devices have access times of 450 nsec, which is sufficient for this application. The ROM addresses are located at the top of the memory from F000 to FFFF. The control program uses only the 128 bytes of RAM located on the 6802 microprocessor 12. The RAM is used for buffers and variable storage.The RAM address locations are from 0000 to 007F. The design includes two Motorola 6840 programmable timer modules PTM 16 and 18. Three individual timers are located on one LS1 device.The timers are used to generate output waveform pulse patterns at 20, measure time variant digital inputs, generate interrupts, and provide a machine fault time MFT function. The timers 16, 18 are operated in a single shot mode. This mode allows a 16 bit binary number to be loaded into a timer latch. Count down is initiated through software or external logic control. A complete countdown to 0 of the 16 bit binary number generates an interrupt, or changes the state of the output associated with that timer.The rate at which count down occurs is determined by the system clock or an external clock source. Four timers in 18 are dedicated to the generation of the three pulse width modulated waveforms 20.One timer is a master timer in 16 which generates processor interrupts at a rate proportional to the output frequency of the controller. The interrupt routine updates the other three timers, each dedicated to abase output, with the new PWM waveform values. The processor timernot associated withthe interrupt routine is used to complete the main task of the control software to be described later. The use of the timers minimizes the processor overhead associated with the generation of the PWM waveforms. The digital system inputs 22 are all TTL logic level. The incoming digital inputs are all filtered at 24 to eliminate noise generated by high power inverter circuitry. In addition, transient protection is provided to suppress electrical surges. The inputs are buffered and interfaced to the processor by an octal buffer 26. Digital signals which are outputted by the processor 12 for control of the PWM waveform 20, mode status at latch 32, and analog multiplexing,interface to their associated circuitry by octal latches. The octal latches are a low cost method of digital interface for a given dedicated application. The latch 32 dedicated to controller mode display 28 is configured to allow data bus information from line 30 to be displayed under program control. This feature is beneficial for both testing and analog calibrations at 28. Latches, buffers, programmable timers, memory, and the analog to digital converter are all memory mapped by a 3 to 8 digital decoder 36. The decoder segments the memory into 8 addressable zones. All necessary logic has been included to ensure the proper timing of data, address, and chip select lines. A machine fault timer MFT in 16 has been provided on the PCM 10 to reset the processor 12 in the event a noise pulse or bad address disturbs the normal software execution. The MFT is updated by the processor during a regular known program sequence. The absence of this update implies a software failure. The MFT times out and rests the processor, reinitializing the system as will be described later. Four analog signals at line 38 are recognized by the PCM 10. Two represent the gain and deadband control parameters which are generated internally by potentiometers.These parameters are associated with closed loop position control. They can easily be redefined in software for other applications. The remaining two are the setpoint and the feedback analog inputs which originate from a control system Fig. 6 . Each analog signal has the voltage range of 0.75 to 5.25V dc. The feedback and setpoint signals, in addition, can be 4 20 mA signals which are converted to voltages by the PCM. The advantage of a current input signal is reduced noise and no attenuation due to long signal wires. The feedback signal is buffered and outputed to the control system for other control applications. The four analog voltages are selected individually for AID analog to digital conversion by an analog multiplexer 40 under processor control.The selected analog voltage is applied to a level shifter and filter 42 for proper signal conditioning before the 8 bit AID conversion 44. The AID converter 44 has an adjustable zero and span allowing maximum resolution for the given input voltage range. The span and zero are adjusted for allowing the 0.75 and 5.25V dc input range corresponds to 5 to 105 of variable to convert from 0 to 255 counts of digital data.The AID interfaces to the processors by internally contained three state buffers which are controlled by the.processor 12. Accurate conversions are possible by proper printed circuit layout and component selection. Reduction of digital noise generated by the microprocessor is reduced by separating the analog and digital ground returns, placement of components, and physically segregating all analog components from digital components. The component tolerances and temperature coefficients are selected such that an accuracy of more than 0.3 is maintained across the temperaturerange of 40 C to 600 C 400 to 1400 F . The PWM waveform 20 which is outputed by the programmable timers is conditioned at 46 before being applied to the phase driver inputs 48. The activation of the positive and negative phase outputs are non overlapping to ensure safe operation of the 3 phase inverter. A 24 microsecond dead time is created by a shift register and various logic elements. A processor controlled latch 34 generates waveform inversion signals which are combined with the timer outputs 20 to reduce the memory table associated with the waveforms by 50 . This same latch 34 has the capability to interrupt the waveform outputs instantly under program control. The conditioned waveform outputs are buffered by a Darlington transistor package before leaving the PCM at 48. Two hardware interrupts are generated for processor recognition. The most active interrupt is generated by the master timer. The master timer also in 16 generates maskable interrupts proportional to the desired output frequency. The interrupt is electrically generated by the 6840 PTM 16. The second interrupt overcurrent condition is generated by circuitry external to the PCM. This interrupt is also processed by the maskable interrupt of the processor. The two inter rupts are distinguished by polling the 6840 timer 16. The functions of the microprocessor 12, according to the processor software, are as follows. The microprocessor must read inputs, decide what mode is being input, and process that mode. Then the processor must determine the proper frequency, and output this frequency via the programmable timer 18. Figures 2 and 3 show a state diagram overview of these functions. Fig. 4 shows the analog and digital interface to the processor. The processor software is written entirely in machine code to maximize processor time available for response to control system parameters. After receiving a RESET input at 11, the microprocessor 12, as shown in Fig. 2, goes into a normal software reset RAM test 52 , ROM checksum test 54 , setting of the stack pointer 56 , initializing both programm able times 58,60 , setting up Machine Fault Timer, setting up pulse storage timer, and setting up the first IRQ timer value. If either the RAM or ROM test fail line 66 , the processor turns all LEDs 62 on and stops 64 . The main task of the processor 12 handles analog conversions, checks limit conditions, checks feedback, ramps frequency, and checks the mode of operation. In a section 68 the processor 12 converts the analog signals. The analog signals are converted to hexadecimal and stored in RAM for use later. Each analog signal thus converted is determined by the input of the multiplexer 40. Next, limit checking occurs 70 . If either limit is set up or down , the DESFRQ Desired Frequency is set to zero. Then as long as a limit is set, the DESFRQ equals zero only in the direction of the limit. This causes the motor to be able to run in the opposite direction of the limit condition The limit inputs can be externally configured to provide system control of the motor. Next, feedback checking occurs 72 . The function of this section is to determine the maximum allowable frequency DESFRQ output for the given application. The ramping of frequency 74 only occurs after so many passes of the wave pulse output. Iffien the actual frequency ACTFRQ is to be ramped, the processor decides if the actual direction ACTDIR is equal to the desired direction DESDIR . If the directions are not equal, the ACTFRQ must be ramped down to Hz motor stopped before the directions can be set equal, the processor decides whether to ramp the frequency or not, and if so, in which direction.The following tests are made and the results are as follows ACTFRQ DESFRO ACTFRO ACTFRQ ACTFRQ DESFRQ ACTFRQ ACTFRQ 3 ACTFRQ DESFRQ ACTFRQ ACTFRQ 3 Then a pointer is set up at the beginning of the proper table of ACTFRQ. The next task is mode selection 76 . This portion of the real time software can be configured to allow control of a particular application. This section of the software will contain all applicable control algorithms for a given application. The ACTFRQ and DESFRQ values are determined in this portion of the software. The IRQ interrupt is used for an over current condition and wave pulse output, as shown in Fig. 3. Overcurrent condition is noted by hardware, which gives the processor an IRQ interrupt. The response of the processor to an overcurrent interrupt is dependent on the application. If the over current condition is determined undesirable, the motor is turned off and a manual RESET must occur to INITIALIZE the controller again. The desired outputs are three sine waves 90, 92, 94 in Fig. 5, which are used to drive the three phases of a threephase induction motor. The three sine waves either lead or lag each other by 1200 per phase. A reverse in the phasing of the sine waves results in a reverse in the direction of the motor. The establishment of the square pulse patterns 96, 98, 100, leading to the superimposed sine wave,is known as pulse width modulation. Twenty four, thirty six, seventy two or one hundred and fourty four equal pulses frequency determining the number with varying on times are used to generate the sine wave of the desired frequency. The number of pulses per cycle can be altered for any given frequency under software control. Thirty six pulses are used in Fig. 5.The on time for each pulse is calculated from the following formula EMI11.1 where T time in microseconds f fundamental frequency 3 to 60 Hz in 3 Hz increments phase angle in angle degrees 2.5 , 5.0 , 10 , or 15 increments from 0 to 90 depending on funda mental frequency I increments per cycle f 3,6 Hz I 144 f 9, 12, 15, Hz I 72 f 18 thru 45 Hz I 36 f 48 thru 60 Hz I 24 V desired peak voltage in volts adjusted for maximum motor torque . Fig. 5 shows the pulse pattern sine wave relation p. The negative half of the sine wave is derived from the element of this signal. The method for each of the three phase waverms is the same. The ROM 14 contains 20 different tables. ch table corresponds to a different output waveform frequency anging from 3 to 60 Hz in 3 Hz increments . The entries each table are the programmable timer values necessary create 90 degrees of a 360degree PWM sine wave. The entire ne wave is created by repeating the entries inthe table in ie proper sequence and proper control of the waveform inversion ntrol lines outputed by latch 34. Only one table is necessary generate all three phase outputs. The individual phases quire the same timer values for a given frequency. It is 1st necessary to displace the three waveforms by 1200 with aspect to each other. The programmable timer values located in each frequen table do not necessarily have to be sine weighted. The mer values can be changed to provide non sinusoidal waveforms achieve greater average voltage output resulting in a efferent motor torque relationship. The method used in creating this sine wave is the same whether 24, 36, 72, or 144 pulses per cycle are outputed Initialization of each waveform is approximai the same The counters and pointers are set up, inversion latch set, and IRQ time is determined. Table I shows the initialization of counters and pointers for each number of pulses PNTA, PNTB and PNTC are thepointers for the three phases A, B and C FRQPT is frequency point and CNTA, CNTR,CNTC are the counts for the three phases. The output for each phase is similarregardles of the number of pulses. A 36 pulse output will be shown in more detail. The pointers move up and down the table depot on the value of the counter that it is associated with. SeeTables II and III for an example of this. A gate is also set reset, depending on the count of the counter for each phase.when the counter reaches its limit, it is set to zero and the process starts over again.Frequency change can only occur when CNTA IRQ time is determined by EMI12.1 where ç number of pulses per frequencyThe IRQ time is loaded into a programmable timer module and this determines the rate of IRQ interrupts. TABLE I 24 Pulses PNTA FRQPT CNTA PNTB FRQPT 8 CNTB t 8 PNTC FRQPT 8 CNTC 16 36 Pulses PNTA FRQPT CNTA PNTB FRQPT 12 CNTB 12 PNTC 2 FRQPT 12 CNTC 24 72 Pulses PNTA FRQPT CNTA O PNTB FRQPT 24 CNTB 24 PNTC FRQPT 24 CNTB 48 144 Pulses PNTA FRQPT CNTA PNTB FRQPT 48 CNTB 48 PNTC FRQPT 48 CNTC 96TABLE IIEMI13.1 tb Table SEP Count tb SEP XX SEP A SEP 9 SEP E A SEP 18 SEP 36 SEP tb SEP XX SEP r SEP 1 SEP 17 SEP 19 SEP 35 tb SEP XX SEP 9 SEP 2 SEP 16 SEP 20 SEP 34 tb SEP XX SEP 3 SEP 15 SEP 21 SEP 33 tb SEP XX SEP 4 SEP 14 SEP 22 SEP 32 tb SEP XX SEP t SEP 5 SEP 13 SEP 23 SEP 31 tb SEP XX SEP BC SEP 6 SEP 12 SEP m SEP 24 SEP S SEP 30 tb SEP XX SEP 1 SEP 7 SEP 11 SEP 25 SEP 29 tb SEP XX SEP 8 SEP 12 SEP 26 SEP 28 tb SEP XX SEP 9 SEP 27 tb SEP at SEP start SEP CNT SEP W SEP SEP 8 SEP PNT SEP SEP SEP SEP 6 tb SEP CNT SEP S SEP SEP 12 SEP PNT SEP SEP 6 tb SEP CNT SEP 2 SEP SEP 24 SEP PNT SEP SEP SEP SEP 6. tb Pointers PNT and startatthesamelocation but more in opposite directions because of CNT values. TABLE IIEMI14.1 tb Counter SEP Pointer SEP Movement SEP Gate tb SEP SEP 9 SEP inc SEP t SEP SEP pos tb 10 SEP SEP 18 SEP dect SEP 0 SEP pos tb 19 SEP SEP 27 SEP inc4 SEP 1 SEP neg tb 28 SEP SEP 36 SEP dect SEP 1 SEP neg tb The time required to process an IRQ interrupt directly affects the overall system response of the PCM 10. The IRQ routine is given top priority to allow the real timePWM waveform outputs 48 to continue without interruptionThe IRQ execution time is reduced by the use of efficient machine instructions at the expense of. increased memory locations necessary to store the IRQ routine. An increase of PWM output frequency resolution for more precise control applications can be ovtained by increasing the number of frequency tables located in the ROM. The system response will not be significantly decreased by the addition of more output frequencies.