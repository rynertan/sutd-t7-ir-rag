# METHOD AND APPARATUS FOR PROCESSING DIGITAL SIGNALS PRIOR TO RECORDING

## Claims
Verfahren zum Verarbeiten digitaler Information vor dem Aufzeichnen mit folgenden Verfahrensschritten

## Description
The present invention relates to a method and apparatus for processing digital signals prior to recording. More particularly but not exclusively the digital signals represent television video signals. A channel code which had a minimum transition separation of 1.5 bit cells and which also was capable of statistically controlling the low frequency components was described in our co pending U.K. Application A 2,141,906. In that application an n bit input word was represented by a channel code word having 2n a half bit cell time slots. For each successive group of eight bits it is possible, theoretically, at least on average to identify just over 453 discrete combinations having a minimum transition separation of 1.5 bit cells and this should make it possible to construct a block code with controlled low frequencies using chanel code words having sixteen, half bit cell time slots. An alternative proposal has been made which operates on a bit by bit basis. Consideration has been given to the realisation of this alternative proposal but there are a number of difficulties which stem from the combination of the necessary high speed, the look ahead and the modulo three requirements of parts of the coder. The US Patent, US A 4261019, describes a coding method and apparatus in which data words are converted into code words each having a number of time slots double the number of bit cells in each of the data words and wherein there is a minimum inter transition spacing in the code words of three time slots. In order to ensure that the required inter transition spacing is maintained at boundaries between successive code words code words are selected so as not to end with a 1 , and if the situation arises that digits 101 appear at the boundary because a first word ends 10 and the next word begins 1 these digits are inverted to 010 . The present invention provides a method of processing digital information prior to recording, comprising the steps of The present invention also provides apparatus for processing digital information prior to recording, comprising An advantage of the method is that less read only memory is required whilst approaching close to the theoretical limit of just over 453 different combinations in each block of 8 cells. In order that the present invention be more readily understood an embodiment thereof will now be described by way of example with reference to the accompanying drawings, in which Before describing the invention in detail, it is considered helpful to explain some basic principles of the coding system being used. It is to be remembered that the techniques disclosed in our co pending application identified above are still being used and attention is directed to that case for further details. Suffice to say that the present invention comprises a method of processing digital information for recording purposes. The processing is organised on a word based arrangement and generates a code word for each input digital word to be recorded, the code word occupies the same time as the input digital word but has at least double the number of time slots with respect to the number of bit locations in an input digital word. In a code word, transitions are not permitted at specified locations. For a minimum transition separation of three half cells, the number of different combinations which can be portrayed as the number of half cells increases from 0 to 34 is shown in the following table A way of preventing transitions from being less than three half cells spacing between blocks would be to arrange that there were two half cells without transitions between the end of one block and the start of the next. An eight bit data block, allowing for the two half cells between blocks, would leave 14 half cells for information which can provide 277 combinations. This is significantly less than the 453 combinations theoretically available on average, amounting to only 61 . If a 16 bit data block could be realised, providing 30 information slots and 125491 combinations, this would provide a number of combinations equivalent to 354 per eight bit data block. This is better but it is still far short of the 453 combinations theoretically available. A much better coding strategy has been discovered and to illustrate the principle this will be described for a four bit data block. This coding strategy uses two alternative Code Books A and B and the basis for each of these is shown in Figures 1 and 2 respectively. In Code Book A there is a first range A in which transitions are barred in time slots 0 and 1 in the word being coded and also in the subsequent word. A 0 in a time slot indicates that a transition is not permitted, a indicates that a transition is permissible providing no two transitions are closer than three half cells. There are 13 combinations of patterns and for this first range A the subsequent word will also be coded on the basis of Book A . The second range B has word transitions barred in time slots 0,1,6,7 and there must be a transition in time slots 0 or 1 of the following word i.e. within the brackets. Note however that the choice of the two positions will be determined by the next 4 bit word. This second range B provides a further 6 combinations making 19 in all available for Code Book A . When the range B is used for one word the next word must be coded on the basis of Code Book B shown in Figure 2. Again there are two basic ranges A and B but in this case each is split into two giving sub ranges A0, A1, B0 and B1. For A0 and B0 there is a defined transition at time slot 0 whereas for A1 and B1 it is at time slot 1. A0 and A1 give 9 and 6 combinations respectively and for these 15 cases the following word is coded on the basis of Code Book A . B0 and B1 give 4 and 3 combinations and for these 7 cases the following word is coded on the basis of Code Book B . The total number of combinations is therefore 22 for Code Book B . For random data, Code Book A would be used on about 68 of occasions, Code Book B for the remainder, so the average number of combinations for every 4 bit cells would be just under 20 or approximately 400 combinations in eight bit cells an efficiency of about 88 of the theoretical limit. Figure 3 shows the time of transitions for the 19 and 22 possible combinations in Code Books A and B respectively. Since the number of available combinations exceeds the sixteen necessary to carry 4 bits of binary information it is possible to eliminate patterns having less desirable characteristics, for example the one having no transitions, and or to allocate two different patterns to certain 4 bit combinations. This may be most usefully realised by replacing Code Book A by two alternatives Code Book A same and Code Book A opposite . For at least 13 of the 16 binary combinations the patterns stored in the alternative code books would be the same but for three combinations the patterns in the same and opposite sections could differ. For these combinations the patterns would be chosen on the basis that the direct component due to the pattern would be in the same or the opposite direction to the polarity existing immediately before some sensible reference time for example just prior to time slot 0 . If a 1 be stored to indicate a transition and a 0 to indicate no transition then the parallel information from the Read Only Memory when serialised could cause a change of state of a divide by two counter to generate the signal to be recorded. The same type of splitting of Code Book B into sections same and opposite would be used but in this case at least 10 patterns would appear unchanged in both sections whilst 6 patterns could differ. If an odd number of transitions occurs in a word then the polarity at the reference time for the next word is reversed. A total of six address bits for the ROM would be required and these consist of 4 for the binary data, one to select between Code Books A and B and one to select between same and opposite . It might appear at first sight that nine output bits are required, eight to indicate the presence or absence of a transition in each of the 8 time slots and one to instruct the ROM which of the Code Books A and B to use for the next 4 bit word. By means of three 2 input gates, two binary digits giving four states can be very easily used to produce the four permissible patterns that can occur in three consecutive time slots these permissible patterns consist of no transition or a transition in the first, second or third time slot. It is also possible to use 5 bits to control transitions in 8 time slots. Transitions in time slots 0 and 1 can only occur when Code Book B is in use and must occur in one of these positions so a single ROM output bit may be used to control which of these two time slots must contain the transition. If there is spare output capacity in the ROM it would be worth considering that one bit should be used to indicate if a word results in an odd or an even number of transitions since this is required information for the control of the direct component. Spare output capacity could also be used to give a measure of the direct component being produced by each word but the sign of this must also take note of the polarity of the signal at the reference time. Since there are many alternatives for the ROM system, which can even include direct generation of the signal to be recorded by the ROM but probably in parallel form it seems pointless giving ROM details and that transition patterns are all that is necessary to define the channel code. So far the information has been on a 4 bit coder, obviously other sizes are possible and the one of particular interest is a coder for 8 bits. For such a coder Figures 4 and 5 show the basis of Code Books A and B which yield 406 and 466 combinations respectively. The average of these when weighted for frequency of occurrence is about 425 or about 94 of that theoretically achievable. The reason that a higher efficiency is not achieved stems from the occasions when transitions in time slot 14 are barred even when the next transition is in time slot 1 of the next word. To save space in providing information for the look up table to make computation easier, the number of transitions in time slots 0 15 inclusive, the Code Book to use for the next word, and the time slots in which transitions occur, are combined in one 11 digit word. First digit in the tens position gives the number of transitions in time slots 0 15 inclusive. The second digit units position gives which Code Book is to be used for the following word 0 corresponds to A, 1 to B. After the decimal point the first digit gives the address of the first transition, this never exceeds 8. The next pair and subsequent pairs of digits give the addresses of the subsequent transitions but note that pairs 00 do not signify a transition. For example in Code Book B or 1 level 16 same the number is 50.003081114. In this particular case although it is from the same the magnitude of the shift of direct component happens to be zero as can be calculated. If B level 16 opposite had been selected the number would have been 50.004071114 with transitions in the 0,4,7,11 and 14th time slots and the shift would have been 2 i.e. a shift of 2 in the opposite direction to the polarity existing just before the zero time slot. The number of address bits for the ROM will total 10, 8 for the data, one for differentiating between Code Books A and B and one same or opposite . As mentioned earlier 1 output bit will suffice for time slots 0 and 1, taken as a pair, and 2 bits for each of the triads 2 4, 5 7, 8 10, 11 13 and 14 16 making 11 bits in all to refer to time slot 16 is incorrect but it can be used to control the selection between Code Books A or B to be used for the next 8 bit word. A total of 11 output bits is required and since 8 bit wide ROMs are common there could remain 5 bits surplus when two are used. These 5 bits could be used and are sufficient to aid the evaluation of a running sum and to provide the important information whether the number of transitions in a word is odd or even and the sign and magnitude of the change. None of these bits is essential since the information may be derived from the transition information but this information may make it easier to achieve fast operation and simplify running sum computation. It may be useful to note that the code with six transitions at time slots 0,3,6,9,12 and 15 is not used this might be useful for synchronisation. The continuation 2, 5, 8, 11 and 14 is used for level 5 Code Book A . Another useful feature for synchronisation is that a transition in time slots 14 never precedes any word in Code Book B . The constraints used in the Code Books are that no transitions are less than 3 or more than 12 time slots apart with the exception that between transitions in adjacent words the maximum separation may occasionally be 15 time slots the latest first transition is in time slot 9 and the earliest last transition is in time slot 10 ignoring the cases where a further transition is forced to occur in time slots 0 or 1 in the following word. Fig. 6 shows the above described arrangement in more detail. A 8 bit input latch feeds the information word to be carried as an address for a 10 x 16 programmed ROM 62. Outputs D₀ D₁₀ of the ROM 62 are fed to six assemblies of gates, 63 68, and are operated thereby in accordance with the truth tables shown in Fig. 7. The assemblies 63 68 of gates transform the eleven outputs D₀ D₁₀ from ROM 62 into seventeen signals, sixteen of which are fed through a block of latches 70 clocked at word frequency and into a parallel to series converter 71. The output of the converter 71 is fed through a divide by two circuit 72 and an output latch 73 which is clocked at bit rate e.g. sixteen times word rate. The signal 16 from the assemblies of gates is used to indicate whether Code Book A or B should be used if signal 16 is a 0 Code Book A is used for the next word while if the signal is a 1 Code Book B is used. Signal 16 is fed through a latch 75 clocked at word frequency and the output of the latch 75 is fed as an input to latch assembly 63 and as an address bit to the ROM 62. Outputs D₁₁ D₁₄ of the ROM 62 are assembled in an accumulator 76 and the sixteenth output D₁₅ is added to or subtracted from the signal in the accumulator 76 after being fed through a latch 77 and a divide by two circuit 78. The output of the accumulator is used as the tenth addressing input to the ROM 62. As shown in Fig. 8, the accumulator 76 may be constructed from a modulo 256 counter circuit 76a which feeds an 8 bit latch 76b. ROM 62 contains 1024 words of 16 bits and is addressed chiefly by the 8 bit words A₀ to A₇ containing the information to be carried. However, there are two further address bits A₈ and A₉. It is convenient to consider that if A8 is zero then Code Book A will be used whereas Code Book B will be used if A₈ is in the one state. For each of these code books some of the words output from the ROM will differ depending on the state A₉ the state of A₉ is controlled by the most significant bit of an accumulator which will be assumed to operate in modulo 256. Initially this should be set to represent a 128 state 127 would also be useable but 128 will be assumed. If the state is in the range 128 to 255 inclusive then Ag will be high and this selects opposite , if the state is in the range 0 to 127 inclusive same will be selected. All the inputs to the parallel to serial converter 71 are in the zero state except for those where transitions are required there are in a one state. Whenever a one state reaches the output of the parallel to serial converter 71 the divide by two circuit 72 changes state so causing the production of a transition. Knowing the required transition patterns, the patterns of data D₀ to D₁₀ may be derived from consideration of the Truth Tables shown in Fig. 7. Note however that for A words the state of D₀ is irrelevant and that D₉ and D₁₀ are both ones when the following word is required to be from the B Code Book. For the embodiment shown there remain 5 bits D₁₁ D₁₅, of the 16 output bits, that are not used for the information being carried. These may be used for evaluating the running sum rapidly. The running sum is usually defined for NRZ as follows. At the initial start of data the running sum is assumed to be zero. As each succeeding bit occurs the running sum is incremented by one if the bit represents a one whilst it is decremented by one if the bit represents a zero . For NRZ after an even number of bits the running sum must be even. With this method of running sum calculation the running sum at the end of the word only becomes available after the start of the last bit of the word. With the 2 ₃ coder a choice needs to be made for the next word to be coded dependent on the running sum which will exist at the end of the current word. The variation of the running sum during a word can never be greater than the range 8 the extreme values would only occur if no transitions occurred within a word. It is assumed when the running sum is computed that a state is counted as ½ per half bit cell. For an even number of half bit cells the possible sum variations during a word always have integer values. For code books which are practical there will always be at least one transition in a word preventing the extremes of the range being used so a four bit number, capable of representing the number range 8 to 7, will always be sufficient. It is convenient to represent zero variation by the binary number 0000 and to add decimal 16 to negative numbers. The modulo 16 numbers can be changed to the appropriate modulo 256 numbers by applying the D₁₁ input to the adder also to the higher significance inputs as shown in Fig. 8. It is suggested that the running sum variation during a word should be the one starting from the centre of half cell 0 up to the same point on the following word and that it be assumed that the state prior to the start should be one . Since the polarity of the signal immediately before the start of half cell 0 will reverse each time a previous word has an odd number of transitions it is necessary to appropriately switch the accumulator from addition to subtraction. This is achieved by making D₁₅ a one in all cases where the number of transitions in a word is odd. At the end of that word the divide by two changes state so switching the accumulator from add to subtract or vice versa at the appropriate times. There are many requirements of the replay circuitry which are unconnected with the channel code used and these will not be considered and it will be assumed that, a transition causes a 1 state lasting one time slot, that clocks at twice the bit cell frequency and that word framing are available. The important step is how to reduce a pattern of transitions which may be occurring at 16 different points per word into say 10 or 11 binary digits used for addressing a ROM of practical size. There are two approaches of interest. One is based on auxilliary ROMs. Only 28 different combinations of valid transition patterns may occur in eight adjacent time slots this number can be portrayed by 5 bits. A small read only memory with 256 address locations would be used for this purpose and the speed could be so high that the same ROM could be used twice per word rather than to use two identical ROMs. This method can incorporate the checking of the minimum separation of transitions of three time slots. Table 2 shows the relationship between the number of, adjacent time slots, possible patterns and the number of bits in practice some limitations such as the first transition occurring no later than time slot 8 ninth time slot may be used to slightly decrease the number of possible patterns if this is high. It is desirable that at least one additional pattern be available so that faulty operation can be signalled when two transitions are apparently separated by less than three time slots. The alternative method which uses no auxiliary ROM is shown in Fig. 9. Before describing Fig. 9 in detail it is necessary to recall that there is a time slot clock running at sixteen times the frequency of the word frame clock and also that in the code words there must be at least three time slots between adjacent transitions. This latter feature requires that a further clock signal be generated where frequency is one third the time slot clock frequency. As shown in Fig. 9 this further clock signal is reset by the word frame signal. Turning now to Fig. 9, incoming serialized code words are fed through a series of latches 101, 102, 103 clocked at time slot frequency which together with EXCLUSIVE OR gates 106 and 107 form a data validation section. The output from gate 106 is fed through a series of latches 111 115 clocked at one third the time slot frequency while the output from the gate 107 is fed through another series of latches 121 125 also clocked at one third the time slot frequency. The outputs from the latches 111 115 and 121 125 constitute ten inputs to an 11 input latch 130 which is clocked at word frame frequency. The eleventh input to the latch 130 is derived from a further latch 104 which is fed with the incoming serialized code words. Every three time slots the latches 111 and 121 capture the information derived from outputs A, B and C of the latches 101, 102, 103 and have the states 01, 10 and 11 for transitions at A, B and C respectively. If A, B and C all have no transition present these latches have the state 00. After a word, the information derived from 15 of the 16 time slots, time slots 0 14, appears at the output of latches 111 115 and 121 125 in coded form. The information for time slot 15 is captured by the latch 104. It will also have previously captured the presence of transitions at time slots 3, 6, 9 and 12 but these will be ignored. The eleven input latch 130 operates once per word and transfers the data then present at its inputs to the address inputs of a ROM 131 which contains the data necessary to convert the coded data into the original digital words i.e. the information relating to both code books A and B . At the same time the 8 data outputs from the ROM for the previous word are captured by the output latch 132. For this system it is necessary to check for invalid data where transitions occur at less than three time slots separation. If, during a word, A and C or B and C are simultaneously both 1s the word is invalid. This may either be used as a flag on the word but a possible alternative or addition would be to clear the input latch to the ROM when the word is entering and to reserve one output state, for example all ones , which may need to be excluded from the normal signal range.