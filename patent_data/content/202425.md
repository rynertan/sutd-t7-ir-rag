# SYSTEM FOR REPRODUCING MIXED IMAGES

## Claims
System zum Reproduzieren von Bildern mit Bereichen eines Textes und eines Halbtones, deren Bildelemente in ihren Intensitätswerten entsprechende Binärformat Daten umgewandelt wurden, welches aufweist

## Description
The present invention relates to the reproduction of electronically processed mixed text continuous tone images and, more particularly, to the conversion of a scanned multi bit image into a readily compressible binary image capable of reproduction with improved quality in both the text and continuous tone regions. The reproduction of mixed images using electronic scanning and processing, such as in facsimile systems, poses a particular problem since known processes that work well on graphics or text areas, having sharp black and white edges in the original images, do not work well on continuous tone or gray scale areas, and vice versa. One form of known process for such reproducing involves converting a scanned multi bit image to a binary image suitable for electronic transmission. An example of such a system is disclosed in U.S. A 4,314,281 of Wiggins et al wherein separate modes are used for processing the text areas and the continuous tone areas of an image, the desired mode being manually selected. Typically, in the former mode, continuous tone areas tend to be degraded in reproduction, while in the latter mode text edge quality is sacrificed. The scanned picture elements or pixels are processed one at a time in this system and conversion is accomplished by comparing each multi bit pixel to one of 16 thresholds stored in a RAM and presented periodically. Compression of the resulting binary images for transmission is problematical. An example of a known system for converting a multi bit image to a binary image specifically designed for compression is found in U.S. A 4,084,196 of Tisue et al, wherein in one mode the image is divided into non overlapping blocks containing 3 3 pixels. A quantized level for each block is mapped onto a fixed pattern and the value of each block can be recovered and mapped onto another pattern more appropriate for the output device, which may be a printer. Again, however, different modes are used for text and continuous tone images and one or the other mode is used for processing, resulting in some quality loss. Also, noticeable contours may result in the areas of the reproduction image where the level changes slowly as only the pixels within each block are looked at when producing the output. US A 4 225 888 discloses a facsimile system which is a combination of a prior art system called Skipping White Space SWS System, which is a digital system, and a prior art analog system called AM PM VSB Amplitude Modulation, Phase Modulation, Vestigial Side Band Modulation . The benefits of the disclosed system is that it combines the simplicity an analog system with the efficiency of a digital system, e.g. can important information such as line synchronization and a flag information be transmitted with high reliability. However, it has no means for distinguishing between TEXT and IMAGE portions of a document. US A 4 414 581 uses a dither type approach to distinguish between parts of a document showing and parts not showing tonal rendition. It involves using two different dither patterns with a plurality of threshold values, one pattern for each type of image characteristic. The present invention is directed to improving upon these known processes by providing a method and means that deal with both the text and continuous tone areas of an image to be reproduced in the same mode and which produce binary image data in a form that is readily compressible for transmission. Further, the resulting images are of better quality due to a diffused error correction technique. According to the invention there is provided a system for reproducing images having areas of text and of continuous tone the pixels of which have been converted into binary format data according to their intensity values, comprising means for dividing said binary format data into non overlapping blocks of n by n pixels, classifying means for classifying said blocks as either of TEXT or IMAGE, based on the intensity values of the n According to a second aspect of the invention there is provided a process for reproducing images having areas of text and of continuous tone the pixels of which have been converted to data into binary format data according to their intensity values, comprising the steps of dividing said data into non overlapping blocks of n by n pixels, classifying said blocks as either of TEXT or IMAGE, based on the intensity values of the n 2 pixels within each, eliminating short runs of blocks with the same classification, thresholding the values of the pixels in the TEXT blocks, calculating the average gray level of the pixels in the IMAGE blocks, then quantizing the average gray level of the pixels in the IMAGE blocks to one of a predetermined number of discrete levels, and merging the thresholded TEXT blocks and the quantized IMAGE blocks into a binary image. In order that the invention may be fully understood it will now be described by way of example and with reference to the accompanying drawings in which Figure 2 illustrates a block of pixels used in the present invention. Figure 3 illustrates a set of output pel patterns used in the present invention. Figure 4 is a flowchart of the process to convert to other halftone pattern sets. The IBM 8815 IBM is a Registered Trade Mark and many other facsimile products scan documents, convert them to binary representations, and compress the binary representations. A binary representation of a document is one in which each picture element, or pixel, is assigned one of two values, e. g., 1 or 0. When the scanned document consists essentially of black strokes on a white background or white strokes on a black background, the binary representation is a good replica of the scanned document and compression algorithms are available that reduce the amount of data by large factors. The areas of a document that consist essentially of black strokes on a white background or white strokes on a black background, shall be called text areas in the following. However, many documents contain image areas as well. These areas are not essentially black and white instead they consist of varying shades of gray. Documents that contain both image and text areas are called mixed documents. In order to represent the image areas of documents with a binary representation, a halftoning algorithm is needed. Halftoning algorithms simulate a gray level by adding black and white dots to a region in the binary representation, with increasing blackness of the gray level of the scanned image corresponding to increasing numbers of black dots in the binary representation. Although many halftoning algorithms perform well on image areas, they often perform poorly on text areas, creating ragged edges and broken strokes. In order to handle mixed text image documents, it is desirable to have an algorithm that does well in both text and image areas. Various halftoning methods are available that produce image representations of image regions with acceptable quality, but it is also necessary to consider the halftoning algorithm s effect on compression. When standard facsimile compression algorithms are applied to halftoned images, the compression techniques often expand the amount of data. In some cases data expansion of halftoned images may be by as much as a factor of three. The present invention processes the multi bit scan of a document to produce an acceptable binary representation of the document which then readily compresses when processed by standard facsimile compression techniques. The binary representation produced will have sharp edges in text areas, and will simulate continuous tones in the image areas. The processing algorithm of the invention considers the scan of the document as a sequence of blocks of pixels. Each block of N N pixels is classified as either TEXT or IMAGE. Those pixels in a block classified as TEXT are simply thresholded. Those pixels in a block classified as IMAGE are first averaged to obtain a single gray level value for the block. This gray level is then quantized to one of a number of levels, and each level maps onto a pattern of a block of pixels. The quantization process considers the errors introduced in other nearby blocks that have already been quantized. The patterns of pixels associated with the quantization levels are chosen to maximize the compression that can later be obtained by processing the binary representation with a standard facsimile compression technique. The preferred embodiment uses 8 bits of gray values 0 255 and a resolution of 200 picture elements pel per inch. With these parameters, a block size of 4 pixels by 4 pixels has proved adequate. A flow chart of the preferred embodiment of the processing required to convert a multi bit image to the desired binary representation is given in Fig. 1. In the following, the input pixels are assumed to have multi bit gray values, with larger values corresponding to a whiter input. Output pels are assumed to take on a value of 1 for a black pixel and 0 for a white pixel. As shown, the algorithm proceeds in steps with the succession running in rows from left to right and from top to bottom. The first step of the processing is a conceptual step in which the image is segmented into non overlapping blocks consisting of sixteen pixels each, arranged in a four pixel by four pixel square. The pixels of the input image are labelled as p i,j for 0 αµρ i αµρ M 1 and 0 αµρ j αµρ N 1, and block B I,J is defined to contain pixels p i,j for 4I αµρ i αµρ 4I 3 and for 4J αµρ j αµρ 4J 3. The second step of the processing classifies each block as either TEXT or IMAGE. In Fig. 2, the sixteen pixels of a block are shown. The pixel in the upper left hand corner of the block is denoted pixel A, the pixel in the upper right hand corner of the block is denoted pixel B, the pixel in the lower left hand corner of the block is denoted pixel C, and the pixel in the lower right hand corner of the block is denoted pixel D. Blocks are classified as TEXT or IMAGE according to the following rule If any of the pixels A,B,C or D has a value WBAR, then the block is classified as TEXT, if pixels C and D both have values αµρ BBAR, then the block is classified as TEXT, otherwise the block is classified as IMAGE. In this classification procedure, WBAR is a fixed threshold chosen such that all levels above it may be considered white and BBAR is a fixed threshold chosen so that all levels below it may be considered black. The third step of the processing improves the classification of blocks by first eliminating short runs of blocks that are classified as TEXT and by then eliminating short runs of blocks that are classified as IMAGE. A run of TEXT blocks is defined to be a set of consecutive blocks B I,J within a row such that the block to the left of the run is not classified as TEXT, the block to the right of the run is not classified as TEXT, and all blocks within the run are classified as TEXT. Similarly, a run of IMAGE blocks is defined to be a set of consecutive blocks B I,J within a row such that the block to the left of the run is not classified as IMAGE, the block to the right of the run is not classified as IMAGE, and all blocks within the run are classified as IMAGE. The length of the run is defined as the number of blocks in the run. The classification is first improved by eliminating all runs of blocks classified as TEXT with run lengths less than MINRUN blocks and with at least one IMAGE block in the prior row above a block in the TEXT run. Eliminating a run of TEXT blocks means changing the classification of all blocks in that run to IMAGE. The classification is then improved by eliminating all runs of blocks classified as IMAGE with run lengths less than MINRUN blocks, where eliminating a run of IMAGE blocks means changing the classification of all blocks in that run to TEXT. In a typical implementation, MINRUN may be set to 6. After the third step of the processing, in which the classification is improved, each row of input blocks is processed block by block. The processing of each block is dependent on its classification. A block classified as TEXT is processed using a fixed threshold scheme. Each of the pixels p i,j of the block is compared with a fixed threshold, THRESH. If p i,j is less than THRESH, then the corresponding output pel, o i,j , is set to 1, indicating a black output pel. Otherwise, the output o i,j is set to 0. Processing of a block classified as IMAGE The second step of processing a block classified as IMAGE consists of quantizing the average gray value of the block to one of seventeen discrete levels 0,1,...,16 , such as might be produced by a printer capable of printing a set of output pel patterns having a respective set of gray values, by the following steps This modified average is the sum of the average value of this block plus a weighted average of the quantization errors of neighboring blocks already quantized. Next the quantity Q is calculated as The quantization error of the block, e I,J , is then calculated as This quantization scheme may be called quantization error diffusion. A scheme called error diffusion e.g., see Digital Halftoning of Images by D. Anastassiou and K. S. Pennington, IBM Journal of Research and Development, vol. 26, No. 6, 687 697, November 1982 operates at the pixel level, quantizing to two levels. Quantization error diffusion operates at the block level, and quantizes the block average to one of a multiplicity of levels. In the third and final step of processing for an IMAGE block, the block quantization level, q I,J , is mapped onto a unique four pixel by four pixel binary pattern. The complete set of these patterns is given in Fig. 3. The four by four pattern sets the sixteen pels in the output block. The final stage of processing combines those bit maps produced by processing the blocks classified as TEXT and those produced by processing the blocks classified as IMAGE. The output image is merely the merger of the two sets of output blocks. The halftone patterns given in Fig. 3, when used with the procedure described above, render a binary representation which has good quality. However, in continuous tone image regions this representation may contain the texture of horizontal lines, which may be objectionable in some applications. In these situations it is recommended that the binary image, constructed as described above, be modified at print time so that the patterns of Fig. 3 are replaced by another set of patterns in continuous tone image areas. In the following, the binary image constructed as described above will be called the preferred representation . The image constructed with the replacement patterns will be called the replacement representation . A flow chart of the processing required to convert the preferred representation to the replacement representation is given in Fig. 4. As shown in the figure, this processing proceeds by steps, a detailed description of which follows. The first step of the processing is a conceptual step in which the image is segmented into non overlapping blocks consisting of sixteen pels each, arranged in a four pixel by four pixel square. The pels of the input image are labelled as p i,j for 0 αµρ i αµρ M 1 and 0 αµρ j αµρ N 1 and block B I,J is defined to contain pels p i,j for 4I αµρ i αµρ 4I 3 and for 4J αµρ j αµρ 4J 3. The second step of the processing classifies each block as either TEXT, IMAGE, WHITE, or BLACK according to the following rule The third step of the processing improves the block classifications. First, short runs of WHITE blocks are eliminated. A run of WHITE blocks is defined to be a set of consecutive blocks within a row of blocks such that the block to the left of the run is not classified as WHITE, the block to the right of the run is not classified as WHITE, and all the blocks within the run are classified as WHITE. Short runs of WHITE blocks, those with run lengths less than MINRUN, are eliminated according to the following rule If the WHITE run is followed by an IMAGE block, then reclassify all blocks in the run as IMAGE blocks, otherwise reclassify all white blocks in the run as TEXT. Next, the classification of IMAGE blocks is improved by examining prior and subsequent rows. If block B I,J is classified as IMAGE, block B I 1,J is classified as TEXT, and block B I 1,J is not classified as IMAGE, then reclassify block B I,J as TEXT. Lastly, the classification is improved by processing short runs of IMAGE blocks. If the run length of a run of IMAGE blocks is less than MINRUN, then all blocks in the run are reclassified as TEXT. Again in a typical implementation, minrun may be set to 6. After the third step of the processing, in which the classification is improved, each row of input blocks is processed block by block. The processing of each block is dependent on its classification. A block classified as BLACK, WHITE, or TEXT requires no further processing. The output pels for these blocks are identical to the input pels. The first step of processing a block classified as IMAGE consists of calculating the block quantization level, q I,J . This value is computed as the number of white pels in the block. The second step of processing for an IMAGE block consists of mapping the block quantization level, q I,J , onto a four pixel by four pixel binary pattern. Any desired set of four pixel by four pixel binary patterns may be used. However, to preserve the proper gray shade, the four pixel by four pixel pattern associated with a given level should contain a number of white pels equal to q I,J . The final stage of processing combines those bit maps produced by processing the blocks classified as WHITE, BLACK, or TEXT with those produced by processing the blocks classified as IMAGE. The output image is merely the merger of the two sets of output blocks.