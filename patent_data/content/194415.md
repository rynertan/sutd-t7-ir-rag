# BUS TO BUS CONVERTER BUS TO BUS CONVERTER

## Abstract
Bus to bus converter 8 in a data processing system comprising a system bus 6 connecting a system storage unit to a central processing unit, said converter 8 connecting the system bus 6 to an I O bus 10 to which are attached a plurality of randomly selected I O devices. The converter 8 dynamically inserts appropriate address control information into messages transmitted from the I O bus 10 to the system bus 6 , whereby access can be denied to and from selected I O devices.

## Claims
1. Bus to bus converter in a data processing system comprising a global system storage unit 4 , a central processing unit 2 , a system storage bus 6 connecting the central processing unit and the global system storage unit, an I O bus 10 having a plurality of I O ports 12 , to which are connected a plurality of randomly selected I O devices through adapters 14 said bus to bus converter interfacing the system bus with the I O bus, being characterized in that it comprises means 26 for partitioning I O address fields which are transmitted from an I O device on said I O bus into a high order field 28 and a low order field 30 means 32 for combining the DMA ID 20 of said I O device with the high order field of said I O address to form a first combined address 34 a RAM 36 for receiving said first combined address and reformatting said first combined address into a control field 38 and a prefix field 40 and outputting the same an address formatter 42 which inputs said control field, said prefix field and said low order address field and operates on said prefix field and said low order field responsive to said control field to form a second combined address 44 and means 46 for transmitting said second combined address onto said system bus.

## Description
The present invention relates to data processing systems and particularly to systems having a system bus connected through a bus converter to an I O bus, and more particularly to bus to bus translation apparatus. Many personal computers are provided with an I O bus for the attachment of I O adapters. The PC I O bus, through control signals, may define two address maps, an I O address map and a storage address map. Transactions over the PC I O bus are assumed to be targeted for one of the two address maps, and provisions are not made in the PC I O bus architecture to accommodate any address maps outside the domain of the I O and storage maps. Direct Memory Access DMA transfers initiated by adapters on the PC I O bus are required to access either the I O bus are required to access either the I O bus attached storage or the system bus attached storage. Thus the I O bus has effectively a dual storage address map, the basic I O storage map and the reflected system storage map with no provisions for differentiation between the two maps. For a given address there may exist a machine configuration with an I O adapter and system storage assigned to the same address within their respective address map. A bus converter may be interposed between a system bus and an I O bus. Since the various I O devices and the global system storage may have the same address, difficulty may be encountered in transferring messages to a particular I O device. The basic architectural assumptions that all data movement is confined within the address map or maps of the I O bus makes no provision for accommodating a foreign address map outside the basic architecture. The present invention solves the above problem by translating an address request to an address which maintains the address of the targeted storage location and in addition contains information identifying the specific I O device. It is an object of the present invention to permit the migration of an existing I O architecture and adapters to a new system with multiple address maps. It is another object of the present invention to provide a mechanism to insert control information on a message transfer originating on one bus that is targeted for a second bus. A further object of the invention is to provide a system that permits all storage addresses that are not implemented in I O bus attached adapters to be mapped to the system bus. A further object of the invention is to provide a system that permits storage addresses to be selectively mapped to the system bus with appropriate gating of I O bus control signals and or the inclusion of additional control information. Still a further object of the invention is to provide a system tolerant of changes in the configuration of the I O adapters. The system allows the contents of a control word to be changed under program control at any point in the execution of a task and thus allows for a corresponding change in the nature of the modification of the I O bus operation. These and other objects of the present invention are provided by a programmable bus to bus converter which inserts control information on a message transfer originating on one bus that is targeted for a second bus. The bus to bus converter of the present invention can be made a component of a data processing system comprising a global system storage unit, a central processing unit, a system storage bus connecting the central processing unit and the global system storage unit, said converter interfacing the system bus with an I O bus. The I O bus may be provided with a plurality of I O ports to which randomly selected I O devices are attached. In particular, the present invention is directed to means for partitioning I O address fields which are transmitted to the I O bus into a high order field and a low order field, and then combining the Direct Memory Access Identification DMA ID of the I O devices with the high order field I O address to form a combined address. The combined address is transmitted to a RAM which is programmed to reformat the combined address and to form a Translation Control Word TCW which has a control field and a prefix field. The TCW is transmitted to an address formatter. A second combined address is formed by combining the TCW and the low order field. The second combined address is then transmitted to the system bus. In one preferred embodiment of the present invention the bus converter is provided with means whereby access can be denied to certain addresses or particular I O devices. These and other objects, features and advantages of the invention will be apparent from the following, more particular description of the preferred embodiments of the invention as illustrated in the accompanying drawings. The present invention is directed to an apparatus for use on a bus to bus translation. The apparatus of the present invention provides for the insertion of control information on a message transfer originating on an I O bus that is targeted for a system bus. By using the apparatus of the present invention existing bus architecture and associated I O adapters can be used. The present invention permits attachment of existing I O architecture and adapters to a Central Processor Unit CPU and associated system storage without requiring specific adaptation of the I O devices, alteration of the CPU or its operating system. The apparatus used in a bus to bus translator of the present invention provides for dynamically translating the signals of the I O bus to new addresses on the system bus which map onto unused segments of the system storage map. The apparatus of the present invention is tolerant of changes in the configuration of the I O adapters and allows for the flow or execution of the pending I O bus operations without knowledge, or cooperation by the I O device. The TCW of the present invention contains both an address prefix and control information. The TCW allows for flexibility with respect to the I O bus operation, and can effect no modification with respect to the I O operation, provides a translation of the address as applied to the I O bus for use on a system bus, can augment the I O bus control information to permit access to the system bus in either real or virtual addressing mode, prevents access to the system bus for a given address or range of addresses, and or causes a busy or bus error response to a selected I O operation. The contents of the TCW can be changed under program control at any point in the execution of a task causing a corresponding change in the nature of the modification of the I O bus operation. Figure 1 shows a schematic representation of a system configuration which provides bus to bus translation. A central processing unit 2 and the system global storage 4 are connected by means of a system bus 6. Attached to the system bus 6 is a bus convertor 8. Attached to the bus converter 8 is an I O bus 10. A variety of I O devices can be attached to ports 12 on the I O bus 10 through I O adapters 14. Storage 16 can also be attached to the I O bus 10. The bus converter 8 is programmable and translates signals from the I O bus 10. The bus converter can support real, real resolved and virtual storage access. Figure 2 is a schematic representation of one embodiment of the bus converter 8 of the present invention. The I O bus 10 carries direct memory access identification 20 signals DMA ID , storage addresses 22 of the storage of the I O devices, as well as the stored data. The addresses pass through receiver 24, and next pass through means 26 for partitioning each I O address 22 into a high order field 28 and a low order field 30. Means 32 are provided for combining the DMA ID 20 and the high order field 28 to form a first combined address 34. A RAM 36 provides a table of programmable entries that instruct the logic in the bus converter 8 on the required action to be taken on each I O bus cycle. The RAM 36 is programmed to reformat to first combined address 34 into a control field 38 and a prefix field 40. The control field 38 and the prefix field 40 form the TCW. Figure 3 is a schematic representation the format of a TCW. The format contains a format control and a prefix. Part of the format control information identifies the target storage unit. If maps with duplicate addresses are used the format control contains the necessary information to select which map to address. Other portions of the format control are used to control the formatting of the address by the bus converter. The prefix contains the information necessary to identify the address within the target storage area. Again referring to figure 2 an address formatter 42 receives the control field 38, the prefix field 40 and the lower order address field 30 and operates on the prefix field 40 and the lower order address field 30 to form a second combined address 44 which is transmitted to the system bus 6 through the bus driver 46. This combined address 44 directs the data from the I O bus 10 to a unique region within the global storage system. Additional variations in the translation ability of the bus converter 8 can be accomplished by including a gate 48 through which the lower order field 30 passes. The gate 48 is responsive to the control field 38 and limits the bits transferred from the lower order field 30 to the address formatter 42. The control field 38 can be input to means 50 for generating bus control signals. Means 50 sends control signals 52 back to the I O bus 10 to control the I O devices. This can result in denial of access to a selected address block of an I O device. In another preferred embodiment the DMA IDs are input into the address formatter 42 with the control field 38, the prefix field 40, and the lower order field 30. The address formatter 42 operates on the prefix field 40 and the lower field 30 responsive to the DMA ID 20 and the control field 38 to produce a combined address which the bus driver 46 transmits to the system bus 6. In another preferred embodiment the RAM 36 is programmed to generate a control field 38 for certain DMA ID s 20 which will block the address formatter 42 from generating a combined address and thus deny access to the system global storage map 4. Figure 4 is a schematic representation of the mapping of the I O storage onto the system global storage. The I O storage is partitioned into blocks 62. For each block there is an associated RAM element 64. Each RAM element 64 contains a control code and a prefix. The control code and prefix point to blocks 66 in the global storage map 68. The local address in each of the blocks is determined by the lower order address bits forming the lower order field 30. While the novel features of this invention have particular applications, it will be appreciated that various omissions and substitutions in form may be made by those skilled in the art without departing from the spirit of the invention.