# IMAGE PROCESSING FOR PHOTOGRAPHING SCINTIGRAM OF SUBJECT ON X RAY FILM AT OPTIMUM DENSITY

## Claims
Nuklearmedizinisches Diagnosegerät mit

## Description
This invention relates to a diagnostic nuclear medical apparatus and, more particularly, to image processing for an apparatus using a digital scintillation camera. Diagnostic nuclear medical apparatuses are utilized for the diagnosis of subjects human patients through detection of the distribution of gamma rays emitted from the subject dosed with radioisotopes hereinafter referred to as RI . In a prior art gamma camera system, gamma rays emitted from the interior of the subject are detected by a gamma camera having a two dimensional detection surface, and position signals indicative of positions at which gamma rays are detected are fed to a gamma imager. The gamma imager exposes an X ray film with luminescent spots according to the detected distribution of the gamma rays to obtain a scintigram an RI distribution image . Recently, digital scintillation camera systems have been applied in practice to obtain a scintigram of subject. Diagnostic data position data obtained from a scintillation camera is converted by an analog to digital converter into digital data for storage in an image memory. In the memory, the number of times i.e., counts gamma rays are detected at each position i.e., each pixel on the detection surface of the camera is stored as data. Data is read out from the image memory in the order of addresses corresponding to picture elements on the camera detection surface for conversion by a digital to analog converter into analog information. The analog information is further converted into a video signal for displaying the RI detection times at graduated levels of brightness. The video signal is fed to a video imager to display a luminescent spot image on a TV monitor. The luminescent spot image is imaged photographed by a multi format camera on an X ray film. A portion of the subject where the RI detection count is large is displayed with high brightness on the TV monitor. A portion where the RI detection count is high, on the other hand, is imaged black on the X ray film, i.e., it is photographed at a high photographic density. The relation between the video signal amplitude level and X ray film photographic density is peculiar to a film photographing system including a TV monitor, X ray film, developing unit and liquid developer . With such a diagnostic apparatus, in many cases, a contrast between a region of interest and other regions imaged on the X ray film provides important information for the diagnosis. Therefore, it is desired to photograph the region of interest at an optimum density. Otherwise, erroneous diagnosis is liable to result. In the digital scintillation camera system, the video signal gray scale GRAY has 256 levels from 0 to 255, for instance. The display count scale WINDOW , i.e., the gamma ray detection times, has 4,096 count levels of 0 to 4095, for instance. The display gray scale level is linearly proportional to the video signal amplitude level in volts . The GRAY scale and WINDOW scale may be arbitrarily set through a keyboard of a computer system by an operator. For example, 10 to 50 counts may be made to correspond to a gray scale of 20 to 100. For this reason, it is possible to freely determine the relation between the WINDOW level and X ray film photographic density. Once this relation is determined, the relation between the WINDOW level and GRAY scale can be determined. The quality such as density and contrast of image on the X ray film is influenced by the type of an X ray film used, an elapsed period after the manufacture of the film, and developing conditions developing unit, liquid developer, etc. . The upper and lower limits of gamma ray detection counts depend on the kind of an organ to be diagnosed and the kind of a radioactive medicine used. Therefore, the image quality is also influenced by these conditions. Therefore, in order to obtain the optimum image quality for the diagnosis, it is necessary to determine optimum image processing conditions for each diagnosis. This is, however, time consuming. Prior art document US A 3,983,394 discloses a radiation camera exposure control apparatus and method in which a signal output from a scintillation camera unit is supplied directly to an oscilloscope. In accordance with the applied signal, an image is formed on the display of the oscilloscope, and this image is photographed onto a film by a photo camera. While supplying one signal directly to the display, the scintillation camera supplies another signal to an information control circuit, to control the amount of exposure at which the photo camera photographs the image onto the film. The signal supplied to the control circuit is processed by a D A converter, which produces an output signal, in accordance with which the exposure value of the photo camera is adjusted, thereby to obtain an optimum density characteristic on the film. It is an object of the invention to provide an improved diagnostic nuclear medical apparatus and a method of photo graphing a scintillation image which enable all subjects of diagnosis to be photographed on an X ray film at an optimum image quality for diagnosis on condition that the characteristics of a film photographic system remain constant. To solve this object, the present invention provides a digital nuclear medical apparatus as stated in claim 1 and a method of photographing a scintillation iamge as stated in claim 4. Thus, in the apparatus of the present invention the data processing means is arranged to convert the digital data into the analog information such that the conversion characteristic of the radiation detection level to the photographic density of a scintigram image on the developed film is made substantially linear. This invention can be more fully understood from the following detailed description when taken in conjunction with the accompanying drawings, in which For better understanding of the invention, a prior art digital scintillation camera system will now be described with reference to Fig. 1. Gamma rays emitted form the inside of subject P with RI dosed are detected by scintillation camera gamma camera 11. Camera 11 progressively provides analog position data with a magnitude corresponding to a gamma ray detection count for each pixel on a detection surface having X Y co ordinates, according to the sequence of arrangement of pixels. A D converter 12 converts analog position data into 16 bit digital data. Digital data corresponding to pixels on the detection surface are successively stored in locations of image memory 13 in a data processing section which correspond to the positions of the pixels. 16 bit digital data is progressively read out from image memory 13 to be applied to conversion table memory 14. Conversion table memory 14 converts 16 bit digital data into 8 bit digital data. This means a provision of a display gray scale having 256 2⁸ gradations from 0 to 255. D A converter 15 converts 8 bit digital data into analog data. D A converter 15 converts digital data of the highest gray level of 255 to analog data of the maximum amplitude level of, for instance, 0.7 volts. Analog data of 0 to 0.7 volts is applied to video imager 16 to display a scintigram in 256 gradations on a TV monitor. A bright spot image on the TV monitor is photographed by a multi format camera onto X ray film 17. Analog data is also applied to data processing display 17. A region of interest is set while watching an image on display 17. Fig. 2 shows a characteristic of video imager 16, i.e., a characteristic of conversion of video signal level to X ray film photographic density. The video signal maximum level of 0.7 volt is converted into the maximum photographic density level of 2.0. The shape of conversion characteristic curve shown in Fig. 2 varies with the type of X ray film used and development conditions. Fig. 3 shows a characteristic of conversion of WINDOW level to GRAY level. This characteristic is set in conversion table memory 14 of Fig. 1. This conversion characteristic can be desirably set by rewriting the content in conversion table memory 14. The conversion characteristic is determined by a characteristic of conversion of WINDOW level to photographic density that the operator desires. Fig. 4 shows a GRAY scale to video signal level conversion characteristic of D A converter 15. It will be seen that the video signal level is linearly proportional to the GRAY scale. The characteristic of Fig. 2 shows that the maximum count of 4,095 is converted to the maximum photographic density of 2.0. The maximum count varies depending on the kind of organs to be diagnosed and the kind of radioactive medicine used. Therefore, when the maximum count is considerably smaller than 4,095, it is impossible to obtain a scintigram with a contrast suited for diagnosis. The invention intends to obtain an X ray image with an optimum contrast for diagnosis irrespective of the maximum gamma ray detection count. Accordingly, a feature of the invention resides in automatically setting in a conversion table memory the WINDOW level to gray scale conversion characteristic shown in Fig. 3, which enables WINDOW level to photographic density characteristic as shown in Fig. 5 to be linear, with the aid of detection data from the scintillation camera, and a video signal level to photographic density conversion characteristic shown in Fig. 2 which can be known from a measurement. Now, the image processing in accordance with the invention will be described. The processing according to the invention comprises two stages, i.e., a pre processing stage of measuring the characteristic of the film photographing system and a image collection stage for diagnosis. In the pre processing stage, a 16 gradation test pattern video signal, which indicates a test pattern having 16 gradations obtained by dividing the gray scale of 0 to 225 levels an equal step size, is fed to the video imager to be displayed on a TV monitor. The test pattern image on the TV monitor is photographed by a multi format camera to obtain an X ray film image for testing. This X ray film image has a gray level to photographic density conversion characteristic D G as shown in Fig. 6. This conversion characteristic is peculiar to a film photographing system. The X ray film image is measured by a film density meter so that the density level is read for each of 16 gradations of the test pattern. The measurement data of the X ray film image is fed through a keyboard to a computer, in which the gray level to photographic density conversion characteristic is filed in a memory in the form of a data table. In the actual image collection stage, a region of interest is set on a data collection display where a diagnostic image is displayed. The gamma ray detection count for each picture element in the region of interest is checked, and an average AV per one pixel of the counts is computed. Further, a standard deviation value SD of counts per one pixel of the region of interest is computed. From the average value AV and standard deviation value SD, display window upper level WU is computed as follows In this embodiment, upper and lower levels WU and WL of the display window are made to correspond to the maximum and minimum density levels 2.0 and 0 of the photographic density, respectively, as shown in Fig. 7. A data table showing a WINDOW level to photographic density conversion characteristic which changes linearly between WL and WU is prepared by the computer and stored as data table in a memory. In Fig. 7, conversion characteristics n1 and n2 corresponding to display window upper levels WU1 and WU2 in different examples of diagnosis are shown. The computer refers to the data tables showing the characteristics of Figs. 6 and 7 to prepare a data table of a window level to gray scale conversion characteristic shown in Fig. 8. This data table is prepared by reading out the window level and the gray level corresponding to a photographic density level. Fig. 8 shows conversion characteristics g n1 and g n2 corresponding to window upper levels WU1 and WU2. The conversion characteristic of Fig. 8 corresponds to an inverse function D The window level to gray level conversion table thus obtained is loaded into a conversion table memory. As a result, the diagnostic image data read out from the image memory is converted into a gradation image data according to the characteristic shown in Fig. 8. With this image data fed to the video imager, an X ray image is obtained which has a characteristic in which the density level is linearly proportional to the window level as shown in Fig. 7. Therefore, it will be understood that all the diagnostic X ray images are obtained at an optimum image quality irrespective of the upper counts of the gamma ray detection unless the characteristic of the film photographing system shown in Fig. 6 is changed. Now, the arrangement of the digital scintillation camera system according to the invention will be described with reference to Fig. 9. Gamma ray measurement data detected by gamma camera 90 is converted by A D converter 91 into 16 bit digital image data for each pixel. The digital image data is coupled to image data collection section 92. Image collection section 92 is coupled to central processor unit CPU 93 through address bus 94 and data bus 95. Man machine interface 96, system memory 97 storing operation programs, hard disk unit 98, image memory 99 and conversion table memory 100 are also coupled to CPU 93 via address bus 94 and data bus 95. Conversion table memory 100 is coupled to video imager 102 through D A converter 101. Image memory 99, conversion table memory 100 and D A converter 101 constitute a count to video signal conversion section. Image data collected in image data collection section 92 is stored in hard disk unit 98. Data table showing the characteristic of the film photographing system shown in Fig. 6, obtained in the pre processing stage described before, is in advance stored in hard disk unit 98 through man machine interface 96. To photograph a diagnostic image, image data is transferred from hard disk unit 98 to image memory 99. Image memory 99 has a capacity of storing 16 bit data for each of 512 x 512 pixels, for instance. This operation corresponds to an image collection step S100 shown in Fig. 10. Man machine interface 96 includes data collection display, on which a diagnostic image is displayed. By watching the diagnostic image a region of interest ROI having a size of 3 x 3 cm², for instance, in the diagnostic image is set using track ball and numeral keys step S101 . CPU 93 reads in image data of the region of interest from hard disk unit 98 or image memory 99. CPU 93 checks the counts for each pixel in the region of interest and computes the average value AV of counts per pixel step S102 . Subsequently, CPU 93 computes standard deviation value SD step S103 . CPU 93 further computes display window upper level WU from average value AV and standard deviation value SD according to equation 1 step S104 . CPU 93 prepares a data table representing a line connecting a point WU, 2.0 of photographic density and a point WL 0, 0 as shown in Fig. 7 and stores it in hard disk unit 98 step S105 . CPU 93 prepares the conversion table as shown in Fig. 8 by refering to the data table shown in Fig. 6 and data table shown in Fig. 7 stored in hard disk unit 98 step S106 . CPU 93 loads the conversion table into conversion table memory 100. 16 bit image data is read out from image memory 99 to be converted by conversion table memory 100 into 8 bit image data step S108 . Conversion table memory 100 is addressed by 16 bit data to provide 8 bit data. 8 bit data from the conversion table memory is converted by D A converter 101 into analog data which is applied to video imager 102 to obtain a scintigram step S109 . Fig. 11 shows a modification of the count to video signal conversion section. In this example, conversion table memory 100a is disposed ahead of image memory 99a. Conversion table memory 100a has 16 bit address inputs and 8 bit data outputs. Image memory 99a has a capacity of 512 x 512 x 8 bits. 8 bit conversion data from CPU 93 is written into conversion table memory 100a. To write the data, 16 bit image data read out from hard disk unit 98 in the order of pixels is transferred through a bus controller not shown from data bus 95 to address bus 94 to thereby access conversion table memory 100a. Image memory 99a is accessed in the order of pixels for writing 8 bit data from conversion table memory 100a. In this embodiment, the capacity of image memory 99a may be less than that of the image memory shown in Fig. 9. Fig. 12 is a graphical representation of the image processing according to the invention so far described. Fig. 12 A is a graph showing a RI distribution in ROI. In the Figure, the ordinate is taken for the number of pixels, and the abscissa is taken for count. The display window upper level WU is computed from the average count AV per pixel and standard deviation SD according to equation 1 . As shown in Fig. 12B, a linear count to photographic density conversion characteristic is obtained, in which WU corresponds to a photographic density of 2.0. With this conversion characteristic, the distribution ℓ of numbers of pixels with respect to counts, is converted into a distribution ℓ of numbers of pixels with respect to photographic density according to which a ROI scintigram image has an optimum density on an X ray film, as shown in Fig. 12 C . That is, the characteristic of the film photographing system is corrected so that the ROI is photographed on the X ray film with the best quality suited for diagnosis. The ROI may be a lattice ROI, which divides the display into a plurality of units, for instance 32 x 32 units. In this case, the count average is obtained for each ROI, and the display window upper level WU is computed for the ROI having the maximum average value of count.