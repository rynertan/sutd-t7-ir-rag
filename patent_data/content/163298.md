# PCM CODER DECODER WITH TWO WIRE FOUR WIRE CONVERSION

## Claims
PCM Kodierer und Dekodierer mit

## Description
The present invention relates to a PCM coder and decoder having the function of two wire four wire conversion, and more particularly to a coder and decoder CODEC which is used in the subscriber s circuit of a digital switching system, etc. and in which a PCM signal applied to a four wire receiving line is decoded and converted into an analogue signal that is sent to a two wire line being subscriber s line, while an analogue signal from the two wire subscriber s line is coded into a PCM signal that is sent to a four wire transmission line. The subscriber s circuit of a switchboard is arranged so as to have the functions of battery feed, overvoltage protection, ringing, supervision, PCM coding and decoding, two wire four wire conversion, test, etc. In the arrangement having these functions, a circuit for the two wire four wire conversion has heretofore been constructed separately from a PCM coder and decoder. Recently, however, with the progresses of semiconductor integration technology and signal processing circuit technology, it is studied to construct the conversion circuit unitarily with the PCM coder and decoder Electronics May 5, 1982, pp. 113 118 . In order to realize the function of two wire four wire conversion by the use of an electronic circuit, an input signal from a receiving line must be sent to only a bidirectional two wire line, such as subscriber s line, so as not to return to a transmission line and then be provided as an output. To this end, in a PCM coder and decoder hitherto proposed, a circuit for canceling a return signal, namely, a balancing circuit is constructed of a digital circuit unitarily with the PCM coder and decoder. More specifically, a voice analogue signal from a two wire line to be transmitted is converted into a digital signal via a pre filter for eliminating high frequency noise and an A D converter, and the digital signal has its band limited by a digital filter and is thereafter delivered to a transmission line as a PCM signal. On the other hand, a PCM signal received from a receiving line has its band limited by a digital filter and is passed through a D A converter and a post filter so as to be supplied to a two wire line as a voice analogue signal. The balancing circuit is so constructed that a filter which has characteristics approximating the transmission characteristics of the path of the return signal is interposed between the A D converter and the D A converter so as to subtract the output of the filter from the output of the A D converter. With the PCM coder and decoder as stated above, an amplifier circuit is generally provided in the path of the return signal. It is therefore sometimes the case that the leakage signal becomes greater in amplitude than the received signal and exceeds the coding level of the A D converter. Even when the leakage signal is not higher than the maximum coding level, the return signal is superposed on the signal from the two wire line which ought to be transmitted, resulting in the problem that the dynamic range of the transmission signal becomes insufficient, which deteriorate the S N ratio. Further, when it is intended to implement the coder and decoder in the form of an LSI, the composite amplitude of the return signal and the transmission signal might exceed a supply voltage to destroy the LSI. In contrast to the aforementioned balancing circuit realized by the all digital circuit, it is also considered that a balancing circuit is constructed of only analogue circuits and is formed between the input of an A D converter and the output of a D A converter. Since, however, the balancing circuit needs to be suited to various loads, namely, impedances on the two wire line side, it must comprise a plurality of analogue circuits having different transfer functions, and a circuit for selecting and controlling the optimum analog circuit is required. In case of digital circuitry, a plurality of balancing circuits can be readily realized by changing the coefficient of a multiplier unit and without adding any circuit device, whereas in case of analogue circuitry, the realization of a plurality of balancing circuits of different transfer functions makes it necessary to switch and use different resistors, capacitors, operational amplifiers etc., resulting in a large circuit device scale which incurs the problem that an economical occupation area cannot be held in the LSI implementation. Further, a circuit arrangement according to the first part of claim 1 and comprising an analogue balancing circuit and a digital balancing circuit is known from The Bell System Technical Journal , Vol. 60, No. 7, pp. 1585 1619, September 1981. The analogue balancing circuit, however, requires a especial transfer function having one pole and a frequency characteristic with its zero point fixed so that the impedance of a two wire four wire interface portion for example, a transformer and a plurality of two wire subscriber s line impedances can be coped with. Accordingly, the realization of such an analogue balancing circuit requires a capacitor or an inductor of comparatively large element value, and the LSI implementation is, in effect, impossible from the economical viewpoint as in the foregoing case. Moreover, with the analogue balancing circuit, a fluctuation in the absolute value of the element value directly changes the frequency gain characteristic and phase characteristic of a return signal, and it becomes very difficult to suppress the return signal precisely by means of the digital balancing circuit at the succeeding stage. A further PCM coder decoder is known from Electronics Engineering , Vol. 55, No. 684, pp. 37 43, December 1983, in which a compression of the PCM signal is performed by a signal processor connected to the outgoing transmission line. It is an object of the present invention to provide a PCM coder and encoder having a balancing circuit which efficiently suppresses the return signal with a circuit arrangement that permits full LSI implementation. This object is met by the PCM coder and decoder defined in claim 1. According to the invention, the balancing circuit is divided into two portions, the first portion forming a digital circuit interposed between the input side of a D A converter and the output side of an A D converter and the second portion forming an analogue circuit interposed between the output side of the D A converter and the input side of the A D converter and having no frequency response, namely, having a gain independent of frequencies. The analogue circuit is used for stably lowering the level of the return signal, whereby degradation in the S N ratio of the A D converter is lessened, and the digital circuit is used for changing the transfer function of a digital filter in accordance with the impedance of a two wire transmission line side, whereby the return signal can be canceled at high precision. In a more preferable aspect of performance of the present invention, a circuit portion whose sampling frequency is high, that is, whose sampling period is short is used for adjusting a signal delay, whereby a delay compensation of high precision is permitted, and a sufficient return loss is attained. The above mentioned and other objects and features of the present invention will become more apparent from the following description taken in conjunction with the accompanying drawings. Fig. 1 is a diagram showing the arrangement of an embodiment of a PCM CODEC according to the present invention. Fig. 2 shows a frequency characteristic diagram of the transfer functions of return signals. Figs. 3 and 4 are circuit diagrams each showing an embodiment of an analogue balancing circuit in Fig. 1. Fig. 5 shows the arrangement of another embodiment of the CODEC according to the present invention. Fig. 1 is a diagram showing the arrangement of one embodiment of a PCM coder and decoder CODEC according to the present invention. In the figure, a portion enclosed with a dotted line 0 is a coding and decoding portion which has a balancing circuit, while the other portion is an equivalent circuit from the analogue input and output terminals 1, 10 of this coder and decoder to a telephone set and is conjointly illustrated for the description of the present invention. A PCM signal from a receiving line not shown which is a four wire line is applied through a terminal 6 and has its band limited by a digital filter 7. Part of the resulting signal is converted by a D A converter 8 into an analogue signal, which is smoothed by a post filter 9 and then provided from the terminal 10 as a decoded voice analogue signal. On the other hand, a voice analogue signal to be transmitted is applied through the input terminal 1, an adder 14 and a pre filter for eliminating high frequency noise 2 to an A D converter 3, by which it is converted into a digital signal. Further, the digital signal is passed via an adder 12 and has its band limited by a digital filter 4, whereupon the resulting signal is delivered from an output terminal 5 to a transmission line not shown of a four wire line as a PCM signal. As will be discussed in detail later, a digital filter 11 and an analogue filter 13 constitute the balancing circuit along with the adder 12 and the adder 14 respectively. This balancing circuit is a circuit for eliminating a signal, which arises in such a manner that the analogue signal from the terminal 10 returns through an amplifier 16, a terminal impedance 17 and an amplifier 16, and it forms the essential portion of the present invention. After passing through the external amplifier 16 gain In the above equation, the component of the return signal is the second term. Here, by way of example, the following four typical impedances corresponding to a two wire side telephone line in North America will be concretely studied and the transfer functions H Accordingly, if can be put, H Fig. 3 shows a circuit illustrative of one embodiment of the balancing circuit 13 and adder 14 in Fig. 1 in the case of ab O. A terminal 4 8 is connected to the input terminal 1, a terminal 4 9 is connected to the output side of the post filter, and a terminal 4 14 is connected to the input side of the pre filter. A capacitor 4 6 capacitance C₄ , a capacitor 4 7 capacitance C₅ and an operational amplifier 4 2 constitute a well known amplifier Likewise, a capacitor 4 3 capacitance C₁ , a capacitor 4 4 capacitance C₂ , a capacitor 4 5 capacitance C₃ and an operational amplifier 4 1 constitute a circuit for the addition between the input voltage of the terminal 4 8 and the output voltage of the amplifier 4 2. Further, a capacitor 4 11 capacitance C₆ , a capacitor 4 12 capacitance C₇ and an operational amplifier 4 13 constitute an inverting amplifier 4 0 for the output voltage of the amplifier 4 1. Letting v₈ and v₉ denote the input voltages of the terminals 4 8 and 4 9 respectively, the output v₁₄ of the inverting amplifier 4 0 becomes Here, assuming C₁ C₂ C₃ and C₆ C₇, Thus, since and hold, Eq. 9 is brought into agreement with Eq. 7 by putting It is accordingly understood that the circuit of Fig. 3 realizes the desired balancing circuit 13 and adder 14 in Fig. 1. Further, the circuit of Fig. 3 can be adapted to various values of the gain ab of the external circuit by changing the ratio of C₄ and C₅. More specifically, for ab 2, C₄ C₅ is set, whereby k 1 can be realized, and for, e. g., ab 1.5 and ab 3, C₄ 3 4 C₅ k 3 4 and C₄ 3 2 C₅ k 3 2 are respectively set, whereby effects quite equal to those illustrated in Fig. 2 can be attained for the impedances of Eqs. 2 5 . Next, Fig. 4 shows one embodiment of the balancing circuit 13 and adder 14 in Fig. 1 in the case of ab 0. Since, in this case, the phase of the return signal at the terminal 4 8 has been inverted, the signal for cancellation to be applied from the terminal 4 9 need not be phase inverted. It is accordingly possible to omit the capacitors 4 6 and 4 7 and the amplifier 4 2 and to apply the output signal of the post filter directly from the capacitor 4 4. The operation of this embodiment can be readily conjectured from the above first embodiment, and shall not be explained. In Fig. 3 or Fig. 4, the inverting amplifier 4 0 indicated by a broken line can be dispensed with in such a way that the output voltage 4 10 of the amplifier 4 1 is used as an input signal to the pre filter. As a result, the phase of the adder output signal responsive to the input signal from the terminal 4 8 is inverted. Regarding any influence ascribable thereto, if necessary, the phase inversion of the signal may be performed in any desired place of the pre filter, the A D converter, the digital filter, etc., and the phase inversion is possible by the use of a method already known extensively and generally. Further, with an arrangement not shown wherein any of the capacitors C₄, C₅ and C₂ in Fig. 3 or Fig. 4 is divided into a plurality of capacitors which are respectively provided with switches, the capacitance ratios namely, the values of Next, an allowable voltage will be studied. In the case of Fig. 3 or Fig. 4, the potential of the inverting input terminal of the operational amplifier 4 1 is fixed to the potential of the non inverting input terminal earth , and hence, the allowable voltage of the signal to be applied to the input terminal 4 8 1 in Fig. 1 is determined by the breakdown voltage of the capacitor 4 3. In case of realizing the coder and decoder in the form of an LSI, the allowable voltage is not affected by a supply voltage or the breakdown voltage of any other circuit element for example, the operational amplifier 4 1 . In the circuits of Figs. 3 and 4, the capacitors may well be replaced with resistance elements. Since the analogue circuit in Fig. 3 or Fig. 4 is constructed by resorting to only the relative precisions of the capacitors or resistors, the desired value Fig. 5 is a diagram which shows the arrangement of another embodiment of the PCM coder and decoder according to the present invention. In the figure, the same constituents as in Fig. 1 are indicated by identical symbols. Especially to the end of setting a sufficient return loss, the present embodiment is so arranged that delays which arise when return signals pass through digital filters 4 P and 7 S, an A D converter 3, a D A converter 8, analogue filters 2 and 9, etc. are precisely compensated by the output of a digital filter 11. A PCM signal a PCM signal according to the µ law from a four wire receiving line 6 B is converted by an expandor 22 into a linear PCM signal, which is converted by a digital filter 7 P into a digital signal having a sampling frequency of 32 kHz. Part of the digital signal is further changed by the digital filter 7 S into a digital signal having a sampling frequency of 512 kHz, and the resulting signal is passed through delay means 23. The delayed signal is passed through the over sampling type D A converter 8 and the post filter 9 to become a decoded analogue signal, which is partly delivered to a two wire line being subscriber s line via a buffer amplifier 16 and a terminal impedance 17. On the other hand, an analogue signal 19 from the subscriber s line is passed through an amplifier 15 and the pre filter 2 and is converted by the over sampling type A D converter 3 into a digital signal sampled at a sampling frequency of 512 kHz. The digital signal is further changed into a digital signal at a sampling frequency of 32 kHz by the digital filter 4 P, and the resulting signal is applied to an adder 12. The adder 12 serves to eliminate a component which is such that the digital signal from the four wire receiving line 6 B has been decoded and returned to the path of the blocks 2, 3 and 4 P through the amplifier 16 as well as the terminal impedance 17. Part of the output of the digital filter 7 P is applied to the adder 12 through delay means 24 as well as the BN balancing network filter 11. The output of the adder 12 applies only the signal component from the signal source 19 to a digital filter 4 S, which converts the applied signal into a linear PCM signal at a sampling frequency of 8 kHz . Further, the linear PCM signal is changed into a nonlinear PCM signal of, for example, the µ law or the A law by a compressor 21, and the nonlinear PCM signal is delivered to a four wire transmission line 5 B. As stated before, the component by which the decoded signal returns to the coder side and which is the return signal undergoes the following delay in the course of shifting from the filter 7 S to the adder 12 Usually, a sampling frequency of at least 512 kHz is employed for the over sampling type A D converter 2 and D A converter 8, and a clock at a still higher frequency for example, 1024 kHz is employed for the digital filter 4 P for processing the A D conversion result. Accordingly, when this clock is used, the delay adjustments in the delay circuits 23 and 24 can be performed at a precision corresponding to one clock pulse period of 1 µs or less. As a result, the delays of the filters 4 P and 7 S, the A D and D A converters 3 and 8, the pre and post filters 2 and 9, etc. are considered, and the delay magnitude of the delay circuit 23 is adjusted so that the sum between the total of the considered delay magnitudes and the delay magnitude of the delay circuit 23 may become close to a value which is integral times the sampling period of the filter 7 P. Then, the delay of a signal the output of the filter 11 for canceling the return signal can be adjusted by the simple delay circuit 24. Assuming by way of example that the sampling frequency of the output of the filter 7 P be 32 kHz, that the sampling frequencies of the A D and D A converters be 512 kHz, that the clock be 4.096 MHz, and that the summation of the delay times of the filters 4 P and 7 S, the A D converter 3, the D A converter 8, and the pre and post filters 2 and 9 be 119.5 µs, then the delay circuit 23 can be controlled with the clock of 4.096 MHz, and the delay magnitude thereof can therefore be set at 5.62 µs 23 x 1 4.096 x 10⁶ . Accordingly, the total delay magnitude can be set at 125.1 µs by the insertion of the delay circuit 23. This value is a value which is close to four times 1 32 x 10³ x 4 125 µs the sampling period of the output signal of the filter 7 P, and the delay circuit 24 can afford a delay which is integral times as large as 31.25 µs 1 32 kHz , so that the output of the filter 11 can have its delay compensated at a precision of 0.1 µs. It is to be understood that the delay circuit in Fig. 5 can be readily constructed by the use of a shift register, a memory or the like. While, in the embodiment, the delay circuit 23 is inserted on the input side of the D A converter, it may well be installed on the input side of the filter 7 S, the output side of the A D converter or the output side of the filter 4 P, or it may well be installed in dispersed fashion. Further, it is needless to say that a quite equal effect is attained even when the roles of the delay circuits 23 and 24 are replaced with each other so as to finely adjust the delay magnitude by means of the delay circuit 24. As set forth above, according to the present invention, the compensation of a signal delay is permitted at high precision, and a two wire four wire conversion function of good characteristics can be constructed and realized within a digital CODEC LSI, so that the miniaturization and economization of the subscriber s circuit of a switching system becomes possible over the function in the prior art constructed by adding a transformer or an external circuit.