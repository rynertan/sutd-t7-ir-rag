# Processing circuit capable of raising throughput of accumulation

## Claims
Verarbeitungsschaltung mit einer Multiplikationseinrichtung 15 zur sukzessiven Multiplikation eines innerhalb eines Bereichs von 2

## Description
This invention relates to a processing circuit for use in processing digital signals in a signal processor. In general, digital signal processing can accomplish reliability and stability higher than analog signal processing and realizes a filter and a modem which have high reliability and high stability. In addition, the digital signal processing enables a time varying adaptive filter which can not be expected in the analog signal processing. However, the digital signal processing is inferior in a size of hardware and in power consumption to the analog signal processing. Under the circumstances, the digital signal processing has not been put into practical use until recent rapid evolution of a digital large scale integration circuit, namely, an advent of a signal processor for processing digital signals. Such a signal processor must process arithmetic operation at a high speed because a differential and an integration can be carried out in a digital manner. The signal processor has therefore been developed independently of a general purpose computer and a general purpose microprocessor. In order to increase throughput of the signal processor by the use of a small amount of hardware, each value or number is frequently represented by two s complement of a binary number and is often expressed by a fixed point representation. More specifically, the signal processor processes a digital signal which is subjected to analog to digital conversion and which is normalized with reference to a maximum acceptable amplitude of an analog to digital converter. For this purpose, the maximum acceptable amplitude is represented by 1.0. In the fixed point representation, a fixed point is placed between a most significant bit and a most significant bit but one. Each value is handled as numerals falling within a range from 1 inclusive to 1 exclusive . The range will be called a predetermined dynamic range and specified by 1, 1 . It is mentioned here that the most significant bit serves as a sign bit, as known in the art. In an article contributed by Takao Nishitani et al to IEEE Journal of Solid State Circuits, Vol. SC 16, No. 4 August 1981 , pages 372 to 376, a signal processor is used to calculate a product of a first input data word and a second input data word. When each of the first and the second input data words has a single precision bit length of N bits given by the fixed point representation of two s complement, the product can be represented by a double precision bit length of 2N 1 bits. In this event, a fixed point of the product is located between a most significant bit and a most significant bit but one, like each of the first and the second input data words. A more significant half N bits of the product is produced as an output signal so as to keep a dynamic range of each signal constant. In a finite impulse response FIR filter, such a signal processor must carry out an arithmetic operation given by where x In Equation 1 , the coefficients a Taking the above into consideration, a conventional method converts the coefficients a From Equation 3 , it is readily understood that the output signal y Each time when the overflow occurs in a signal processor comprising a single precision adder, it is usual that a maximum value is substituted for an overflow value by hardware. Alternatively, the overflow is neglected and handled as a calculation noise. As far as the finite impulse response filter is concerned, such an overflow does not put a system in an unstable state. However, in a system, such as an infinite impulse response filter, having a feedback loop, occurrence of an overflow gives rise to unstability of the system. Accordingly, replacement of a maximum value should be done on occurrence of the overflow even at the cost of an operation speed. As mentioned above, conventional methods either neglect an overflow appearing in the course of calculation or replace a maximum value each time when an overflow occurs. The neglection of overflow and frequent replacement of the maximum value result in an undesirable error of the output signal y In a paper described in PROCEEDINGS ICASSP 85, IEEE INTERNATIONAL CONFERENCE ON ACOUSTICS, SPEECH, AND SIGNAL PROCESSING, VOL. 1, pages 228 to 231, a signal processor is disclosed by Cole Erskine et al. The signal processor is for carrying out calculation of Equation 1 and comprises a multiplier for multiplying a first data word of 16 bits by a second data word of 16 bits to produce a product of 32 bits. Each of the first and the second data words has a single precision bit length while the product has a double precision data length. The product of 32 bits is sent through a shifter to an arithmetic logic unit to be successively accumulated into a result of accumulation of 32 bits. The result of accumulation is divided into an upper significant half of 16 bits and a lower significant half of 16 bits which are kept in an upper part and a lower part of an accumulator, respectively. The upper and the lower significant halves of the result of accumulation are produced as an accumulator output signal from the accumulator. The accumulator output signal is fed back to the arithmetic logic unit on one hand and are delivered to a data bus of 16 bits through shifters on the other hand. The shifters serve to adjust the accumulator output signal of 32 bits to the data bus of 16 bits by shifting the accumulator output signal by a single bit or four bits. Such shift operation may be carried out towards a least significant bit of the accumulator output signal and consequently brings about no overflow in the shifters. At any rate, no consideration is paid to an overflow which may occur in the arithmetic logic unit. EP A 0 202 633 document under Article 54 3 EPC discloses a processing circuit comprising multiplication means for successively multiplying a first input data signal by a second input data signal to produce a product signal representative of a result of multiplication, each of said first and said second input data signals being represented in two s complement form of a single precision bit length while each of said product signals being represented in two s complement form of a double precision bit length. The processing circuit further comprises first shifting means coupled to said multiplication means for shifting said product signal towards the least significant bit for scaling purposes of each product signal by a second predetermined number L of bits to produce a succession of shifted product signals each of which has the double precision bit length. Accumulating means are coupled to said first shifting means for successively accumulating a first predetermined number M of the shifted product signals to produce an accumulation signal representative of a result of accumulation, having the double precision length. Second shifting means are coupled to said accumulating means for shifting said accumulation signal by a third predetermined number of bits towards the most significant bit. The third predetermined number is K L where K relates to a predetermined range of 2 EP A 0 136 834 discloses a digital circuit for performing multiply add operations which includes a multiplier which executes a multiplication on values in fixed point representation and an arithmetic unit for executing addition or subtraction, a result register for receiving a result from the arithmetic unit, a multiplexer controlled by a controlled circuit for selecting data to be applied to one input of the arithmetic unit, and a shifter for shifting data applied thereto, the data from the result register being fed back to the other input of the arithmetic unit, whereby the shifter is between the output of the multiplexer and the one input of the arithmetic unit, and includes a shift controlled register whose contents determines what shift if any is to be effected by the shifter. The control circuit so controls the multiplexer, the shifter and the shift control register that when an overflow occurs, the multiplexer selects the data of the result register, and the shifter shifts the data from the multiplexer by one bit, and the content of the controlled register is incremented, whereas when the overflow does not occur, the multiplexer selects the input data supplied by the multiplier and the shifter shifts the data from the multiplexer by the number of bits determined by the content of the control register. It is an object of this invention to provide a processing circuit which can raise throughput on accumulating a predetermined number of products. It is another object of this invention to provide a processing circuit of the type described, which can raise a precision of calculation by reducing an error included in an output signal. It is still another object of this invention to provide a processing circuit of the type described which can diminish occurrence of overflows which occur in the course of the above mentioned accumulation. It is yet another object of this invention to provide a processing object of the type described, which is applicable to both a finite impulse response filter and an inifinite impulse response filter. These objects are achieved by the processing circuit according to the claims. The invention will be further described in connection with the drawing in which Description will at first be directed to principles of this invention to facilitate an understanding of this invention. It is assumed that calculation of Equation 1 is carried out by the use of a fixed point multiplier responsive to first and second input data signals or words each of which has a single precision bit length of N bits with a most significant bit defined as a sign bit and with a fixed point placed between the most significant bit and the most significant bit but one. Each input data signal is representative of either a positive number or a negative number represented by two s complement. As well known in the art, the positive number is specified by the sign bit of a logic 0 level while the negative number is specified by the sign bit of a logic 1 level. As a result, each data signal can represent a number falling within a predetermined range of 1, 1 . The fixed point multiplier produces a multiplier output signal which is representative of a product of the input data signals and which is represented by a double precision bit length of 2N 1 . A fixed point of the multiplier output signal is placed between a first bit and a second bit following the first bit, like in the input data signals. Let a first predetermined number of the multiplier output signals be summed up or accumulated in compliance with Equation 1 . According to this invention, each of the multiplier output signal is shifted together with the fixed point towards a least significant bit thereof by a second predetermined number of bits into a shifted multiplier output signal. The second predetermined number is determined in relation to the first predetermined number. The shifted multiplier output signal is represented by a double precision bit length similar to that of the multiplier output signal. Consequently, less significant bits of the multiplier output signal which are equal in number to the second predetermined number are rounded off in the shifted multiplier output signal. Instead, more significant bits of the shifted multiplier output signal are given a logic level identical with that of the sign bit of the multiplier output signal. It is mentioned here that the shifted multiplier output signal represented in the above mentioned manner gives rise to no undesired shortage of a precision in relation to the multiplier output signal, although the less significant bits of the multiplier output signal are rounded off in the shifted multiplier output signal. This is because only a single precision bit length of a result of accumulation is produced as an output signal or a sum signal. In addition, the shift operation towards the least significant bit of the multiplier output signal brings about extension of a variable range, namely, a dynamic range on the above mentioned accumulation in comparison with the conventional methods which are restricted to the predetermined range. Inasmuch as the result of accumulation averagely falls within the predetermined range, an accurate value can be obtained by shifting the result of accumulation towards the most significant bit of the result of accumulation by a third predetermined number. More specifically, each of the first and the second input data signals depicted at a respectively. As readily understood from Equations 4 , the first input data signal a Under the circumstances, each product of Equation 1 indicated at Z Equation 5 shows that each product of the first and the second input data signals falls within the second predetermined range of 2 In Equation 1 , accumulation is made about the products which are represented by Equation 5 and which are equal in number to M which may be called a first predetermined number. The accumulation of the products possibly extends the dynamic range of a result of accumulation. A maximum extension of the dynamic range is represented by A second predetermined number depicted at L is determined in relation to the first predetermined number M by selecting a minimum integer which is equal to or greater than log₂M. Each product, namely, each multiplier output signal is shifted towards the least significant bit by L bits into the shifted multiplier output signal depicted at Z As understood from Equation 6 , the less significant bits, L in number, of the shifted multiplier output signal Z By the use of Equation 6 , Equation 1 is rewritten into Inasmuch as a result y Taking the above into account, the result y If Equation 8 does not hold, the result y It is readily possible to detect whether or not the overflow occurs in the result y According to the above mentioned procedure, an error of the output signal results from rounding off the less significant bits, L in number, on rewriting Equation 5 into Equation 6 and from the above mentioned overflow. It is to be noted that round off errors which result from rounding off the less significant bits, L in number, are repeatedly added M times. Such addition of the round off errors, M in number, brings about extension of an error range by log₂M bits , as described in conjunction with Equation 5 . Accordingly, the minimum integer L may be selected which is equal to or greater than log₂M like in the maximum extension of the dynamic range. As a result, addition of each round off error of L bits influences 2L bits at most. In addition, upward shift of K L bits is carried out, as described in conjunction with Equation 8 to produce the output signal. Taking the upward shift of K L bits into consideration, the addition of each round off error influences the output signal over bits thereof which are not less than K 3L bits. Moreover, the result y On accumulating the products, M in number, the dynamic range is extended by L bits selected in relation to M so as to cope with a maximum variation of the dynamic range, as mentioned above. It is mentioned here that each output signal y It is preferable that the second predetermined number is varied with reference to the first predetermined number. Referring to Fig. 1, a processing circuit according to a first embodiment of this invention is for use in carrying out calculation of Equation 1 in response to the first and second input data signals which may be made to correspond to a The first and the second input data signal a The first and the second input data signals a Initially, the processing circuit is put into a reset state and these registers 16 and 17 are at first loaded with a The multiplication circuit 15 produces the multiplier output signal which is given by Equation 5 and which has 2N 1 bits. The multiplier output signal may be called a product signal representative of a result of multiplication and is sent to a selector 27 which is coupled to the controller 10. The selector 27 is also supplied with a 2N 1 bit output of a third register 23 described later and selects the multiplier output in response to the logic 1 level of a selection signal SS from the controller 10 until the multiplication result of In the example being illustrated, the barrel shifter 20 is supplied from the controller 10 with a first control signal FC representative of the second predetermined number L determined in relation to the first predetermined number M in the above mentioned manner. Thus, the controller 10 comprises a calculation circuit for calculating the second predetermined number L with reference to the first predetermined number M. Consequently, the multiplier output signal is shifted by L bits towards the least significant bit thereof or downwards into the shifted multiplier output signal Z The shifted multiplier output signals Z At any rate, the ALU 21 produces the result y When the processing circuit is supplied with a During calculation of a first one Z Subsequently, the multiplication circuit 15 is supplied with a₂ and x The second shifted multiplier output signal Z₂ is added in the ALU 21 to the previous result of accumulation, namely, the first shifted multiplier output signal Z The above mentioned operation or calculation is repeated M times. In this event, the third register 23 is loaded with the result of accumulation represented by Equation 7 while the shifter 20 and the selector 27 are supplied with the second control signal SC representative of K L and the logic 0 level of the selection signal SS from the controller 10, respectively. Thus, the controller 10 comprises another calculation circuit for producing the second control signal SC with reference to K and L. It is to be noted here that the second control signal SC is produced after the shifted multiplier output signal Z The selector 27 is responsive to the logic 0 level of the signal SS to select the result of accumulation and send the same to the shifter 20. Responsive to the second control signal SC, the shifter 20 shifts the result of accumulation towards the most significant bit thereof by the third predetermined number K L of bits. For the time being, it is surmised that the first predetermined number M is comparatively small and that the formula 9 holds. The shifted result of accumulation is supplied to the overflow corrector 25 through the ALU 21. Meanwhile, the overflow detector 26 serves to detect whether or not an overflow occurs in the shifter 20 and whether the overflow is a positive or negative overflow. If the detector 26 detects no overflow in the shifted result of accumulation, the corrector 25 passes the shifted result as a processed signal through the third register 23 to an output circuit 45. In the output circuit 45, the processed signal PS is tailored into a circuit output signal OUT of N bits which is sent to the data bus. The circuit output signal OUT is representative of a final sum and may be called a sum signal. Fig. 2 shows one example of the overflow detector 26 which comprises an overflow direction indicating circuit 46 for indicating whether the overflow is positive one or negative one. It is assumed that the ALU 21 and the shifter 20 are not simultaneously put into overflow states. Occurrence of the overflow in the result y On the other hand, the second control signal SC is sent from the controller 10 as an address signal to a read only memory 35 having a plurality of memory addresses each of which stores data signals corresponding to the second control signal SC. As mentioned before, the third predetermined number K L may be variable as the first predetermined number M varies. In the illustrated example, the third predetermined number K L is varied between 0 and 4, both inclusive. Each data signal has a four bit pattern as shown in Table 1. In Table 1, the third predetermined number K L is specified by the number of the logic 0 levels arranged from the most significant bit of each four bit pattern. Operation for indicating the overflow is carried out at each bit position of the logic 0 level, as will later become clear as the description proceeds. Let the third Predetermined number K L be equal to 2. In other words, it is assumed that upward shift operation of two bits is indicated by the second control signal SC. In addition, the five higher significant bits y₀ As a result, the AND gate 37 produces a logic 1 level signal representative of absence or nonoccurrence of any overflow. It is understood that the AND gate 37 practically monitors signals produced by the Exclusive NOR gates 33₁ and 33₂ when the two bit shift operation is indicated by the controller 10. Consequently, the AND gate 37 indicates coincidence of three bits y₀ In Fig. 2, the overflow detector 26 is supplied with the most significant bit signal MSB and the overflow signal OVF from the ALU 21. The overflow signal OVF is sent through an inverter 44 to an AND circuit 38 while the most significant bit signal MSB is sent through another inverter 45 to a selector 39 which is connected to the AND gate 37 and which is responsive to the sign bit y₀ As mentioned beofre, the overflow signal OVF takes the logic 0 level when no overflow occurs in the ALU 21. The AND circuit 38 produces the logic 1 level as a detector output signal DET when no overflow is indicated by the logic 1 level of the AND gate 37 and the logic 0 level of the overflow signal OVF. Supplied with the logic 1 level from the AND gate 37, the selector 39 selects an output of the inverter 45 as a selector output signal SEL. Such an inverter output signal may be called an inverted most significant bit signal The selected In short, the selector 39 produces a selector output signal SEL representative of the polarity of an overflow which may occur in either the shifter 20 or the ALU 21. The selector output signal SEL takes the logic 1 level when the overflow is a negative one. Otherwise, the selector output signal SEL takes the logic 0 level. Thus, the selector output signal SEL may be referred to as an overflow polarity signal. In the above mentioned example, the detector output signal DET takes the logic 1 level with the inverter output signal selected by the selector 39. Therefore, the overflow detector 26 informs the overflow corrector 25 Fig. 1 of no occurrence of overflow in both the shifter 20 and the ALU 21. In Fig. 2, let the five higher significant bits y₀ Similar operation is carried out on occurrence of the positive overflow. Thus, the overflow detector 26 indicates occurrence of the overflow in either the shifter 20 or the ALU 21 and the polarity of the overflow. Referring to Fig. 1 again and Fig. 3 afresh, the overflow corrector 25 comprises a selection circuit 41 controlled by the detector output signal DET and the selector output signal SEL both of which are described with reference to Fig. 2. In addition, the selection circuit 41 is connected to the ALU 21, a positive number generator 42, and a negative number generator 43. The positive number generator 42 is for generating a positive maximum number MP equal to 011...1 while the negative number generator 43 is for generating a negative maximum number MN of 100...0. Either one of the result y As readily understood from Table 2, the positive maximum number MP is selected as the processed signal PS by the selection circuit 41 on occurrence of the positive overflow while the negative maximum number MW is selected on occurrence of the negative overflow. On no occurrence of any overflow, the result y A combination of the overflow detector 26 and the overflow corrector 25 serves to monitor an overflow in the shifter 20 and the ALU 21 to produce the processed signal PS. In addition, the positive or the negative maximum number MP or MN is selectively substituted by the selection circuit 41 for the result y In the above mentioned example, it has been assumed that Equation 9 holds because the first predetermined number M is comparatively small. The following description will be directed for a while to the case where Equation 9 does not hold. In this case, the second predetermined number is given by a number L such that Equation 9 holds. Therefore, the number L is smaller than L and may be called an additional number. Selection of such an additional number L might result in possibility of occurrence of an overflow which appears in the course of calculation. However, the calculation can be carried out with a high precision because a smaller number L determines the downward shift bits. Let the additional number L be equal to log₂P and an overflow occur in the ALU 21 on a P th accumulation. The third register 23 is loaded with a result of first through P l th accumulations, namely, Under the circumstances, a When the overflow occurs on the P th accumulation and is a positive one, the ALU 21 indicates a negative number with the most significant bit MSB which is changed to the logic 1 level due to the overflow. The overflow detector 26 detects occurrence of the positive overflow in the above mentioned manner. As a result, the positive maximum number MP is selected by the overflow corrector 25 in the manner described with reference to Fig. 3 and is substituted for the result of the first through P th accumulations stored in the third register 23. After an M th accumulation, the second control signal SC is given to the shifter 20 to shift the result of accumulation stored in the third register 23 upwards by K L bits. From the above, it is readily understood that the AND circuit 38 and the selector 39 may be omitted from Fig. 2, if no overflow occurs in the ALU 21 by selection of the number L While this invention thus far been described in conjunction with a few embodiments thereof, it will readily be possible for those skilled in the art to put this invention into various other manners. For example, the third predetermined number K L may be changed on each accumulation under control of the controller 10 in Fig. 2. The first and the second input data signals a