# ERROR CONCEALMENT IN DIGITAL TELEVISION SIGNALS

## Claims
Verfahren zum Verdecken von Fehlern in einem digitalen Fernsehsignal, welches Fernsehsignal eine Vielzahl von Komponenten Abtastwerten umfaßt, die jeweils Abtastpositionen längs einer horizontalen Abtastzeile eines Fernsehbilds entsprechen, welches aus einer Vielzahl derartiger Zeilen zusammengesetzt ist, wobei das Verfahren in bezug auf jeden Abtastwert, der fehlerhaft ist, Schritte umfaßt zum

## Description
This invention relates to error concealment in digital television signals. If errors occur in the handling of digital television signals, for example due to noise or drop out occurring in a digital video tape recorder VTR , the digital signals are lost or corrupted, and then the reformed analog television signal does not correspond exactly to the original analog television signal, and a resulting television picture is degraded. There are two main approaches to dealing with errors in digital television signals. The first approach is correction, which involves the production and use of additional data signals purely for the purpose of error detection and correction, these additional data signals otherwise being redundant. While correction provides good results, it cannot generally be used as the sole means of dealing with errors, because a comprehensive correction capability would require an excessive amount of additional data which might overload the data handling paths or raise the data rate to an unacceptable level. The second approach, with which the present invention is more particularly concerned, is concealment. This comprises the replacement of lost or corrupted data signals by data signals generated using available uncorrupted data signals. This method relies largely for accuracy on the strong correlation that exists in a television signal. In our UK Patent GB A 2 073 534 and the corresponding European Patent EP A2 0 037 212, we have disclosed a method of error concealment which comprises selecting from a plurality of algorithms a preferred algorithm for calculating a corrected value for use in concealment of an error sample, calculating a corrected value for the error sample using the preferred algorithm, and replacing the error sample by the corrected value sample. This method works well in most situations, but we have found that there are certain error situations and also certain signal frequency conditions which result in problems in selecting the preferred algorithm. These problems will be discussed in more detail below. According to the present invention there is provided a method of concealing errors in a digital television signal, which television signal comprises a plurality of component sample values corresponding respectively to sample positions along a horizontal scan line of a television picture made up of a plurality of said lines, the method comprising, in respect of each said sample value which is in error According to the present invention there is also provided apparatus for concealing errors in a digital television signal, which television signal comprises a plurality of component sample values corresponding respectively to sample positions along a horizontal scan line of a television picture made up of a plurality of said lines, the apparatus comprising The invention will now be described by way of example with reference to the accompanying drawings, in which Figure 1 shows a matrix of sample positions in a television picture Figure 2 shows a further matrix of sample positions in a television picture Figure 3 shows a further matrix of sample positions in a television picture Figures 4A to 4D show still further matrices of sample positions in a television picture and Figure 5 shows in simplified block form an embodiment of apparatus for concealing errors in a digital television signal and in accordance with the present invention. Before describing an embodiment of the invention, and to assist understanding of the embodiment, further reference will first be made to the problems mentioned above. Referring to Figure 1, this shows part of the television raster of one field, and in particular parts of three consecutive horizontal scan lines labelled line n 1, line n and line n 1. The luminance sample positions are disposed at regular intervals along each of the lines, the intervals corresponding to a sampling frequency of say 13.5 MHz, and the sample positions being aligned in the vertical direction. In other words, the field is orthogonally sampled, although this is not essential to the invention, it being sufficient that the sample positions are substantially aligned in vertical lines. Reading from the left, consecutive sample positions in each line are labelled S 3, S 2, S 1, SO, S1, S2 and S3. Using this notation, any sample position in the matrix can be designated by the line and the sample number, and for the purpose of this discussion it is assumed that the sample position at which there is an error sample signal requiring concealment is in line n at position SO, this being designed n, SO. As disclosed in our above mentioned patents, a corrected value for the sample position n, SO could be estimated in one of four different ways. Firstly, the average could be taken of the two sample values in line n adjacent to and on each side of the sample position n, SO. Secondly, the average could be taken of the two sample values in line n 1 and line n 1 adjacent to and vertically above and below the sample position n, SO. Thirdly, the average could be taken of the two sample values in line n 1 and line n 1 and on either side of the sample position n, SO along the positive diagonal direction Fourthly, the average could be taken of the two sample values in line n 1 and line n 1 adjacent to and on either side of the sample position n, SO and along the negative diagonal direction. These four directions are indicated by the arrows A, B, C and D respectively. Each of these possibilities may be thought of as an algorithm for calculating a corrected value, and it will be appreciated that it is likely that one of these algorithms will give a better result than any of the others. The direction to be used is therefore selected by testing each algorithm using known sample values to see which gives the best result. A corrected value derived using the direction corresponding to that preferred algorithm is then used when substituting a corrected value sample. As a further refinement, the results derived from the respective algorithms can be weighted. In other words, a value can be placed on the likely accuracy of the results obtained. This is necessary because the distance between adjacent sample positions is less in the horizontal direction than in the vertical direction, the difference amounting to a factor of approximately 1.75. For this reason, the algorithm using the horizontal direction is in fact most likely to give the nearest result, with the algorithm for the vertical direction being next best, and the two algorithms for the diagonal directions being the next best. The four algorithms referred to above will now be specified in mathematical terms. Thus, the decision as to which concealment direction to use is made by investigating the adjacent sample values and obtaining the concealment accuracy for each direction. If the concealment accuracy is H for the horizontal direction, V for the vertical direction, D Likewise These four values H, V, D One of the problems that can arise with this method, and which was referred to briefly above, will now be further described with reference to Figure 2. This again shows part of the raster of one field, and in this case each sample position is marked by a cross. It is possible during severe error conditions for a high proportion of the sample values to be in error. A 25 error rate is not unusual, and may arise, for example, where due to drop out there is no output from one of the heads of a four head digital VTR. It will be usual for the error samples in such a case to be symetrically distributed throughout the field, so that every fourth sample value is in error, as indicated by the crosses enclosed in boxes in Figure 2. If now Figure 2 is compared with Figure 1, it will be seen that due to the error samples it is not possible to determine the concealment accuracies D The other problem referred to briefly above will now be further described with reference to Figure 3. The specifications of the above mentioned patents refer to the frequency response of this form of error concealment, and this second problem arises in this area of frequency response. It is to be remembered that when a television signal is orthogonally sampled, the sample positions along each horizontal scan line have a predetermined phase. The frequency response is the average of all the possible phases of the signals at the sample positions. Figure 3 shows the case where successive sample positions differ in phase by π 2, and using the designation plus, minus and zero for the phases at respective sample positions as indicated by the waveform in Figure 3, it will be seen that it may not be possible to determine the concealment accuracies H, V, D This problem can be demonstrated, for example, by using a zone plate. A zone plate is a television picture comprising concentric circles which move outwards from the centre of the screen, increasing in diameter and speed, and hence in signal frequency, as they approach the periphery of the screen. With such a zone plate, it is found that the problem arises on each of the two diagonals of the screen, about midway between the centre and the corner of the screen. In the method according to the present invention, both these problems are overcome by modifying the way in which the concealment accuracies H, V, D Figure 4A indicates the modified calculation for the horizontal direction A. For the calculation the same sample values as in the algorithm 1 are used, but the sample values are subtracted from one another in pairs as indicated by the dotted lines in Figure 4A. Figure 4B indicates the similarly modified calculation for the concealment accuracy in the vertical direction V. Figure 4C indicates the modified calculation for the positive diagonal direction C. For the calculation, each of the four sample values nearest to the error sample in the same horizontal line are used. The first two are subtracted from the two sample values in the preceding horizontal line and located in the respective positive diagonal direction, and the two succeeding the error sample have subtracted from them the two sample values in the succeeding horizontal line located in the respective positive diagonal direction. Figure 4D indicates the similarly modified calculation for the concealment accuracy D Written in the form of algorithms the concealment accuracies H, V, D The method has been described as applied to the luminance channel, that is to say concealment of errors occuring in luminance sample values. It is also necessary to consider the colour difference channels, and here two possibilities arise. Firstly, each colour difference channel can be provided with a separate concealment selection arrangement independent of the arrangement for the luminance channel. Secondly, because the first solution referred to above increases the amount of hardware required by approximately three, an alternative method which economizes on the amount of hardware required makes use of the fact that the chrominance information is related to the luminance information. That is, where a chrominance edge exists, so usually does a luminance edge. Based on this assumption it is possible to select the direction of colour difference concealment to be the same as that selected for luminance concealment. However, because the chrominance samples occur at only one half the frequency of the luminance samples along each horizontal line, a different set of weighting coefficients has to be used, these being optimized to the chrominance bandwidths. Referring to Figure 5, this shows apparatus in accordance with the present invention for concealing errors in a digital television signal. The apparatus comprises a luminance sample storage means 1 to which luminance input samples are supplied by way of an input terminal 2. The luminance sample storage means 1 supplies outputs to a luminance sample matrix storage means 3 which stores a moving matrix of sample values corresponding to the sample positions Four concealment accuracy detectors are provided, these being a horizontal concealment accuracy detector 4, a vertical concealment accuracy detector 5, a positive diagonal concealment accuracy detector 6 and a negative diagonal concealment accuracy detector 7. Each of the concealment accuracy detectors 4 to 7 is continuously supplied with the appropriate part of the sample matrix from the luminance sample matrix storage means 3. Thus the horizontal concealment accuracy detector 4, for example, receives or selects the sample values necessary to calculate the concealment accuracy H using the algorithm 5 above, and supplies a signal representing the concealment accuracy H by way of a weighting multiplier 8 to a luminance direction processor 12. Likewise the concealment accuracy detectors 5 to 7 supply a respective signal representing the vertical concealment accuracy V using the algorithm 6 above, the positive diagonal concealment accuracy D The luminance direction processor 12 supplies an output signal representing the selected direction of concealment to a sample value calculator 13 which operates to select the appropriate samples from the luminance sample matrix storage means 3 and calculate therefrom the required concealment value to be used to conceal the error sample. For example, if the horizontal direction is selected, the sample value calculator 13 uses the sample values for the sample positions n, S 1 and n, S1 to calculate the value to be used to conceal the error sample at the sample position n, SO. The concealment value is supplied to a selector 14 to which a switching signal is supplied by way of a terminal 15. The selector 14 is also supplied with the sample value from the sample position n, SO by way of a terminal 16. Preferably the apparatus as so far described operates continuously, that is to say concealment values are determined as described for every sample position and supplied to the selector 14. Only, however, when it has been determined that there is an error at a given sample position n, SO, is a signal supplied to the selector 14 by way of the terminal 15, whereupon the concealment value supplied from the calculator 13 is supplied to a luminance output terminal 17 in place of the sample value supplied by way of the terminal 16. At all other times, the sample value supplied by way of the terminal 16 is supplied to the luminance output terminal 17. The fact that there is an error at a given sample position n, SO can be determined in any suitable manner. For example, it may be determined that the data word representing the sample value is not valid, or the data words may be grouped into error detecting blocks for recording and an error detecting code such as a cyclic redundancy check code associated with each block. The apparatus may also include arrangements for calculating concealment values for the colour difference channels U and V. For simplicity, only that part of the apparatus necessary to calculate concealment values for the difference channel U is shown and will be described. For this purpose the apparatus comprises a chrominance sample storage means 21 to which chrominance input samples are supplied by way of an input terminal 22. The chrominance sample storage means 21 supplies outputs to a chrominance signal matrix storage means 23 which stores a moving matrix of sample values corresponding to those listed above in connection with the luminance sample matrix storage means 3, but adjusted to take account of the different spacing between adjacent chrominance samples. Operating in time division multiplex for the luminance and chrominance samples respectively, the concealment accuracy detectors 4 to 7 derive signals representing the horizontal, vertical, positive diagonal and negative diagonal concealment accuracies H, V, D As with the luminance part of the apparatus, the chrominance part of the apparatus preferably operates continuously. Only, however, when it has been determined there is an error at a given sample position n, SO, is a signal supplied to the selector 30 by way of the terminal 31, whereupon the concealment value supplied from the calculator 29 is supplied to a chrominance output terminal 33 in place of the sample value supplied by way of the terminal 32. The chrominance part of apparatus may be duplicated for the colour difference channel V or alternatively hardware can be saved by also using the direction selected for the colour difference channel U for the colour difference channel V. The method described works well so long as the average number of error samples over the field is not more than approximately 25 . If the error rate goes higher than this, as it may well do for example when using special reproduction modes such as slow or fast motion, the resulting increase in the density of error samples increases the probability of there being more than one error sample within the sample space from which sample values are used for calculating the concealment accuracies. This problem can be alleviated in a modified method in which no direction of concealment is used if the calculation of the corrected value involves the use of an error sample. However, it is not necessary to exclude a direction of concealment merely because the concealment accuracy H, V, D In other words, the algorithm 5 for calculating the horizontal concealment accuracy H can be split into four algorithms which can be separately used for calculating component concealment accuracies H1 to H4, as follows These calculations are performed continuously and are most conveniently performed in the concealment accuracy detectors 4 to 7 of the apparatus of Figure 5.