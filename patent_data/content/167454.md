# SYSTEM FOR CONTROLLING TRANSFER OF COMMANDS BETWEEN PROCESSORS

## Claims
System zum Steuern der Übertragung von Befehlen zwischen Prozessoren 11 14 eines Multiprozessorsystems, mit einer einzigen Steuereinheit 10 , die mit allen genannten Prozessoren verbunden ist, welche Steuereinheit hat Einrichtungen 30 zum Auswählen, auf der Basis einer vorbestimmten Prioritätszuordnungsreihenfolge, eines Prozessors, der eine Befehlsübertragung angefordert hat, welche Anforderung durch ein Befehlsübertragungsanforderungssignal signalisiert wird und Einrichtungen 60 zum Empfangen der Adresse eines beabsichtigten empfangenden Prozessors von dem ausgewählten Prozessor

## Description
The present invention relates to a computer system of a multiprocessor construction, more particularly to a system for controlling the transfer of commands between processors in the system. One of the major methods for forming a computer system is to tie in a plurality of central processors, input output processors, and the like under a common main memory unit. Such a system is called a multiprocessor system. Such a multiprocessor system requires means for compulsory synchronization of the control operation between processors or the ability to directly transmit command information and response information therefor between processors for the control over startup at the start of the system operation, control by one processor over the initialization, start, stop, etc. of another processor in the case of the other processor malfunctioning, etc. For example, the central processors of multiprocessor systems are subject to what are called signal processor commands , by which they transfer commands to other processors for the above mentioned purpose. When executing such a command, they transfer command codes and parameters specified by the command to a designated processor and receive response information therefrom. The response information includes the state of receipt of the commands and, when the commands are not received, information enabling judgement of the state of the specified processor. Further, when a desired kind of command is executed, information summarizing the results of execution, etc. is set as a condition code. The condition code of a signal processor command is mainly formed based on the above mentioned response information. For such transfer of information between processors, conventional systems have been provided with information transfer paths directly connecting the processors for every combination of two processors. Most conventional multiprocessor systems consist of two central processors. Advances in electronics technology, however, have made an increased number of the central processors more practical. A multiprocessor system having an increased number of processors should preferably be controlled by a method different from the conventional method and appropriate for information transfer between a large number of processors for communication of common information between processors. That is, by the method of control of a conventional system, the number of the information transfer lines increases in proportion to the square of the number of the processors and the scale of the control circuit provided in each processor increases in proportion to the number of the processors. An example of such a prior art system of communication between a plurality of processor modules is disclosed in US Patent No. 4099233. Therefore, the scale of the overall system increases in proportion to the square of the number of the processors. This causes problems in economy and reliability. An object of the present invention is to provide a novel system for controlling the transfer of commands between processors in a multiprocessor system by which the above mentioned drawbacks can be eliminated. This object can be achieved, according to the present invention, by a system as set out in claim 1. Further features and advantages of the present invention will be apparent from the ensuing description with reference to the accompanying drawings to which, however, the scope of the invention is in no way limited. Figure 1 is a block diagram of one example of a conventional system. In Fig. 1, 1 to 4 are processors. As typically shown by reference numeral 6, a pair of information transfer paths is provided between every combination of two processors. Therefore, six pairs of the information transfers paths are required. Further, each processor requires the same number of information transfer interfaces. In addition, for the purpose of controlling the transfer of commands, each processor should be provided with a control circuit, for judging the state of the other three processors, and with lines for showing for this state. Figure 2 shows the system construction of an embodiment of the present invention. In the drawing, a control unit 10 functions to control communication between four processors 11 to 14. The processors 11 to 14 are separately connected to the control unit 10 by pairs of information transfer paths 15 to 18. Figure 3 is a block diagram of an embodiment of the control unit 10 and processors. As shown in the figure, each processor 11 to 14 processor 14 not shown in fig. 3 is provided with a command sending portion 20. When a processor is to execute the above command, the command sending portion 20 generates command information based on the command and receives response information for processing. Each processor 11 to 14 is also provided with a command receiving portion 21. When a processor is to receive commands, the command receiving portion 21 receives and processes the command information and generates response information. Information transfer paths 22 and 23 connect each of the processors 11 to 14 to the control unit. These paths carry information between the command sending portion 20 and command receiving portion 21, and the controller , respectively. Alternatively, a single information transfer path may be provided for the command sending portion 20 and the command receiving portion 21 for common use. Registers 24, 25 are provided in each of the processors 11 to 14 and a corresponding number of registers 26, 27 in the control unit corresponding to the transfer paths 22 and 23. The sending side register 24 is connected to the command sending portion 20 by a multiplexer 28 when the command receiving portion 21 is not transferring information. The receiving side register 25 is always connected to the command sending portion 20 and the command receiving portion 21, the received information being used as valid information by one of the same depending on the content thereof. Below, the invention will be explained in more detailed referring to the case wherein command information is transferred from the processor 11 to the processor 13 due to execution of a signal processor command in the processor 11, response information therefore being sent back from the processor 13 to the processor 11. When the processor 11 begins executing the signal processor command, its command sending portion 20 forms, by a well known method, the processor address of the command receiving side, a command code, and parameters from the operand based on the specifications of the command. The command sending portion 20 sets the receiving processor address in the register 24. At the same time, it sets the command transfer request bit of the register 24 and transfers the information in the register 24 to the register 26 in the control unit. In the control unit , a multiplexer 30 is used to select the one of the registers 26 corresponding to the processors wherein the command transfer request bit is on by a suitable priority order. The receiving processor address in the register 26 is transferred to the register 60 and held therein. At the same time, the processor address of the sending processor 11 determined by the terminal selected by the multiplexer 30 is held in the register 32. The address of the receiving processor of the register 60 is supplied to a control circuit 61, where the appropriateness of the address is examined. The concept of improper addresses will be explained later. Accordingly, when the processor address is proper exists in this system , the state signal corresponding to the processor address of the register 60 is selected from the signals indicating the switching state of the source or control state in the processors indicated as the signal line group 62. Using the selected signals, the control unit judges whether the command can be received. When receivable, the processor address in the register 60 is transferred to a register 31. A multiplexer 33 is controlled by the content of the register 31 and functions to connect the bus 34 in the control unit to one of the registers 27 corresponding to the processors 11 to 14. The information transfer path to the specified receiving processor is determined in this way. The control circuit 61 transfers the sending processor address in the register 32 to the signal line 63 and sends the same via the register 27 to the receiving processor. When it is judged that the receiving processor address in the register 60 is proper, but the processor is in a state where it cannot receive the command at that time, the control circuit 61 exercises control so as to transfer the sending processor address in the register 32 to the register 31 and connect the multiplexer 33 to the sending processor. Also, at this time, the control circuit 61 generates, based on the signal of the signal line group 62, a processor address not proper for the state and transfers it from the signal line 63 via the register 27 to the register 25 in the sending processor 11. When there is an improper processor address in the register 60, this means an improper processor address was generated forcibly in the sending processor 11. That is, for example, the sending processor 11 examines whether the processor address formed by the operand of the signal processor command is the processor address packaged in the system. When it does not exist in the system, the sending processor 11 generates forcibly the improper processor address. If the maximum number of processors connectable to the system is four, the improper processor address can be formed as an address having one 1 bit in a position higher than the lower 2 bits in the binary coded notation. Further, if necessary, special meaning may be given to the position of above mentioned 1 bit, e.g., the indication of a specific state. When there is an improper processor address in the register 60, just as when the specified processor cannot receive the command, the control circuit 61 connects the multiplexer 33 to the sending processor 11. However, the content of the register 60 is sent as is from the signal line 63. By the above, when the receiving processor and the predetermined transfer information are determined, signal lines not shown of the processors are used for transmission of a command input signal to the receiving processor 13 and a command valid signal to the sending processor 11. An information transfer path is thus secured from the sending processor 11 to the receiving processor 13. At the same time, the transfer information of the register 27 is transferred via the register 25 in the receiving processor 13 to the command receiving portion 21. When the command sending portion 20 in the sending processor 11 receives the above mentioned command valid signal, it successively sends the command code, parameters, etc. via the register 24, the register 26, the multiplexer 30, the multiplexer 33, the register 27, and the register 25 in the receiving processor 13 to the command receiving portion 21. The command receiving portion 21 in the receiving processor 13 receives, by receipt of the command input signal mentioned above, the above mentioned transfer information, transferred at the same time, and the command code, parameters, etc. transferred successively from the sending processor 11. Further, as mentioned above, sometimes the receiving processor is the same processor as the sending processor. In such a case, the exact same information transfer as mentioned above is carried out between the command sending portion 20 and the command receiving portion 21, constructed to operate independently in the same processor, of the processor 11, which is commonly used as the sending and receiving processor. In the receiving processor 13 same for processor 11 used as receiving processor, no special explanation made below , when the command receiving portion 21 receives, via the registers 25, the processor address together with the command input signal, the portion 21 recognizes, by the processor address, that the command is issued from, for example, the processor 11, and receives the following command information. The command receiving portion 21 in the receiving processor 13 has, for example, the construction shown in Fig. 4. It decodes the command code on the register 25 by a decoder 40 and sends the same to the control circuit 41. The control circuit 41 judges, based on the kind of the command and the state of the processor 13 read from the signal line 42, whether the command can be received and forms status information denoting the results thereof, etc. Further, by the above mentioned process, when it is judged that the command can be received, the command information is supplied to the processor by the signal line 43. As a result, control by the command is carried out, and, in accordance with the content of the command, generation and hold of interruptions, initialization of the processor, and other controls commences. In the above mentioned process in the control circuit 41, at the same time when the status information is created, the condition code is created as information summarizing the status information. For example, such information concerning, for example, whether the command is received in the state where it executed normally, whether status information indicating abnormal state is received as the response information, etc. is set. When the command receiving portion 21 of the processor 13 on the command receiving side creates response information formed by the above mentioned process from the status information and the condition code, it switches the multiplexer 28 so as to connect the register 24 to the command receiving portion 21 and sets the response information in the register 24. Further, it sets the response information transfer request bit of the register 24 and transfers the information to the register 26 in the control unit 10. When the register 26 in the control unit 10 receives the response information transfer request bit, the multiplexer 30 is switched so as to receive input from the receiving processor 13. Further, the multiplexer 33 is switched for output to the sending processor 11 by the processor address in the register 32. By the process mentioned above, the response information set in the register 24 in the processor 13 is received by the command sending portion 20 via the registers 26, 27, and the register 25 in the processor 11. When the command receiving portion 21 in the processor 13 sends the response information, the portion 21 returns the register 24 to connection to the command sending portion 20 and resets the state to enable execution of a new signal processor instruction. The response information has a predetermined bit length, and it is thus possible for the control unit to detect when the transfer of this information has terminated, by timing, given that the data rate is known. After detecting the above termination of response information, the control unit 10 proceeds to recognize the termination of a series of the communications commenced in the processor 11 and resets the state to enable receipt of a new transfer request. Along with the completion of the above mentioned sequence of operations command transfer requests from processors previously not selected in the command transfer are accepted in a predetermined priority order when the command transfer request bits of the corresponding registers 26 are on. In the command receiving portion 21, when the first received processor address is an improper processor address as mentioned above in this case, the receiving processor becomes the same as the sending processor , the command receiving portion 21 refers also to the upper 1 bit of the address and generates status information and a condition code. The means and method of information transfer control mentioned above enables processing in the case where a nonexistent processor address is designated, in the case where the receiving processor cannot receive the command due to a power cut, etc., and other abnormal cases by exactly the same control sequence as when the receiving processor normally sends response information. This simplifies the control in the command transfer control system. The second embodiment of the present invention is shown in Fig. 5. In Fig. 5, elements the same as in Fig. 2 are shown by the same reference numerals. Reference numerals 24a, 24b 25a, 25b 26a, 26b, 26c, 26d 27a, 27b, 27c, 27d correspond to 24, 25, 26, 27 in Fig. 2, respectively. The signals in line 22 shown in Fig. 5 from the central processor to the system control interface include the following The signals in line 23 from SCI to CPU include the following Figure 6 is a timing chart explaining the signal flow in the circuit shown in Fig. 5. Figure 7 shows the construction of the signals in Fig. 6, that is, CPU.ADDRESS, ORDER, PARAMETER, CC Condition Code , and STATUS. In Fig. 5, a command out signal is generated from, for example, the central processor 0. The command out signal is supplied via the register 26a, a multiplexer 51, a register 56, and a multiplexer 52, or via the register 26a, a multiplexer 51, a register 58, and a multiplexer 54, to a central processor which is addressed by the central processor 0. When the COMMAND ACK signal is fed back to the central processor 0, the ORDER and PARAMETER shown in Figs. 7 b and c are supplied to the central processor 0, via the system control interface. When the receiving side receives ADDRESS, ORDER, PARAMETER from the sending portion, the receiving side judges whether the received information can be accepted and forms the condition code CC. The condition code CC and the response information transfer bit is transferred to the sending portion. Figures 8 and 9 are block diagrams of the sending portion and the receiving portion. Reference numerals the same as in Fig. 2 designate the same elements. In Fig. 8, the information received from the system control interface is stored in the register 25, the register 60, and the order register 61. The output of the register 25 is decoded in an order decoder 62 and supplied to a status control unit. In the status control unit, in accordance with a first valid circuit 64 or a second valid circuit 65, the CC and STATUS information is supplied to a data out selector. On the other hand, the received data is stored via a data in latch circuit to registers 67 and 68. In Fig. 9, the sending portion stores CPU ADDRESS, ORDER CODE, and PARAMETER in registers 71, 72, and 73 respectively. The stored data is selected by an address check circuit 74 and an order check circuit 75, and the data is output to the system control interface via the register 24 and a data output selector 76. The data received from the system control interface is stored in the registers 25. As mentioned in detail above, the processors are each provided with a single separate set of information transfer paths linking them to a single control unit. The control unit, based on the request of a sending processor, controls the transfer of desired information from the transfer origin to the receiving processor. Further, the control unit is provided with means for deciding on the receiving processor and the predetermined transfer information based on the selected processor on the command sending side, the processor address on the receiving side specified by the sending processor, and processor status information determined by the receiving processor address. Therefore, each processor need not judge the state of the receiving processor, which is dynamically changed when the command is sent. The processor status information includes an information on whether a processor is separated from the system by the control, if not separated, whether the power is on, and other information enabling judgement of the possibility of command receipt and execution. The above mentioned means, in normal command transfer, assumes the processor having the specified address to be the receiving processor and sends the sending processor address thereto as transfer information. If the processor having the specified address is in a state where it cannot receive the command, e.g., the power is off, a predetermined processor with other than the specified address, for example, the sending processor itself, is assumed as the receiving processor, and the information corresponding to the abnormal state is sent as the transfer information. By such control means, abnormal command transfer and processing can be performed by the same sequence as normal command transfer and processing. As clear from the above, the present invention has considerable advantageous industrial effects, i.e., improved reliability and economy of command transfer control between processors in a multiprocessor system.