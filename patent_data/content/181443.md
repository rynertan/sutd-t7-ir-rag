# One chip microcomputer

## Claims
Integrierter Halbleiter Schaltkreis LSI mit einem elektrisch programmierbaren Festspeicher EPROM , in den Daten geschrieben werden und diese anschließend von einer externen Schreibeinrichtung geprüft werden, und mit einer Steuereinheit WCON , die den Lese Schreibvorgang des elektrisch programmierbaren Festspeichers steuert, wobei der Schaltkreis umfaßt

## Description
The present invention relates to a semiconductor integrated circuit device and, according to the first part of claim 1 and to a technique effective for use in a one chip microcomputer in which an ROM i.e., Read Only Memory to be stored with a data processing program is constructed of an EPROM i.e., Electrically Programmable Read Only Memory . In a one chip microcomputer, a predetermined data processing is executed in accordance with a program which is written in the built in ROM. Prior to the present invention, we have conceived the use of an EPROM as the built in ROM. This use of the EPROM makes it possible to promptly provide a one chip microcomputer which has the data processing function desired by the user and to improve the mass productivity. If a mask type ROM is used as the aforementioned ROM, more specifically, it takes time to fabricate a variety of masks during program development. In case the EPROM is used as above, it would be convenient to conduct the writing operation by the use of an existing EPROM writer. As compared with the address space in the microcomputer, however, the ratio to be occupied by the EPROM is far smaller, e.g. at most 4K 4K x 8 bits of an address space of 8K. As a result, errors for as many as half of the addresses are caused if the writing operation is conducted by the use of the existing EPROM writer e.g., 8K x 8 bits 64 Kbits having the same address space as that of the microcomputer. In case the existing EPROM writer is used, more specifically, it is desirable that the construction of the usable EPROM writer be not restricted. In accordance with the existing EPROM writer, the address data are renewed sequentially from the start address, and the data to be written are sequentially outputted. The EPROM writer reads out the data written into the EPROM and checks them each time the writing operation into one address is executed. If, in this case, the start address of the EPROM is conveniently coincident with that of the EPROM, the data are written into the EPROM in a normal manner. However, the address space to be given to the built in EPROM has not always a range convenient for the EPROM writer. In case the address data outside of the address range of the EPROM are outputted from the EPROM writer at the start of the data writing operation, no data are written into the EPROM. In this case, it is substantially impossible to check verify the write data after the data writing operation is conducted, because the address data designate memories other than the EPROM. As a result, errors, which should not exist, are detected by executing the verifying operation. Thus, in the operation to write into the addresses in which the EPROM is present, the check or verification can be made, but all data become erroneous for the remaining write check so that no continuous write is conducted. Incidentally, a high grade EPROM writer capable of arbitrarily designating the addressing range is present but has a high price and raises a problem in distribution. Incidentally, the EPROM is disclosed in Japanese Patent Laid Open No. 54 152933, for example. Address discriminators used for protecting specific memory areas, I O ports or storage facilities from access by unauthorised programs are disclosed in EP A 0 109 504 and US A 4 298 934 for example. An object of the present invention is to provide a semiconductor integrated circuit device according to the preamble of claim 1 which may be programmed by a conventional EPROM programmer. It is a further object to provide an operating method for the above device. These objects are solved by the device of claim 1 and the method set forth in claim 11. These and other objects and novel features of the present invention will become apparent from the description to be made herein with reference to the accompanying drawings. Representatives of the present invention to be disclosed herein will be briefly described in the following. It is made possible to write a programmable ROM by means of a simple writer by adding a function to discriminate an address space, which is assigned to the programmable ROM to be stored with a data processing program, and a function to send out a signal identical to a blank to the output for the assigned address other than the address space assigned. Fig. 1 is a block diagram showing the embodiment of the one chip microcomputer to which the present invention is applied. A rectangular encircled by double dotted lines in Fig. 1 indicates an integrated circuit LSI. The respective circuit blocks formed in the rectangular construct the one chip microcomputer as a whole and are formed in one semiconductor substrate made of silicon by the known semiconductor integrated circuit device fabricating technique. Indicated by a symbol CPU is a micro processor which has its major component blocks exemplified as representatives. Specifically symbol A indicates an accumulator symbol X an index register symbol CC a condition code register symbol SP a stack pointer symbols PCH and PCL program counters symbol CPU CONT a CPU controller and symbol ALU an arithmetic logic operation unit. The construction of such microprocessor CPU is well known in the art by Fundamentals of Microcomputer published by on April 10, 1983 by KK OHM and written by Koji YADA, for example, and its detail description is omitted. Indicated at symbols I O₁ and I O₂ are input output ports each having a data transmission direction register therein. The input output port I O₁ can be controlled by a control circuit WCON, and its specific example will be described later with reference to Fig. 3. On the other hand, symbol I indicates an input only port. Indicated at symbol OSC is an oscillator for generating a highly accurate reference frequency signal by making use of a quartz crystal unit Xtal attached externally, although not especially limited thereto. Clock pulses necessary for the microprocessor CPU are generated by that reference frequency signal. This reference frequency signal is used as a reference time pulse of a timer, too. This timer is composed of a counter COUT, a prescaler PR and a controller CONT. Indicated at symbol RAM is a random access memory which is used mainly as a memory circuit for temporary data. Indicated at symbol EPROM is an electrically programmable read only memory which is to be written with a program for a variety of data processings. The respective circuit blocks described above are connected around the micro processor CPU with one another through a bus BUS. This bus contains a data bus and an address bus. In the bus BUS, incidentally, the address bus ADD is linked to the external terminal and can be linked directly to the EPROM. In the microcomputer of the present embodiment, the aforementioned EPROM is used, and there is provided the control circuit WCON for controlling the write of the EPROM and so on. The control circuit WCON receives a chip enable signal through an external terminal Moreover, the aforementioned address signal is fed to the address discrimination circuit contained in the aforementioned control circuit WCON. This address discrimination circuit inhibits the write operation and feeds out the read signal at that time as a blank i.e, a logic 1 , although not limitative thereto, if it detects the set address other than those in the address space to which the EPROM is assigned. Incidentally, the aforementioned write inhibiting function need not be provided. This is because the non existing address designation of the EPROM is conducted so that EPROM is not selected not to effect the writing operation. The writing operation of the EPROM of the present embodiment will be schematically described with reference to the address space diagram of Fig. 2. Let the case be considered, in which, of address spaces A0 to A3 set by the address bus ADD the address of the input output port is assigned to A0 to A1 the area of the EPROM is assigned to A1 to A2 and an RAM area is assigned to the remaining A2 to A3. In the writing operation of the EPROM by the writer, then, the continuous writing operations of the area A0 to A3 are conducted, and the blank i.e., the logic 1 is written for the set addresses i.e., the hatched areas of those other than the aforementioned EPROM areas A0 to A1 and A2 to A3 when in the verifying operation e.g., the read check after the write . For these writing operations, the control circuit WCON makes its output blank i.e., the logic 1 for the set addresses other than those of the aforementioned EPROM areas A0 to A1 and A2 to A3 so that the continuous writing operation can be conducted without any write error. Fig. 3 shows a specific circuit of the control circuit WCON of Fig. 1. The control circuit WCON is constructed of a voltage level detector VDT, an address discriminator ADC, and first and second control signal generators CSG₁ and CSG₂. The voltage level detector VDT is composed of an input circuit HSC for voltage level detection and an inverter IV₂ as a buffer. The input circuit HSC is made of a hysterisis circuit so that it may be insensitive to the undesired noises applied to the external terminal Vpp, although not limitative thereto. The hysterisis circuit is not shown in detail because it is known per se, and both its two threshold voltages are made to take intermediate values between the supply voltage Vcc of the circuit and the high voltage such as 12 V fed to the terminal Vpp. With the construction described above, the voltage level detector VDL outputs a high level discrimination signal The address discriminator ADC is constructed to discriminate the address space of the EPROM with reference to the upper three bits of the not shown address bus in the internal bus BUS, although not especially limitative thereto. More specifically, the output of a NAND circuit ND₄ is set at a low level only when the most significand bit am and the next significant am 1 of the address signal are at the logics 0 and 1 , whereas the output of a NAND circuit ND₅ is set at a low level only when the bits am and am 1 are at 1 and 0 . Likewise, the output of a NAND circuit ND₆ is set at the low level only when the bits am, am 1 and am 2 take the values 1 , 1 and 0 , respectively. In accordance with the outputs of those NAND circuits ND₄ to ND₆, the output of a NAND circuit ND₇, i.e., the output In response to the output The control signal The first control signal generator CSG₁ contains a not shown OR circuit for generating the internal chip enable signal by OR composing the Although not especially limitative, the combination of the high level of the discrimination signal The control signal The control signal The control signal The second control signal generator CSG₂ is composed, as shown in Fig. 3, of a NAND circuit ND₈ and inverter circuits IV₃ to IV₅ so that it outputs a control signal The EPROM is composed, as shown in Fig. 4, of an address decoder DEC made receptive of the address signal through the bus line BUS an memory array MM having its word lines W₀ to W The address decoder DEC is made receptive of not only the address signal but also the control signal The output buffer circuits OB₁ to OB The input buffer circuits DW₁ to DW As a result, when in the reading operations the read data signals of the memory array MM fed to the respective common data lines CD₁ to CD When in the writing operations on the other hand, the high voltage level write data signals outputted from the input buffer circuits DW₁ to DW In accordance with the present embodiment, the input output circuit I O₁ has its construction modified slightly as the input output circuit of the EPROM direct access mode for the ordinary input output circuit. A specific example of the construction of the input output circuit I O₁ is shown in Fig. 5. The input output circuit I O₁ contains circuits composing the ordinary input output circuit such as an output buffer OB and an input buffer IB linked to an input output terminal I O and data transmission direction registers RGr and RGi having their respective contents determined by the control signals fed through the bus line BUS NAND circuits ND₁ to ND₃, a gate circuit GC an inverter circuit IV₁ and an OR circuit OR. In accordance with this construction, the output of the NAND circuit ND₃, i.e., the control input of the output buffer circuit OB is made identical to the output O₁ of the register RGr, if the control signal The gate circuit GC is made substantially identical to the circuit composed of the NAND circuits ND₁ to ND₃. The output of the gate circuit GC, i.e., the control input of the input buffer circuit IB is made identical to the output O₂ of the register RGi, if the control signal The output of the OR circuit is set at the high level irrespective of the signal fed from the bus line BUS if the signal As a result, the output buffer and input buffer OB and IB have their respective operations controlled by the registers RGr and RGi if the control signal The output buffer OB and the input buffer IB have their respective operations controlled by the control signals In the EPROM direct access mode namely, If the control signal In the program of the EPROM by the EPROM writer, incidentally, either a socket especially for setting the semiconductor device of the present embodiment or a conversion socket for changing the pin arrangement is prepared and is linked to the socket which is mounted in the EPROM writer. For verification of the EPROM, either the data corresponding to the address other than those of the address space of the EPROM or expectable values are all set at the high level 1 . As a result, the signals outputted from the input output circuit I O₁ of Fig. 1 or 5 become coincident with the expectable values set in advance in the EPROM writer, when an address outside of the address space of the EPROM is designated. According to the present invention, the following effects can be attained. Although the present invention made by us has been described specifically in connection with the embodiment thereof, it should not be limited thereto but can naturally be modified in various manners within the scope of the gist thereof. For example, the programmable ROM should not be limited to the aforementioned EPROM but may be replaced by a variety of programmable ROMs such as an electrically writable PROM, e.g., an electrically erasable PROM EEPROM or an electrically unerasable PROM. In this modification, the control circuit WCON shown in Fig. 1 is made to conduct the write control according to the built in programmable ROM. The signal level forcibly set when the address other those of the address space of the programmable ROM may be either at the high level or at the low level. Although the foregoing description has been directed mainly to the case in which the present invention is applied to the one chip microcomputer providing the background thereof and having the built in EPROM, the present invention should not be limited thereto but may be widely applied to a variety of semiconductor integrated circuit devices containing the programmable ROM and having a larger address space than that of the former.