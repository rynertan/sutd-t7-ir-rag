# Phase discriminator and data standardiser.

## Abstract
The invention relates to a phase discriminator and data standardiser apparatus, responsive to the difference in phase between an input data signal D having transitions and a variable frequency reference data clock signal f The invention is characterised in that the measuring means 16 comprises reference timing means 36, 41 responsive to the data signal for producing a timing reference signal defining a predetermined reference timing period 48 , multi variable circuit means 32, 34, 36, 38, 40 responsive to the reference timing signal and to a transition of the reference data clock signal by producing and changing a plurality of variable signals in a sequence defining a multi state transition cycle in which each transition between adjacent states is determined by the change of one respective variable and for producing phase difference signals indicative of the measured phase difference, and gate means 12 responsive to the phase difference signal for producing a phase correction signal INC, DEC to change the frequency of the reference data clock signal.

## Claims
1. A phase discriminator and data standardiser apparatus, responsive to the difference in phase between an input data signal D having transitions and a variable frequency reference data clock signal fC having transitions, for producing a phase correction signal INC, DEC to change the frequency of said reference data clock signal and for producing a standardised output signal by combining said input data D with said reference data clock signal fC , comprising

## Description
This invention relates to a phase discriminator and data standardiser apparatus that detects the difference in phase between an input data signal and a variable frequency reference data clock signal and produces an output for changing the frequency of the clock signal to reduce the measured phase difference, while also providing the input data as an output in a standardised format that is synchronised with the reference data clock signal. Disk file storage systems are conventionally used as information storage adjuncts to computer systems. In a disk file storage system, data is recorded by flux reversals induced on the surface of a magnetic disk. The information content of the data lies in the distance between any two successive flux reversals which corresponds to the time between the detection of successive flux reversals as detected by a read head. To obtain information previously recorded on a disk, the distance or time between two successive flux reversals must be accurately measured to allow the information to be retrieved. The time between successive flux reversals of the data read from a disk is dependent on the rotational velocity of the disk. In systems where the data from the disk file system is supplied to another apparatus in synchronism with a reference data clock signal, means must be provided for varying the frequency of the reference data clock signal in a closed loop operation in order to compensate for any variations in the rate of supply of output data resulting from changes in the rotational velocity of the disk. As a result, the input data must be standardised to provide an output signal that has a predictable time relationship with the reference data clock signal. In a disk file storage system, the reference data clock signal is normally produced by a phase locked loop including a voltage controlled oscillator VCO whose frequency is controlled by a phase discriminator that compares the phase relationship of the reference data clock signal to the phase of the incoming data pulses. Typically, such a phase discriminator, after detecting a phase difference, causes the frequency of the VCO to be varied incrementally to align the phase of the clock and data signals. The exact positions of magnetic transitions on a disk can be altered in time relative to adjacent transitions. Such positional variations can result from imperfections in the recording medium, flux leakover from adjacent transitions, and noise and imperfections in the detection process. As a result, the digital data pulses derived from the flux transitions will not have a predictable position relative to the reference data clock signal. Therefore, a data standardiser must make a precise determination of which clock signal cycle a data pulse occurs in and produce as an output a pulse that occurs in a manner that is predictably standardised in its time relationship to the reference data clock signal. Existing phase discriminators employed to detect the difference in phase between a data signal and a reference data clock signal typically employ circuitry that is sensitive to race conditions in which a plurality of signal transitions must be made in parallel. A variation in the relative delays of these parallel transitions can produce unwanted variations in the phase discrimination and data standardisation processes. As the speeds of data transfer and data processing equipments increase with each new generation of computers, the destabilising effects of multiple path conditions on phase detection will only grow in magnitude. Reduction of race conditions will enhance the ability of phase detectors to synchronise data obtained from a disk file system with a data clock signal and to standardise the data in a predictable manner. The object of the present invention is to provide an improved phase discriminator and data standardiser apparatus that detects the difference in phase between an input data signal and a variable frequency reference data clock signal and produces an output for changing the frequency of the clock signal to reduce the measured phase difference, while also providing the input data as an output in a standardised format that is synchronised with the reference data clock signal. The invention relates to a phase discriminator and data standardiser apparatus, responsive to the difference in phase between an input data signal having transitions and a variable frequency reference data clock signal having transitions, for producing a phase correction signal to change the frequency of said reference data clock signal and for producing a standardised output signal by combining said input data signal with said reference data clock signal, comprising measuring means for measuring the phase difference between the input data signal and the reference data clock signal, means responsive to the phase difference to vary the frequency of the reference data clock signal so as to reduce the phase difference, and means for combining the input data signal with the reference data clock signal to produce the standardised output signal. The invention is characterised in that the measuring means comprises reference timing means responsive to the the data signal for producing a timing reference signal defining a predetermined reference timing period, multi variable circuit means responsive to the reference timing signal and to a transition of the reference data clock signal by producing and changing a plurality of variable signals in a sequence defining a multi state transition cycle in which each transition between adjacent states is determined by the change of one respective variable and for producing phase difference signals indicative of the measured phase difference, and gate means responsive to the phase difference signal for producing a phase correction signal to change the frequency of the reference data clock signal. The present invention is a phase discriminator and data standardiser apparatus that suppresses the occurrence of multiple path conditions in a phase discriminator used to detect phase difference between an input data signal and a variable frequency reference data clock signal. The operation of the apparatus is characterised by the absence of multiple path conditions in the phase measuring circuitry of the apparatus. In eliminating multiple path conditions, the apparatus of the invention employs a multi state latching circuit that measures relative phase between the input data and reference data clock signals by following a state change or transition path in which each state change or transition results from the alteration of only one respective state variable. The invention further extracts information embedded in the data signal and provides the information in a format that is predictably standardised and synchronised with the reference data clock signal. The phase discriminator and data standardiser apparatus of the invention is responsive to the difference in phase between an input data signal having transitions which occur at a nominal input data rate and a variable frequency reference data clock signal. In response to the detection of a phase difference between the input data and reference data clock signals, the apparatus produces a phase difference signal for changing the frequency of the clock signal in a direction tending to eliminate the phase difference. The apparatus includes a reference timing circuit responsive to a transition of the input data signal for producing a timing reference signal that has a particular reference timing period. The latch circuit of the apparatus responds to the timing reference signal and to a transition of the reference data clock signal. If the clock signal transition occurs after completion of the timing reference signal, the apparatus provides a first phase difference signal indicating that the clock signal is late relative to the data signal and of a value corresponding to the time by which the timing reference signal precedes the reference data clock transition. If the clock signal transition occurs during the timing reference signal, the apparatus provides a second phase difference signal indicating that the clock signal is early relative to the data signal and of a value corresponding to the portion of the reference timing signal remaining after the clock transition. A gate circuit is provided that responds to the first phase difference signal by producing an increase signal to increase the reference data clock signal frequency. The gate circuit further responds to the second phase difference signal by producing a decrease signal to decrease the reference data clock signal frequency. Also included in the apparatus of the invention is a gate responsive to the latch circuit for providing information contained in the input data signal in a standardised data format that corresponds in phase with the corrected reference data clock signal. In order that the invention may be more readily understood an embodiment will now be described with reference to the accompanying drawings, in which The phase discriminator and data standardiser of the invention performs frequency synchronization and data standardisation necessary in a binary data processing system wherein a clock signal must be synchronised to an incoming data signal, a determination made as to which cycle of the clock the incoming data signal falls in, and the data provided in a standardised format related to the clock signal. The phase discriminator and data standardiser apparatus of the invention referred to hereinafter as the apparatus, or the apparatus of the invention is intended for use with a disk file storage system wherein data is retrieved or read from a spinning magnetic disk. The data is provided, by way of a pulse shaping circuit, to a phase locked loop. The phase locked loop produces a variable frequency clock signal that is synchronised with the data and then combined with the data into an output suitable for supply to a computer system. Such a phase locked loop is illustrated in Figure 1 and includes a voltage controlled oscillator VCO 10 that produces a reference data clock signal f Charge pumps are known in the art, and the one indicated by reference numeral 12 is typical. The charge pump 12 includes a source of charging current I In a typical phase locked loop, the charge pump 12 is fed by a phase discriminator that produces a pair of phase correction signals, one correction signal to increase the charge held by the LPF 13 and thus increase the frequency of the clock signal f The apparatus of the invention, indicated by reference numeral 16 in Figure 1, accepts as inputs the clock signal f Preferably, D represents data read from a magnetic disk. As is known, data is stored on such a disk in the form of magnetic flux transitions. Information is represented by the distance between successive transitions. When read from the disk, successive transitions are sensed and fed to a pulse circuit, which produces a pulse for each transition. In the discussion following, D represents the output of such a pulse circuit. The information carried by D corresponds to the time that elapses between the rising edges of successive pulses. The apparatus 16 also provides, as an output, information obtained from the input data signal D. The apparatus places the information in a standardised format that is synchronised with the clock signal f The operation of the apparatus 16 is illustrated by waveforms in the waveform diagram of Figure 2. In Figure 2, f In the portion of Figure 2 entitled EARLY INPUT CASE, a positive transition 20 of D precedes a positive transition 22 of f In the apparatus of the invention, the INC correction signal alone is enabled and occurs for the period of time t₁ corresponding to the measured phase difference. During this period, the charge pump will direct current into the LPF 13 so as to raise the magnitude of the voltage provided to the VCO 10. The increase in magnitude will increase the frequency of f After the INC correction signal has been occurring for the time t₁, the apparatus 16 turns on the DEC signal to neutralise the INC signal and effectively stop the charge pump changing the voltage to the VCO any more. Referring now to the portion of Figure 2 entitled LATE INPUT CASE, a positive transition 26 of D follows a positive transition 28 of f Again, the apparatus 16 stops the charge pump voltage from changing by causing the INC signal to assume a positive state after the DEC signal has been on for the time t₂ corresponding to the measured phase difference. This neutralises the DEC signal and stops the charge on the LPF 13 changing any more. The procedure of turning on the unactivated INC or DEC correction signal after the other correction signal has been in a positive state for a time corresponding to a measured phase difference permits the phase discriminator operation of the apparatus 16 to be terminated without transitioning through the well known deadband region . The deadband region results from the finite time required to switch the charge pump current circuits. As shown in Figure 2, after providing both correction signals in their positive states for an amount of time, the apparatus 16 will deactivate them simultaneously. The apparatus 16 includes the elements indicated by reference numerals 32 46 shown in Figure 3. It does not include the block labelled DISK FILE CONTROLLER. The apparatus 16 includes a multi state latch circuit that embraces the latches 32 40. The latch circuit moves through a multi state phase measurement and frequency adjustment cycle. The latches 32 40 are referred to hereinafter by the designation given to their respective outputs or by their assigned reference numerals. The output of each latch depends on whether the latch is set or reset. A ramp timer 41 is enabled by the output W of the TIMER RUN latch 36. The ramp timer is conventional. When W is set, a ramp generator, not illustrated, in the timer produces a ramp signal whose duration defines the reference timing period. When the ramp signal ends, the timer 41 produces a signal T marking the end of the reference timing period. Thus, the time between a positive transition of W and the following transition of T defines the reference timing period. The outputs of the latches 32, 34, 36, 38, and 40 and the output of the ramp timer 41 are labelled Z, X, W, Y, V, and T, respectively. These outputs, together with f As illustrated in Figure 3, the output Z of the latch 32 is determined by the conditions of state variables V, W, f The INC and DEC correction signals are provided by an INC gate 42 and a DEC gate 44. The INC signal output of the INC gate 42 depends upon the conditions of the state variables Y and W that are the inputs to the gate. The DEC signal output of the DEC gate 44 is determined by the conditions of the state variables V and W. The standardised data provided by the apparatus 16 is the output of a DATA DECODER gate latch 46 that responds to the conditions of the input state variables W, V, and X. The operation of the apparatus 16 illustrated in Figure 3 can be understood with reference to the timing diagram of Figure 2 and the state change or transition diagram of Figure 4, the logic equation of Table II see below , and the equations 1 , 2 and 3 that follow. Each state of the Figure 4 diagram is determined by a particular combination of the state variables produced by the multi state latch circuit. The state sequences of the Figure 3 apparatus for the EARLY INPUT and LATE INPUT cases illustrated in Figure 2 are shown at the bottom of Figure 2 beneath the STANDARDISED DATA waveform. Table I associates each of the states of Figure 4 with the conditions of the V, W, X, Y and Z state variables which determine each state. In Table I, conventional digital notation is used for the state variables. Thus, for example, the multi state latch circuit of the apparatus 16 is in state 1 when all of the latches 32 40 are reset. Similarly, the multi state latch circuit of apparatus 16 is in state 5B when all of the latches 32 40 are set. As will be understood by those skilled in the art, the reset state of a state variable is indicated by a bar over the variable, while the set state is indicated by the absence of a bar. The conditions of the input state variables for setting and resetting the latches 32 40 are given in Table II. Again, the notation of the state variables equations in Table II is conventional and equivalent to that utilised in Table I. The values of the phase correction signals INC and DEC produced by the apparatus 16 are given by equations 1 and 2 . The STANDARDISED DATA output of the DATA DECODER gate latch 46 is given in equation 3 . Finally, the waveform labelled RUN in the Figure 2 waveform drawing illustrates the variable W output by the TIMER RUN latch 36 as well as the ramp signal generated in RAMP TIMER 41. As shown in the state change or transition diagram of Figure 4, the multi state latch circuit will initially be in state 1 or state 2, depending on the state of the clock signal f For the EARLY INPUT case of Figure 2, the positive transition 20 of the input data signal D is received while the latch circuit is in state 1. In state 1 all of the latches 32 40 are reset. The input data transition 20 sets the TIMER RUN latch 36 causing the state variable W to rise at 47. Setting the latch 36 takes the latch circuit to state 3. In state 3, the ramp generator in ramp timer 41 begins operation, as indicated by transition 47a in the RUN signal. Operation of the ramp generator in ramp timer 41 results in the generation of a ramp signal indicated by the dashed outline 48. The ramp signal 48 is generated for a reference time period that is equivalent to 1 2 of the nominal cycle time for the clock signal f In the EARLY INPUT case, the reference timing period established by the ramp signal 48 will end prior to the next negative transition 24 of f In state 4I, W and Y are both in their positive states, which satisfies the condition of equation 1 . This raises the INC correction signal, which, as explained above, causes the charge pump 12 to raise the voltage supplied to the VCO 10 so that f The latch circuit will remain in state 4I for the phase difference time represented by t In state 5ID both the INC and DEC correction signals are on in order to neutralise the INC signal and effectively stop the charge pump 12 from further changing the voltage to VCO, as explained above. In addition, the first variable term of equation 3 is satisfied, causing the standardised data output OUT to rise as illustrated by transition 64. The latch circuit remains in state 5ID for only a short time. Being in state 5ID satisfies the set conditions for the X latch 34 and raises the state variable X as illustrated by transition 66. This sends the latch circuit to state 5B where it stays for a length of time equivalent substantially to the time consumed between establishing the reset conditions at the input to the TIMER RUN latch 36 and the responsive negative transition of W at 68. Once in state 5, the INC and DEC correction signals are turned off, but the standardised data output OUT remains on. States 5ID and 5B provide a two gate delay for the overlap of the INC and DEC signals. As described hereinbelow, the logic structure of the latch TIMER RUN 36 is designed to make sure enough time is allowed for the latch 34 to be set well before the latch 36 begins to reset. Assuming that the state variable F is disabled, the latch circuit will immediately change to state 5F when the Y latch 38 is reset following the negative transition 68 of W. During state 5F, the next positive transition 25 of f In the LATE INPUT case of Figure 2, the positive transition 26 of D is received while the latch circuit is in state 2 since the transition 26 was preceded by the positive transition 28 of f In state 5D the ramp signal continues to rise, the standardised data output OUT is activated, and the DEC signal goes to a true state. This causes the charge pump to remove charge from the LPF 13 so as to reduce the frequency of f The latch circuit will remain in state 5D for a time equal to the phase error between the input data D and the clock f When the ramp timer 41 completes generating the reference time period and produces the timeout signal T, the Y latch 38 is set, which moves the latch circuit to state 5ID. From this point, the latch circuit will perform as described above for the EARLY INPUT case. An advantageous feature of the apparatus 16 is that the ramp timer 41 is controlled by state variable W. This enables the apparatus to produce an INC or DEC correction signal by enabling a respective one of gates 42 or 44 by initially changing the state of W, and then producing the signal by a change in state of Y or V. For example, the INC correction signal rises when the variables W and then Y are positive. The TIMER RUN latch is always set first so that an INC sequence, represented by the transition from state 4 to state 4I, always begins by setting only the state variable Y through the Y latch 38. The DEC correction signal is caused by W and then V both being set. Again, the variable W is always set first so the DEC sequence represented by the change from state 4 through state 5D is initiated solely by setting V. Both the INC and the DEC correction signals are disabled when the variable W is reset. This provides a balance in the phase measurement performed by the apparatus 16 that reduces the offset that can be introduced by logic. Another desirable feature of the apparatus of the invention is the effect of the state variables V and Y on the provision of the INC and DEC correction signals. In an EARLY INPUT case, correction begins when Y is set. Correction ends when V is set. The correction ends because both the DEC and INC signals are set. This permits both the charging and discharging current sources to remain on long enough for the decrease current source to stabilise, at which point both INC and DEC signals are disabled by resetting the variable W. In the case of a LATE INPUT, the discharge current source is switched on when the variable V is set. The decrease current source operates and reduces the frequency of f The standardised data output OUT from the DATA DECODER gate 46 is synchronised with a negative transition of f For example, with reference to Figure 2, the negative transition 24 of f Returning to the state change or transition diagram of Figure 4 and regarding the timing diagram of Figure 5, it will be seen that the return path in the transition diagram from state 5 will vary if the state variable F is set. This variation in the return path enables a special data asymmetry protection function of the apparatus 16 that permits the apparatus to perform phase detection on specialised data that is typically encountered when first synchronising to a field of data on a magnetic disk. Such specialised data can include, for example, a repeated data pattern contained in a gap heading the data field. The embodiment of the invention illustrated in Figures 2, 4, and 5 is intended for a disk drive system in which the repetition rate of gap synchronising data is 1 4 of the rate of f The fact that the data in the gap is of known frequency can be used to prevent a false lockup condition occurring. A false lockup condition occurs when a phase locked loop temporarily locks to input data with a phase error of 180 , which can occur if the input signal has bit pairing. As is known, when 180 false lockup occurs, input data pulses will have an apparent phase error that alternates on successive input pulses between very early and very late. Further, the input data pulses will alternately appear to be separated by one less clock cycle and then one more clock cycle than is actually the case in fact, the pulses are separated by a constant number of clock cycles. Although false lockup is not a stable condition, it can increase the time needed for a phase locked loop to achieve phase alignment. The data asymmetry variable F represents a signal that would be produced, for example, when detection circuitry in a disk file controller detects the presence of a gap. Since the apparatus of the invention is expecting gap data that has 1 4 the frequency of f Therefore, assuming a positive transition in the incoming data D that results from the detection of a gap transition that, together with the transition 80 of f From state 6, the state change cycle will prevent the latch circuit from responding to any positive transitions of D for two more cycles of f As inspection of Figure 4 shows, the succession of states from A1 to 1 is made in response to the transitions of f An additional loop in the state change cycle of Figure 4 is between states 7 and 8. When the disk file system changes from a read to a write function, the disk file controller will inhibit the operation of the apparatus of the invention by enabling the RESET signal R. If the latch circuit is in states 1 or 2, when R is set, it will change to either state 7 or to state 8, respectively. The latch circuit will alternate between states 7 and 8 without taking any other action until R is disabled and no input data signal is present. It should be evident that the logic states described hereinabove are not the only ones that can be assumed by the multi state latch circuit. Other states and other variations of the state change cycle of Figure 4 are possible. Indeed, it would behove a designer to provide for those other states and changes when implementing the apparatus of the invention. If the multi state latch circuit should enter one of the states not discussed herein under a set of conditions not described, it would be necessary to provide an escape path that would permit the latch circuit to change back to one of the states illustrated in Figure 4. Design of such escape paths or alternate routes is well within the competence of any reasonably skilled logic designer, and the logic equations of Table II provide such escape routes. Although a variety of circuit technologies exist for implementing the latches 32 40 and 46 and the gates 42 and 44, it has been found that conventional differentially coupled cascaded emitter coupled logic CECL provides several advantages over conventional single ended logic circuitry such as TTL. The use of differential logic circuitry such as CECL reduces the effects of noise and other external influences in causing a variation in the delay characteristics of the latch circuits. Further, the variations due to differences between rise and fall times are reduced since every state transition involves one or more pairs of differential signals. Finally, as is known, differential logic circuits provide a better noise margin than is obtained with single ended logic circuits. This permits smaller signal swings to be used, which results in a better speed power product for the latch circuits. An example of implementing the latches 32 40 and 46 in CECL is provided in Figure 6, which is a schematic representation of a CECL circuit that is functionally equivalent to the TIMER RUN latch 36. As is typical with CECL circuits, two cascaded sets of emitter coupled transistor pairs 100 106 and 110 are used to implement logic internal to the latch that will provide the response to the input state variables required to set and reset the variable W. Thus, when the latch is reset, each of the positive sense output voltages W1, W2, W3, W4, and W5 will be at a lower voltage than the corresponding one of the negative sense output voltages 1 5. The set or reset state is determined by diversion of the current from the main current source transistor 118 through successive ones of the emitter coupled switch pairs 100 106 and 110, which are connected in such a manner as to allow a number of logical decisions to be made while only expending the dissipation of a single current path. One further addition to the CECL circuits of the latches 32 40 and 46 is the provision of trickle current transistors, one of which is indicated by 120 in Figure 6. Each of the trickle current transistors is biased by a voltage V Of course, it is within the capability of a skilled circuit engineer to convert the state variable signals in Figure 3 to the multi level, differential signals required to operate CECL. It will be noted in Figure 6 that the variable X which resets the TIMER RUN latch is obtained from the penultimate output level X4 of the X latch. This prevents a race between the setting of the X latch in state 5ID and the resetting of the TIMER RUN latch in state 5B. As shown in Figure 6, the X4 differential inputs are brought into the fourth input level of the TIMER RUN latch, which guarantees complete setting of the X latch before the resetting conditions of the TIMER RUN latch are present.