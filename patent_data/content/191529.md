# ELECTRICAL FILTER

## Claims
Integriertes elektrisches Filter mit wenigstens einem Kondensator, wenigstens einem Widerstand und einer Trimmerschaltung zum Feinabgleichen des Produkts des Widerstandswerts des Widerstandes und der Kapazität des Kondensators,

## Description
The invention relates to an integrated electrical filter comprising at least one capacitor, at least one resistor, and a trimming circuit for adjusting the value of the product of the resistance of the resistor and the capacitance of the capacitor. Both active and passive filters may be constructed using one or more capacitors and resistors. The filters may have high pass, low pass, band pass and band stop characteristics. Low pass filters may be used as input filters for switched capacitor filters which because they are sampled data filters require the input signal to be band limited to prevent aliasing. Switched capacitor filters are being increasingly used due to their relative ease of integration. Similarly low pass filters are required as input filters for any signal processing circuits using sampled data techniques, e.g. other switched capacitor circuits and CCD circuits. However, resistors and capacitors in integrated form have only a limited accuracy which prevents continuous time RC filters from having a closely defined, repeatable characteristic. Consequently it has been the general practice to use a discrete component filter in front of an integrated switched capacitor circuit or to use a much higher clock frequency which tends to increase the power dissipation. This, however, increases the cost of a system and consequently it is desirable to find a method of satisfactorily integrating a continuous time filter. An integrated continuous time filter in which a more accurate RC time constant may be achieved is described in a paper entitled Switched Resistor Filters. A Continuous Time Approach to Monolithic MOS Filter Design by R.L. Geiger, P.E. Allen, and D.T. Ngo published in IEEE Transactions on Circuits and Systems, Vol. Cas 29, No. 5, May 1982, pages 306 315. This paper describes a filter in which each resistor is formed by field effect transistors FETs whose resistance is determined by the change stored in, and hence the voltage across, a capacitor connected between their gate and source electrodes. Each resistor is formed by two FET s only one being switched into the filter at a time, the other being connected in a trimming circuit which adjusts the voltage across the capacitor so that the resistance of the FET is made equal to the equivalent resistance of a switched capacitor. Thus when the FET is switched into the filter circuit the time constant of the filter capacitor and resistor depends only on the ratio between the switched capacitor and the filter capacitor and the clock frequency at which the switched capacitor is switched. When two or more capacitors are formed in a single integrated circuit it is comparatively straightforward to obtain an accurate ratio between the capacitance values. The clock frequency can also be defined accurately as it will normally be generated by an external circuit. However this known filter has the disadvantage that the resistance of the FETs have a non linear relationship to the control voltage and this gives rise to inaccuracies in the resistance values. Also the resistances of different FETs for equal gate source voltages are found to vary significantly due to differences in the voltages on the drain electrodes and on the back gates. Since the resistance of the FET is influenced by the source drain voltage the input signal will cause modulation of the FET resistance thus varying the filter characteristics with input signal amplitude. Further the use of two FETs for each resistor, only one of which is used at any instant, may give rise to crosstalk between the clock signals used for switching. It is an object of the invention to enable the provision of a filter as set forth in the opening paragraph in which a different approach to the problem of compensating for the spread in values of capacitance and resistance in integrated filters can be adopted which enables the effects of some of the disadvantages of known filter to be mitigated. The invention provides an integrated electrical filter as set forth in the opening paragraph characterised in that, the trimming circuit comprises means for charging a further capacitor from a reference voltage source through a further resistor for a first period, means for removing the charge from the further capacitor in discrete increments during a second period, means for counting the number of increments required to remove the charge accumulated on the further capacitor during the first period, and means for adjusting the value of said at least one capacitor or said at least one resistor in dependence on the number of increments counted. A filter according to the invention has the advantage that the value of real resistors or capacitors is adjusted, thus avoiding the problems associated with the non linear response of the FETs. The first period may be equal to 2 The means for counting the number of increments may be a binary counter which is incremented by said clock signal. The further capacitor may form part of an integrator and the output of the integrator may be arranged to cause the output of the counter to be read into a register when the charge has been removed from the further capacitor. Alternatively the output of the integrator may be arranged to inhibit further counting of the clock signal by the counter. Said at least one capacitor may comprise a first capacitor and N associated capacitors, each of the N associated capacitors being connected in parallel with the first capacitor Said at least one resistor may comprise a first resistor and N associated resistors, each of the N associated resistors having an associated switch to enable it to be selectively connected in series with the first resistor, the associated switches being controlled by the counting means. The means for removing the charge from the further capacitor may comprise a switched capacitor which is charged from said reference voltage source in a first part of each cycle of a clock signal and whose charge is transferred to the further capacitor in a second part of each cycle of the clock signal, the first and second parts being non overlapping. The filter may further comprise means for comparing the current state of the counting means with that stored in the register in the previous cycle, means for comparing the voltage across the further capacitor with a first reference voltage when the current state of the counting means is not equal to that stored in the register, and means for comparing the voltage across the further capacitor with a second reference voltage when the current state of the counting means is equal to that stored in the register. This has the advantage of enabling the provision of a hysteresis effect which reduces the effect of noise on the increment count obtained and thus reduces the possibility of switching the characteristics on the occurrence of noise. The integrator may comprise a differential amplifier whose offset voltage is switched in sign between the first and second periods. This enables the provision of an offset cancelling arrangement which reduces the effect of offsets in the amplifier on the adjustment of the capacitors or resistors of the filter. Embodiments of the invention will now be described, by way of example, with reference to the accompanying drawings, in which Figure 1 shows a simple first order active filter having an input I Clearly any spreads in the value of R The filter referred to in the introduction has sought to overcome this problem by making a controlled adjustment of the resistance values in the filter. The arrangement shown in Figure 2 allows a controlled adjustment of the capacitance values or if suitable modifications are made the resistance values. As shown in Figure 2 a first order active filter comprises an input I1 which is connected via a resistor R1 to the junction of the inverting input of a differential amplifier A1, a resistor R2, a capacitor CO, and to N series arrangements of a capacitor CN and a switch SN, where N is an integer which is chosen to give the desired precision of cut off frequency. The other end of the resistor R2, the series arrangements of capacitors CN and switches SN, and the capacitor CO are connected to the junction of the output of the differential amplifier A1 and an output terminal O1. The non inverting input of the differential amplifier A1 is connected to ground. This arrangement forms a first order active low pass filter. The capacitors CN have binary weighted values and can be selectively connected in parallel with capacitor CO by means of the switches S1 to SN, which switches are controlled, as described hereinafter, to be operated in such a manner as to closely define the cut off frequency of the filter. The rest of the circuit forms a trimming circuit for adjustment of the value of the filter capacitance by providing appropriate signals for controlling the operation of the switches S1 to SN. A terminal T1, to which, in operation, a reference voltage source is connected, is connected The operation of the arrangement will now be described with reference additionally to the waveforms shown in Figure 3 and the characteristic shown in Figure 4. Since the filter and trimming circuit are integrated together it can be arranged that the ratios of the capacitances of capacitors CO, CN, TC1 and TC2 are accurately defined as are the ratios of resistors TR1 and R2. A reference voltage V, which may for example be the chip power supply voltage, is applied to terminal T1 while a clock signal Ø is applied to terminal T2. At time t₁ the signal Ø where At time t₃ switch TS1 is opened and switches TS2, TS3, TS4, and TS5 are controlled by waveforms A and B which between times t₃ and t₅ are complementary to each other and change at the clock frequency fc. Consequently capacitor TC2 integrates the current from capacitor TC1 to produce a positively going staircase. Each where C1 is the capacitance of capacitor TC1. At time t₄ which is P cycles of the clock signal after time t₃ the counter 11 is reset. Capacitor TC2 continues to integrate current from capacitor TC1 and when the staircase crosses zero, i.e. v 0, AND gate 10 produces a signal which causes the pulse generator 20 to produce a short pulse to load the output of the counter into the N bit register 13. The pulse generator 20 is constructed to produce a short pulse in response to the signal transition from false to true at the output of the AND gate 10 and may be a monostable multivibrator or could alternatively be formed from clocked bistable circuits. The outputs S1 to SN of this register then control the switches S1 to SN of the filter to produce a more accurately defined cut off frequency. At time t₅ the Figure 4 shows the discrete approximation to the ideal compensation characteristic covering a spread in characteristic frequency Ω for the range As shown in Figures 3 and 4 Ω The approximate characteristic coincides with the ideal characteristic at 2 The term From equation 1 the integrator output voltage at time t₃ is given by m cycles of the clock signal Ø after time t₃ the integrator output voltage is After a further m Equation 8 shows that for processing characteristic Ω Equations 15 and 17 show that the filter cut off frequency w The value of the capacitance Co of capacitor TC2 does not influence the performance of the trimming circuit and need only be chosen to limit the voltage excursion at the output of the integrator, i.e. to prevent saturation of the amplifier TA1. The maximum voltage at the output of the integrator is given by The quantization error, E, can be expressed as the peak error between the ideal and quantized characteristics shown in Figure 4 This is a maximum when n o The range of cut off frequencies produced by processing spreads which can be compensated for can be expressed as S where Equations 19 and 20 illustrate how a filter having an uncompensated spread S can be improved to give a compensated spread given by E Table 1 shows uncompensated U and compensated C spreads in filter cut off frequency for various values of N and P. TABLE I Assume that From Table 1 choose The values of the capacitors in the capacitor array shown in Figure 5 are then as follows If, in a given circuit, the counted increments n 26 then The counter output n in binary form is 11010 and hence switches 55, 54, and 52 are made and the capacitor array connected across the amplifier A1 comprieses capacitors CA5, CA4, CA2 and CAO whose total capacitance is 20.25pF. Figure 6 shows a first order filter in which the resistors are adjustable instead of the capacitor. This may have advantages when higher order filters are desired since they do not always have solutions with equal valued capacitors but normally to have solutions with equal valued resistors. The programming is made easier if all the values are the same. It should be noted that although in theory the corrections for unequal valued capacitors are the same, i.e. the capacitance ratios remain constant, the difference in value between the lowest and highest required values becomes unwieldy and makes them difficult to fabricate. With a first order filter as shown in Figures 1 and 6 there are advantages in using a capacitor array in that only one capacitor needs adjustment. When the adjustment is applied to the resistance values it is desirable to adjust both R Various modifications may be made to the trimming circuit. For example instead of using the output of the comparator TA2 to load the N bit register 13 with the counter state it would be possible to stop the counter cycling at the time and use the counter outputs directly to control the switches S1 to SN. The advantage of the arrangement shown in Figure 2 is that it compensates for long term drift due to ageing and temperature variations. If the processing spreads are outside the limits of correction set by the chosen values of N and P it is possible for an inappropriate correction to be made. For example when the value is less than Ω An alternative to the trimming circuit described is to transfer a charge from a further capacitor to the capacitor TC2 in a first period and to discharge the capacitor TC2 through a resistor in a second period. A counter is started at the beginning of the second period and stopped when the capacitor TC2 is discharged, i.e. v 0. The state of the counter again programmes the switches S1 to SN. Again the count reached by the counter will depend on the processing spreads, the total charge transferred and hence the discharge time is representative of the absolute capacitance and resistance values. Figure 7 shows a third embodiment of a first order active low pass filter which is a modified version of that shown in Figure 2. Equivalent elements in Figure 7 have been given the same reference numerals as those in Figure 2. Only the changes from the embodiment shown in Figure 2 and described with reference thereto will be described in detail hereinafter. The differential amplifier TA1, an example of which is shown in Figure 9, is provided with a further input which is fed with the signal Ø The analogue comparator TA2 has been modified by connecting its inverting input to two reference voltage sources VR1 and VR2 The digital comparator 21, switches TS9 and TS10 and reference voltage sources VR1 and VR2 form a hysteresis circuit which reduces the tendency of the programming outputs S1 SN to change due to noise on the signal applied to the amplifier TA1. The voltage VR1 may be 5mV and the voltage VR2 5mV, the switch TS9 being operated when the comparator 21 does not detect equality, and the switch TS10 when the comparator 21 detects equality. In this way noise on the incremental charges fed to capacitor TC2 and noise at the output of amplifier TA1 are both less likely to affect the point at which the amplifier TA2 detects that the charge on capacitor TC2 has been reduced to zero, since on the step before the expected increment the reference voltage is 5mV rather than ground and on the step of the expected increment the reference voltage is 5mV. In this context the expected increment is the increment corresponding to the increment which produced zero charge on capacitor TC2 during the previous cycle, i.e. the increment number stored in the register 13. This means that a peak noise level of 5mV can be superimposed on the step before the expected increment without a false change of programming count. Similarly, on the expected increment a 5mV peak noise signal in the opposite direction can be tolerated before the zero charge is not detected. The 5mV levels are given only as an example, the actual level used will depend on the step size and the noise immunity required in a particular embodiment. It is, of course, necessary that VR2 VR1. The switches TS7 and TS8 are used to cancel offsets in the amplifier TA1 using the property of the amplifier TA1 that its offset voltage is reversible by means of the further input fed with the signal Ø The capacitor TC1 discharges to x because the offset on the amplifier has been reversed by application of the signal Ø After n increments the outputs of the amplifier TA1 Figure 8 shows the effect of this arrangement on the output of the amplifier TA1 with zero offset waveform Y , 100mV offset waveform X , and 100mV offset waveform Z . It can be seen from Figure 8 that all the waveforms cross at an output voltage of zero regardless of the offset voltage. It can also be seen that the magnitude of the incremental steps varies with the offset. Figure 9 shows an embodiment of an amplifier suitable for use as the amplifier TA1. The amplifier shown in Figure 9 comprises two FETs having their source electrodes coupled through a current source CS1 to a first power supply rail PS1. The gate electrode TR1 is connected In operation during the period t₁ to t₃ switches AS1, AS3, AS5 and AS8 are made and switches AS2, AS4, AS6, and AS7 are open. Consequently the non inverting input is connected to TR1, TR3 forms the diode of the current mirror comprising TR3 and TR4, and the output is taken from the drain of TR4. During the period t₃ to t₅ switches AS1, AS3, AS5 and AS8 are open and switches AS2, AS4, AS6 and AS7 are closed. Consequently the non inverting input is connected to TR2, TR4 forms the diode of the current mirror comprising TR3 and TR4, and the output is taken from the drain of TR3. Since the positions of TR1 and TR2 are interchanged and the positions of TR3 and TR4 are also interchanged any offsets will be of equal magnitude but opposite sign. Thus this amplifier may be used in the offset cancelling arrangement described with respect to Figure 7. While the foregoing description has been with reference to active filters it is equally applicable to passive filters where the adjustments of resistors and or capacitors is required to produce an accurately defined cut off frequency.