# INTERRUPT MECHANISM FOR MULTI MICROPROCESSING SYSTEM HAVING MULTIPLE BUSSES

## Claims
Multiverarbeitungssystem, enthaltend

## Description
This invention relates to data processing systems having a plurality of microprocessors interconnected by a plurality of busses. More particularly, the invention relates to a novel interrupt mechanism for such systems. There are many types of applications in the data processing area in which a plurality of processors operate in parallel to execute a single job or solve a single problem. One such area is that of hardware accelerators which are used to solve a variety of computer aided design problems. In designing such a system, it was decided to use a relatively large number of commercially available microprocessors that would operate in parallel under the control of a single executive processor. By way of example, it was decided to use sixteen microprocessors and allow for the expansion of the system to accommodate even more. To reduce bus contention and bottlenecks, which would occur if all the processors were connected to a single bus, several busses are connected into a hierarchy. The executive processor is connected to a global bus which in turn is connected to a plurality of cell busses. Each cell bus is connected to plural processors. Next, it was decided that communication between the different processors would be handled primarily through an interrupt mechanism in which each processor would be given a unique interrupt. However, the standard bus design for such processors has a limited number of prioritized interrupt lines so that where the number of processors exceeds the number of interrupt lines, each processor cannot be given a unique interrupt by being connected to a different line. One solution would be to connect plural processors in a daisy chain, as, with conventional I O devices, but such a solution would create a bottleneck where plural processors in a given daisy chain simultaneously require being interrupted. Another solution would be to change the bus protocol and add a different line for each processor. Again such solution would increase the cost of the system. Thus, a novel interrupt mechanism described hereinafter, was designed enabling each processor to have a unique interrupt without requiring modification of a conventional bus protocol. The object of the invention is to provide a unique interrupt for each processor of a multiprocessing system wherein the number of processors exceeds the number of prioritized interrupt level lines in a bus interconnecting the processors and to provide a relatively low cost, high performance multiprocessor system, with a novel interrupt mechanism for communicating between a plurality of commercially available microprocessors utilizing a standard bus architecture or protocol. Briefly, in accordance with the invention, a multiprocessing system is described which comprises a global bus having a plurality of prioritized interrupt lines, an executive processor connected to said global bus for signalling interrupt requests on predetermined interrupt lines, a plurality of cells connected to said global bus via an associated bus interface system, each cell being connected to receive an interrupt request from a different one of said predetermined interrupt lines. Each cell comprises a cell bus having a plurality of cell bus interrupt lines, and a plurality of cell processors each connected to a different one of said cell bus interrupt lines of said cell bus for receiving interrupt requests therefrom, one cell processor being a master processor for receiving interrupt requests initiated by said executive processor, and each other cell processor in a cell being a slave processor for receiving interrupt requests from said master processor, the total number of cell processors exceeding the number of prioritized interrupt lines in said global bus, whereby each cell processor has a unique interrupt by virtue of each cell being connected to a different interrupt line in said global bus and each cell processor being connected to a different interrupt line in said cell bus connected thereto. Said executive processor initiates an interrupt request for a given slave processor in one of said cells, such interrupt request being transmitted over said global bus by the one of said prioritized interrupt lines thereof connected to said one cell via the bus interface system, to said master processor in such cell, said master processor in such cell responding to receipt of such interrupt request to transmit such interrupt request to said given slave processor. Each bus interface system comprises an interrupt system for controlling the flow of interrupt requests between the cell bus and the global bus, and memory means connected to the global bus and to the associated cell bus for storing data, each of said cell processors storing interrupt handling routines. Each cell processor in response to an interrupt request received on an interrupt line of said cell bus connected thereto interrupts its current processing and processes one of said interrupt handling routines. Referring now to the drawings and first to Fig. 1, a multiprocessing system includes an executive processing element EPE 10 connected to a global bus 11. A plurality of cells 12 a d each of which includes plural processors as more fully described below, are connected through a plurality of bus interface systems 13 a d respectively to global bus 11. A work station 14, such as a personal computer, is connected to the executive processing element 10 and is operative amongst other things to input jobs into the multiprocessing system for execution. Referring to Fig. 2, each of cells 12 is identical so that only one need be described in detail. Each cell 12 comprises a cell bus 16 connected to the associated bus interface system BIS 13. Connected to bus 16 is a master processing element MPE 18 and three slave processing elements SPE 20, 22, and 24. All of the processing elements 10, 18, 20, 22, and 24 are substantially identical so that only one need be described in detail. Each processing element is a commercially available micro computer system and comprises a Versamodule monoboard micro computer, M68KVM02 series, commercially available from Motorola Inc. Such micro computer is described in detail in the publication entitled Versa Modules , M68KVM02 Series, Versa Module Monoboard Micro Computer User s Guide, First Edition, Copyright 1982 by Motorola, to which reference may be had for details thereof not described herein. Inasmuch as the processing elements are commercially available, only those details thereof that are necessary for an understanding of the invention are described herein. With reference to Fig. 3, which shows the executive processing element 10, each processing element includes a microprocessor or processor 30 connected to a local bus 32. Associated with processor 30 is a local memory 34 connected to a dual port interface 36. One port of interface 36 is connected to local bus 32 and provides the means whereby processor 30 can access memory 34. The other port of interface 36 is connected by line 38 to bus 11 whereby other devices and processors external to processing element 10 can access local memory 34. Connected between busses 11 and 32 is an interrupter 40 the primary function of which is to interrupt other processors with an interrupt request initiated by processor 30. An interrupt handler 42 is also connected between the busses and its primary function is to receive interrupt requests from bus 11 for interruption of processor 30. A bus interface 44 is connected between busses 11 and 32 and provides the primary interconnection between the two busses for the transfer of addresses and data so that local bus 32 can be either connected to or disconnected from bus 11. When disconnected from bus 11, local bus 32 allows processor 30 to use local bus 32 independent of usage of bus 11. A requester 46 is connected between bus 32 and 11 and supplies signals over bus 11 to an arbiter 48 when processor 30 wants to be connected to or use bus 11. Arbiter 48 is connected to bus 11 and receives various requests for use of bus 11 and controls which request will be granted at any given time. Processing element 10 and each of the master processing elements 18 use an arbiter and act as a master for controlling use of the global bus or cell busses to which they are connected. The remaining processing elements which are slave processing elements have their respective arbiters 48 disabled. Status and control registers 49 are connected to bus 32 and provide information, in a manner described in more detail hereafter, for use during the interrupt process. A serial port 51 connects processing element 10 to work station 14. However, the serial port is not used in the other processing elements of the system. Busses 11 and 16 are architected to conform to the bus design described in Versabus Specification Manual , Fourth Edition, Copyrighted by Motorola Inc. in 1981, to which reference may be had for details thereof not described herein. The processing elements and busses as thus far described are constructed in accordance with and operated using the bus protocol of the prior art commercially available system. It should also be noted that in accordance with the general teachings of the prior art, the different processing elements and external busses 11 and 16 to which they are connected could be interconnected by means of either simple switches or bus interfaces that selectively allow each bus to communicate with one another. The point at which the present invention begins to depart from the teachings of the prior art are the use of BIS 13 a d for interconnecting the cell busses 16 to the global bus 11 in the manner more fully described below. With reference to Fig. 4, each BIS 13 includes an interrupt system 50 for controlling the flow of interrupts between cell bus 16 and global bus 11, and a memory system 54 connected between busses 11 and 16. As shown in Fig. 5, memory system 54 includes a random access memory 60 operable under the control of a memory control 62 for storing data in conventional fashion. Address decoders 64 and 66 are respectively connected to busses 11 and 16 and to an arbiter 68 the function of which is to connect memory 60 for access from either of the busses but only one at a time. In this regard, arbiter 68 gives priority to access requests from bus 11. Memory drivers 70 and 72 are respectively connected to busses 11 and 16 and to memory control 62. Referring to Fig. 6, interrupt system 50 includes an interrupt handler 80 that receives requests and data from cell bus 16 and transmits them to an interrupter 78 which, in turn, places the requests and data on global bus 11. System 50 further includes an interrupt handler 74 and interrupter 76 that act in the direction reverse to that of elements 78 and 80 to receive an interrupt request from global bus 11, and place an interrupt request on cell bus 16. Global bus 11 includes an interrupt sub bus having seven prioritized interrupt level lines of which line L7 not shown is reserved for system usage and is not germaine to an understanding of the invention. The remaining lines L1 L6 are used, as schematically shown in Fig. 7 to control the interrupt process. EPE 10 has lines L1 L4 connected to input into bus 11 interrupt request signals that will initiate eventual interruption of one of the other processing elements within the system. Lines L1 L4 are respectively connected to provide inputs into BIS 13 A D , each BIS being connected to a different one of the lines so as to have a unique interrupt signal associated therewith. In turn, each of the BIS units 13 A D is connected as input line into L6, and line L6 from bus 11 is an input into EPE 10 so that EPE 10 can be interrupted by signals from any of the BIS units. The connection between each BIS 13 and the associated cell bus 16 are identical so that only one need be described in detail. With reference to BIS 13a shown in Fig. 7, line L5 is connected as an input into bus 16 and this bus line in turn is connected as an input line L5 to MPE 18. MPE 18 is the only one of the processing elements of a cell that monitors line L5 so that interrupt requests coming into the cell are handled only by MPE 18. Each of the slave units SPE 20, 22 and 24 are connected respectively to lines L1, L2 and L3 of bus 16 so as to receive interrupt requests respectively on such lines. That is, within a given cell, each processing element can have an interrupt initiated by request appearing on a different one of the priority interrupt lines. Thus, within the system, by virtue of the fact that each BIS 13 is interrupted by a different line and each processing element within a cell is interrupted by a different line, each processing element within in the total system thereby has a unique interrupt. Within a cell, each processing element is connected to send interrupt requests to each of the other processing elements. Thus, with reference to SPE 20, lines L2, L3 and L4 are respectively connected to provide inputs into bus 16 which thereupon causes interrupt request signals to be outputted on line L2 to SPE 22, on line L3 to SPE 24, and on line L4 to MPE 18 respectively. This allows intra cell interruption. Relative to MPE 18, it should be noted that it can be interrupted by signals on lines L4 or L5, L4 coming from the other processing elements within the cell and L5 coming from the associated BIS 13. Further MPE 18 sends interrupt requests over line L6 to bus 16 and BIS 13A. The remaining processing elements within the cell SPE 20, 22 and 24 can only be interrupted by other elements in the cell and not from BIS 13. In accordance with conventional technique, the complete interrupt process involved the interation of both software and hardware. Fig 8, is a schematic block flow diagram illustrating the interaction of the principal hardware elements and software used to carry out an exemplary interrupt process. In this particular example, it is assumed that the executive processing element 10 will interrupt MPE 18 of cell 12a. In accordance with step 100 of the process, an application program in memory 34 is being executed by processor 30 and first causes in step 102 a message to be transferred from the application program into a predefined location in memory 54, the message defining what is to be done as a result of the interrupt. In step 104, the status register in 49 is loaded with a one byte interrupt vector which, as indicated below, is an index into a vector table for selecting the appropriate interrupt handling routine. Also, in accordance with step 104, the control register in the 49 is loaded with information identifying which interrupt level will be used. Once the control register is loaded, then step 106 causes interrupter 40 to send in step 108 an interrupt request to BIS 13a. Interrupt handler address decoder 85 receives the request and upon recognizing that the request is directed to BIS 13a, causes the interrupt vector in status register 49 to be transferred to an interrupt handler register 87, in step 110. Thereafter, interrupt handler 85 acknowledges step 112 the interrupt request and thereupon allows processing element 10 to issue another interrupt or proceed with other processing. After acknowledgement, step 114 causes interrupter 76 via step 116 to interrupt cell master processing element 18a. Thus, interrupt request 116 is handled by handler 42 which causes by step 118 the interrupt vector to be transferred into the cell master processor 30 of cell 18a. The interrupt vector is used in step 122 as an index into a vector table and memory 34 of PE 18a which thereupon by step 124 invokes an interrupt handling routine for processing the interrupt. Such routine causes the message in memory system 54 to be transferred into a work area of memory 34 whereupon the message is interpreted by the routine. Upon acknowledgement 120 being sent to BIS 13a, BIS 13a is then free to receive subsequent interrupts. Should the message from memory 54 indicate that another processor in cell 12a is to be interrupted, then processing element 18a would initiate an interrupt to the appropriate processor.