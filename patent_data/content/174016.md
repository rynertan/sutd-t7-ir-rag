# IDENTIFICATION CARD AND AUTHENTICATION SYSTEM THEREFOR

## Claims
Echtheitsnachweissystem f√ºr eine Transaktion, welche eine Chipkarte 1 und eine Echtheitsnachweiseinrichtung 40 verwendet,

## Description
The present invention relates to an authentication system for a transaction using an IC card and an authentication device. Recently, desired items can be purchased without cash but with cards issued from card issuers such as credit cards companies. At time of purchasing, a store clerk checks whether or not a card user or customer is the authorized card holder, i.e., whether or not the card is being misused by the current card user. When the card user is authenticated as the legal card holder, the selected item is sold with the identification card. In this case, the card user is authenticated with a key code. DE A 32 22 288 defining the closest prior art discloses an IC card having a keyboard and a display thereon and being capable of confirming a card holders identity in response to entry of a personal identification number from the keyboard. Furthermore, this known IC card includes a calculating means for carrying out calculating operations without being connected to a terminal. However, the reliability for authenticating the cards holder is not very high since the data calculated in the IC card are not checked outside the card. From EP A1 0096599, a system is known in which only an IC card is authenticated by a terminal. In this known system, random number data is generated in the terminal, and the random number data and address data are supplied to the IC card from the terminal. Prescribed data is then read out of a memory provided in the IC card according to the supplied address data. The read prescribed data, the address data, and the random number data are used to calculate new number data in the IC card. Accordingly, the IC card must be connected to the terminal. Furthermore, in the terminal, second new number data are calculated from the generated random number data. The authentication of the IC card is performed by comparing the obtained first and second number data. This system has a rather high reliability for authenticating the card. However, this known system can only be operated in an on line fashion, and, since a communication line must be used, the code and data may be intercepted, thus failing to guaranty security of the system. The present invention has been made in consideration of the above situation, and has as its object to provide an authentication system for a transaction using an IC card and an authentication device, wherein both a card holder and the IC card itself can be authenticated respectively. According to the present invention, this object can be achieved by an authentication system for a transaction using an IC card and an authentication device, wherein said IC card which represents a predetermined number specified by respective IC cards on the card surface has a keyboard and a display thereon, is capable of confirming a card holder s identity in response to entry of a personal identification number PIN from said keyboard and includes a calculating means According to the present invention, the card holder is authenticated when PIN data input by the card holder coincides with PIN data stored in the IC card, and the IC card is authenticated when first SAN data calculated in the IC card by using the input PIN data and input transaction data coincides with second SAN data calculated in the authentication device by using the stored PIN data and the input transaction data. More specifically, the first SAN data is calculated in the IC card by using the transaction and PIN data input from its keyboard, after a coincidence between the input PIN data and the stored PIN data is detected in the IC card. The PIN data corresponding to the respective IC card are stored in the authentication device in such a manner that each PIN data corresponds to a predetermined number of the IC card, in particular to a primary account number data. When a transaction is performed by using the IC card, the PIN data corresponding to the predetermined number of the IC card which is not a secret number like an identification number is read out from a memory provided in the authentication device. The read PIN data and the input transaction data are used to calculate the second SAN data in the authentication device. The first and second SAN data are compared with each other to output a comparison result. In the system of EP A1 0096599, the authentication of the IC card is also performed by comparing first and second obtained number data. However, the function of this prior art system is quite different from that of the invention. The calculation of the number data is based on random number data generated in the terminal and supplied to IC card when it is connected to the terminal. Furthermore, this data includes a secret code which is unknown to the card holder. In contrast to this prior art, the IC card of the invention includes a keyboard for inputting the PIN data and transaction data. After a coincidence between the input PIN data and the stored PIN data is detected in the IC card, then the first SAN data is calculated in the IC card by using the transaction data input from the keyboard of the IC card and the input PIN data. Further advantageous embodiments are defined in the subclaims. This invention can be more fully understood from the following detailed description when taken in connection with the accompanying drawings, in which The present invention will be described in detail with reference to a preferred embodiment in conjunction with the accompanying drawings. Referring to Fig. 1, an identification card 1 has the same outer dimensions as a normal credit card. The card 1 has a measure of 54 mm x 85 mm x 0.8 mm to comply with the ISO standards. A data input keyboard 2 and a liquid crystal display unit 3 are formed on the surface of the card 1. An LSI not shown is incorporated in the card 1. A card holder s name, an account number and the like are embossed on the plastic lower surface of the card 1. A paper like cell is incorporated in the body of the card 1. The keyboard 2 has a ten key pad and function keys in the same manner as a conventional compact calculator. The keyboard 2 also has an collation function CF key 2a, a date D set key 2b, a time T set key 2c, a time date selector T D key 2d and the like. Fig. 2 is a block diagram of the identification card 1. Data entered at a keyboard unit 2 is supplied to an arithmetic operation memory unit 7 through an input control unit 5 and a system bus line 6 under the control of a control unit 4 constituted by a microprocessor. The input data is written in a register 8 for temporarily storing a personal identification number PIN as secret data and a total amount AMT as transaction data. The arithmetic operation memory unit 7 is used when the identification card 1 performs a calculator function. The unit 7 stores data written therein and performs various types of arithmetic processing. The arithmetic operation data is displayed on a display unit 3 through the bus line 6 and the display control unit 9. The bus line 6 is connected to a time measuring circuit 10 for measuring the current date and time, a PIN register 11, a coincidence unit 12, a sales approval number SAN calculation processing unit 13 and a system program memory unit 14 for storing a program for controlling the entire system. The register 11 stores a PIN which is arbitrarily selected by a card holder upon issuance of the card and registered by the credit card company. The unit 12 compares the content of the register 11 with the PIN stored in the register 8 and supplies a detection signal C1 to the unit 4. The unit 4 generates an identification enable signal C2 in response to the signal C1. Upon reception of the signal C2 from the unit 4, the unit 13 starts operation by using the contents PIN and AMT of the register 8 and the content DATE of the circuit 10 in accordance with the encryption algorithm specified by the credit card company and calculates specific encrypted data SAN. The unit 13 has an algorithm program memory 13a for storing the encryption algorithm and a calculation register 13b. Since the card holder and the card having the arrangement are authenticated by the card itself, part of the system circuit of an authentication system host computer 40 installed in an issuer s center such as a credit card company will be described with reference to Fig. 3. Referring to Fig. 3, an interface unit 20 converts data supplied through a communication line 21 such as a telephone line and sends the converted data onto a system bus line 22. At the same time, the data appearing on the bus line 22 is sent onto the line 21. The bus line 22 is connected to a time measuring circuit 23, a system program memory unit 24 for storing a program for controlling the overall system and a control unit 25 for controlling the respective units in accordance with the program stored in the unit 24 in the same manner as in the identification card 1 of Fig. 2. The arrangement shown in Fig. 3 further has a SAN calculation processing unit 26 for encrypting the input data in accordance with the encryption algorithm varying in different credit companies specified by the given credit card company. The bus line 22 is also connected to a register 27 for temporarily storing data representing a total amount AMT which is externally supplied through the unit 20, and a card identification code representing a primary account number PAN , and a register 28 for storing SAN calculated by the identification card 1. The line bus 22 is further connected to a memory table 29 for storing account numbers PAN1, PAN2,... of the respective customers and personal identification numbers PIN1, PIN2,... corresponding to the PANs and a register 30 for storing the SAN calculated by the unit 26 in the computer 40. The data SAN and SAN stored in the registers 28 and 30 are compared with each other by a coincidence unit 31. The unit 31 supplies a detection signal C3 to the unit 25. The authentication operation of the card holder and the card 1 by the card itself and by the computer 40 installed in a center of an issuer such as a credit card company will be described. Fig. 4 shows authentication procedures which consist of operation procedures by a card holder, a clerk of a point of sales POS such as a store, and the computer 40 installed in the center such as a credit card company. A card holder brings a desired item to a cashier counter of the store and takes out his identification card. He enters his PIN registered with the credit card company and contained in the card without being monitored by the cashier T1 and depresses the CF key 2a The entered data PIN is supplied to the unit 12 and is compared with the data PIN stored in the register 11. The unit 4 writes the coinciding PIN in the register 8 and causes the unit 3 to display the OK message. The card holder shows the indentification card 1 displaying OK to the clerk and after confirmation as legal card holder enters the total amount AMT of the desired item. He then depresses the CF key 2a again. The unit 4 writes the AMT in the register 8 and supplies the signal C2 to the unit 13. In step T3, the unit 13 performs a predetermined calculation by using three data i.e., PIN , AMT and DATE supplied from the circuit 10 in accordance with the specific encryption algorithm. A typical example of the encryption algorithm will be described with reference to the flow chart of Fig. 5A. In step S1, the data PIN , AMT and DATE are fetched by the unit 13. It should be noted that the data PIN represents a 12 digit numeric value. Processing of the input data PIN is started. In step S2, products of the first and 12th digits, the second and 11th digits, the third and 10th digits, the fourth and ninth digits, the fifth and eighth digits, and sixth and seventh digits of the data PIN are calculated by the unit 13. In step S3, the six products calculated in step S2 are added to each other. In step S4, values of the last four figures i.e., lowest four digits of the data PIN are added to the sum obtained in step S3. In step S5, the sum is stored as data X in the X register 13b in the unit 13. The unit 4 checks in step S6 whether or not the value of the lowest digit of the current date DATE is an even value. If YES in step S6, the DATE is divided by 2 in step S7. The quotient is stored as data Z of the DATE in the Z register in the register 13b in step S8. In step S9, the AMT is stored in the Y register. A calculation is performed in accordance with the contents of the X, Y and Z registers in step 10 as follows In step S11, the following calculation is performed to obtain data SAN If NO in step S6, the flow advances to step S13 of Fig. 5B. The data DATE is divided by 4, and a resultant remainder is omitted in step S14. The quotient in step S14 is stored as data Z in the Z register step S15 . The AMT is doubled in step S16, and the product is stored as data Y in the Y register in step S17. The following calculation is performed in step S18 In this manner, when the card holder enters the data PIN and AMT on the card 1, the unit 13 calculates the encrypted data SAN, and the calculated result is displayed on the unit 3. The card holder shows the card 1 displaying the data SAN to the cashier step T4 and requests authentication of the card. In step T5, the cashier confirms the credit card company of the card 1 shown by the customer and contacts the issuing credit card company with a telephone set installed in the terminal through the line 21. The cashier sends to the computer 40 the data SAN displayed on the card 1, the account number PAN as the card identification i.e., card holder identification code which varies in accordance with the card holder and embossed on the lower surface of the card 1, and the total amount AMT. When the computer 40 receives the transmitted data described above, the following processing as shown in Fig. 4 is started. The data i.e., SAN, PAN and AMT received through the unit 20 are written in the registers 28 and 27 in the computer 40. The memory table 29 is accessed in accordance with the received data PAN, and the data PIN corresponding to the input PAN is read out from the table 29 step T6 . Thereafter, the unit 25 in the computer 40 supplies a calculation start instruction signal C4 to the unit 26 which is then started. The unit 26 calculates data SAN by using the three data PIN, AMT and DATE in accordance with the same encryption algorithm as that in the identification card step T7 . The data calculated in this manner is written in the register 30 and at the same time compared by the unit 31 with the data SAN transmitted from the store. The signal C3 from the unit 31 is supplied to the unit 25. The message data corresponding to the detection result, i.e., the OK message upon coincidence between the data stored in the registers 28 and 30, or the NO message upon noncoincidence between the data stored in the registers 28 and 30 is sent back to the store through the line 21 and the unit 20. Upon reception of the response, i.e., the message data from the center, the cashier decides whether or not a transaction should be made for the current customer step T9 . When the response is the OK message and the SAN calculated by the card 1 coincides with the SAN calculated by the computer 40, it is confirmed that When the cashier receives the OK message, he confirms that the card user is the legal card holder and that the card 1 itself is authenticated. The cashier can confidently proceed with the current transaction. According to the embodiment described above, when a customer purchases an item in a given store by using the card 1, he can operate the keys on the card by himself, so that the card 1 calculates desired encrypted data SAN Sales Approval Number . The customer shows the desired encrypted data to the cashier to confirm card identification i.e., that the card user is the legal card holder and the card was duly issued by the credit card company or the like . In this case, the encrypted data can be calculated by the card. A special device need not be installed in the store to identify the card. Only a telephone set is required. In the above embodiment, the encrypted data SAN is calculated by using three input data i.e., PIN, AMT and DATE in accordance with the encryption algorithm. The SAN calculation input data is not limited to the three data described above. For example, instead of the DATE or in addition to it, a sales item serial number slip number or the like may be entered to calculate specific encrypted data. The encryption algorithm shown in Figs. 5A and 5B is an example for calculating encrypted data. The algorithm varies in accordance with different credit card companies. In the above embodiment, the identification card has a keyboard and a liquid crystal display LCD unit and serves as a normal card as well as a calculator. A terminal connected to an external device may be arranged in place of the keyboard and the LCD unit. In this case, the card communicates with the external device e.g., a device having a connector, a keyboard and a display through the terminal of the card. The card may be powered through the terminal thereof. In the above embodiment, the issuer s center such as the credit card company is directly called by the telephone set. However, a POS terminal on line connected to the host computer of the center may be installed in a store, and data communication can be performed through the POS terminal. In the above embodiment, the card authentication system is the host computer installed in a center such as a credit card company. However, the authentication system may be installed in the store, and the card holder and the card itself can be authenticated in the store. In the above embodiment, the identification card is used in a store for the purchase of various items. However, when card holder or card authentication is required for a transaction made by a card, e.g., for mail order and ATM Automatic Teller Machine transactions or transactions utilizing automatic vending machines, the card holder and the card itself can be properly authenticated by using the identification card and the authentication system of the present invention. According to the present invention as described in detail, the encryption algorithm approved by the credit card company is stored in the identification card, and upon sale of a desired item predetermined input data is encrypted in accordance with this encryption algorithm. The encrypted data is transmitted from the identification card to the host system of the credit card company through the proper means. The credit card company can check if the encrypted data is calculated in accordance with the authentic encryption algorithm, thereby determining that a transaction is made with an identification card approved by the credit card company. According to the present invention, specific encryption of the predetermined data is performed within the identification card, and the authentication system installed in the credit card company or the store encrypts the predetermined data specified by the identification card and checks whether or not the data encrypted by the identification card coincides with that of the authentication system. As a result, the identification card and the holder are properly authenticated. When a data transmission line connected to the authentication system is used to perform authentication of the card and its holder, secret data such as a personal identification number itself is not transmitted, but instead a corresponding key code is transmitted. Therefore, the personal identification number will not be intercepted through a communication line.