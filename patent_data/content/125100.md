# Motor control.

## Abstract
To control a motor 16 a pulse width modulated signal from a computer 1 is fed to a capacitor 4 which stores each pulse as a voltage proportional to the width of the pulse, the capacitor being reset to zero by a leading edge reset circuit 8 . The voltage on the capacitor 4 is sampled by a sample hold circuit 10 the output of which is fed to a converter 12 which converts the voltage signal to a frequency signal exponen tially related to the voltage, and hence to the pulse width. The converter 12 then powers a driver 14 which drives the motor 16 . Th exponential relationship between the pulses and the signal fed to the motor 16 permits a large variation in the frequency signal based on a small variation in pulse width and hence permits accurate control of the motor 16 .

## Claims
CLAIMS 1. An apparatus for driving a motor at a desired motor speed, the apparatus comprising command means 1 adapted to generate a command signal having a command characteristic control means 2 connected to the command means 1 and adapted to generate a control signal and drive means 14 connected to the control means and adapted to translate the control signal into the desired motor speed characterised in that the control characteristic is exponentially related to the command characteristic, and the desired motor speed is directly proportional to the control characteristic. 2. An apparatus according to claim 1, wherein the control means 2 converts the command signal to a voltage which varies logarithmically as a function of the desired motor speed and converts that voltage into a frequency which is an exponential function of the voltage. 3. An apparatus according to claim 1 or claim 2 wherein the control means 2 includes a charge storage means 4 for accumulating voltage a source means 6 for supplying voltage to the charge storage means as a function of the command signal characteristic and means 10 for sampling the voltage so accumulated on the charge storage means 4 . 4. An apparatus according to any one of the preceding claims further including circuit means 18 for sensing the characteristic of the command signal and for shutting off the motor when the characteristic of the command signal reaches a predetermined limit. 5. An apparatus according to claim 4, wherein the circuit means includes a comparator which changes state when the characteristic of the command signal exceeds the predetermined limit. 6. An apparatus according to claim 5 wherein the circuit means includes means for locking the output of the comparator in a first state when the characteristic of the command signal exceeds the predetermined limit. 7. An apparatus according to claim 6 wherein the circuit means includes a gating means which cuts off operating power to the motor when the output of the comparator is in the first state. B. An apparatus according to any one of the preceding claims wherein the command means 2 includes a comparator. 9. An apparatus according to any one of the preceding claims wherein the command signal characteristic iE pulse width. 10. An apparatus according to any one of the preceding claims for regulating the rate at which material flows through a pump driven by the motor, wherein the command signal characteristic varies logarithmically as a function of the desired pump flow rate. 11. An apparatus according to claim 10 wherein the material flow through the pump is a nutrient solution for cell growth. 12. An apparatus for supplying controlled amount of nutrients to cell cultures, the apparatus comprising a pump driven by a motor 16 means 14 to apply a control signal to the motor 16 and means 2 to generate the control signal in response to a command signal having a command characteristic characterised in that the control signal has a signal characteristic proportional to the speed of the motor and the command characteristic is a logarithmical function of the control characteristic. 13. An apparatus according to claim 12 including means 4,6,8,10 for converting the command signal into a voltage. 14. An apparatus according to claim 13, including means 12 for converting the voltage into a frequency which is an exponential function of the voltage. 15. An apparatus according to any one of the preceding claims wherein the motor is a stepping motor and the control signal is pulsed direct current. 16. An apparatus according to any one of claims 1 to 14, wherein the motor is an AC motor and the control signal is AC. 17. A method of governing the operation of a motor to achieve a desired motor speed, comprising the steps of generating a command signal converting the command signal into a control signal and driving the motor at a speed proportional to the frequency of the control signal characterised in that the command signal has a characteristic logarithmically related to the desired motor speed, and the control signal has a frequency exponentially related to the command signal characteristic. 18. A method according to claim 13 wherein the command signal characteristic is pulse width. 19. A method according to claim 17 or claim 18, wherein the motor is a stepping motor and the control signal is a pulsed direct current. 20. A method according to claim 17 or claim 18 wherein the motor is an AC motor and the control signal is AC.

## Description
Motor Control This invention relates to a method and apparatus for controlling the speed of a motor. In particular, the invention relates to using a command signal to control motor speed through an exponential relationship between the signal and the desired speed. There are a number of instances in which it is desirable to maintain a predetermined speed of a motor. This motor may be used to drive, for example, a vehicle, a conveyor belt, or a robotic component of a mechanized factory system. Motors are presently available which are capable of maintaining constant speed, however, this characteristic is not ordinarily compatible with the ability to select over a wide range of constant speeds. The present invention provides a means whereby a preselected motor speed can be maintained within narrow limits and wherein this speed may be chosen over a wide range of possible RPMs. A particularly demanding application is that wherein the motor is used to drive a pump, which pump supplies a fluid for, for example, a chemical reaction or for a fermenter. Many modern industrial processes in the chemical or bio engineering fields involve mixing of fluid constituents to form solutions of one type or another. The mixing is generally accomplished by pumping the fluid constituents into production vessels under carefully regulated conditions. The fluid pumps are driven by pump motors controlled to provide the fluid flow rates optimally associated with the processes. Conventional pump motor control techniques often rely on signals which are generated in response to process sensor outputs and which exhibit control voltages proportional to the optimal or desired fluid flow rates.The control voltages are converted into control frequencies suitable for use in driving the pump motors at the speeds required to establish the desired fluid flow rates. The ability of such prior art pump motor control techniques to provide accurate control over the amount of a given fluid admitted to a production vessel depends to a great extent on the nature of the control voltage to frequency conversion function. Many prior art pump motor controllers employ linear conversion functions, whereby the sensitivity of the pump motor control circuitry to indicated changes in the desired flow rate remains constant over the entire range of flow rates available to the pump. Many industrial processes can be affected greatly by even small changes in the quantities of constituent fluids admitted to the production vessels. In order to maintain proper pH levels in a fermentation culture, for example, a base or acid must be supplied to the culture in precisely measured amounts at rates which vary continuously in accordance with the measured pH level of the culture. The linear conversion function for process control signals in existing pumps does not yield the pump motor speed resolution necessary to achieve fine control over base or acid supply at the low flow rates typically encountered during fermentation pH level adjustments.Under these circumstances, it would be particularly beneficial to provide a pump motor controller capable of performing control voltage to frequency conversions, in a manner which permits high resolution of pump motor speed settings at low fluid flow rates. Tne present invention offers just such an advantage. This Invention relates to an apparatus fOr driviny a motor at d desired motor speed wnicn operates oy trdnslating a command signal aypliea uy tie operator into a control signal wjiicn relates tne motor speea, and wnere tne control signal is exponentially related to tne command signal. Typically, the command signal is a ciiyitai pulse of a characteristic pulse width, and tne control signal is a frequency, and tile frequency is tnus an exponential tunction of tne pulse width.Tne exponential relationship permits a large variation in tne control signal Bases on a limited adjustment of tne colnaand signal, and nence gives a high degree of control over tne speea of tne motor. Tne invention is also directed to a melnod of controlling motor speea using tne apparatus of tne invention. Tne various features, objects ana advantages of tne present invention will Decome more apparent upon consideration of tne following brief Description of tne Drawings and the Preferred Mode for Carrying Out tne Invention, wnerein Figure i is a DlocK diagram of tne pump control circuitry ana Fiyure 2 is a detailed circuit schematic of tne pump controller illustrateu in Figure 1. Figure 3 is a diagram of the mechanism to switcn from automatic to manual mode. Tne Inotor speed control system of Uie present invention is designed to translate a modulatea command signal, having a command characteristic nto a motor control signal naviny a frequency exponentially related to the command signal cnaracteristic.Tne motor control signal may tnen oe employed to operate tne motor at a speea which varies directly as a function of tne control siynal frequency. Tne relatonsnip between tne characteristic of Ine command signal and tne frequency of tne control signal is exponential i.e., stated in converse tennis, tne commmand ctiaracteristic is a logaritnnic function of the control signal frequency. In formal terms, this results in an equation of the form Control Ka 10 Kb command or, in converse form Control Ka 10 b log control Kb x command Of course, the control signal must be compatible with the nature of the motor which it is designed to control.If the motor used is a stepping motor , the motor operates by virtue of a pulsed DC current wherein the rotating segment of the motor turns in response to a positive pulse and stops when the pulse is no longer applied.Therefore in this case, an appropriate control signal is a pulsed DC current the frequency of which is directly proportional to the motor speed. If an AC motor is used, ordinarily the control signal is an alternating current applied to the coils in that case the control signal is the frequency of the AC current, which is proportional to the motor speed. An appropriate command signal is a digital pulse generated by computer wherein the pulse width characterizes the command it is that characteristic of the pulse width which is translated into the desired control signal. While there are many situations wherein it is desirable to control motor speed with some precision, and to have the ability to do so over a wide range of speeds, a particularly useful application is that wherein the motor is used to drive a pump, and it is desired to control the flow rate of materials flowing through the pump. In that case, the pump must be calibrated so as to generate a calibration curve which relates flow rate for a particular material to motor speed. The method of the invention is designed solely to control the speed of the motor, and does not necessarily include a feedback loop which reads on flow rate. Instead, the method of the invention can be used based on independent parameters which dictate a desired flow rate. For example, If the pump is used to supply nutrients to a microbial culture in a fermenter, it may be desirable to increase the level of nutrients as the organisms grow in response to previously added nutrients. Thus, the quantity of cells, as assessed by, for example, optical density measurements, measurements of carbon dioxide output or oxygen uptake or other suitable means can be used to ascertain the desirable flow rate, and the calibrated cnaracteristics of the pump with respect to that particular nutrient solution integrated into the system so as to define an appropriate motor speed. In this case, for example, the pulse width of the command signal could be set depending on tne light absorbing capability of tne culture.This pulse width then, for example, could be translated into a voltage, tne magnitude of wnicn is a linear function of the pulse width, and this voltage translated into a frequency which is exponentially related to the voltage amplitude. The following detailed description of a preferred mode sets forth in detail the application of the method of the invention to a particular system and is designed to illustrate, but not to limit the scope of the invention. In a preferred emboaiment, the apparatus and method of the present invention are designed to translate a pulse width modulated command signal from a computer into voltage and then to a motor control signal having a frequency exponentially related to the command signal width. The motor control signal may then be employed to operate a stepping motor at a speed wnich varies as a direct function of the control signal frequency. The stepping motor, in turn, drives a peristalic pump head to provide the pumping action necessary for delivering metered amounts of fluid to a utilization site.The exact relationship between pulse width of the command signal and the frequency of the motor control signal can be expressed as an exponential transfer function Such a relationship permits high resolution speed settings at very low pumping rates, while simultaneously providing for a wide range of accurate in speed settings. The relationship between computer generated command signal and the pump flow rate can be expressed as follows R mllmin K1 x l0K2t 1 where R represents the ultimate pump flow rate expressed in ml min, t represents the pulse width of the command signal in minutes, andK1 and g are calibration constants which may be adjusted to fit the particular pump, motor and control circuit characteristics of the system.Solving Equation 1 for pulse width yields EMI6.1 Equation 3 is the actual equation used by the computer to determine the pulse width of the command signal to be fed to the pump controller for any desired pump rate. Using appropriate software, the computer generates a command signal in the form of a pulse train having pulse widths which vary logarithmically as a function of the desired fluid flow rate. A memory capacitor in the analog motor controller is connected to receive the command signal from the computer. A leading edge reset circuit in the analog motor controller is triggered by the leading edge of each incoming command signal to discharge the memory capacitor and initiate each stepping motor control cycle. The memory capacitor subsequently recharges to a voltage level indicative of the width of the incoming command signal pulse.This voltage level is sampled by a sample hold circuit and fed to a voltage to freqency converter where an exponential transfer function is performed to derive a control signal having a frequency proportional to the desired fluid flow rate. The control signal is in turn directed to a stepping motor at a speed proportional to the control signal frequency, thereby operating the pump at the desired fluid flow rate. Pump shutdown can be initiated by instructing the computer to generate command signals with abnormally long pulses. A turnoff circuit in the analog pump controller detects the abnormal pulse widths in the incoming command signal and disconnects the stepping motor driver from the pump stepping motor to complete the pump shutdown procedure. Turning to Figure 1, the pump controller can be seen in block diagram form. Pump controller 2 basically includes a memory capacitor 4 connected to a switchable current source 6, a leading edge re set circuit 8 connected across memory capacitor 4, a sample hold circuit 10 for measuring the voltage on the memory capacitor, an exponential frequency converter 12, which performs a frequency conversion on the voltage measured by sample hold circuit 10, and a stepping motor driver 14, which drives a stepping motor 16 with a series of incremental steps in response to the output of voltage to frequency converter 12. The leading edge of each incoming command signal pulse trips the leading edge reset 8 to complete a circuit across memory capacitor 4, dissipating any residual voltage otherwise present on the capacitor.Shortly thereafter, the command signal pulse gates current source 6, and memory capacitor 4 is linearly charged for the duration of the command signal pulse width. The sampleihold circuit 10 operates in the hold mode while capacitor 4 is charging, preventing the voltage to frequency converter from sensing the capacitor ramping action. When the command signal pulse ceases, the voltage on memory capacitor 4 remains essentially stable for a period sufficient to permit the measurement thereof by samplelhold circuit 10, which retains this valve.The voltage to frequency converter 12 receives the voltage measured by samplelnold circuit 10 and generates the aforementioned motor control signal in the form of a pulse train having a frequency exponentially related to the voltage at the sample hold current output. The motor control signal is used by the stepping motor driver 14 to drive stepping motor 16 at a rate which likewise varies exponentially with the sample hold circuit output, and hence at a rate exponentially related to the pulse width of the command signal output by the computer, thereby satisfying the constraints of Equations 1 3 . If desired, the computer can be programmed to output a command signal pulse having an abnormally long width whenever the pump is to be disabled.The abnormally long pulse width energizes a turnoff circuit 18 to cut off the stepping motor drive current output from stepping motor driver 14. A detailed circuit diagram of the pump controller can be seen inFigures 2A 2B. The incoming command signal pulses are received by an opto isolator 20. The use of the opto isolator eliminates ground loop and data line noise pick up problems. In response to each incoming command signal pulse, the opto isolator supplies an output which first activates leading edge reset 8. The leading edge reset in particular comprises and n p n transistor 22 connected across memory capacitor 4, a bias current source in the form of a second n p n transistor 24 connected to the base of transistor 22, and a differential comvaritor 26 for controlling the flow of current from transistor 24 to the base of transistor 22. The positive input of differential amplifier 26 is tied to the emmiter output of opto isolator 20. Hence, the rise in the opto isolator output appearing at the leading edge of each incoming command signal pulse causes the differential comparitor itself to output a short pulse.Because the differential comparitor is an open collector device, the short pulse differential comparitor output momentarily results in the flow of current from the base of transistor 22 through transistor 24, biasing transistor 22 on to discharge memory capacitor 4. Once the short pulse output from differential comparitor 25 has ended, the bias on transistor 22 is removed and transistor 22 shut off to permit recharging of the memory capacitor. It should here be noted that the base bias for transistor 24 is supplied by the opto isolator output which reaches the positive input of differential amplifier 26.This circuit configuration guarantees that severe noise disturbances otherwise producing a short output pulse from differential amplifier 26 will not result in re setting capacitor 4, inasmuch as transistor 24 can only provide current for transistor 22 when an actual command signal pulse is present at the opto isolator. In addition to feeding the positive input of differential amplifier 26 in leading edge reset circuit 8, the output from the opto isolator 20 is connected to the positive input of an amplifier which serves as the gate for current source 6. Current source 6 specifically comprises a p n p transistor connected to supply memory capacitor 4 with charge from a voltage supply 30. When transistor 22 turns off at the end of the short pulse output from differential comparitor 26, memory capacitor 4 immediately begins to ramp up to a voltage level determined by the width of the incoming command signal pulse reaching opto isolator 20.When the output from the opto isolator drops at the falling edge of the incoming command signal pulse, amplifier 28 switches low to draw off current from voltage supply 30, gating current supply 6 off in preparation for the measurement of voltage across the memory capacitor 4. The memory capacitor is actually unloaded by a follower amplifier 32 in sample hold circuit 10 via lead 34. The output of follovzer amplifier 32 feeds through transistor 36 to amplifier 38 in the sampleihold circuit 10. The base of transistor 36 is tied to amplifier 40 in the samplelhold circuit, the negative input of which amplifier receives the output from opto isolator 20.During the rampup interval of memory capacitor 4, the opto isolator output which triggers amplifier 28 to gate current source 6 on simultaneously switches the output of amplifier 40 low, shutting off transistor 36 to maintain the output of amplifier 38 at a quiescent level. In this manner, the sample hold circuit 10 is maintained in a hold mode for the duration of the incoming command signal pulse. When, however, the command signal pulse ceases, output from amplifier 40 will switch high to bias transistor 36 on, transferring the voltage stored on memory capacitor 4 from amplifier 32 through transistor 36 to amplifier 38.An RC network 40 at the input to amplifier 38 may be employed to establish a time constant in the output of amplifier 38, limited the rate of acceleration seen by stepping motor 16 should the width of any one command signal pulse increase over that associated with the previous command signal pulses. The sampled voltage from samplelhold circuit 10 is directed to voltage to frequency converter 12 for the purpose of generating the motor control signal. To this end, voltage to frequency converter includes amplifier 42, exponential amplifier 44, and amplifiers 46 and 48. Amplifier 44 performs the basic logarithmic amplification of the capacitor voltage. A resistor 50 at the input to amplifier 44 sets the slope constant for this exponential amplification. A potentiometer 52 operates in conjunction with amplifier 42 to establish the input offset for amplifier 44, and thus the starting point of the exponential curve characteristic of the transfer function performed by amplifier 44.The ability to adjust the resistive value of potentiometer 52 furnishes a means for trimming the output of the voltage to frequency converter 12 until a desired signal frequency is reached for a given command signal pulse width.Amplifiers 46 and 48 are arranged in an integrator comparator type oscillator configuration, whereby a pulse train having a frequency exponentially related to the width of the most recent command signal pulse is output from amplifier 48. This pulse train, which serves as the motor control signal, drives a counter 54 such as a CD 4022J8 counter in stepping motor driver 14. Counter 54 in turn outputs a series of properly phased drive signals which alternately gate a series of drive transistors 56 to energize the windings not shown in stepping motor 16. If desired, a reversing switch 58 can be connected intermediate to counter 54 and drive transistors 56 to enable reversal of the stepping motor operating direction. The turnoff circuitry 18 used in conjunction with the present invention may be seen to best advantage by returning to Figure 2A.Turnoff circuitry 18 includes a group of amplifiers 60, 62, 64, and 66 interconnected with a pair of capacitors 68, 70. The positive input of amplifier 60 as well as the negative input of amplifier 62 are connected to the output of amplifier 28. It will be recalled that amplifier 28 serves as a gate for current source 6, switching on while each incoming command signal pulse is present at opto isolator 20. The value of capacitor 68 in the input of amplifier 60 are selected such that capacitor 68 can not charge to a point where the output of amplifier 60 switches high, as long as the command signal pulse width is within a predetermined normal range.Consequently, under normal pulse conditions,the output of amplifier 60 remains low, the output of amplifier 38 in sample hold circuit 10 is positive to turn off amplifier 64 and the only source charge available to capacitor 70 at the negative input of amplifier 66 is through resistor 72. The value of resistor 72 is such that the voltage appearing at the negative input to amplifier 66 during normal command signal pulses forces the open collector output of the amplifier to float until reaching the level at the positive input to amplifier 38. If, however, a command signal pulse having a width substantially wider than normal is received at opto isolator 20, the increased gating time for current source 6 charges capacitor 68 until the output from amplifier 60 switches high, whereupon a large quantity of charge is dumped into capacitor 70. This latter quantity of charge forces the output of amplifier 66 to the negative rail, pulling the positive input of amplifier 38 down until the output of amplifier 38 switches negative to turn transistor 74 on. Transistor 74, which is connected to the bases of the drive transistors 56, then cuts off all drive current to the drive transistors, disabling the stepping motor 16 to stop pump operation. The negative output from amplifier 38 is also returned to the negative input of amplifier 64, forcing the output of amplifier 64 positive to supply a continuous topping offl current to capacitor 70. In this manner, a positive feedback Hlatch is established to prevent re energization of the drive transistors 56 until a command signal pulse within the normal range is received.Amplifier 62 functions to clear out capacitor 70 as each new incoming command signal pulse arrives at opto isolator 20. The time constant established by RC network 40 at the input to amplifier 38 slows the response of amplifier 38 to prevent the output of amplifier 64 from switching low while each incoming command signal pulse is present at opto isolator 20, thereby allowing the system to examine every command signal pulse to ensure that the pulse width is within normal limits before the feedback latching effect created by amplifier 64 is removed.Accordingly, altnough it is unnecessary for the computer to send successive shut down pulses to the pump controller for the purpose of maintaining a shut down condition, the appearance of such successive shut downy length pulses cannot result in the energization of stepping motor 16 for even a brief period. If desired, the analog motor controller 2 of the present invention may include a circuit feature for shifting the operation of the controller from the aforementioned automatic or command signal pulse width initiated mode to a manual mode. In the manual mode of controller operation, an adjustable voltage from an independent voltage source is employed by the voltage to frequency converter 18 to generate the motor control signal, permitting regulation of the pump stepping motor speed without regard to the computer calculated R value or associated command signal pulse width. Figure 3 illustrates the mechanism utilized to perform the automatic mode to manual mode switch. Figure 3 components corresponding to components in Figures 1, 2A and 2B are assigned like reference numerals.Hence, operational amplifier 42, logarithmic amplifier 44 and operational amplifiers 46 and 46of voltage to frequency converter 18 may all be seen in Figure 3. A switch element 100 is connected to operational amplifier eb for movement between an automatic mode terminal 102 which receives the output of logarithmic amplifier 4 and a manual mode terminal 104 which receives the output of a variable resistor 106. Variable resistor 106 is tied to a voltage source 108. During automatic controller operation, switch element 100 occupies the solid line position in Figure 3, enabling the output of logarithmic amplifier 44 to drive the operational amplifiers 4b and 46 in oscillatory fashion as described hereinabove.During manual controller operation, switch element 100 is shifted to the dotted line position shown in Figure 3 and operational amplifier 4b is instead supplied with voltage from voltage source 108 through variable resistor 106.Amplifiers 4b and , which remain interconnected in an integratorlcomparator type oscillator configuration, then output a control signal having a frequency proportional to the voltage level established by the variable resistor. This control signal is directed to the stopping motor driver 14, where it is used to drive the pump stepping motor as also described hereinabove. The speed at which the pump stepping motor is driven in the manual mode can be changed by simply adjusting variable resistor 106 to achieve the command signal frequency necessary for driving the motor at the desired speed. An additional switch element 110 is placed in the circuit connection between turnoff circuit lE and stepping motor driver 4 .Specifically, switch element 110 is positioned between transistor 98 of turnoff circuit .ie and the bases of the drive transistors 74 in stepping motor driver 14. A mechanical interlink 112 between switch element 100 and switch element 110 actuates switch element 110 when switch element 100 is moved to the manual mode terminal 104, producing an open circuit condition between transistor 98 and the drive transistor bases which prevents computer not shown in Figure 3 from accidentally deenergizing the pump stepping motor during manual mode operation. The present invention has been set forth in the form of two perferred embodiments. It is nevertheless understood that modifications to the disclosed pump control system may be made by those skilled in the art without departing from the spirit and scope of the present invention. In particular, the various hardware components of the analog motor controller can be replaced partially or in their entirety by appropriatelydesigned software routines carried out by a microprocessor or the like. The command signal pulses generated by the computer employed in the present invention could, for example, be used to gate a clocking device for the purpose of deriving a digital count signal having a binary value equivalent to the width of the command signal pulses.A pulse width to time conversion could thereafter be performed in accordance with the principles of the present invention by exponentiating the digital count signal to obtain a binary output signal which is exponentially related to the command signal pulse width. A variety of software schemes for implementing such an exponentiating function will be apparent to those skilled in the art. The binary output signal would, of course, be used to drive an oscillator or the like for the purpose of generating a pulse train having a frequency proportional to the value of the binary output signal. The pulse train can function as a motor control signal in a manner analogous to that of the motor control signal output from voltage to frequency converter lD in analog motor controller 2. The requisite amount of vernier type control over pump motor acceleration and deceleration could be obtained in a software oriented motor control system by regulating the rate of change of oscillator pulse train through additional software manipulation of the binary output signal, again using software techniques well known to those skilled in the art.The noise immunity provided by the opto isolator 20 in the analog motor controller can be duplicated in a software controller by utilizing self checking software routines to perform the exponentiating and related signal value to frequency transfer and or conversion functions.