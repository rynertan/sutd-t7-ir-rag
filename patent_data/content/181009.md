# IMAGE PROCESSING DEVICE AND METHOD FOR CONTROLLING THE SAME

## Claims
Verfahren zur Steuerung einer Bildverarbeitungseinrichtung mit folgenden Schritten

## Description
This invention relates to a method for controlling an image processing device using a programming language for image processing, which is suitable to the control of the image processing device utilizing polygonal approximation processing. There have been hitherto proposed two methods, the pattern matching and the SRI algorithm, as a somewhat versatil and accordingly kind of a standard image processing algorithm which is directly related with pattern recognition, not with the filtering of an image and the inter image operation. The pattern matching essentially requires a considerable amount of computation and therefore it is actually performed utilizing hardware in most cases and is not an object to be controlled by the programming language. The SRI algorithm does not have much flexibility in its flow of processing and permits only several parameters to be changed. One of the image processing languages based on this SRI algorithm has been discussed in an article entitled, Programming Vision and Robotics Systems with RAIL RDBO TSVI, Conference Proceedings, March 2 4, 1982, pp 392 406 Robotics International of SME. This language, however, permits only the parameters to be changed and the processing results to be referred, and does not have any freedom in terms of the image processing procedure. On the other hand, one example of the programming languages describling the flow itself of image processings has been discussed in an article entitled AML V An Industrial Machine Vision Programming System . The international Journal of Robotics Research, Vol. 1, No. 3, 1982. However, this language has only the instructions for performing elementary or basic processings, such as the inter image operation, which are not directly related with pattern recognition and consequently, writing a recognition program using this language requires substantially the same amount of labor and knowledge as that required in the case of using other general purpose programming languages. The document Computers, vol.15, December 1983, pages 17 32, No 12, Lond Beach, California,USA R.C. GONZALEZ et at.. Computer vision techniques for industrial applications and robot control , discusses in detail the series of steps required for recognizing an object. These include means for inputting an image means for segmenting an image, means for determining the positional or the neighbouring relationships among the elements of the image, polygonal appproximation of the edge of an image, means for comparing an unknown value with a known reference value which are standard items in any recognition apparatus. However, in contrast to the present application, a polygonal approximated pattern is not represented by a row of vertex data. In PROCEEDINGS 6th INTERNATIONAL CONFERENCE ON PATTERN RECOGNITION,Munich, 19th 22nd October 1982, pages 19 22,IEEE, New York,US H.MORI Picture interpretation language for silhouette , the development of the PILS programming language is discussed which allows the programmer to define his own picture operators. But like in the former document Computer vision... no use is made of representing a pattern by a row of vertex data. It is an object of the invention to provide a method for controlling an image processing device comprising the steps indicated in the preamble of claim 1 which permits the processing procedure to be minutely changed so as to be adapted to several uses requiring different procedures. It is another object of this invention to provide an image processing method which can easily develop an application system employing a polygonal approximation processing system with only a small amount of additional software developed using an image processing language. These objects are achieved according to the invention by the features recited in claim 1. Other objects and advantages of this invention will become apparent from the following description taken in conjunction with the accompanying drawings. Fig. 1 diagrammatically illustrates a basic procedure of a polygonal approximation processing system. Fig. 2 shows an arrangement of an image processing device. Fig. 3 is a table of image variables. Figs. 4A to 4C show an arrangement of a segment table. Fig. 5 is a table of image processing instructions. Figs. 6A to 6C and Figs. 7A to 7C show examples of the application of this invention to an actual recognition object, respectively. Several embodiments of this invention will be explained below with referrence to the drawings. Referring now to Fig. 1, a polygonal approximation processing system will be explained. The polygonal approximation processing system is a pattern recognition system in which the contour of a segment is polygonal approximated so that it is represented by a row of vertex coordinates or data, which is processed to provide the information regarding the segment shape, e.g., area or perimeter and to check whether or not two patterns are identical. This pattern recognition system was disclosed in detail in Japanese Patent Unexamined Application No. 154574 84 which was assigned to the assignee of this application. The flow of processing in this polygonal approximation processing system will be explained below. First, an image is input at a step 101 see block 201 and the image is segmented at a step 102 of segmentation as seen from a block 202. At a step 103 of image structure analysis, the contiguous or positional relation among the above segments is provided as seen from a block 203. The segment to be recognized is selected from this information of the contiguous or positional relation and is polygonal approximated at a step of polygonal approximation. This polygonal approximated segment is processed for recognition at a step 105 of polygonal pattern matching or a step 106 of characteristic value extraction. The polygonal pattern matching is the matching by the superposition on a dictionary pattern which is also polygonal approximated as seen from a block 205, and the characteristic value extraction is, as seen from block 206, the recognition of shape by the characteristic values representative of the shape, e.g., area, perimeter, etc., and the positioning of a pattern using the center of gravity, axis of inertia, etc. The advantage of the polygonal approximation processing system resides in its great changeability in the flow of processings. For example, any segment after the image structure analysis can be selected as a segment to be recognized, and the segment subjected to the polygonal approximation can be recognized by many recognition methods. The flow of the entire procedure of polygonal approximation processing system is simple. Therefore, the polygonal approximation processing system can be easily modified so as to be suited for a particular use by changing the combination of the steps each used as a processing unit in Fig. 1 and providing branches in dependence on the intermediate results. Referring now to Fig. 2, an example of the image processing device for performing an image processing on the basis of the polygonal approximation system will be explained. In the figure, numeral 301 designates an image memory 302 designates a image input section 303 designates an image processing section 304 designates a processor CPU and 305 designates a TV camera. The control of the image processing procedure is made by executing the program describing the processing procedure by CPU 304. A programming language image processing language for describing this program will now be explained. The basic structure consists a known programming language, e.g., BASIC and a group of image processing instructions as extension instructions, and image variables as types of variables. First, the image variables will be explained with reference to Fig. 3. The image variables are the variable types which represent the structure of the image data used in the polygonal approximation processing system. There are, as variables, grey scale image, binary image, mask image, segment table, and row of vertex coordinates. These variables are named, e.g., G₁, T₆, and L₃ each consisting of a head character representing the type of the variables and a number to identify each of a plurality of variables all of which are of the same type. G is the head character of Grey Scale Image, T is the head character of Tree which corresponds to a table to record the tree structure representative of the relation among regions in a picture image, and L is the head character of Lines which are the sides of a poligonal approximated segment. More specifically, the grey scale image, binary image and mask image correspond to respective image memories actually used, and the numbers thereof are fixed the structures thereof are two dimensional arrays, respectively. The segment table which is a table for supervising the relations among the segments is a table containing the information regarding the segments of an image, e.g., contiguous state or positional relationship among the segments, positions and areas of the segments, and the like. One segment table corresponds to one image. The size thereof depends upon the number of the segments included in the image and is variable. Each data in the segment table is assumed to be in the form of an integer. One example of the segment table is shown in Figs. 4A to 4C. The illustrated segment table is that of the two dimensional image, and therefore all the contiguous states or positional relationships are include , included . First, the segment table contains the number of the segments children included. Next, the include and included are represented by three kinds of pointer. More specifically, the relation of include or included is represented by a parent child relation. Namely, if A includes B, A is a parent and B is the child. In this case, there are one parent pointer The structure of the image data employed in the polygonal approximation processing system can be defined by the image variables mentioned above, so that users are not required to define it by themselves, and therefore the programming is made easy and errors associated with the programming do not occur. The image processing instructions will be explained with referrence to Fig. 5. Each image processing instruction represents each of the processing units in the polygonal approximation processing system explained referring to Fig. 1 by one instruction or function. The image input at a step 101 corresponds to an image input instruction PICTURE, and the segmentation at a step 102 corresponds to a segmentation instruction SEGMENT. Since these two steps are successively executed in many cases, an instruction PICTURERS is used for this purpose. The image structure analysis at a step 103 corresponds to an instruction ANALYZE, and the polygonal approximation at a step 104 corresponds to an instruction LINSEG. The polygonal pattern matching at step 105 includes parallel shift LSHIFT and rotational shift LROTATE which are instructions for performing the shift to superpose two patterns on each other, and MATCH which is a function for calculating the area of the superposed portion. The characteristic value extraction at a step 106 includes characteristic value functions such as AREA, PERIM, etc. Further, there are also functions such as THDSET for setting a binary digitized threshold value, MASK for setting a processing area, and TSUM, TTOP for referring to the segment table, etc. The program describing the image processing procedure will be explained with reference to Figs. 6A to 6C. The illustrated example intends to discriminate parts 1, 2 and 3 from one another according to their area. Fig. 6A shows the parts to be recognized Fig. 6B shows the processing procedure and Fig. 6C shows an exemplary program description corresponding to this procedure. First, an image is stored into a grey scale image memory G₁ and a binary memory B₁ from a camera No. 1 by the image input instruction PICTURE it is now assumed that the binary digitized threshold value has previously been set by the threshold value setting instruction THDSET step S11 . The image on the binary memory B₁ is segmented by the segmentation instruction SEGMENT and the result of the segmentation is stored in the segment table T₁ step S12 . The image structure analysis is carried out by the structure analyzing instruction ANALYZE step S13 . A background segment number I is first calculated using the segment information referrence functions TTOP and TDOWN and thereafter the segment number J directly depending upon this is calculated. Thus, an optional part placed in the uniform background is selected step S14 . This selected part J is polygonal approximated by the line segmentation instruction LINSEG to provide the vertex row L₁ step S15 . The area S of the part J is calculated by the area function AREA on the basis of L₁ step S16 . On the basis of this result, part numbers, error codes, etc. are reset at step S17 et seq. to perform the branching into the processing routine in each case. A program for determining the polygonal approximation pattern matching will be explained with reference to Figs. 7A to 7C. Fig. 7A shows the state where the part to be recognized is superposed on a dictionary pattern Fig. 7B shows the processing procedure and Fig. 6C shows an exemplary program description corresponding to this procedure. First, an image is stored into the grey scale image memory G₁ and the binary memory B₁ from the camera No. 1 by the image input instruction PICTURE it is now assumed that the binary digitized threshold value setting instruction THDSET step S21 . The image on the binary memory B₁ is segmented by the segmentation instruction SEGMENT and the result of the segmentation is stored in the segment table T₁ step S12 . The image structure analysis is carried out by the structure analyzing instruction ANALYZE step S23 . The segment number J is calculated using the segment information reference functions TTOP and TDOWN in the same manner as in the example shown in Fig. 6 step S24 . The part J is polygonal approximated by the line segmentation insturction LINSEG to provide the vertex row L₁ step S25 . The following steps are the matching thereof with a dictionary pattern by the polygonal approximation pattern matching it is now assumed that the dictionarY pattern is represented by a vertex row L₀ and has gravity center coordinates X₀, Y₀ and an orientation T₀. First, at lines 70 90 in Fig. 7, the gravity center coordinates and orientation of the part J and are obtained by gravity center functions GX, GY and an orientation function ORIENT, and thereafter The positional deviation DX, DY, DT thereof from those of the dictionary pattern L₀ is obtained. Next, at lines 100 and 110, the vertex row L₁ representative of the part J is shifted so as to have the same gravity center coordinates and orientation as those of the dictionary pattern L₀ by the pattern shifting instructions LSHIFT and LROTATE step S26 . The area superposed between L₀ and L₁ is calculated by a matching instruction MATCH. If the area is larger than 98 of the area S₀ of the dictionary pattern calculated by an area function AREA at a line 130, the estimation ST 0 is assumed and if the former is smaller than the latter, the estimation ST 1 is assumed step S26 . In this way, only writing such a short program as described above permits the same image processing device to execute pattern recognition in several kinds of procedure. The image processing device which can easily develop an application system employing a polygonal approximation processing system by developing an small amount of software using an image processing language since the polygonal approximation processing system is flexible or not fixed in its processing procedure, and hence applicable to many fields. Thus, the image processing device does not require the development of hardware and also does not require the development of a large amount of software using an universal programming language, and consequently permits the cost to be greatly reduced. Further, the image processing device permits its processing procedure to be minutely changed in accordance with the purpose so that it contributes to the expansion of the application field of automation by an image processing.