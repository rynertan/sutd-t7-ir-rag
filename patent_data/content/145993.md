# Fuel control apparatus for diesel engine.

## Abstract
Disclosed is a fuel control apparatus for a diesel engine 1 comprising a fuel injection pump 3 of the 2 chamber communicating control system having a first electromagnet ic valve 7 for controlling the quantity of fuel injection and a second electromagnetic valve 8 for controlling the timing of fuel injection, and a electronic control device 9, 10, 12 employing a microcomputer having at least a reference signal REF of revolution angle of a fuel supply portion of the fuel injection pump and a signal POS representing the number of revolution of said engine and for driving each of the first and second electromagnetic valves by processing the respective signals, in which it is made possible to de siredly set the driving timing of each of the first and second electromagnetic valves on the basis of the revolution angle reference signal of the fuel supply portion of the fuel injec tion pump and the signal representing the number of revolu tion of the engine.

## Claims
CLAIMS 1. A fuel control apparatus for a diesel engine 1 comprising a fuel injection pump 3 of the 2 chamber communicating control system having a first electromagnetic valve 7 for controlling the quantity of fuel injection and a second electromagnetic valve 8 for controlling the timing of fuel injection, and an electronic control device 9, 10, 12 having at least a reference signal REF of revolution angle of a fuel supply portion of said fuel injection pump and a signal POS representing the number of revolutions of said engine and for driving each of said first and second electromagnetic valves by processing said respective signals, in which said apparatus further comprises means 13, 14, 15, 16 for determining the revolution angle of the leading edge of a driving pulse for driving each of said first and second electromagnetic valves as a function of the angle corresponding to the width of said driving pulse on the basis of said revolution angle reference signal. 2. A fuel control apparatus according to Claim 1, in which the revolution angle of the leading edge of said driving pulse for each of said first and second electromagnetic valves is determined such that the center of width of said driving pulse has a predetermined angular positional relation with the revolution angle of said fuel supply portion. 3. A fuel control apparatus according to Claim 1, in which the center of width of said driving pulse is varied with respect to the revolution angle of said fuel supply portion as a function of said signal representing the number of revolution of said engine.

## Description
FUEL CONTROL APPARATUS FOR DIESEL ENGINE The present invention relates to a fuel control apparatus for a diesel engine for controlling the quantity and timing of fuel injection in a fuel injection pump used in the diesel engine. As well known, in a diesel engine, no ignition plug is used but ignition and explosion are performed by the heat due to compressed fuel to thereby drive a piston. The ignition timing is determined by the timing when fuel is injected into a cylinder. Even in such a diesel engine in which no ignition plug is used, it is necessary to suitably adjust the ignition timing in accordance with the revolution speed of the engine similarly to the case of gasoline engines. The adjustment of ignition timing is attained by advancing the fuel injection timing. Conventionally, however, there was no control apparatus in which the quantity and timing of fuel injection in such a diesel engine were performed by using an electromagnetic valve. Recently, however, there has been proposed, as disclosed in Japanese Patent Application Laid open No.2435 1983, a control apparatus in which two electromagnetic valves were employed such that one of the electromagnetic valves was driven on the basis of a pulse signal produced as a reference for injection start and the drive start timing of the other electromagnetic valve was set in accordance with the length of opening period of the one electromagnetic valve. The interaction between the two electromagnetic valves is caused due to the structure of the fuel injection pump. Quite recently, however, it has become necessary to set the optimum timing for an electromagnetic valve in order to realize stable supply of fuel to a fuel pump having large capacity and stable and wide control in fuel injection timing. This is because the fuel is supplied into a rotary body in the direction perpendicular to the rotary axis thereof through an supply opening and an inlet hole overlapped with each other and the overlapping area of the supply opening and inlet hole is a function of the revolution angle. For this, in the conventional diesel engine, there has been a disadvantage that it was impossible to obtain a required fuel quantity to be supplied to the engine. It is an object of the present invention to proivde a fuel control apparatus for a diesel engine in which an optimum electromagnetic valve driving timing can be obtained. According to the present invention, the driving timing for two electromagnetic valves, one being a fuel injection quantity control valve and the other being a fuel injection timing control valve, of a fuel injection pump of the 2 chamber communicating control system in which the control of quantity and timing of fuel injection is performed independently from each other, can be desiredly set on the basis of a fuel supply opening revolution angle reference signal and a revolution angle signal of the fuel injection pump to thereby obtain an optimum electromagnetic valve driving timing. The present invention will be apparent from the following detailed description taken in conjunction with the accompanying drawing, in which Fig. 1 is a block diagram of a fuel injection system of a diesel engine to which the present invention is applied Figs. 2 and 3 are detailed block diagrams showing the main parts of Fig. 1 Fig. 4 is a time chart of the control signals Figs. 5 and 6 are flowcharts of the control signals and Fig. 7 is a characteristic diagram of which is a factor of determination of the valve opening timing. An embodiment of the present invention will be described hereunder. Fig. 1 shows the general construction of the system to which the present invention is applied. In the drawing, in a 4 cylinder diesel engine 1, there are provided a ring gear 2 and a pick up 5 disposed in the vicinity of the ring gear 2 to produce pulses as an engine revolution angle signal POS in accordance with the gear teeth as the ring gear 2 rotates. Further, there are provided a fuel injection pump 3 connected to the 4 cylinder diesel engine 1, a rotor 4 for detecting the revolution of the fuel injection pump 3, and an electromagnetic pickup 6 disposed in opposition to the rotor 4 for producing a fuel injection pump supply opening revolution angle reference signal REF. The fuel injection pump 3 is provided with an electromagnetic valve 7 for determining the quantity of fuel injection and another electromagnetic valve 8 for determining the injection timing. The electromagnetic valves 7 and 8 are arranged to be driven by drive circuits 9 and 10 respectively.Each of the drive circuits 9 and 10 is driven by program timer module hereinafter referred to asPTM 16 in a control circuit 12 which may be a microcomputer.The control circuit 12 is constructed by a micro processor hereinafter referred to as MPU 13 incorporating a RAM random access memory , a ROM read only memory 14, and an input output circuit hereinafter referred to as I O 15.The control circuit 12 is arranged to receive a signal from a number of revolutions setter 11 for setting the number of revolutions of the 4 cylinder diesel engine 1. Fig. 2 shows the detail of the control circuit 12 shown in Fig. 1. As the respective circuit components, Hod6802, HD462732, HD46510, and HD6840 each manufactured by Hitachi,Ltd. and available on the market may be used as the MPU 13, the ROM 14, the I O 15, and PTM 16 respectively. The MPU 13 operates the input data from the I O 15 on the basis of the various programs stored in the ROM 14 and produces again the result of operation to the I O 15 and the PTM 16. The RAM is used for temporarily storing the data during these operations. The data exchange among the MPU 13, the ROM 14, the I O 15, and the PTM 16 is performed through a data bus 17 and a control bus 18. The registers provided in the I O 15 of the functions thereof will be described hereunder. The control bus 18 from the MPU 13 is connected to an MPU interface 300 which serves as an interface for an interruption signal hereinafter referred to as IRQ , an address signal, a tip selecting signal, a read write signal, etc., and which performs register control and selection of an address register 301, a multiplier 302, and a bus buffer multiplexer 303. Each of the address register 301 and the multiplier 302 can be directly accessed from theMPU 13, while the registers except the registers 304 and 305 shown in Fig. 2 are indirectly accessed from the bus buffer multiplexer 303. A register address to be accessed is written into the address register 301. The multiplier 302 comprises a multiplicand multiplier register 304 and a multiplication resultant register 305. A control circuit 310 within the I O 15 is constituted by a register for performing angle designation of angle interruption generation hereinafter referred to asANGR 311, a register for performing period designation of timer interruption generation of a predetermined period hereinafter referred to as INTVR 312, a register for performing designation of operation of the I O 15 hereinafter referred to as MODER 313, a resistor for masking each interruption request hereinafter referred to as MASKR 314, a register for indicating a factor of interruption output hereinafter referred to as STSIR 315, and a register for indicating the status of the I O 15 hereinafter referred to STS2R 316. An angle interruption is generated when the content written in the ANGR 311 coincides with count of angles so that the 26 bit of the STS1R 315 becomes 1 . The angular counting is performed at the leading and trailing edges of pulses of the engine revolution angular signal POS and the count is cleared every time when the leading edge of the fuel injection pump stroke reference signal REF is received. Timer interruption is generated when the content written in the INTVR 312 coincides with count of clock signals of 128 psec set therein so that the 25 bit of theSTS1R 315 becomes 1 . An analog data input circuit 330 has eight analog input terminals AI DI , and the selection of terminal is performed on the basis of the data written in an analog input terminal selection register hereinafter referred to as AISEL 331. The A D converted data are held in a 9 bit data register 332 and an 8 bit data register 333. The analog inputs AI DI are internally connected to a digital input circuit hereinafter referred to as DI1 320 and held in a digital input register hereinafter referred to asDI2 321 in the form of 1 or 0 of a digital signal of aMOS level. A number of revolutions measuring circuit 340 comprises a register 341 for designating the measuring time of counting the pulses of the engine revolution angle signal POS, and a register 342 for holding the measured data. A vehicle speed measuring circuit 350 comprises a register 351 for designating the measuring time of counting the pulses of the vehicle speed signal VSP, and a register 352 for holding the measured data. Reference numeral 360 designates a circuit for forming pulses for performing logical processing for counter preprocessing on the basis of the fuel injection pump supply opening reference angle signal REF, the engine revolution angle signal POS, and the vehicle speed signal VSP. A circuit 370 for forming a trigger signal Qt of driving pulse hereinafter referred to as Q pulse for the first electromagnetic valve of the fuel injection pump is constituted by a register 371 hereinafter referred to asQFFSR for designating the revolution angle from fuel injection pump supply opening reference angle signal REF to the opening operation of the first electromagnetic valve, a register 372 hereinafter referred to as ELOI for designating the output pulse width, and a register 373 hereinafter referred to as TABASE for designating the time which becomes the resolution of the output pulse. The counting of the revolution angles of the QFFSR 371 is performed at the leading and trailing edges of the engine rotational angle signal POS. A circuit 380 for forming a trigger signal Tt of initiating output of the second valve driving pulse hereinafter referred to as T pulse for determining the injection timing of the fuel injection pump is constituted by a register 382 hereinafter referred to as DWLR for designating the revolution angle from fuel injection pump supply opening reference angle signal REF to the initiation of output of the T pulse, and a register 381 hereinafter referred to as ADVR for designating the revolution angle of the pulse width of the T pulse output. The counting of the revolution angles is performed at the leading and trailing edges of the engine revolution angle signal POS. The contents of the respective registers ELOI 372,TBASE 373, and ADVR 381 are initially set to a minimum value. A digital input output circuit 410 is constituted by a register 411 hereinafter referred to as DDR for determining the direction of input output, an input data register 412 hereinafter referred to as DI , and an output register 413 hereinafter referred to as DOI . There are provided six input output terminals DI O and one terminal DI O11 of them operates as an external interruption terminal. A free run counter circuit 420 is constituted by a counter preset register hereinafter referred to as PRSR 421, and a counter timer counter hereinafter referred to as TIMEC 422, whereby the contents of the inner timer are held and stored and interruption is generated, at the leading edge of the DI O11 signal on the basis of 16 usec clock.Further, interruption is generated when overflow occurs in the timer. The reading of the TIMEC 422 is performed by measuring the revolution period of the engine on the basis of the number of overflow interruption and calculation. Fig. 3 shows the detail of the PTM 16. That is, the pulse width Q of the Q pulse written in a latch counter 200 from the MPU 13 is produced at the leading edge of the trigger signal Qt. The T pulse is generated also in the same manner. The pulse width data of Q and T have resolu p p tion of 1 psec clock pulse of an enable signal in the control bus 18 of the MPU 13, thereby determining the Q andT pulses. Fig. 4 shows the timing chart of various signals. A of Fig. 4 shows the timing of the fuel supply and compression by the mechanical structure of the fuel injection pump. The fuel injection in the diesel engine is performed for a certain short time during a period of compression. In fuel supplying, the quantity and timing of fuel injection can be controlled by opening the first and second electromagnetic valves. Accordingly, it is sufficient to properly control the valve opening timing. As seen in A of Fig. 4, the triangular shape shows that the cross sectional area of the fuel flow into path of the value varies in accordance with the angle of revolution of the fuel injection pump. B of Fig. 4 shows a fuel supply opening angle reference signal which is mechanically set to 150 in pump angle before the fuel supply point. This is because there is a delay in time until the fuel flowing out of the electromagnetic valve when the valve is opened, reaches the fuel supply opening of the fuel injection pump, and therefore fuel is supplied from point before the fuel supply opening. C of Fig. 4 shows the engine revolution angle signal POS. D of Fig. 4 shows the trigger signal Qt of the Q pulse of the first electromagnetic valve.The signal Qt is outputted at the angle determined by the data Sq of the register QFFSR 371 of the I O 15 is determined. E of Fig. 4 shows the Q pulse produced on the basis of the data Qp of the latch 200 of the PTM 16 for determining the valve opening of the first electromagnetic valve. F of Fig. 4 shows the trigger signal Tt of the T pulse of the second electromagnetic valve. The signal Tt is outputted at the angle determined by the data St of the register ADVR 381 of the LSI 15 of the I O 15. G of Fig.4 shows the T pulse produced on the basis of the data Tp of the latch 201 of the PTM 16 for determining the valve opening timing of the second electromagnetic valve. Referring to Figs. 5 and 6, an embodiment of the present invention will be described. In Fig. 5, an interruption signal is generated at the leading edge of the fuel injection pump supply opening reference angle signal REF and the flow is started in step 1000 in response to this interruption signal. When the flow is started, in a step 1001, the time corresponding to the number of overflow interruption is subtracted by the data read by the TIMEC 422, the difference is doubled, the period is obtained, and the number of engine rotation N is obtained by calculating the reciprocal of the period.Next, in a step 1002, the number of revolution setting data ACCEL is read from the register of the A D converter circuit 330, and in a step 1003, previously obtained map data of engine characteristic curves are read from the ROM 14 on the basis of the number of engine revolutions and the number of revolutions setting data ACCEL and the valve opening pulse width Qp of the first electromagnetic valve for the injection quantity control by interpolating calculation.Next, in a step 1004, the predetermined calculation is made to obtain the valve opening timing angular data S is obtained on the basis of the number of engine revolutions N and the valve opening pulse width Qp. Then, in a step 1005, the valve opening pulse width Tp for the second electromagnetic valve controlling a fuel injection timing is obtained on the basis of the injection timing map of engine characteristic curves previously obtained on the basis of the number of engine revolutions. After the valve opening pulse width T p for the second electromagnetic valve is obtained in the step 1005, the predetermined valve opening timing angular data St is claculated on the basis of the valve opening pulse width T p and the number of engine revolution N in a step 1006.In a step 1007, next, the obtained pulse width data Qp of the Q pulse, and the pulse width data Tp of theT pulse are written into the latch counters 200 and 201, respectively, of the PTM 16, and the valve opening timing angular data S of the Q pulse and the valve opening timing angular data St of the T pulse are written into the OFFSR 371 and the ADVR 381, respectively, of the I O 15, ending the flow in a step 1008. Fig. 6 shows a subroutine of the valve opening timing calculation, and Fig. 7 shows the characteristic of the angle between the angle reference signal and the center of the pulse width, which becomes a factor of valve opening determination. In this embodiment, as shown in Fig. 7, the center position of the output pulse hereinafter referred to as P varies depending on the number of engine revolution. The condition of this characteristic is as follows In the case where N 2000 rpm, e0 3750 In the case where 2000 rpm N 3500, 11.25 1 37.5 I 11.250 N 2000 In the case where 3500 rpm N, 3 750 2 37.5 1500 N 3500 11.25 In these conditions, each of Oot e1, and O2 represents the angles from the angle reference signal to the center position of the P pulse. In the case where the pulse width of the P pulse comes in front of the angle reference signal REF, however, the above mentioned conditions are not applied but the P pulse becomes an immediate output simultaneously with the angle reference signal. The resolution of the revolution angle signal used in this embodiment is 0.90910. In Fig. 6, when the subroutine is started in a step 2000, in the case where N 2000 rpm and e0 375a, the valve opening timing S0 the angular data of the leading edge of pulse from the angle reference signal is calculated in a step 2001. That is the value of S0 is obtained from the following equation S0 37.5 P x N x 1.5 x 10 6 1 0 Next, in a step 2002, judgement is made as to whether the number of engine revolutions N is larger than 2000 rpm or not, and if not it is considered that S S0 in a step 2006.If the result of judgement proves that the number of engine revolutions N is larger than 2000 rpm in the step 2002, judgement is made as to whether the number of engine revolution N is equal to or larger than 3500 rpm or not at a step 2003. If the result of judgement proves that the number of engine revolutions N is smaller than 3500 rpm in the step 2003, the valve opening timing S1 for the electromagnetic valve is obtained from the following equation in a step 2004 sl S0 N 2000 x 8.25 x 10 Then, it is considered that S S1 in the step 2006. On the contrary, if the result of judgement proves that the number of engine revolutions N is larger than 3500 rpm in the step 2003, the valve opening timing S2 for the electromagnetic valve is obtained from the following equation in a step 2005 S2 So N 1000 x 2.75 x 10 Then, it is considered that S S2 in the step 2006. Next, in a step 2007, judgement is made as to whether the value of S set in the step 2006 is smaller than zero, that is S O and if the result of judgement proves that the value of S is larger than zero, it is considered that S 0 in a step 2008 and the routine is ended. Thus, according to the present invention, the dynamic delay in fuel supply due to the structure and revolution of the fuel injection pump is previously measured experimentally to set the optimum valve opening timing to thereby make it possible to perform more stably the control of quantity and timing of fuel injection.