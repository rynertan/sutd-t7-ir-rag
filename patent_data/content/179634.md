# FLUX GATE SENSOR ELECTRICAL DRIVE METHOD AND CIRCUIT

## Claims
Elektrisches Fahrzeug Kompaß System, das umfaßt

## Description
The present invention relates to an electrical system for providing drive signals for a flux gate magnetic sensor used in connection with an automotive or vehicle compass. Typically, vehicle mounted compasses have been mechanical types with rotating compass cards mounted in a viscous damping media. An electrical compass has been described in a 198O SAE paper entitled A flux gate sensor, as is well known, is driven by a fundamental frequency, and information is obtained from the amplitude and polarity changes of the second harmonic frequency signals obtained from the sensor. In order to precisely detect the second harmonic signals, it is necessary to employ synchronous phase detectors to ensure that the information from the two channels is synchronized to provide the desired vectored output information corresponding to vehicle heading. In the past, either analog or digital filtering has been required to provide a sinusoidal second harmonic signal which can be processed to supply the necessary information. The digital filtration system has proven successful in providing the desired information but only with the addition of significant circuit expense for the digital filter itself as well as associated circuit elements. One piece of exemplary prior art is represented by US A 4277751. This discloses a magnetometer circuit including a flux gate sensor having a primary winding and a pair of secondary windings. The two windings are diametrically wound around the core at right angles to one another. As the core saturates in response to an AC signal from the primary drive winding, the half of the core on the side where the AC field and the earth s magnetic field are in the same direction are said to saturate sooner than the other half. By detecting this, the windings provide an indication of the magnitude of the earth s magnetic field. The present invention is concerned with a somewhat similar arrangement of a primary winding and a pair of secondary windings to provide an electrical compass system for a vehicle. EP A 120691 discloses these features set out in the pre characterising portion of Claim 1. According to the present invention there is provided an electrical compass system for a vehicle having those features set out in the characterising portion of Claim 1. The invention may be put into practice in various ways and one vehicle compass and its method of operation will now be described by way of example with reference to the accompanying drawings, in which Referring initially to Figure 1, there is shown a control and display module 1O which is adapted to be integrally included in a vehicle during manufacturing, although it could be separately added at a later time. The module 1O is mounted to the roof 12 of a vehicle and centred near the top edge of the windscreen 14, typically above the rearview mirror. The module 1O includes a pair of map reading lamps 16 having switches 17 for operating lamp means positioned behind lenses 18 which direct illumination into the lap area of either the driver or passenger side of the vehicle, depending on which switch is actuated. The centre of the module includes a garage door opening transmitter 2O including a three position switch 22 for actuating any one of three different garage door remote control units by the actuation of push button switch 24. Module 1O may also include an electrical sunroof control switch 25. The construction of the lamp modules 16 and garage door transmitter module 2O is generally described in US A 4 241 87O. Module 1O additionally includes a separate display panel 3O which includes display indicators 31, 32, 33 and 34 for displaying vehicle operating parameters such as engine temperature, oil pressure, alternator and fuel warnings or the like which can either be displayed in a digital alpha numeric format or as warning lights. The centre of the display module 3O includes a digital display 35 providing, in one embodiment of the present invention, an octant display 36 of the vehicle heading in an alpha format, and on the left side of display 35, a temperature display 37 providing farenheit or centigrade display of the exterior ambient temperature of the air near the vehicle as well as a warning signal when road conditions approach freezing. The temperature display circuit is actuated by a push button temperature switch 38 while the compass circuit is actuated by a push button switch 39. A pair of apertures 4O and 41 provide limited access to calibration and variation switches 42 and 44, respectively Figure 2 , which are only occasionally used and are the push switches mounted to a circuit board 43 Figure 2 positioned behind a panel 45 and are actuated by a pointed instrument such as a ball point pen. The compass system includes a flux gate sensor 5O, shown schematically in Figure 2 and shown in Figure 4. Sensor 5O is preferably mounted to the circuit board 43 shown schematically in Figure 2 which also contains the remaining circuit elements, shown in Figure 2. The circuit board preferably is mounted near the sheet metal roof of the vehicle to position the flux gate sensor near the roof. The metal roof is believed to provide a flux steering effect to the earth s magmetic field which results in improved performance of flux gate sensors over other possible locations in a vehicle. Sensor 5O includes an annular core 58 around which there is wound the helical primary winding 52, as shown in Figure 4. The annular core 58 and winding 52 are mounted to a plastic support 51 which centres and holds the core in position with respect thereto and around which the east west secondary winding 54 and the north south secondary winding 56 are wound. Each of the windings 52, 54 and 56 are of No. 36 gauge magnet wire suitably insulated. The primary winding 52 comprises approximately 25O equally spaced turns of such wire while the secondary windings 54 and 56 each comprise approximately 4OO turns of such wire. Support 51 includes notches 53 for holding the second windings in position with respect to the primary winding. Each of the windings is terminated at suitable terminal posts 55 embedded in the support 51 for subsequent connection to the electrical circuit components, as shown in Figure 2. The annular core is a tape wound core commercially available from The Magnetics Division of Spang Ind., Butler, Pennsylvania, U.S.A., Part No. 8O653 1DO42 O2. The outer and inner diameters of the core are 23.8 mm 15 16 inch and 19.1 mm 3 4 inch , respectively, and the secondary windings 54 and 56 have outer diameters wound around the support 51 of approximately 28.6 mm 1 1 8 inches and 31.8 mm 1 1 4 inches , respectively. The electrical drive circuit 6O for supplying drive signals to the primary 52 of the sensor 5O includes a pair of solid state switches 62 and 64 coupled in a push pull configuration. Switches 62 and 64, in the preferred embodiment of the invention, comprise transistors with transistor 62 being an NPN and transistor 64 being a PNP type. Transistor 62 is a 2N44O1 while transistor 64 is a 2N44O3, both of which are commercially available. The emitter of transistor 64 is coupled to the V supply, which, in the preferred embodiment of the invention, was 5 volt regulated DC while the collector is coupled to a 16O ohm current limiting resistor 66 which, in turn, is coupled to an input terminal 57 of the flux gate primary winding 52. The base of transistor 64 is coupled to the output of a driver amplfier 7O by means of a 1O k ohm resistor 68. Similarly, NPN transistor 62 has its emitter coupled to system ground OV while its collector is coupled to terminal 57 through a 16O ohm current limiting resistor 63. The base terminal of transistor 62 is coupled to the ouptut of amplifier 7O by means of a 1O k ohm resistor 65. The remaining terminal 59 of primary winding 52 of sensor 5O is coupled to a floating ground 61 which is 1 2 of the power supply V or 2.5 volts DC. Coupled in parallel with primary winding 52 and in the emitter to collector current paths of transistors 62 and 64 is a current controlling resistor 69, the value of which is selected to provide the desired mid point saturation of the core 58. In the preferred embodiment shown, the value of resistor 69 is 68 ohms. The selected value may vary depending on circuit parameters of other embodiments to provide current flow through the primary winding 52, as described in greater detail below in connection with Figure 3, to provide saturation of the core at a predetermined time and, in the preferred embodiment, at approximately the mid point of the drive signal waveform for each half cycle. The signal applied to circuit 6O is shown by waveform A and is a squarewave signal supplied through a buffer 7O of conventional design which, in turn, is driven by a 15OO Hz squarewave signal output from terminal or pin 17 of a microprocessor 1OO. Microprocessor 1OO is a Motorola 68O5 microprocessor which is programmed to supply a 15OO Hz output signal at its pin 17 which is applied to the input of amplifier 7O. It is noted here that for purposes of simplfiying the electrical schematic of Figure 2, the conventional buffer amplifier coupling the output terminals of the microprocessor to the various interface circuits are not shown, it being understood that amplifiers, such as a CD4O5O, will be used to interconnect each of the ouptuts of the microprocessor to associated circuits. Similarly, in most cases, the conventional connection of the V and The secondary windings 54 and 56 of the flux gate sensor 5O are commonly coupled at terminal 71 which is coupled to the system floating ground 61, as shown. Coupled across each of the secondary windings 54 and 56 is a one k ohm damping resistor 72 and 73 to prevent oscillation of the output signals. The windings 54 and 56 corresponding to the east west and north south windings, respectively, are capacitively coupled to amplifiers 74 and 76, respectively, by means of coupling capacitors 75 and 77. Capacitors 75 and 77 are .1 Mfd 5O volt capacitors while amplifiers 74 and 76 include an LM29O2 integrated circuit chip coupled in a conventional amplifier circuit configuration. The output terminals of amplifiers 74 and 76 are coupled through resistors 78 and 79 to the inputs of the integrated circuit synchronous phase detector 8O comprising a National Semiconductor CD4O16 integrated circuit chip. Circuit 8O comprises four bilateral switches, two of which are associated with each of the secondary coils 54 and 56 of the flux gate sensor to supply signal information at inputs 8, 11 and 1, 4 to output terminals 9, 1O and 2, 3, respectively. The output terminals of circuit 8O are coupled to integrator circuits 82 and 84 through suitable integrating capacitors 81 and 83 associated with integrator 82, and integrating capacitors 85 and 86 associated with integrator 84, respectively. Integrators 82 and 84 thus receive alternate half cycle sinusoidal signals from the synchronous phase detector 8O to provide a time varying DC output signal at their output terminals representative of the direction sensed by coils 54 and 56 mounted to the vehicle, as described in greater detail in the above identified EP A O 12O 691. These signals are fed back to the output terminals of the secondary windings 54 and 56 through feedback resistors 87 and 88, respectively. Compass compensation correction information similarly is supplied to the output terminals of secondary windings 54 and 56 through resistors 94 and 96 and D to A converters 9O and 92 having their input terminals coupled to output terminals 24 and 23, respectively, of microprocessor 1OO. The compensation correction system as well as the internally programmed compass variation correction technique is described in greater detail in the above identified EP A O 12O 691. The output signals of integrators 82 and 84 are coupled to signal input terminals 21 and 2O of microprocessor 1OO through A to D converters 91 and 93 for converting the time varying DC input information into suitable digital signals compatible with the microprocessor 1OO. The signal conversion, shown by the A to D converter blocks 91 and 93 can be microprocessor controlled, as described in the above identified EP A O 12O 691 if desired. The microprocessor 1OO is coupled to a non volatile memory 11O for, in part, retaining compensation and variation correction information. Memory 11O can be a National Semiconductor NMC93O6 integrated circuit and is coupled to the microprocessor through the terminals as shown. The microprocessor 1OO also includes output terminals 8 and 9 coupled to a suitable display driver circuit 111 for providing signals to the digital display 35. The display driver 111 and display 35 can be any type of desired digital, alpha numeric or graphic display. In the preferred embodiment, the display 35 was a vacuum fluorescent alpha type display, as shown in Figure 1. The microprocessor also receives temperature input information from a thermistor 12O coupled to the V supply in a voltage dividing network including a serially coupled resistor 122. The analog varying DC voltage from the thermistor 12O is supplied to the microprocessor 1OO in a digital format through an A to D converter 124. Similarly, compass and thermometer control and compensation and variation control signal information is supplied to the microprocessor 1OO through switches 38, 39, 42 and 44 each having one terminal commonly coupled to system ground and a remaining terminal coupled to an input terminal of the microprocessor and to V through a resistor network 13O, as shown in Figure 2. Thus, actuation of any of the switches 38 44 will cause one of the inputs of the microprocessor to go from a logic 1 state to a logic 0 providing control information thereto. The programming of the microprocessor to provide the desired compass operation is disclosed in greater detail in the above identified EP A O 12O 691 and forms no part of the present invention other than to provide the output drive frequency signals supplied by the microprocessor as phase related clock pulses at output terminals 17, 18 and 19. The flux gate drive circuit operation can best be understood with reference to the waveform diagrams of Figure 3 in which the location of each of the waveforms A F, inclusively, is shown on the schematic diagram of Figure 2 by the corresponding identification letter. The squarewave drive 15OO Hz drive signal A is applied to the base terminals of transistors 62 and 64 and during the time period t₀ t₂ the positive voltage applied to transistor 62 drives it into saturation whereupon current from the floating ground at 2.5 volts flows downwardly through the parallel current path of resistor 69 and winding 52 through collector resistor 63 and transistor 62 to ground. During this time period, transistor 64 is cutoff. During the time period t₂ t₄, however, transistor 62 is rendered nonconductive and transistor 64 conducts with current flow from V through transistor 64, resistor 66 and the parallel current path of resistor 69 and winding 52 to the lower 2.5 volt floating ground. Thus, transistors 62 and 64 conduct alternatively to provide opposite direction current flow through primary winding 52. The voltage B is illustrated in Figure 3B and is the voltage at terminal 57 of the primary winding. The waveform diagram of Figure 3B shows a 15OO Hz signal which is a pulse having duration of 1 2 of each half cycle of the pulses A, shown in Figure 3A. At times t₁ and t₃, the voltage pulse returns to the reference level of about 2.5 volts. The time and amplitude voltage signal of waveform B indicates the saturation of the flux gate sensor core 58 at the mid point between t₀ and t₂ and again between t₂ and t₄ in the opposite field direction. The saturation at a predetermined time which is the mid point of each half of the driving cycle is important inasmuch as the resultant secondary waveform, shown in Figure 3C, corresponding to the output signal of the north south winding 56 results in sinusoidal half wave pulses which are of alternate polarity and which occur at t₀, t₁, t₂, t₃ and t₄ for each full cycle of drive waveform. The frequency of the sinusoidal 5O µs duration pulses resulting from the drive waveform is 3 kHz since a pair of alternate polarity pulses occurs at the output winding for each pulse supplied to the input. The signals occuring at the output windings of the flux gate sensors in the prior art system, for example that in the above identified EP A O 12O 691, are relatively high frequency damped oscillating pulses occuring at times t₀, t₂ and t₄. These ringing signals could not be readily demodulated to provide the necessary signal information for processing and therefore digital filtration was required to obtain sinewave second harmonic frequency information. Figure 3D shows the amplified and inverted signal D from amplifier 76, which signal is applied to the synchronous phase detector. It will be understood by those skilled in the art that a similar shaped waveform will be applied to the synchronous phase detector 8O through amplifier 74. The amplitude and polarity of the pulses shown in waveform D and those corresponding pulses from amplifier 74 will be directly related to the direction of travel of the vehicle in which the flux gate sensor is mounted. Thus, for example, with the vehicle heading directly north, the waveform D may be at a maximum amplitude and the polarity shown, while when the vehicle is heading directly south, the amplitude may be the same but the polarity reversed. Similarly, when the vehicle is moving in a directly east or west direction, the signal shown by waveform D may be at approximately O level, particularly when the system has been compensated for the local magnetic field disturbances caused by the vehicle. The east west coil 5O similarly provides a varying signal relating to the direction of orientation of the flux gate sensor with respect to the earth s magnetic field. The synchronous phase detector 8O comprises pairs of bilateral switches with the signal of waveform D being applied through resistor 78 to inputs 1 and 4 corresponding to two separate switches. The associated signal from amplifier 74 is similarly applied to input terminals 8 and 11. The switches are driven by the 3 kHz pulses, shown as waveforms E and F, shown in Figures 3E and 3F. The centres of these 3 kHz pulses align with the times t₀, t₁, t₂, t₃ and t₄ for each cycle of operation. The pulses shown as waveforms E and F are applied to the circuit 8O to alternately turn on the pair of switches contained in the synchronous phase detector such that the alternate pulses, for example of waveform D, will be applied to the input terminals of the integrator 82. Similarly, the other pair of switches contained in the synchronous phase detector will couple the similar waveform from amplifier 74 through resistor 79 and applied to input terminals 8 and 11 to the integrator 84 through the output terminals 9 and 1O such that the integrators 82 and 84 will see only the resultant signal waveform and provide a DC varying output signal which is directly representative of the orientation of the flux gate sensor and therefore the vehicle in which it is mounted with respect to the earth s magnetic field. By providing mid point saturation, Naturally, the selection of the value of resistor 69 to assure the mid point saturation is essential. Decreasing of the resistor size thus shunting more current from the winding 52 causes saturation to occur at a later point in time and widens pulses B. Similarly, by increasing the ohmic value of the resistor 69, saturation will occur at an earlier point in time and shorten pulses B. It is noted that the waveform diagrams of Figures 3C and 3D are taken with the feedback loops including resistors 87, 88, 94 and 96 disconnected.