# FOUR WIRE KEYBOARD INTERFACE

## Claims
Datenverarbeitungssystem 29 mit einem Host Rechner 36 und einer Tastatur 30 , wobei der Host Rechner eine zentrale Steuereinheit 38 zur Steuerung der Arbeitsweise der Tastatur aufweist und die Tastatur ein Schaltfeld 32 mit mehreren Reihen und Spalten aufweist, wobei

## Description
This invention relates to communication between subsystems in a computer system, and more particularly, to communication between a keyboard and a terminal. Computer systems in the prior art have employed a variety of devices and techniques to permit the communication between subsystems of a system. In general, a computer system includes subsystems such as central processing units, video display devices, keyboards, and other units generally referred to as terminals. Communication between such a keyboard and a terminal in the prior art involved two techniques. The first technique, as best illustrated in Figure 1, is the use of UARTs to transmit and receive data between the keyboard and the terminal. UART is an acronym for universal asynchronous receiver and transmitter. It is a device that is capable of transmitting and receiving serial data and transforming the data into parallel data, or vice versa. Of the four wires which are provided to interface the keyboard with the terminal, wires one and two permit communication between the keyboard and the terminal. The two remaining connections are used to connect the keyboard and the terminal to a power source and a ground, respectively. In operation, a keyboard microprocessor first scans the keyboard switch array to determine which key of the array has been depressed. Generally, the code that has been assigned to identify the particular key is then transmitted to the keyboard microprocessor via the keyboard UART. The terminal UART receives this code and transmits it to the terminal microprocessor. This code is transmitted across one of the data links such as wire one or wire two. The terminal microprocessor then stores this information or retransmits it to other devices that are connected to the terminal. Macy, US Patent Number 4346369, discloses some aspects of this first technique. The alternative technique for communication in the prior art, as shown in figure 2, is the use of a plurality of data wires. In such a case, for example, a ten wire interface is provided in the keyboard and a similar ten wire interface is provided in the terminal 14. In this instance, seven wires are used by the terminal, in essence, its microprocessor to address the keyboard switch array. An eighth wire is used to transmit data from the keyboard to the terminal. The remaining two wires are the power and ground wires. UARTs are eliminated in this alternative technique. Fowler, III, US Patent Number 4408191 and Amano et al, US Patent Number 4470038 describe some aspects of this second technique. Each of these prior art techniques, however, is deficient in some aspects. For the first prior art technique,not only are UARTs relatively expensive devices but also a microprocessor is required in the keyboard. As for the second prior art technique, a ten wire cable is both relatively expensive and cumbersome. IBM Technical Disclosure Bulletin, Volume 23, Number 4, September 1980, pages 1340 1345, discloses a two wire system in which an array of keyboard switches is scanned by row and column using counters operated by clock pulses set in one direction down one of the two wires. A keyboard switch closure causes the voltage on that wire to be held low, so identifying the keyswitch which is closed. In view of the prior art, it is a major object of the present invention to provide a keyboard interface for communication between a keyboard and a terminal that is both relatively inexpensive and simple. It is another object of the present invention to provide a keyboard interface that utilises a minimal number of data lines without requiring the use of a parallel to serial data conversion device. In order to accomplish the above and still further objects, the present invention is a computer system comprising a host and a keyboard, said host comprising a central control means for controlling the operation of said keyboard and said keyboard comprising a switch array having a plurality of rows and a plurality of columns, the improvement wherein The invention will be further described by way of non limitative example with reference to the accompanying drawings, in which Referring to Figure 1, there is shown a prior art communication system for exchange information and data between a keyboard 12 and a terminal 14. Keyboard 12 may be one of any number of devices which are capable of inputting alphanumerics. Similarly, terminal 14 may be one of any number of devices such as a central processing unit, a video display device, etc. Basically, keyboard 12 includes a keyboard switch array 16, a microprocessor 18 and a UART 20. The UART, an acronym for universal asynchronous receiver and transmitter, is a device that is capable of transmitting and receiving serial data and transforming the data into parallel data, or vice versa. Terminal 14, in the illustration, is a central processing unit that includes a microprocessor 22 and a UART 24. Four wires are provided to interface keyboard 12 with terminal 14, thereby contributing to the name four wire interface. For example, wires one and two are provided to permit communication between keyboard 12 and terminal 14. In addition, wire three connects both keyboard 12 and terminal 14 to a power source and wire four connects both devices to the ground. In operation, keyboard microprocessor 18 scans keyboard switch array 16 to determine which key of the array has been depressed. Generally, the code that has been assigned to identify the particular key is then transmitted by keyboard UART 20 to its counterpart, terminal UART 24. This code is transmitted across one of the data links such as wire one or wire two. Terminal microprocessor 22 then stores this information or retransmits it to other devices that are connected to terminal 14. An alternative technique for communication in the prior art, as shown in Figure 2, is the use of a plurality of data wires. In such a case, for example, a ten wire interface 26 and a ten wire interface 28 are provided in keyboard 12 and terminal 14, respectively. In this instance, seven wires are used by terminal 14 or its microprocessor 22 to address switch array 16 and an eighth wire is used to transmit data from keyboard 12 to terminal 14. The remaining two wires are the power and ground wires. UARTs are eliminated in this alternative technique. Each of these prior art techniques includes disadvantages. For the first prior art technique, not only are UARTs relatively expensive devices but also a microprocessor is required in the keyboard. As for the second prior art technique, a ten wire cable is both relatively expensive and cumbersome. The present invention, as best shown in Figure 3, provides a keyboard 30 of a computer system 29 that has a switch array 32 and a four wire interface means 34. An indicator 44 such a bell or a light is connected to interface means 34. In addition, a terminal 36 of computer system 29 is provided that has a microprocessor 38, an output port 40, and an input port 42. Although four wires are provided to link keyboard 30 with terminal 36, UARTS and the keyboard microprocessor are eliminated. Two of the wires are used for communication between keyboard 30 and terminal 36. One of the remaining wires connects the two devices to a power source and the last wire connects the two devices to a ground. In general, the operation of the present invention is initiated by terminal microprocessor 38 which sends a command signal CMD. The command signal comprises a keyboard initialize signal and a keyboard increment signal. The sequence of operations begins with the presence of the keyboard initialize signal. This signal causes the initialization of keyboard interface means 34, preparing it for the scanning of the switch array. After keyboard interface means 34 has been initialized, keyboard increment signals are sequentially forwarded by terminal microprocessor 38. After each keyboard increment signal, terminal microprocessor 38 senses the state of a particular location or key of the switch array that has been addressed by keyboard interface means 34. This is to detect whether or not that particular key has been activated or depressed by an operator. Interface means 34 then transmits the status of that key to terminal microprocessor 38 via a data signal line DATA. This response from keyboard interface means 34 is merely a simple acknowledgement, i.e., whether the inquired key of switch array 32 has been depressed. This response, the DATA signal, is not a coded message. More particularly, four wire interface means 34 and switch array 32 are more fully described in Figure 4. Switch array 32 is an 11 X 8 array, i.e., a conventional array with eleven rows and eight columns. Switch array 32 is not limited to an 11 X 8 array, and that particular dimension is merely exemplary. Interface means 34 comprises a row selector means 50 the outputs of which are connected to the rows of switch array 32, a column selector means 52 the inputs of which are connected to the columns of Switch array 32. Row selector means 50 in the preferred embodiment comprises two demultiplexers 50A and 50B each of which is a Type SN54LS156 demultiplexer manufactured by Texas Instruments Inc. of Dallas, Texas. As shown in Figure 4, only three outputs of demultiplexer 50A are used, outputs 2Y2, 2Y1, and 2Y0. The remaining outputs are left in the nonconnected n c state. Row selector means 50 also comprises an inverter 66. Column selector means 52 in the preferred embodiment comprises a MM74HC4051 multiplexer 53 manufactured by National Semiconductor Corp. of Santa Clara, California. Each of the columns, through a resistor, is tied to a 5 volt power source. These switch array resistors are designated R In addition, row selector means 50 and column selector means 52 each share a counter 54. Counter 54 in the preferred embodiment is a Type SN54LS393 counter manufactured by Texas Instruments. Counter 54 has a plurality of outputs each of which corresponds to a bit of a binary numeral. This binary numeral represents a count that is provided by counter 54. The four outputs of counter 54 corresponding to the four most significant bits of the binary numeral are provided to control the operation of row selector means 50 and the three outputs of counter 54 corresponding to the three least significant bits of the binary numeral are provided to control the operation of column selector means 52. Further, interface means 34 comprises a command differentiator means 56. Command differentiator means 56 is provided for routing commands which are forwarded to keyboard 30 by terminal microprocessor 38. Differentiator means 56 includes an open collector inverter 58 which in turn is connected to a voltage comparator 60, a resistor 62 and a capacitor 64. The command signal CMD from terminal microprocessor 38 is provided to the clock input of counter 54 and to inverter 58. If the CMD signal does not activate differentiator means 56, then that signal, which appears at the input of counter 54, is defined as the keyboard increment or clock signal CLK. If, however, differentiator means 56 is activated, causing comparator 60 to produce a high output, then that command signal is defined as the keyboard initialize or clear signal CLR. Comparator 60 in the preferred embodiment is a LM339 voltage comparator manufactured by National Semiconductor. Open collector inverter 58 has a non active output characteristic when its output is high. Thus, in this condition, it is essentially disconnected electrically from resistor 62 and capacitor 64. In such a state, the output of inverter 58 has no effect on the current that charges capacitor 64. Thus, capacitor 64 charges solely through resistor 62, at a selected time constant of RC, the product of the values of resistor 62 and capacitor 64. In addition, the output of comparator 60, the CLR signal, is connected to the clear input of counter 54. The outputs of counter 54 are connected to row selector means 50 and column selector means 52 with the four highest binary bits connected to row selector means 50 and the three lowest connected to column selector means 52. Demultiplexers 50A and 50B of row selector means 50 include 10 outputs the operation of the top three, i.e., those of demultiplexer 50A, is controlled by inverter 66. The three lowest outputs of counter 54 are connected to multiplexer 53 for enabling its eight inputs. The output of multiplexer 53, which is designated as the data signal DATA, is connected to driver 68. The output of driver 68 is connected to the DATA wire or wire two of Figure 3. The power and the ground are provided in a conventional manner as shown in Figure 4. In operation, terminal microprocessor 38 begins the sequence by sending a When the CMD signal is low, whether it be of long or short duration, inverter 58 permits the charging of capacitor 64. If the The next To sense the depression of a key of switch array 32, the entire switch array must be scanned. The sequence of scanning is from position row0 column0 through position row0 column7, and continues in this fashion one row at a time, terminating at position row10 column7. For example, after the receipt of the first CLK pulse, position row0 column0 is sensed. Before the next CLK pulse is sent to keyboard 30, terminal microprocessor 38 senses whether a DATA signal has been received by terminal input port 42. Sufficient time is provided between CLK pulses to permit the keyboard circuitry to respond and send back a data signal DATA if that position row0 column0 has been activated or the key corresponding to that position has been depressed. Thus, the low To illustrate the operation of interface means 34, lets assume that the key representing the letter W of the word WYSE has been depressed. The sequence of operations is best illustrated by the flow diagram of Figure 9. Terminal microprocessor 38 first clears interface means 34 and begins the sequential scanning of switch array 32, beginning at position row0 column0. The transmitted command signals At the next binary numeral of the scan, 1000101 , the top four outputs of counter 54 are routed to row selector means 50. Since the topmost bit of counter 54 is a numeral 1 , it disables the lower demultiplexer 50B. Inputs Since the binary numeral is 1000101 , the bottom three bits of counter 54 are outputted to multiplexer 53. The presence of the bits 101 at pins A, B, and C of multiplexer 53 activates input Y5, permitting it to sense the current on column COL5. Multiplexer 53 then outputs a signal at output pin OUT. This signal, after it has been amplified by driver 68, is the As stated previously, the entire switch array is scanned in approximately 10 milliseconds, which is faster than the depression of the next key by the human operator. In this fashion, each of the remaining letters of the word WYSE is sensed during a subsequent scan. For example, at binary numerals 0101100 of a subsequent scan of switch array 32, the array position row5 column4 or the key representing Y is sensed. In this instance, the presence of the numeral 0 at the output of the topmost bit of counter 54 causes inverter 66 to produce a high signal, thereby inactivating top demultiplexer 50A. Correspondingly, the presence of the low signal at inputs As best shown in Figure 6, row selector means 50, column selector means 52, counter 54 and a substantial portion of command differentiator means 56 are replaced by a single custom semiconductor chip 146. Those elements which are identical to their counterparts in Figure 4 are identified by the addition of numeral 1 to the numerals identifying the counterpart element in Figure 4. For example, the counterpart of switch array 32 is designated switch array 132 in Figure 6. Chip 146 includes ten output pins which are connected to the ten rows of array 132, pins 9 through 16 and pins 27 and 28. Pins 1 through 8 are connected to the eight columns of array 132. Although switch array 132 is a 10 X 8 matrix in this embodiment, this dimension is also exemplary. In addition, pin 19 is connected to resistor 162 and capacitor 164 of the command differentiator means 156. Moreover, pin 18 is connected to the The internal elements of chip 146 is best illustrated in Figure 7. Chip 146 includes a row selector means 150 and a column selector means 152. Row selector means 150 in this embodiment is a shift register the outputs of which are connected to the ten rows of array 132. Shift register 150 comprises six flip flops, designated 150a through 150f. Column selector means 152 in this embodiment comprises a shift register 154 that functions as a counter, a plurality of AND gates 153a 153h, a master OR gate 153i, and a plurality of active pull up resistors R In addition, a Schmitt trigger 180 is provided for receiving the More particularly, the output of inverter 182 is connected to the control input of tri state driver 158 the output of which is connected to the timing circuit which is comprised of resistor 162 and capacitor 164. The output of driver 158 is also connected to Schmitt trigger 160 which is configured to output a low signal if its input exceeds 2.5 volts. Schmitt trigger 160, therefore, functions as a voltage comparator. The output of Schmitt trigger 160 is a In operation, a With the exception of the first flip flops of both shift registers, flip flop 150a and flip flop 154a, the remaining flip flops are cleared by the CLR signal. Flip flops 150a and 154a are set direct SD flip flops, that is, they produce a high signal at their outputs when they receive the CLR signal. The remaining flip flops are clear direct CD flip flops, producing a low signal when they receive the CLR signal. Each of these flip flop outputs includes an open collector driver. The negative output A high signal of the Schmitt trigger S In this fashion, subsequent CLK signals increment shift register 154, i.e., causing the high signal of flip flop 154a to propagate through shift register 154. Whereas flip flops 154a 154d are conventional D type flip flops DFF which are capable of propagating one pulse at a time, flip flop 154e is in essence a conventional shift register that is capable of activating columns COL4 through COL7 of array 132. When the topmost bit of shift register 154, i.e., topmost bit of the output Q As for activating indicator counter 144, a flip flop 170, a second D type flip flop 172, and an AND gate 174 are provided. These devices produce the indicator Clock signal From the instant that the clear signal was removed from counter 144, counter 144 proceeds to advance or count through the binary sequence. For example, assume that the CAPS LOCK capability is represented by binary numerals 1110 , counter 144 is required to increment fourteen times before LED 143a can be activated. Although the In Figures 3 and 8, a detailed illustration of output port 40 of terminal 36 is shown. Output port 40 comprises a flip flop 190 and an AND gate 192. Flip flop 190, a conventional DFF, has its inputs connected to an output port enable signal of microprocessor 38 and an internal data line of microprocessor 38. AND gate 192 has its inputs connected to the output Q of DFF 190 and the output port enable signal of microprocessor 38. The output of AND gate 192 is the CMD signal that is forwarded to keyboard interface means 34. In operation, whenever a signal is to be outputted by terminal microprocessor 38, the data line is enabled, causing DFF 190 to latch onto that signal. Thus, a signal appears at the output Q of DFF 190. To activate output port 40, permitting the transmission of a signal to keyboard 30, microprocessor 38 produces the output port enable signal. The combined presence of a high signal at the DFF output and a high output port enable signal causes the transmission of the CMD signal to keyboard 30. In contrast, when the data line from microprocessor 38 is low, causing DFF 190 to output a low signal, a low signal is forwarded by AND gate 192. In the preferred embodiment, the short durationed CMD signal produced by AND gate 192, functioning as the CLK signal when it reaches keyboard interface 34, has a duration that is identical to the duration of the output port enable signal from microprocessor 38. The period that DFF 190 is low is identical to the duration of the long durationed CMD signal, evolving into the CLR signal in keyboard interface means 34.