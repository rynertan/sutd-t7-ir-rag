# PORTABLE DATA STORING PROCESSING DEVICE

## Claims
Tragbare Vorrichtung zum Speichern und Verarbeiten von Daten, die über eine Anschlußvorrichtung mit einer Hauptdatenverarbeitungsvorrichtung verbindbar ist, mit

## Description
The present invention relates to a portable data storing processing device such as an IC card having a control circuit, e.g. CPU, and a memory. A banking organ such as a bank has used a so called cash card with an account number by which money can be deposited or withdrawn without a bankbook. In order to prevent another person from illicitly using the card, a password is stored in the cash card for checking whether or not the user is the real owner of the card. A magnetic stripe memory is used for the memory of the cash card. In this type of the memory, the data stored is easily read. In this respect, the memory has an insufficient protecting function against the read out of data by another person. This gives rise to illicit use of the cash card. To cope with this problem, a portable data storing processing device, such as an IC card, has been developed. In this device, a semiconductor memory of which the data can not be seen from the exterior is included. In this type of IC card, it is necessary to devide the memory area into an accessible zone and an inaccessible zone for a certain people and a certain machine in accordance with the data to be stored. The size and location of the zone in the memory area are properly set in accordance with the issuer of the IC card or the system using the IC card. For this reason, the card maker must individually manufacture the cards prepared for the card issuers and the systems. In the conventional IC card, the password is usually checked. However, in some cases, the password check is not required. Furthermore, the data is output from the IC card being encrypted in accordance with the importance of the data. To meet such a requirement, the card maker must manufacture additional IC cards not requiring the password check or requiring the data encryption. Thus, the conventional IC card lacks versatility in use, and has a high manufacturing cost. The above description, which relates to a card like portable data storing processing device, is also applicable to a coin like device, and any other portable means e.g. a ball point pen or a wristwatch having such a device assembled therein. Prior art document IBM TECHNICAL DISCLOSURE BULLETIN, vol. 22, no. 5, October 1979, pages 2009 2010, New York, US A.J. Sutton et al. Processors sharing and partitioning of main storage in the MP system , describes a plural processor shared storage system. In this system, a main storage is partitioned, and a processor identification field permits or denies each processor of the system to access a particular range of storage addresses according to the identification of the processor. It is an object of the present invention to provide a portable data storing processing device which is versatile in use and low in cost to manufacture. To solve this object the present invention provides a portable data storing processing device as stated in claim 1 or 2. This invention can be more fully understood from the following detailed description when taken in conjunction with the accompanying drawings, in which A preferred embodiment of a portable data storing processing device according to the present invention will be described referring to the accompanying drawings. In the present embodiment, the portable data storing processing device is shaped like a card. Fig. 1 shows a plan view of a so called IC card. An IC chip to be described later is contained in a card 10 made of plastic, for example. A connector 12 is provided on the surface of the card 10. When the card 10 is inserted into a card issuing apparatus or a user terminal device in banks, an automatic cash depositing withdrawing machine , the connector 12 connects the IC chip with such a device. Fig. 2 is a block diagram of an electric circuit in the IC chip contained in the card 10. The IC chip includes a CPU 20, a zone access controller 22, a memory 24, an encrypt circuit 26 and an interface 28. The interface 28 is connected to the connector 12 on the card surface. The memory 24 is an EEPROM for storing a control program for the CPU 20, and data. Its memory area is segmented into a plurality of zones. The zone access controller 22 is also an EEPROM, and stores a password and an access condition for each zone of the memory 24 in the form of a zone access table as given in the following table. The unit of zone size is byte. An access person flag A A1, A2, A3, A4, ..., A8 , a terminal flag B B1, ..., B8 , and an output condition flag C C1, ..., C8 each consists of 8 bit data. Each bit of the access person flag A indicates a card accessible condition for each access person. If the bit is 1 , the card is accessible by that access person. If it is 0 , the card is inaccessible by that access person. In this embodiment, the bits A1, A2 and A3 of the access person flag respectively correspond to a card maker, a card issuer, and a card owner. The bits of the terminal flag B indicate an access condition for each terminal device, respectively. If the bit is 1 , the card is accessible by that terminal. If it is 0 , the card is inaccessible by that terminal. The bits B1, B2 and B3 of the terminal flag B correspond to a card issuing apparatus, an updating apparatus reissuance of an expired card is called an update , and an user terminal, respectively. In the output condition flag, only the bits C1 and C2 are valid. If the bit C1 is 1 , it indicates an indirect encryption of data. If the bit C2 is 1 , it indicates a direct encryption. If both the bits are 0 , the data is output without being encrypted. Direct encryption of data means that the data is encrypted by an encrypt key generator in the IC card. Indirect encryption means that the data is encrypted by an encrypt key generator in the terminal device, not in the IC card. The access person flag A, the terminal flag B and the output condition flag C are tabulated below. In the table, sign indicates invalid data. From Table 2, the zone access table shown in Table 1 can be interpreted in the following way. In Table 1, the zone No. 1 is accessible only when the maker or the issuer operates the card issuing apparatus. The data in the zone is indirectly encrypted and output. The zone No. 2 is accessible only when the issuer or the owner operates the card issuing apparatus, the updating apparatus, or the user terminal device. The data in this zone is directly encrypted and output. The zone No. 3 is accessible only when the owner uses the user terminal device. The data in this zone is directly encrypted and output. The zone No. 4 is accessible only when the owner operates the user terminal device. The data in this zone is output without being encrypted. In this case, the access person is identified by a password. The zone access table is programmed into the zone access controller 22 by the card issuer, for example, a bank, and not in the manufacturing stage of the IC card. A card issuing apparatus used for programming the zone access table will be described. Fig. 3 shows the appearance of a card issuing apparatus, which is like a general personal computer. The card issuing apparatus is comprised of a keyboard 30, a CRT monitor 32, a floppy disk unit 34, a printer 36, and the like. A slit 40 for the IC card to be inserted through is located under a disc inlet 38 of a floppy disk unit 34. Fig. 4 shows a block diagram of an internal circuit of the card issuing apparatus. The issuing operation of the card is performed under the control of a control circuit 48 including a CPU 42, a ROM 44 and a RAM 46. The keyboard 30, the CRT monitor 32, the floppy disk unit 34, and the printer 36 are connected to the CPU 42. The card 10, inserted through the slit 40, is electrically connected to an IC card reader writer 50. With this connection, data is transferred between the circuit of the card 10 and that of the card issuing apparatus. Fig. 5 shows a longitudinal cross sectional view of a card transport path ranging from the slit 40 to the IC card reader writer 50. The transport path is a slit defined between a pair of upper and lower guides 52 and 54. Transport roller pairs 55, ... are equidistantly disposed along the guides 52 and 54. The distance between the adjacent transport roller pairs 55 and 55 is equal to the length of the IC card as viewed in the card transport direction. With such an interval between the roller pairs, the card can be smoothly moved through the card transport path between the guides 52 and 54. The card issuing operation of the card issuing apparatus thus arranged will be given below. An operator as a card issuer inserts a new IC card, on which the zone access controller 22 has not yet written a zone access table, into the slit 38. Then, the IC card is put into the card issuing apparatus and transported therein until the connector 12 is connected to a terminal not shown of the IC card reader writer 50. When the connection is detected, the control circuit 48 directs the CRT monitor 32 to form a zone access table. More specifically, a zone No., a head address and a zone size in each zone are displayed on the CRT monitor 32 to request the operator to input an access person flag, a terminal flag, and an output condition flag. In response to the request, the operator inputs these flags. The flags as input are written, in the form of the above zone access table, into the zone access controller 22 of the IC card 10, through the CPU 42 and the IC card reader writer 50 in the card issuing apparatus, and the CPU 20 in the card 10. Upon completion of the programming of the zone access table, an operator writes a password of an issuer and an owner into a predetermined memory area of the zone access controller 22. At this point, the card issuing operation is completed. Generally, the IC card thus issued is owned by an owner, and is used at user terminals of banks e.g. automatic cash depositing withdrawing machine , for example, for depositing or withdrawing money. The user terminal also has, substantially, the same construction as that of the card issuing apparatus. The CPU of the user terminal is connected to a host computer through a data communication cable. At the user terminal, after insertion of the IC card, a password is input by an card owner. It is sequentially checked whether or not each zone is accessible by the user terminal and the owner. Then, only the accessible zones are open to use by the owner. As described above, the memory area of the IC card is segmented into a plurality of zones in the stage of its manufacture. In each zone, the access condition can be set at the time of card issuance. Therefore, the IC card has greater versatility in use. The access condition may include an assortment of access people and a type of user terminal device as well, or a combination of them. Therefore, protection of the data can be ensured. In addition to the access condition, the way of encryption or the presence or not of the encryption can also be set. In this respect, the portable data storing processing device of this embodiment has a good versatility in use. A second embodiment of a portable data storing processing device according to the present invention will be given. In the first embodiment, a password of the user must be given when the card is used. In the second embodiment, the IC card is usable with a terminal device requiring no password verification, that is, in cases where the access condition for each user is not necessary. This can be realized by modifying the zone access table as shown in Table 3. The bits D1, D2 and D3 of a password verification flag D respectively correspond to a card maker, a card issuer and a card owner, as in the case of the bits of the access person flag A. If the bits of the password verification flag D are 1 , the password verification for that person is required. If these are 0 , no password verification for that person is required. The items other than the password verification flag are the same as those in Table 1. In Table 3, indicates that either 0 or 1 is allowed for the bits. As seen from Table 3, the zones Nos. 1 to 3 require the inputting of a password since password verification must be performed. The zone No. 4 requires no password verification for any person. In issuing the IC card in this embodiment, the zone No., the head address, and the zone size for each zone are displayed by the CRT monitor 32 as in the first embodiment to call upon an operator as a card issuer to input an access person flag, a terminal flag, an output condition flag, and a password verification flag. The access person flag, the terminal flag, the output condition flag, and the password verification flag as input from the keyboard 30 are programmed into the zone access controller 22 in the form of the above mentioned zone access table, through the CPU 42, the IC card reader writer 50, and the CPU 20 in the card 10. The IC card requiring no password verification may be used as time cards for employees, tickets for playland, telephone cards, etc. If it is used as the ticket or telephone cards, the data representing a predetermined amount of money is stored in the memory. Every time it is accessed, the data of a necessary amount of money is subtracted from the previously stored data. In the above mentioned embodiments, individual EEPROMs are used for the memory and the zone access controller, respectively. A single EEPROM may be used for them. In this case, different addresses are assigned to them, respectively. Other memory components such as PROM, ROM, RAM, etc. may be used in place of the EEPROM. While the portable data storing processing device is shaped like a card in the above mentioned embodiments, the present invention may be embodied in a coin like configuration. Further, it is applicable for a ball point pen, a wrist watch, etc. Thus, any configuration is allowed for embodying the present invention, if it allows the portability of the device thus configured. As described above a memory area is segmented into a plurality of zones. In each zone, any access condition can be set. Therefore, the portable data storing processing device according to the present invention is versatile in use, and can reliably ensure data protection. This versatility allows a mass production of the portable data storing processing devices, thus resulting in a cost reduction of the devices.